{"version":3,"sources":["../src/index.ts","../node_modules/@mapbox/point-geometry/index.js","../node_modules/color2k/src/guard.ts","../node_modules/color2k/src/ColorError.ts","../node_modules/color2k/src/parseToRgba.ts","../node_modules/color2k/src/parseToHsla.ts","../node_modules/color2k/src/hsla.ts","../node_modules/color2k/src/adjustHue.ts","../node_modules/color2k/src/darken.ts","../node_modules/color2k/src/desaturate.ts","../node_modules/color2k/src/getLuminance.ts","../node_modules/color2k/src/getContrast.ts","../node_modules/color2k/src/rgba.ts","../node_modules/color2k/src/mix.ts","../node_modules/color2k/src/getScale.ts","../node_modules/color2k/src/hasBadContrast.ts","../node_modules/color2k/src/lighten.ts","../node_modules/color2k/src/transparentize.ts","../node_modules/color2k/src/opacify.ts","../node_modules/color2k/src/readableColorIsBlack.ts","../node_modules/color2k/src/readableColor.ts","../node_modules/color2k/src/saturate.ts","../node_modules/color2k/src/toHex.ts","../node_modules/color2k/src/toRgba.ts","../node_modules/color2k/src/toHsla.ts","../src/attribute.ts","../src/line.ts","../src/text.ts","../node_modules/@mapbox/vector-tile/index.js","../node_modules/pbf/index.js","../node_modules/pmtiles/dist/index.js","../src/tilecache.ts","../src/symbolizer.ts","../src/default_style/style.ts","../src/default_style/themes.ts","../node_modules/quickselect/index.js","../node_modules/rbush/index.js","../src/view.ts","../src/labeler.ts","../src/painter.ts","../src/frontends/static.ts","../src/frontends/leaflet.ts","../node_modules/potpack/index.mjs","../src/task.ts"],"sourcesContent":["export * from \"./frontends/static\";\nexport * from \"./frontends/leaflet\";\nexport * from \"./symbolizer\";\nexport * from \"./task\";\nexport * from \"./default_style/style\";\nexport * from \"./painter\";\nexport * from \"./tilecache\";\nexport * from \"./view\";\nexport * from \"./labeler\";\n","/**\n * A standalone point geometry with useful accessor, comparison, and\n * modification methods.\n *\n * @class\n * @param {number} x the x-coordinate. This could be longitude or screen pixels, or any other sort of unit.\n * @param {number} y the y-coordinate. This could be latitude or screen pixels, or any other sort of unit.\n *\n * @example\n * const point = new Point(-77, 38);\n */\nexport default function Point(x, y) {\n    this.x = x;\n    this.y = y;\n}\n\nPoint.prototype = {\n    /**\n     * Clone this point, returning a new point that can be modified\n     * without affecting the old one.\n     * @return {Point} the clone\n     */\n    clone() { return new Point(this.x, this.y); },\n\n    /**\n     * Add this point's x & y coordinates to another point,\n     * yielding a new point.\n     * @param {Point} p the other point\n     * @return {Point} output point\n     */\n    add(p) { return this.clone()._add(p); },\n\n    /**\n     * Subtract this point's x & y coordinates to from point,\n     * yielding a new point.\n     * @param {Point} p the other point\n     * @return {Point} output point\n     */\n    sub(p) { return this.clone()._sub(p); },\n\n    /**\n     * Multiply this point's x & y coordinates by point,\n     * yielding a new point.\n     * @param {Point} p the other point\n     * @return {Point} output point\n     */\n    multByPoint(p) { return this.clone()._multByPoint(p); },\n\n    /**\n     * Divide this point's x & y coordinates by point,\n     * yielding a new point.\n     * @param {Point} p the other point\n     * @return {Point} output point\n     */\n    divByPoint(p) { return this.clone()._divByPoint(p); },\n\n    /**\n     * Multiply this point's x & y coordinates by a factor,\n     * yielding a new point.\n     * @param {number} k factor\n     * @return {Point} output point\n     */\n    mult(k) { return this.clone()._mult(k); },\n\n    /**\n     * Divide this point's x & y coordinates by a factor,\n     * yielding a new point.\n     * @param {number} k factor\n     * @return {Point} output point\n     */\n    div(k) { return this.clone()._div(k); },\n\n    /**\n     * Rotate this point around the 0, 0 origin by an angle a,\n     * given in radians\n     * @param {number} a angle to rotate around, in radians\n     * @return {Point} output point\n     */\n    rotate(a) { return this.clone()._rotate(a); },\n\n    /**\n     * Rotate this point around p point by an angle a,\n     * given in radians\n     * @param {number} a angle to rotate around, in radians\n     * @param {Point} p Point to rotate around\n     * @return {Point} output point\n     */\n    rotateAround(a, p) { return this.clone()._rotateAround(a, p); },\n\n    /**\n     * Multiply this point by a 4x1 transformation matrix\n     * @param {[number, number, number, number]} m transformation matrix\n     * @return {Point} output point\n     */\n    matMult(m) { return this.clone()._matMult(m); },\n\n    /**\n     * Calculate this point but as a unit vector from 0, 0, meaning\n     * that the distance from the resulting point to the 0, 0\n     * coordinate will be equal to 1 and the angle from the resulting\n     * point to the 0, 0 coordinate will be the same as before.\n     * @return {Point} unit vector point\n     */\n    unit() { return this.clone()._unit(); },\n\n    /**\n     * Compute a perpendicular point, where the new y coordinate\n     * is the old x coordinate and the new x coordinate is the old y\n     * coordinate multiplied by -1\n     * @return {Point} perpendicular point\n     */\n    perp() { return this.clone()._perp(); },\n\n    /**\n     * Return a version of this point with the x & y coordinates\n     * rounded to integers.\n     * @return {Point} rounded point\n     */\n    round() { return this.clone()._round(); },\n\n    /**\n     * Return the magnitude of this point: this is the Euclidean\n     * distance from the 0, 0 coordinate to this point's x and y\n     * coordinates.\n     * @return {number} magnitude\n     */\n    mag() {\n        return Math.sqrt(this.x * this.x + this.y * this.y);\n    },\n\n    /**\n     * Judge whether this point is equal to another point, returning\n     * true or false.\n     * @param {Point} other the other point\n     * @return {boolean} whether the points are equal\n     */\n    equals(other) {\n        return this.x === other.x &&\n               this.y === other.y;\n    },\n\n    /**\n     * Calculate the distance from this point to another point\n     * @param {Point} p the other point\n     * @return {number} distance\n     */\n    dist(p) {\n        return Math.sqrt(this.distSqr(p));\n    },\n\n    /**\n     * Calculate the distance from this point to another point,\n     * without the square root step. Useful if you're comparing\n     * relative distances.\n     * @param {Point} p the other point\n     * @return {number} distance\n     */\n    distSqr(p) {\n        const dx = p.x - this.x,\n            dy = p.y - this.y;\n        return dx * dx + dy * dy;\n    },\n\n    /**\n     * Get the angle from the 0, 0 coordinate to this point, in radians\n     * coordinates.\n     * @return {number} angle\n     */\n    angle() {\n        return Math.atan2(this.y, this.x);\n    },\n\n    /**\n     * Get the angle from this point to another point, in radians\n     * @param {Point} b the other point\n     * @return {number} angle\n     */\n    angleTo(b) {\n        return Math.atan2(this.y - b.y, this.x - b.x);\n    },\n\n    /**\n     * Get the angle between this point and another point, in radians\n     * @param {Point} b the other point\n     * @return {number} angle\n     */\n    angleWith(b) {\n        return this.angleWithSep(b.x, b.y);\n    },\n\n    /**\n     * Find the angle of the two vectors, solving the formula for\n     * the cross product a x b = |a||b|sin(θ) for θ.\n     * @param {number} x the x-coordinate\n     * @param {number} y the y-coordinate\n     * @return {number} the angle in radians\n     */\n    angleWithSep(x, y) {\n        return Math.atan2(\n            this.x * y - this.y * x,\n            this.x * x + this.y * y);\n    },\n\n    /** @param {[number, number, number, number]} m */\n    _matMult(m) {\n        const x = m[0] * this.x + m[1] * this.y,\n            y = m[2] * this.x + m[3] * this.y;\n        this.x = x;\n        this.y = y;\n        return this;\n    },\n\n    /** @param {Point} p */\n    _add(p) {\n        this.x += p.x;\n        this.y += p.y;\n        return this;\n    },\n\n    /** @param {Point} p */\n    _sub(p) {\n        this.x -= p.x;\n        this.y -= p.y;\n        return this;\n    },\n\n    /** @param {number} k */\n    _mult(k) {\n        this.x *= k;\n        this.y *= k;\n        return this;\n    },\n\n    /** @param {number} k */\n    _div(k) {\n        this.x /= k;\n        this.y /= k;\n        return this;\n    },\n\n    /** @param {Point} p */\n    _multByPoint(p) {\n        this.x *= p.x;\n        this.y *= p.y;\n        return this;\n    },\n\n    /** @param {Point} p */\n    _divByPoint(p) {\n        this.x /= p.x;\n        this.y /= p.y;\n        return this;\n    },\n\n    _unit() {\n        this._div(this.mag());\n        return this;\n    },\n\n    _perp() {\n        const y = this.y;\n        this.y = this.x;\n        this.x = -y;\n        return this;\n    },\n\n    /** @param {number} angle */\n    _rotate(angle) {\n        const cos = Math.cos(angle),\n            sin = Math.sin(angle),\n            x = cos * this.x - sin * this.y,\n            y = sin * this.x + cos * this.y;\n        this.x = x;\n        this.y = y;\n        return this;\n    },\n\n    /**\n     * @param {number} angle\n     * @param {Point} p\n     */\n    _rotateAround(angle, p) {\n        const cos = Math.cos(angle),\n            sin = Math.sin(angle),\n            x = p.x + cos * (this.x - p.x) - sin * (this.y - p.y),\n            y = p.y + sin * (this.x - p.x) + cos * (this.y - p.y);\n        this.x = x;\n        this.y = y;\n        return this;\n    },\n\n    _round() {\n        this.x = Math.round(this.x);\n        this.y = Math.round(this.y);\n        return this;\n    },\n\n    constructor: Point\n};\n\n/**\n * Construct a point from an array if necessary, otherwise if the input\n * is already a Point, return it unchanged.\n * @param {Point | [number, number] | {x: number, y: number}} p input value\n * @return {Point} constructed point.\n * @example\n * // this\n * var point = Point.convert([0, 1]);\n * // is equivalent to\n * var point = new Point(0, 1);\n */\nPoint.convert = function (p) {\n    if (p instanceof Point) {\n        return /** @type {Point} */ (p);\n    }\n    if (Array.isArray(p)) {\n        return new Point(+p[0], +p[1]);\n    }\n    if (p.x !== undefined && p.y !== undefined) {\n        return new Point(+p.x, +p.y);\n    }\n    throw new Error('Expected [x, y] or {x, y} point format');\n};\n","/**\n * A simple guard function:\n *\n * ```js\n * Math.min(Math.max(low, value), high)\n * ```\n */\nfunction guard(low: number, high: number, value: number): number {\n  return Math.min(Math.max(low, value), high);\n}\n\nexport default guard;\n","class ColorError extends Error {\n  constructor(color: string) {\n    super(`Failed to parse color: \"${color}\"`);\n  }\n}\n\nexport default ColorError;\n","import guard from './guard';\nimport ColorError from './ColorError';\n\n/**\n * Parses a color into red, gree, blue, alpha parts\n *\n * @param color the input color. Can be a RGB, RBGA, HSL, HSLA, or named color\n */\nfunction parseToRgba(color: string): [number, number, number, number] {\n  if (typeof color !== 'string') throw new ColorError(color);\n  if (color.trim().toLowerCase() === 'transparent') return [0, 0, 0, 0];\n\n  let normalizedColor = color.trim();\n  normalizedColor = namedColorRegex.test(color) ? nameToHex(color) : color;\n\n  const reducedHexMatch = reducedHexRegex.exec(normalizedColor);\n  if (reducedHexMatch) {\n    const arr = Array.from(reducedHexMatch).slice(1);\n    return [\n      ...arr.slice(0, 3).map((x) => parseInt(r(x, 2), 16)),\n      parseInt(r(arr[3] || 'f', 2), 16) / 255,\n    ] as [number, number, number, number];\n  }\n\n  const hexMatch = hexRegex.exec(normalizedColor);\n  if (hexMatch) {\n    const arr = Array.from(hexMatch).slice(1);\n    return [\n      ...arr.slice(0, 3).map((x) => parseInt(x, 16)),\n      parseInt(arr[3] || 'ff', 16) / 255,\n    ] as [number, number, number, number];\n  }\n\n  const rgbaMatch = rgbaRegex.exec(normalizedColor);\n  if (rgbaMatch) {\n    const arr = Array.from(rgbaMatch).slice(1);\n    return [\n      ...arr.slice(0, 3).map((x) => parseInt(x, 10)),\n      parseFloat(arr[3] || '1'),\n    ] as [number, number, number, number];\n  }\n\n  const hslaMatch = hslaRegex.exec(normalizedColor);\n  if (hslaMatch) {\n    const [h, s, l, a] = Array.from(hslaMatch).slice(1).map(parseFloat);\n    if (guard(0, 100, s) !== s) throw new ColorError(color);\n    if (guard(0, 100, l) !== l) throw new ColorError(color);\n    return [...hslToRgb(h, s, l), Number.isNaN(a) ? 1 : a] as [\n      number,\n      number,\n      number,\n      number\n    ];\n  }\n\n  throw new ColorError(color);\n}\n\nfunction hash(str: string) {\n  let hash = 5381;\n  let i = str.length;\n\n  while (i) {\n    hash = (hash * 33) ^ str.charCodeAt(--i);\n  }\n\n  /* JavaScript does bitwise operations (like XOR, above) on 32-bit signed\n   * integers. Since we want the results to be always positive, convert the\n   * signed int to an unsigned by doing an unsigned bitshift. */\n  return (hash >>> 0) % 2341;\n}\n\nconst colorToInt = (x: string) => parseInt(x.replace(/_/g, ''), 36);\n\nconst compressedColorMap =\n  '1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm'\n    .split(' ')\n    .reduce((acc, next) => {\n      const key = colorToInt(next.substring(0, 3));\n      const hex = colorToInt(next.substring(3)).toString(16);\n\n      // NOTE: padStart could be used here but it breaks Node 6 compat\n      // https://github.com/ricokahler/color2k/issues/351\n      let prefix = '';\n      for (let i = 0; i < 6 - hex.length; i++) {\n        prefix += '0';\n      }\n\n      acc[key] = `${prefix}${hex}`;\n      return acc;\n    }, {} as { [key: string]: string });\n\n/**\n * Checks if a string is a CSS named color and returns its equivalent hex value, otherwise returns the original color.\n */\nfunction nameToHex(color: string): string {\n  const normalizedColorName = color.toLowerCase().trim();\n  const result = compressedColorMap[hash(normalizedColorName)];\n  if (!result) throw new ColorError(color);\n  return `#${result}`;\n}\n\nconst r = (str: string, amount: number) =>\n  Array.from(Array(amount))\n    .map(() => str)\n    .join('');\n\nconst reducedHexRegex = new RegExp(`^#${r('([a-f0-9])', 3)}([a-f0-9])?$`, 'i');\nconst hexRegex = new RegExp(`^#${r('([a-f0-9]{2})', 3)}([a-f0-9]{2})?$`, 'i');\nconst rgbaRegex = new RegExp(\n  `^rgba?\\\\(\\\\s*(\\\\d+)\\\\s*${r(\n    ',\\\\s*(\\\\d+)\\\\s*',\n    2\n  )}(?:,\\\\s*([\\\\d.]+))?\\\\s*\\\\)$`,\n  'i'\n);\nconst hslaRegex =\n  /^hsla?\\(\\s*([\\d.]+)\\s*,\\s*([\\d.]+)%\\s*,\\s*([\\d.]+)%(?:\\s*,\\s*([\\d.]+))?\\s*\\)$/i;\nconst namedColorRegex = /^[a-z]+$/i;\n\nconst roundColor = (color: number): number => {\n  return Math.round(color * 255);\n};\n\nconst hslToRgb = (\n  hue: number,\n  saturation: number,\n  lightness: number\n): [number, number, number] => {\n  let l = lightness / 100;\n  if (saturation === 0) {\n    // achromatic\n    return [l, l, l].map(roundColor) as [number, number, number];\n  }\n\n  // formulae from https://en.wikipedia.org/wiki/HSL_and_HSV\n  const huePrime = (((hue % 360) + 360) % 360) / 60;\n  const chroma = (1 - Math.abs(2 * l - 1)) * (saturation / 100);\n  const secondComponent = chroma * (1 - Math.abs((huePrime % 2) - 1));\n\n  let red = 0;\n  let green = 0;\n  let blue = 0;\n\n  if (huePrime >= 0 && huePrime < 1) {\n    red = chroma;\n    green = secondComponent;\n  } else if (huePrime >= 1 && huePrime < 2) {\n    red = secondComponent;\n    green = chroma;\n  } else if (huePrime >= 2 && huePrime < 3) {\n    green = chroma;\n    blue = secondComponent;\n  } else if (huePrime >= 3 && huePrime < 4) {\n    green = secondComponent;\n    blue = chroma;\n  } else if (huePrime >= 4 && huePrime < 5) {\n    red = secondComponent;\n    blue = chroma;\n  } else if (huePrime >= 5 && huePrime < 6) {\n    red = chroma;\n    blue = secondComponent;\n  }\n\n  const lightnessModification = l - chroma / 2;\n  const finalRed = red + lightnessModification;\n  const finalGreen = green + lightnessModification;\n  const finalBlue = blue + lightnessModification;\n\n  return [finalRed, finalGreen, finalBlue].map(roundColor) as [\n    number,\n    number,\n    number\n  ];\n};\n\nexport default parseToRgba;\n","// taken from:\n// https://github.com/styled-components/polished/blob/a23a6a2bb26802b3d922d9c3b67bac3f3a54a310/src/internalHelpers/_rgbToHsl.js\nimport parseToRgba from './parseToRgba';\n\n/**\n * Parses a color in hue, saturation, lightness, and the alpha channel.\n *\n * Hue is a number between 0 and 360, saturation, lightness, and alpha are\n * decimal percentages between 0 and 1\n */\nfunction parseToHsla(color: string): [number, number, number, number] {\n  const [red, green, blue, alpha] = parseToRgba(color).map((value, index) =>\n    // 3rd index is alpha channel which is already normalized\n    index === 3 ? value : value / 255\n  );\n\n  const max = Math.max(red, green, blue);\n  const min = Math.min(red, green, blue);\n  const lightness = (max + min) / 2;\n\n  // achromatic\n  if (max === min) return [0, 0, lightness, alpha];\n\n  const delta = max - min;\n  const saturation =\n    lightness > 0.5 ? delta / (2 - max - min) : delta / (max + min);\n\n  const hue =\n    60 *\n    (red === max\n      ? (green - blue) / delta + (green < blue ? 6 : 0)\n      : green === max\n      ? (blue - red) / delta + 2\n      : (red - green) / delta + 4);\n\n  return [hue, saturation, lightness, alpha];\n}\n\nexport default parseToHsla;\n","import guard from './guard';\n\n/**\n * Takes in hsla parts and constructs an hsla string\n *\n * @param hue The color circle (from 0 to 360) - 0 (or 360) is red, 120 is green, 240 is blue\n * @param saturation Percentage of saturation, given as a decimal between 0 and 1\n * @param lightness Percentage of lightness, given as a decimal between 0 and 1\n * @param alpha Percentage of opacity, given as a decimal between 0 and 1\n */\nfunction hsla(\n  hue: number,\n  saturation: number,\n  lightness: number,\n  alpha: number\n): string {\n  return `hsla(${(hue % 360).toFixed()}, ${guard(\n    0,\n    100,\n    saturation * 100\n  ).toFixed()}%, ${guard(0, 100, lightness * 100).toFixed()}%, ${parseFloat(\n    guard(0, 1, alpha).toFixed(3)\n  )})`;\n}\n\nexport default hsla;\n","import parseToHsla from './parseToHsla';\nimport hsla from './hsla';\n\n/**\n * Adjusts the current hue of the color by the given degrees. Wraps around when\n * over 360.\n *\n * @param color input color\n * @param degrees degrees to adjust the input color, accepts degree integers\n * (0 - 360) and wraps around on overflow\n */\nfunction adjustHue(color: string, degrees: number): string {\n  const [h, s, l, a] = parseToHsla(color);\n  return hsla(h + degrees, s, l, a);\n}\n\nexport default adjustHue;\n","import parseToHsla from './parseToHsla';\nimport hsla from './hsla';\n\n/**\n * Darkens using lightness. This is equivalent to subtracting the lightness\n * from the L in HSL.\n *\n * @param amount The amount to darken, given as a decimal between 0 and 1\n */\nfunction darken(color: string, amount: number): string {\n  const [hue, saturation, lightness, alpha] = parseToHsla(color);\n  return hsla(hue, saturation, lightness - amount, alpha);\n}\n\nexport default darken;\n","import parseToHsla from './parseToHsla';\nimport hsla from './hsla';\n\n/**\n * Desaturates the input color by the given amount via subtracting from the `s`\n * in `hsla`.\n *\n * @param amount The amount to desaturate, given as a decimal between 0 and 1\n */\nfunction desaturate(color: string, amount: number): string {\n  const [h, s, l, a] = parseToHsla(color);\n  return hsla(h, s - amount, l, a);\n}\n\nexport default desaturate;\n","import parseToRgba from './parseToRgba';\n// taken from:\n// https://github.com/styled-components/polished/blob/0764c982551b487469043acb56281b0358b3107b/src/color/getLuminance.js\n\n/**\n * Returns a number (float) representing the luminance of a color.\n */\nfunction getLuminance(color: string): number {\n  if (color === 'transparent') return 0;\n\n  function f(x: number) {\n    const channel = x / 255;\n    return channel <= 0.04045\n      ? channel / 12.92\n      : Math.pow(((channel + 0.055) / 1.055), 2.4);\n  }\n\n  const [r, g, b] = parseToRgba(color);\n  return 0.2126 * f(r) + 0.7152 * f(g) + 0.0722 * f(b);\n}\n\nexport default getLuminance;\n","// taken from:\n// https://github.com/styled-components/polished/blob/0764c982551b487469043acb56281b0358b3107b/src/color/getContrast.js\nimport getLuminance from './getLuminance';\n\n/**\n * Returns the contrast ratio between two colors based on\n * [W3's recommended equation for calculating contrast](http://www.w3.org/TR/WCAG20/#contrast-ratiodef).\n */\nfunction getContrast(color1: string, color2: string): number {\n  const luminance1 = getLuminance(color1);\n  const luminance2 = getLuminance(color2);\n\n  return luminance1 > luminance2\n    ? (luminance1 + 0.05) / (luminance2 + 0.05)\n    : (luminance2 + 0.05) / (luminance1 + 0.05);\n}\n\nexport default getContrast;\n","import guard from './guard';\n\n/**\n * Takes in rgba parts and returns an rgba string\n *\n * @param red The amount of red in the red channel, given in a number between 0 and 255 inclusive\n * @param green The amount of green in the red channel, given in a number between 0 and 255 inclusive\n * @param blue The amount of blue in the red channel, given in a number between 0 and 255 inclusive\n * @param alpha Percentage of opacity, given as a decimal between 0 and 1\n */\nfunction rgba(red: number, green: number, blue: number, alpha: number): string {\n  return `rgba(${guard(0, 255, red).toFixed()}, ${guard(\n    0,\n    255,\n    green\n  ).toFixed()}, ${guard(0, 255, blue).toFixed()}, ${parseFloat(\n    guard(0, 1, alpha).toFixed(3)\n  )})`;\n}\n\nexport default rgba;\n","import parseToRgba from './parseToRgba';\nimport rgba from './rgba';\n\n/**\n * Mixes two colors together. Taken from sass's implementation.\n */\nfunction mix(color1: string, color2: string, weight: number): string {\n  const normalize = (n: number, index: number) =>\n    // 3rd index is alpha channel which is already normalized\n    index === 3 ? n : n / 255;\n\n  const [r1, g1, b1, a1] = parseToRgba(color1).map(normalize);\n  const [r2, g2, b2, a2] = parseToRgba(color2).map(normalize);\n\n  // The formula is copied from the original Sass implementation:\n  // http://sass-lang.com/documentation/Sass/Script/Functions.html#mix-instance_method\n  const alphaDelta = a2 - a1;\n  const normalizedWeight = weight * 2 - 1;\n  const combinedWeight =\n    normalizedWeight * alphaDelta === -1\n      ? normalizedWeight\n      : normalizedWeight + alphaDelta / (1 + normalizedWeight * alphaDelta);\n  const weight2 = (combinedWeight + 1) / 2;\n  const weight1 = 1 - weight2;\n\n  const r = (r1 * weight1 + r2 * weight2) * 255;\n  const g = (g1 * weight1 + g2 * weight2) * 255;\n  const b = (b1 * weight1 + b2 * weight2) * 255;\n  const a = a2 * weight + a1 * (1 - weight);\n\n  return rgba(r, g, b, a);\n}\n\nexport default mix;\n","import mix from './mix';\nimport guard from './guard';\n\n/**\n * Given a series colors, this function will return a `scale(x)` function that\n * accepts a percentage as a decimal between 0 and 1 and returns the color at\n * that percentage in the scale.\n *\n * ```js\n * const scale = getScale('red', 'yellow', 'green');\n * console.log(scale(0)); // rgba(255, 0, 0, 1)\n * console.log(scale(0.5)); // rgba(255, 255, 0, 1)\n * console.log(scale(1)); // rgba(0, 128, 0, 1)\n * ```\n *\n * If you'd like to limit the domain and range like chroma-js, we recommend\n * wrapping scale again.\n *\n * ```js\n * const _scale = getScale('red', 'yellow', 'green');\n * const scale = x => _scale(x / 100);\n *\n * console.log(scale(0)); // rgba(255, 0, 0, 1)\n * console.log(scale(50)); // rgba(255, 255, 0, 1)\n * console.log(scale(100)); // rgba(0, 128, 0, 1)\n * ```\n */\nfunction getScale(...colors: string[]): (n: number) => string {\n  return (n) => {\n    const lastIndex = colors.length - 1;\n    const lowIndex = guard(0, lastIndex, Math.floor(n * lastIndex));\n    const highIndex = guard(0, lastIndex, Math.ceil(n * lastIndex));\n\n    const color1 = colors[lowIndex];\n    const color2 = colors[highIndex];\n\n    const unit = 1 / lastIndex;\n    const weight = (n - unit * lowIndex) / unit;\n\n    return mix(color1, color2, weight);\n  };\n}\n\nexport default getScale;\n","import getContrast from './getContrast';\n\nconst guidelines = {\n  decorative: 1.5,\n  readable: 3,\n  aa: 4.5,\n  aaa: 7,\n};\n\n/**\n * Returns whether or not a color has bad contrast against a background\n * according to a given standard.\n */\nfunction hasBadContrast(\n  color: string,\n  standard: 'decorative' | 'readable' | 'aa' | 'aaa' = 'aa',\n  background: string = '#fff'\n): boolean {\n  return getContrast(color, background) < guidelines[standard];\n}\n\nexport default hasBadContrast;\n","import darken from './darken';\n/**\n * Lightens a color by a given amount. This is equivalent to\n * `darken(color, -amount)`\n *\n * @param amount The amount to darken, given as a decimal between 0 and 1\n */\nfunction lighten(color: string, amount: number): string {\n  return darken(color, -amount);\n}\n\nexport default lighten;\n","import parseToRgba from './parseToRgba';\nimport rgba from './rgba';\n\n/**\n * Takes in a color and makes it more transparent by convert to `rgba` and\n * decreasing the amount in the alpha channel.\n *\n * @param amount The amount to increase the transparency by, given as a decimal between 0 and 1\n */\nfunction transparentize(color: string, amount: number): string {\n  const [r, g, b, a] = parseToRgba(color);\n  return rgba(r, g, b, a - amount);\n}\n\nexport default transparentize;\n","import transparentize from './transparentize';\n\n/**\n * Takes a color and un-transparentizes it. Equivalent to\n * `transparentize(color, -amount)`\n *\n * @param amount The amount to increase the opacity by, given as a decimal between 0 and 1\n */\nfunction opacify(color: string, amount: number): string {\n  return transparentize(color, -amount);\n}\n\nexport default opacify;\n","import getLuminance from './getLuminance';\n\n/**\n * An alternative function to `readableColor`. Returns whether or not the \n * readable color (i.e. the color to be place on top the input color) should be\n * black.\n */\nfunction readableColorIsBlack(color: string): boolean {\n  return getLuminance(color) > 0.179;\n}\n\nexport default readableColorIsBlack;\n","import readableColorIsBlack from './readableColorIsBlack';\n\n/**\n * Returns black or white for best contrast depending on the luminosity of the\n * given color.\n */\nfunction readableColor(color: string): string {\n  return readableColorIsBlack(color) ? '#000' : '#fff';\n}\n\nexport default readableColor;\n","import desaturate from './desaturate';\n\n/**\n * Saturates a color by converting it to `hsl` and increasing the saturation\n * amount. Equivalent to `desaturate(color, -amount)`\n * \n * @param color Input color\n * @param amount The amount to darken, given as a decimal between 0 and 1\n */\nfunction saturate(color: string, amount: number): string {\n  return desaturate(color, -amount);\n}\n\nexport default saturate;\n","import parseToRgba from './parseToRgba';\nimport guard from './guard';\n\n/**\n * Takes in any color and returns it as a hex code.\n */\nfunction toHex(color: string): string {\n  const [r, g, b, a] = parseToRgba(color);\n\n  let hex = (x: number) => {\n    const h = guard(0, 255, x).toString(16);\n    // NOTE: padStart could be used here but it breaks Node 6 compat\n    // https://github.com/ricokahler/color2k/issues/351\n    return h.length === 1 ? `0${h}` : h;\n  };\n\n  return `#${hex(r)}${hex(g)}${hex(b)}${a < 1 ? hex(Math.round(a * 255)) : ''}`;\n}\n\nexport default toHex;\n","import parseToRgba from './parseToRgba';\nimport rgba from './rgba';\n\n/**\n * Takes in any color and returns it as an rgba string.\n */\nfunction toRgba(color: string): string {\n  return rgba(...parseToRgba(color));\n}\n\nexport default toRgba;\n","import parseToHsla from './parseToHsla';\nimport hsla from './hsla';\n\n/**\n * Takes in any color and returns it as an hsla string.\n */\nfunction toHsla(color: string): string {\n  return hsla(...parseToHsla(color));\n}\n\nexport default toHsla;\n","import { Feature } from \"./tilecache\";\n\nexport type AttrOption<T> = T | ((z: number, f?: Feature) => T);\n\nexport class StringAttr<T extends string = string> {\n  str: AttrOption<T>;\n  perFeature: boolean;\n\n  constructor(c: AttrOption<T> | undefined, defaultValue: T) {\n    this.str = c ?? defaultValue;\n    this.perFeature = typeof this.str === \"function\" && this.str.length === 2;\n  }\n\n  public get(z: number, f?: Feature): T {\n    if (typeof this.str === \"function\") {\n      return this.str(z, f);\n    }\n    return this.str;\n  }\n}\n\nexport class NumberAttr {\n  value: AttrOption<number>;\n  perFeature: boolean;\n\n  constructor(c: AttrOption<number> | undefined, defaultValue = 1) {\n    this.value = c ?? defaultValue;\n    this.perFeature =\n      typeof this.value === \"function\" && this.value.length === 2;\n  }\n\n  public get(z: number, f?: Feature): number {\n    if (typeof this.value === \"function\") {\n      return this.value(z, f);\n    }\n    return this.value;\n  }\n}\n\nexport interface TextAttrOptions {\n  labelProps?: AttrOption<string[]>;\n  textTransform?: AttrOption<string>;\n}\n\nexport class TextAttr {\n  labelProps: AttrOption<string[]>;\n  textTransform?: AttrOption<string>;\n\n  constructor(options?: TextAttrOptions) {\n    this.labelProps = options?.labelProps ?? [\"name\"];\n    this.textTransform = options?.textTransform;\n  }\n\n  public get(z: number, f: Feature): string | undefined {\n    let retval: string | undefined;\n\n    let labelProps: string[];\n    if (typeof this.labelProps === \"function\") {\n      labelProps = this.labelProps(z, f);\n    } else {\n      labelProps = this.labelProps;\n    }\n    for (const property of labelProps) {\n      if (\n        Object.prototype.hasOwnProperty.call(f.props, property) &&\n        typeof f.props[property] === \"string\"\n      ) {\n        retval = f.props[property] as string;\n        break;\n      }\n    }\n    let transform: string | ((z: number, f: Feature) => string) | undefined;\n    if (typeof this.textTransform === \"function\") {\n      transform = this.textTransform(z, f);\n    } else {\n      transform = this.textTransform;\n    }\n    if (retval && transform === \"uppercase\") retval = retval.toUpperCase();\n    else if (retval && transform === \"lowercase\") retval = retval.toLowerCase();\n    else if (retval && transform === \"capitalize\") {\n      const wordsArray = retval.toLowerCase().split(\" \");\n      const capsArray = wordsArray.map((word: string) => {\n        return word[0].toUpperCase() + word.slice(1);\n      });\n      retval = capsArray.join(\" \");\n    }\n    return retval;\n  }\n}\n\nexport interface FontAttrOptions {\n  font?: AttrOption<string>;\n  fontFamily?: AttrOption<string>;\n  fontSize?: AttrOption<number>;\n  fontWeight?: AttrOption<number>;\n  fontStyle?: AttrOption<string>;\n}\n\nexport class FontAttr {\n  family?: AttrOption<string>;\n  size?: AttrOption<number>;\n  weight?: AttrOption<number>;\n  style?: AttrOption<string>;\n  font?: AttrOption<string>;\n\n  constructor(options?: FontAttrOptions) {\n    if (options?.font) {\n      this.font = options.font;\n    } else {\n      this.family = options?.fontFamily ?? \"sans-serif\";\n      this.size = options?.fontSize ?? 12;\n      this.weight = options?.fontWeight;\n      this.style = options?.fontStyle;\n    }\n  }\n\n  public get(z: number, f?: Feature) {\n    if (this.font) {\n      if (typeof this.font === \"function\") {\n        return this.font(z, f);\n      }\n      return this.font;\n    }\n    let style = \"\";\n    if (this.style) {\n      if (typeof this.style === \"function\") {\n        style = `${this.style(z, f)} `;\n      } else {\n        style = `${this.style} `;\n      }\n    }\n\n    let weight = \"\";\n    if (this.weight) {\n      if (typeof this.weight === \"function\") {\n        weight = `${this.weight(z, f)} `;\n      } else {\n        weight = `${this.weight} `;\n      }\n    }\n\n    let size: number | ((z: number, f: Feature) => number) | undefined;\n    if (typeof this.size === \"function\") {\n      size = this.size(z, f);\n    } else {\n      size = this.size;\n    }\n\n    let family: string | ((z: number, f: Feature) => string) | undefined;\n    if (typeof this.family === \"function\") {\n      family = this.family(z, f);\n    } else {\n      family = this.family;\n    }\n\n    return `${style}${weight}${size}px ${family}`;\n  }\n}\n\nexport class ArrayAttr<T = number> {\n  value: AttrOption<T[]>;\n  perFeature: boolean;\n\n  constructor(c: AttrOption<T[]>, defaultValue: T[] = []) {\n    this.value = c ?? defaultValue;\n    this.perFeature =\n      typeof this.value === \"function\" && this.value.length === 2;\n  }\n\n  public get(z: number, f?: Feature): T[] {\n    if (typeof this.value === \"function\") {\n      return this.value(z, f);\n    }\n    return this.value;\n  }\n}\n","import Point from \"@mapbox/point-geometry\";\n\nexport interface LabelableSegment {\n  length: number;\n  beginIndex: number;\n  beginDistance: number;\n  endIndex: number;\n  endDistance: number;\n}\n\n// code from https://github.com/naturalatlas/linelabel (Apache2)\nconst linelabel = (\n  pts: Point[],\n  maxAngleDelta: number,\n  targetLen: number,\n): LabelableSegment[] => {\n  const chunks = [];\n  let a: Point;\n  let b: Point;\n  let c: Point;\n  let i = 0;\n  let n = 0;\n  let d = 0;\n  let abmag = 0;\n  let bcmag = 0;\n  let abx = 0;\n  let aby = 0;\n  let bcx = 0;\n  let bcy = 0;\n  let dt = 0;\n  let iStart = 0;\n  let dStart = 0;\n\n  if (pts.length < 2) return [];\n  if (pts.length === 2) {\n    d = Math.sqrt((pts[1].x - pts[0].x) ** 2 + (pts[1].y - pts[0].y) ** 2);\n\n    return [\n      {\n        length: d,\n        beginIndex: 0,\n        beginDistance: 0,\n        endIndex: 2,\n        endDistance: d,\n      },\n    ];\n  }\n\n  abmag = Math.sqrt((pts[1].x - pts[0].x) ** 2 + (pts[1].y - pts[0].y) ** 2);\n  for (i = 1, n = pts.length - 1; i < n; i++) {\n    a = pts[i - 1];\n    b = pts[i];\n    c = pts[i + 1];\n    abx = b.x - a.x;\n    aby = b.y - a.y;\n    bcx = c.x - b.x;\n    bcy = c.y - b.y;\n    bcmag = Math.sqrt(bcx * bcx + bcy * bcy);\n    d += abmag;\n\n    dt = Math.acos((abx * bcx + aby * bcy) / (abmag * bcmag));\n    if (dt > maxAngleDelta || d - dStart > targetLen) {\n      chunks.push({\n        length: d - dStart,\n        beginDistance: dStart,\n        beginIndex: iStart,\n        endIndex: i + 1,\n        endDistance: d,\n      });\n      iStart = i;\n      dStart = d;\n    }\n    abmag = bcmag;\n  }\n\n  if (i - iStart > 0) {\n    chunks.push({\n      length: d - dStart + bcmag,\n      beginIndex: iStart,\n      beginDistance: dStart,\n      endIndex: i + 1,\n      endDistance: d + bcmag,\n    });\n  }\n  return chunks;\n};\n\nexport interface LabelCandidate {\n  start: Point;\n  end: Point;\n}\n\nexport function simpleLabel(\n  mls: Point[][],\n  minimum: number,\n  repeatDistance: number,\n  cellSize: number,\n): LabelCandidate[] {\n  const candidates = [];\n\n  for (const ls of mls) {\n    const segments = linelabel(ls, Math.PI / 45, minimum); // 4 degrees, close to a straight line\n    for (const segment of segments) {\n      if (segment.length >= minimum + cellSize) {\n        const start = new Point(\n          ls[segment.beginIndex].x,\n          ls[segment.beginIndex].y,\n        );\n        const end = ls[segment.endIndex - 1];\n        const normalized = new Point(\n          (end.x - start.x) / segment.length,\n          (end.y - start.y) / segment.length,\n        );\n\n        // offset from the start by cellSize to allow streets that meet at right angles\n        // to both be labeled.\n        for (\n          let i = cellSize;\n          i < segment.length - minimum;\n          i += repeatDistance\n        ) {\n          candidates.push({\n            start: start.add(normalized.mult(i)),\n            end: start.add(normalized.mult(i + minimum)),\n          });\n        }\n      }\n    }\n  }\n\n  return candidates;\n}\n\nexport function lineCells(a: Point, b: Point, length: number, spacing: number) {\n  // determine function of line\n  const dx = b.x - a.x;\n  const dy = b.y - a.y;\n  const dist = Math.sqrt((b.x - a.x) ** 2 + (b.y - a.y) ** 2);\n\n  const retval = [];\n  // starting from the anchor, generate square cells,\n  // guaranteeing to cover the endpoint\n  for (let i = 0; i < length + spacing; i += 2 * spacing) {\n    const factor = (i * 1) / dist;\n    retval.push({ x: a.x + factor * dx, y: a.y + factor * dy });\n  }\n  return retval;\n}\n","// TODO should be visual length in pixels, not strlen\nexport function linebreak(str: string, maxUnits: number): string[] {\n  if (str.length <= maxUnits) return [str];\n  const endIndex = maxUnits - 1;\n  const spaceBefore = str.lastIndexOf(\" \", endIndex);\n  const spaceAfter = str.indexOf(\" \", endIndex);\n  if (spaceBefore === -1 && spaceAfter === -1) {\n    return [str];\n  }\n  let first: string;\n  let after: string;\n  if (\n    spaceAfter === -1 ||\n    (spaceBefore >= 0 && endIndex - spaceBefore < spaceAfter - endIndex)\n  ) {\n    first = str.substring(0, spaceBefore);\n    after = str.substring(spaceBefore + 1, str.length);\n  } else {\n    first = str.substring(0, spaceAfter);\n    after = str.substring(spaceAfter + 1, str.length);\n  }\n  return [first, ...linebreak(after, maxUnits)];\n}\n\nconst CJK_CHARS =\n  \"\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3220-\\u3229\\u3248-\\u324F\\u3251-\\u325F\\u3280-\\u3289\\u32B1-\\u32BF\\u3400-\\u4DB5\\u4E00-\\u9FEA\\uF900-\\uFA6D\\uFA70-\\uFAD9\\u2000\";\nconst cjkTest = new RegExp(`^[${CJK_CHARS}]+$`);\n\nexport function isCjk(s: string) {\n  return cjkTest.test(s);\n}\n","\nimport Point from '@mapbox/point-geometry';\n\n/** @import Pbf from 'pbf' */\n/** @import {Feature} from 'geojson' */\n\nexport class VectorTileFeature {\n    /**\n     * @param {Pbf} pbf\n     * @param {number} end\n     * @param {number} extent\n     * @param {string[]} keys\n     * @param {unknown[]} values\n     */\n    constructor(pbf, end, extent, keys, values) {\n        // Public\n\n        /** @type {Record<string, unknown>} */\n        this.properties = {};\n\n        this.extent = extent;\n        /** @type {0 | 1 | 2 | 3} */\n        this.type = 0;\n\n        /** @type {number | undefined} */\n        this.id = undefined;\n\n        this._pbf = pbf;\n        this._geometry = -1;\n        this._keys = keys;\n        this._values = values;\n\n        pbf.readFields(readFeature, this, end);\n    }\n\n    loadGeometry() {\n        const pbf = this._pbf;\n        pbf.pos = this._geometry;\n\n        const end = pbf.readVarint() + pbf.pos;\n\n        /** @type Point[][] */\n        const lines = [];\n\n        /** @type Point[] | undefined */\n        let line;\n\n        let cmd = 1;\n        let length = 0;\n        let x = 0;\n        let y = 0;\n\n        while (pbf.pos < end) {\n            if (length <= 0) {\n                const cmdLen = pbf.readVarint();\n                cmd = cmdLen & 0x7;\n                length = cmdLen >> 3;\n            }\n\n            length--;\n\n            if (cmd === 1 || cmd === 2) {\n                x += pbf.readSVarint();\n                y += pbf.readSVarint();\n\n                if (cmd === 1) { // moveTo\n                    if (line) lines.push(line);\n                    line = [];\n                }\n\n                if (line) line.push(new Point(x, y));\n\n            } else if (cmd === 7) {\n\n                // Workaround for https://github.com/mapbox/mapnik-vector-tile/issues/90\n                if (line) {\n                    line.push(line[0].clone()); // closePolygon\n                }\n\n            } else {\n                throw new Error(`unknown command ${cmd}`);\n            }\n        }\n\n        if (line) lines.push(line);\n\n        return lines;\n    }\n\n    bbox() {\n        const pbf = this._pbf;\n        pbf.pos = this._geometry;\n\n        const end = pbf.readVarint() + pbf.pos;\n        let cmd = 1,\n            length = 0,\n            x = 0,\n            y = 0,\n            x1 = Infinity,\n            x2 = -Infinity,\n            y1 = Infinity,\n            y2 = -Infinity;\n\n        while (pbf.pos < end) {\n            if (length <= 0) {\n                const cmdLen = pbf.readVarint();\n                cmd = cmdLen & 0x7;\n                length = cmdLen >> 3;\n            }\n\n            length--;\n\n            if (cmd === 1 || cmd === 2) {\n                x += pbf.readSVarint();\n                y += pbf.readSVarint();\n                if (x < x1) x1 = x;\n                if (x > x2) x2 = x;\n                if (y < y1) y1 = y;\n                if (y > y2) y2 = y;\n\n            } else if (cmd !== 7) {\n                throw new Error(`unknown command ${cmd}`);\n            }\n        }\n\n        return [x1, y1, x2, y2];\n    }\n\n    /**\n     * @param {number} x\n     * @param {number} y\n     * @param {number} z\n     * @return {Feature}\n     */\n    toGeoJSON(x, y, z) {\n        const size = this.extent * Math.pow(2, z),\n            x0 = this.extent * x,\n            y0 = this.extent * y,\n            vtCoords = this.loadGeometry();\n\n        /** @param {Point} p */\n        function projectPoint(p) {\n            return [\n                (p.x + x0) * 360 / size - 180,\n                360 / Math.PI * Math.atan(Math.exp((1 - (p.y + y0) * 2 / size) * Math.PI)) - 90\n            ];\n        }\n\n        /** @param {Point[]} line */\n        function projectLine(line) {\n            return line.map(projectPoint);\n        }\n\n        /** @type {Feature[\"geometry\"]} */\n        let geometry;\n\n        if (this.type === 1) {\n            const points = [];\n            for (const line of vtCoords) {\n                points.push(line[0]);\n            }\n            const coordinates = projectLine(points);\n            geometry = points.length === 1 ?\n                {type: 'Point', coordinates: coordinates[0]} :\n                {type: 'MultiPoint', coordinates};\n\n        } else if (this.type === 2) {\n\n            const coordinates = vtCoords.map(projectLine);\n            geometry = coordinates.length === 1 ?\n                {type: 'LineString', coordinates: coordinates[0]} :\n                {type: 'MultiLineString', coordinates};\n\n        } else if (this.type === 3) {\n            const polygons = classifyRings(vtCoords);\n            const coordinates = [];\n            for (const polygon of polygons) {\n                coordinates.push(polygon.map(projectLine));\n            }\n            geometry = coordinates.length === 1 ?\n                {type: 'Polygon', coordinates: coordinates[0]} :\n                {type: 'MultiPolygon', coordinates};\n        } else {\n\n            throw new Error('unknown feature type');\n        }\n\n        /** @type {Feature} */\n        const result = {\n            type: 'Feature',\n            geometry,\n            properties: this.properties\n        };\n\n        if (this.id != null) {\n            result.id = this.id;\n        }\n\n        return result;\n    }\n}\n\n/** @type {['Unknown', 'Point', 'LineString', 'Polygon']} */\nVectorTileFeature.types = ['Unknown', 'Point', 'LineString', 'Polygon'];\n\n/**\n * @param {number} tag\n * @param {VectorTileFeature} feature\n * @param {Pbf} pbf\n */\nfunction readFeature(tag, feature, pbf) {\n    if (tag === 1) feature.id = pbf.readVarint();\n    else if (tag === 2) readTag(pbf, feature);\n    else if (tag === 3) feature.type = /** @type {0 | 1 | 2 | 3} */ (pbf.readVarint());\n    else if (tag === 4) feature._geometry = pbf.pos;\n}\n\n/**\n * @param {Pbf} pbf\n * @param {VectorTileFeature} feature\n */\nfunction readTag(pbf, feature) {\n    const end = pbf.readVarint() + pbf.pos;\n\n    while (pbf.pos < end) {\n        const key = feature._keys[pbf.readVarint()],\n            value = feature._values[pbf.readVarint()];\n        feature.properties[key] = value;\n    }\n}\n\n/** classifies an array of rings into polygons with outer rings and holes\n * @param {Point[][]} rings\n */\nexport function classifyRings(rings) {\n    const len = rings.length;\n\n    if (len <= 1) return [rings];\n\n    const polygons = [];\n    let polygon, ccw;\n\n    for (let i = 0; i < len; i++) {\n        const area = signedArea(rings[i]);\n        if (area === 0) continue;\n\n        if (ccw === undefined) ccw = area < 0;\n\n        if (ccw === area < 0) {\n            if (polygon) polygons.push(polygon);\n            polygon = [rings[i]];\n\n        } else if (polygon) {\n            polygon.push(rings[i]);\n        }\n    }\n    if (polygon) polygons.push(polygon);\n\n    return polygons;\n}\n\n/** @param {Point[]} ring */\nfunction signedArea(ring) {\n    let sum = 0;\n    for (let i = 0, len = ring.length, j = len - 1, p1, p2; i < len; j = i++) {\n        p1 = ring[i];\n        p2 = ring[j];\n        sum += (p2.x - p1.x) * (p1.y + p2.y);\n    }\n    return sum;\n}\n\nexport class VectorTileLayer {\n    /**\n     * @param {Pbf} pbf\n     * @param {number} [end]\n     */\n    constructor(pbf, end) {\n        // Public\n        this.version = 1;\n        this.name = '';\n        this.extent = 4096;\n        this.length = 0;\n\n        // Private\n        this._pbf = pbf;\n\n        /** @type {string[]} */\n        this._keys = [];\n\n        /** @type {unknown[]} */\n        this._values = [];\n\n        /** @type {number[]} */\n        this._features = [];\n\n        pbf.readFields(readLayer, this, end);\n\n        this.length = this._features.length;\n    }\n\n    /** return feature `i` from this layer as a `VectorTileFeature`\n     * @param {number} i\n     */\n    feature(i) {\n        if (i < 0 || i >= this._features.length) throw new Error('feature index out of bounds');\n\n        this._pbf.pos = this._features[i];\n\n        const end = this._pbf.readVarint() + this._pbf.pos;\n        return new VectorTileFeature(this._pbf, end, this.extent, this._keys, this._values);\n    }\n}\n\n/**\n * @param {number} tag\n * @param {VectorTileLayer} layer\n * @param {Pbf} pbf\n */\nfunction readLayer(tag, layer, pbf) {\n    if (tag === 15) layer.version = pbf.readVarint();\n    else if (tag === 1) layer.name = pbf.readString();\n    else if (tag === 5) layer.extent = pbf.readVarint();\n    else if (tag === 2) layer._features.push(pbf.pos);\n    else if (tag === 3) layer._keys.push(pbf.readString());\n    else if (tag === 4) layer._values.push(readValueMessage(pbf));\n}\n\n/**\n * @param {Pbf} pbf\n */\nfunction readValueMessage(pbf) {\n    let value = null;\n    const end = pbf.readVarint() + pbf.pos;\n\n    while (pbf.pos < end) {\n        const tag = pbf.readVarint() >> 3;\n\n        value = tag === 1 ? pbf.readString() :\n            tag === 2 ? pbf.readFloat() :\n            tag === 3 ? pbf.readDouble() :\n            tag === 4 ? pbf.readVarint64() :\n            tag === 5 ? pbf.readVarint() :\n            tag === 6 ? pbf.readSVarint() :\n            tag === 7 ? pbf.readBoolean() : null;\n    }\n\n    return value;\n}\n\nexport class VectorTile {\n    /**\n     * @param {Pbf} pbf\n     * @param {number} [end]\n     */\n    constructor(pbf, end) {\n        /** @type {Record<string, VectorTileLayer>} */\n        this.layers = pbf.readFields(readTile, {}, end);\n    }\n}\n\n/**\n * @param {number} tag\n * @param {Record<string, VectorTileLayer>} layers\n * @param {Pbf} pbf\n */\nfunction readTile(tag, layers, pbf) {\n    if (tag === 3) {\n        const layer = new VectorTileLayer(pbf, pbf.readVarint() + pbf.pos);\n        if (layer.length) layers[layer.name] = layer;\n    }\n}\n","\nconst SHIFT_LEFT_32 = (1 << 16) * (1 << 16);\nconst SHIFT_RIGHT_32 = 1 / SHIFT_LEFT_32;\n\n// Threshold chosen based on both benchmarking and knowledge about browser string\n// data structures (which currently switch structure types at 12 bytes or more)\nconst TEXT_DECODER_MIN_LENGTH = 12;\nconst utf8TextDecoder = typeof TextDecoder === 'undefined' ? null : new TextDecoder('utf-8');\n\nconst PBF_VARINT  = 0; // varint: int32, int64, uint32, uint64, sint32, sint64, bool, enum\nconst PBF_FIXED64 = 1; // 64-bit: double, fixed64, sfixed64\nconst PBF_BYTES   = 2; // length-delimited: string, bytes, embedded messages, packed repeated fields\nconst PBF_FIXED32 = 5; // 32-bit: float, fixed32, sfixed32\n\nexport default class Pbf {\n    /**\n     * @param {Uint8Array | ArrayBuffer} [buf]\n     */\n    constructor(buf = new Uint8Array(16)) {\n        this.buf = ArrayBuffer.isView(buf) ? buf : new Uint8Array(buf);\n        this.dataView = new DataView(this.buf.buffer);\n        this.pos = 0;\n        this.type = 0;\n        this.length = this.buf.length;\n    }\n\n    // === READING =================================================================\n\n    /**\n     * @template T\n     * @param {(tag: number, result: T, pbf: Pbf) => void} readField\n     * @param {T} result\n     * @param {number} [end]\n     */\n    readFields(readField, result, end = this.length) {\n        while (this.pos < end) {\n            const val = this.readVarint(),\n                tag = val >> 3,\n                startPos = this.pos;\n\n            this.type = val & 0x7;\n            readField(tag, result, this);\n\n            if (this.pos === startPos) this.skip(val);\n        }\n        return result;\n    }\n\n    /**\n     * @template T\n     * @param {(tag: number, result: T, pbf: Pbf) => void} readField\n     * @param {T} result\n     */\n    readMessage(readField, result) {\n        return this.readFields(readField, result, this.readVarint() + this.pos);\n    }\n\n    readFixed32() {\n        const val = this.dataView.getUint32(this.pos, true);\n        this.pos += 4;\n        return val;\n    }\n\n    readSFixed32() {\n        const val = this.dataView.getInt32(this.pos, true);\n        this.pos += 4;\n        return val;\n    }\n\n    // 64-bit int handling is based on github.com/dpw/node-buffer-more-ints (MIT-licensed)\n\n    readFixed64() {\n        const val = this.dataView.getUint32(this.pos, true) + this.dataView.getUint32(this.pos + 4, true) * SHIFT_LEFT_32;\n        this.pos += 8;\n        return val;\n    }\n\n    readSFixed64() {\n        const val = this.dataView.getUint32(this.pos, true) + this.dataView.getInt32(this.pos + 4, true) * SHIFT_LEFT_32;\n        this.pos += 8;\n        return val;\n    }\n\n    readFloat() {\n        const val = this.dataView.getFloat32(this.pos, true);\n        this.pos += 4;\n        return val;\n    }\n\n    readDouble() {\n        const val = this.dataView.getFloat64(this.pos, true);\n        this.pos += 8;\n        return val;\n    }\n\n    /**\n     * @param {boolean} [isSigned]\n     */\n    readVarint(isSigned) {\n        const buf = this.buf;\n        let val, b;\n\n        b = buf[this.pos++]; val  =  b & 0x7f;        if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 7;  if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 14; if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 21; if (b < 0x80) return val;\n        b = buf[this.pos];   val |= (b & 0x0f) << 28;\n\n        return readVarintRemainder(val, isSigned, this);\n    }\n\n    readVarint64() { // for compatibility with v2.0.1\n        return this.readVarint(true);\n    }\n\n    readSVarint() {\n        const num = this.readVarint();\n        return num % 2 === 1 ? (num + 1) / -2 : num / 2; // zigzag encoding\n    }\n\n    readBoolean() {\n        return Boolean(this.readVarint());\n    }\n\n    readString() {\n        const end = this.readVarint() + this.pos;\n        const pos = this.pos;\n        this.pos = end;\n\n        if (end - pos >= TEXT_DECODER_MIN_LENGTH && utf8TextDecoder) {\n            // longer strings are fast with the built-in browser TextDecoder API\n            return utf8TextDecoder.decode(this.buf.subarray(pos, end));\n        }\n        // short strings are fast with our custom implementation\n        return readUtf8(this.buf, pos, end);\n    }\n\n    readBytes() {\n        const end = this.readVarint() + this.pos,\n            buffer = this.buf.subarray(this.pos, end);\n        this.pos = end;\n        return buffer;\n    }\n\n    // verbose for performance reasons; doesn't affect gzipped size\n\n    /**\n     * @param {number[]} [arr]\n     * @param {boolean} [isSigned]\n     */\n    readPackedVarint(arr = [], isSigned) {\n        const end = this.readPackedEnd();\n        while (this.pos < end) arr.push(this.readVarint(isSigned));\n        return arr;\n    }\n    /** @param {number[]} [arr] */\n    readPackedSVarint(arr = []) {\n        const end = this.readPackedEnd();\n        while (this.pos < end) arr.push(this.readSVarint());\n        return arr;\n    }\n    /** @param {boolean[]} [arr] */\n    readPackedBoolean(arr = []) {\n        const end = this.readPackedEnd();\n        while (this.pos < end) arr.push(this.readBoolean());\n        return arr;\n    }\n    /** @param {number[]} [arr] */\n    readPackedFloat(arr = []) {\n        const end = this.readPackedEnd();\n        while (this.pos < end) arr.push(this.readFloat());\n        return arr;\n    }\n    /** @param {number[]} [arr] */\n    readPackedDouble(arr = []) {\n        const end = this.readPackedEnd();\n        while (this.pos < end) arr.push(this.readDouble());\n        return arr;\n    }\n    /** @param {number[]} [arr] */\n    readPackedFixed32(arr = []) {\n        const end = this.readPackedEnd();\n        while (this.pos < end) arr.push(this.readFixed32());\n        return arr;\n    }\n    /** @param {number[]} [arr] */\n    readPackedSFixed32(arr = []) {\n        const end = this.readPackedEnd();\n        while (this.pos < end) arr.push(this.readSFixed32());\n        return arr;\n    }\n    /** @param {number[]} [arr] */\n    readPackedFixed64(arr = []) {\n        const end = this.readPackedEnd();\n        while (this.pos < end) arr.push(this.readFixed64());\n        return arr;\n    }\n    /** @param {number[]} [arr] */\n    readPackedSFixed64(arr = []) {\n        const end = this.readPackedEnd();\n        while (this.pos < end) arr.push(this.readSFixed64());\n        return arr;\n    }\n    readPackedEnd() {\n        return this.type === PBF_BYTES ? this.readVarint() + this.pos : this.pos + 1;\n    }\n\n    /** @param {number} val */\n    skip(val) {\n        const type = val & 0x7;\n        if (type === PBF_VARINT) while (this.buf[this.pos++] > 0x7f) {}\n        else if (type === PBF_BYTES) this.pos = this.readVarint() + this.pos;\n        else if (type === PBF_FIXED32) this.pos += 4;\n        else if (type === PBF_FIXED64) this.pos += 8;\n        else throw new Error(`Unimplemented type: ${type}`);\n    }\n\n    // === WRITING =================================================================\n\n    /**\n     * @param {number} tag\n     * @param {number} type\n     */\n    writeTag(tag, type) {\n        this.writeVarint((tag << 3) | type);\n    }\n\n    /** @param {number} min */\n    realloc(min) {\n        let length = this.length || 16;\n\n        while (length < this.pos + min) length *= 2;\n\n        if (length !== this.length) {\n            const buf = new Uint8Array(length);\n            buf.set(this.buf);\n            this.buf = buf;\n            this.dataView = new DataView(buf.buffer);\n            this.length = length;\n        }\n    }\n\n    finish() {\n        this.length = this.pos;\n        this.pos = 0;\n        return this.buf.subarray(0, this.length);\n    }\n\n    /** @param {number} val */\n    writeFixed32(val) {\n        this.realloc(4);\n        this.dataView.setInt32(this.pos, val, true);\n        this.pos += 4;\n    }\n\n    /** @param {number} val */\n    writeSFixed32(val) {\n        this.realloc(4);\n        this.dataView.setInt32(this.pos, val, true);\n        this.pos += 4;\n    }\n\n    /** @param {number} val */\n    writeFixed64(val) {\n        this.realloc(8);\n        this.dataView.setInt32(this.pos, val & -1, true);\n        this.dataView.setInt32(this.pos + 4, Math.floor(val * SHIFT_RIGHT_32), true);\n        this.pos += 8;\n    }\n\n    /** @param {number} val */\n    writeSFixed64(val) {\n        this.realloc(8);\n        this.dataView.setInt32(this.pos, val & -1, true);\n        this.dataView.setInt32(this.pos + 4, Math.floor(val * SHIFT_RIGHT_32), true);\n        this.pos += 8;\n    }\n\n    /** @param {number} val */\n    writeVarint(val) {\n        val = +val || 0;\n\n        if (val > 0xfffffff || val < 0) {\n            writeBigVarint(val, this);\n            return;\n        }\n\n        this.realloc(4);\n\n        this.buf[this.pos++] =           val & 0x7f  | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] = ((val >>>= 7) & 0x7f) | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] = ((val >>>= 7) & 0x7f) | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] =   (val >>> 7) & 0x7f;\n    }\n\n    /** @param {number} val */\n    writeSVarint(val) {\n        this.writeVarint(val < 0 ? -val * 2 - 1 : val * 2);\n    }\n\n    /** @param {boolean} val */\n    writeBoolean(val) {\n        this.writeVarint(+val);\n    }\n\n    /** @param {string} str */\n    writeString(str) {\n        str = String(str);\n        this.realloc(str.length * 4);\n\n        this.pos++; // reserve 1 byte for short string length\n\n        const startPos = this.pos;\n        // write the string directly to the buffer and see how much was written\n        this.pos = writeUtf8(this.buf, str, this.pos);\n        const len = this.pos - startPos;\n\n        if (len >= 0x80) makeRoomForExtraLength(startPos, len, this);\n\n        // finally, write the message length in the reserved place and restore the position\n        this.pos = startPos - 1;\n        this.writeVarint(len);\n        this.pos += len;\n    }\n\n    /** @param {number} val */\n    writeFloat(val) {\n        this.realloc(4);\n        this.dataView.setFloat32(this.pos, val, true);\n        this.pos += 4;\n    }\n\n    /** @param {number} val */\n    writeDouble(val) {\n        this.realloc(8);\n        this.dataView.setFloat64(this.pos, val, true);\n        this.pos += 8;\n    }\n\n    /** @param {Uint8Array} buffer */\n    writeBytes(buffer) {\n        const len = buffer.length;\n        this.writeVarint(len);\n        this.realloc(len);\n        for (let i = 0; i < len; i++) this.buf[this.pos++] = buffer[i];\n    }\n\n    /**\n     * @template T\n     * @param {(obj: T, pbf: Pbf) => void} fn\n     * @param {T} obj\n     */\n    writeRawMessage(fn, obj) {\n        this.pos++; // reserve 1 byte for short message length\n\n        // write the message directly to the buffer and see how much was written\n        const startPos = this.pos;\n        fn(obj, this);\n        const len = this.pos - startPos;\n\n        if (len >= 0x80) makeRoomForExtraLength(startPos, len, this);\n\n        // finally, write the message length in the reserved place and restore the position\n        this.pos = startPos - 1;\n        this.writeVarint(len);\n        this.pos += len;\n    }\n\n    /**\n     * @template T\n     * @param {number} tag\n     * @param {(obj: T, pbf: Pbf) => void} fn\n     * @param {T} obj\n     */\n    writeMessage(tag, fn, obj) {\n        this.writeTag(tag, PBF_BYTES);\n        this.writeRawMessage(fn, obj);\n    }\n\n    /**\n     * @param {number} tag\n     * @param {number[]} arr\n     */\n    writePackedVarint(tag, arr) {\n        if (arr.length) this.writeMessage(tag, writePackedVarint, arr);\n    }\n    /**\n     * @param {number} tag\n     * @param {number[]} arr\n     */\n    writePackedSVarint(tag, arr) {\n        if (arr.length) this.writeMessage(tag, writePackedSVarint, arr);\n    }\n    /**\n     * @param {number} tag\n     * @param {boolean[]} arr\n     */\n    writePackedBoolean(tag, arr) {\n        if (arr.length) this.writeMessage(tag, writePackedBoolean, arr);\n    }\n    /**\n     * @param {number} tag\n     * @param {number[]} arr\n     */\n    writePackedFloat(tag, arr) {\n        if (arr.length) this.writeMessage(tag, writePackedFloat, arr);\n    }\n    /**\n     * @param {number} tag\n     * @param {number[]} arr\n     */\n    writePackedDouble(tag, arr) {\n        if (arr.length) this.writeMessage(tag, writePackedDouble, arr);\n    }\n    /**\n     * @param {number} tag\n     * @param {number[]} arr\n     */\n    writePackedFixed32(tag, arr) {\n        if (arr.length) this.writeMessage(tag, writePackedFixed32, arr);\n    }\n    /**\n     * @param {number} tag\n     * @param {number[]} arr\n     */\n    writePackedSFixed32(tag, arr) {\n        if (arr.length) this.writeMessage(tag, writePackedSFixed32, arr);\n    }\n    /**\n     * @param {number} tag\n     * @param {number[]} arr\n     */\n    writePackedFixed64(tag, arr) {\n        if (arr.length) this.writeMessage(tag, writePackedFixed64, arr);\n    }\n    /**\n     * @param {number} tag\n     * @param {number[]} arr\n     */\n    writePackedSFixed64(tag, arr) {\n        if (arr.length) this.writeMessage(tag, writePackedSFixed64, arr);\n    }\n\n    /**\n     * @param {number} tag\n     * @param {Uint8Array} buffer\n     */\n    writeBytesField(tag, buffer) {\n        this.writeTag(tag, PBF_BYTES);\n        this.writeBytes(buffer);\n    }\n    /**\n     * @param {number} tag\n     * @param {number} val\n     */\n    writeFixed32Field(tag, val) {\n        this.writeTag(tag, PBF_FIXED32);\n        this.writeFixed32(val);\n    }\n    /**\n     * @param {number} tag\n     * @param {number} val\n     */\n    writeSFixed32Field(tag, val) {\n        this.writeTag(tag, PBF_FIXED32);\n        this.writeSFixed32(val);\n    }\n    /**\n     * @param {number} tag\n     * @param {number} val\n     */\n    writeFixed64Field(tag, val) {\n        this.writeTag(tag, PBF_FIXED64);\n        this.writeFixed64(val);\n    }\n    /**\n     * @param {number} tag\n     * @param {number} val\n     */\n    writeSFixed64Field(tag, val) {\n        this.writeTag(tag, PBF_FIXED64);\n        this.writeSFixed64(val);\n    }\n    /**\n     * @param {number} tag\n     * @param {number} val\n     */\n    writeVarintField(tag, val) {\n        this.writeTag(tag, PBF_VARINT);\n        this.writeVarint(val);\n    }\n    /**\n     * @param {number} tag\n     * @param {number} val\n     */\n    writeSVarintField(tag, val) {\n        this.writeTag(tag, PBF_VARINT);\n        this.writeSVarint(val);\n    }\n    /**\n     * @param {number} tag\n     * @param {string} str\n     */\n    writeStringField(tag, str) {\n        this.writeTag(tag, PBF_BYTES);\n        this.writeString(str);\n    }\n    /**\n     * @param {number} tag\n     * @param {number} val\n     */\n    writeFloatField(tag, val) {\n        this.writeTag(tag, PBF_FIXED32);\n        this.writeFloat(val);\n    }\n    /**\n     * @param {number} tag\n     * @param {number} val\n     */\n    writeDoubleField(tag, val) {\n        this.writeTag(tag, PBF_FIXED64);\n        this.writeDouble(val);\n    }\n    /**\n     * @param {number} tag\n     * @param {boolean} val\n     */\n    writeBooleanField(tag, val) {\n        this.writeVarintField(tag, +val);\n    }\n};\n\n/**\n * @param {number} l\n * @param {boolean | undefined} s\n * @param {Pbf} p\n */\nfunction readVarintRemainder(l, s, p) {\n    const buf = p.buf;\n    let h, b;\n\n    b = buf[p.pos++]; h  = (b & 0x70) >> 4;  if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 3;  if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 10; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 17; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 24; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x01) << 31; if (b < 0x80) return toNum(l, h, s);\n\n    throw new Error('Expected varint not more than 10 bytes');\n}\n\n/**\n * @param {number} low\n * @param {number} high\n * @param {boolean} [isSigned]\n */\nfunction toNum(low, high, isSigned) {\n    return isSigned ? high * 0x100000000 + (low >>> 0) : ((high >>> 0) * 0x100000000) + (low >>> 0);\n}\n\n/**\n * @param {number} val\n * @param {Pbf} pbf\n */\nfunction writeBigVarint(val, pbf) {\n    let low, high;\n\n    if (val >= 0) {\n        low  = (val % 0x100000000) | 0;\n        high = (val / 0x100000000) | 0;\n    } else {\n        low  = ~(-val % 0x100000000);\n        high = ~(-val / 0x100000000);\n\n        if (low ^ 0xffffffff) {\n            low = (low + 1) | 0;\n        } else {\n            low = 0;\n            high = (high + 1) | 0;\n        }\n    }\n\n    if (val >= 0x10000000000000000 || val < -0x10000000000000000) {\n        throw new Error('Given varint doesn\\'t fit into 10 bytes');\n    }\n\n    pbf.realloc(10);\n\n    writeBigVarintLow(low, high, pbf);\n    writeBigVarintHigh(high, pbf);\n}\n\n/**\n * @param {number} high\n * @param {number} low\n * @param {Pbf} pbf\n */\nfunction writeBigVarintLow(low, high, pbf) {\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos]   = low & 0x7f;\n}\n\n/**\n * @param {number} high\n * @param {Pbf} pbf\n */\nfunction writeBigVarintHigh(high, pbf) {\n    const lsb = (high & 0x07) << 4;\n\n    pbf.buf[pbf.pos++] |= lsb         | ((high >>>= 3) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f;\n}\n\n/**\n * @param {number} startPos\n * @param {number} len\n * @param {Pbf} pbf\n */\nfunction makeRoomForExtraLength(startPos, len, pbf) {\n    const extraLen =\n        len <= 0x3fff ? 1 :\n        len <= 0x1fffff ? 2 :\n        len <= 0xfffffff ? 3 : Math.floor(Math.log(len) / (Math.LN2 * 7));\n\n    // if 1 byte isn't enough for encoding message length, shift the data to the right\n    pbf.realloc(extraLen);\n    for (let i = pbf.pos - 1; i >= startPos; i--) pbf.buf[i + extraLen] = pbf.buf[i];\n}\n\n/**\n * @param {number[]} arr\n * @param {Pbf} pbf\n */\nfunction writePackedVarint(arr, pbf) {\n    for (let i = 0; i < arr.length; i++) pbf.writeVarint(arr[i]);\n}\n/**\n * @param {number[]} arr\n * @param {Pbf} pbf\n */\nfunction writePackedSVarint(arr, pbf) {\n    for (let i = 0; i < arr.length; i++) pbf.writeSVarint(arr[i]);\n}\n/**\n * @param {number[]} arr\n * @param {Pbf} pbf\n */\nfunction writePackedFloat(arr, pbf) {\n    for (let i = 0; i < arr.length; i++) pbf.writeFloat(arr[i]);\n}\n/**\n * @param {number[]} arr\n * @param {Pbf} pbf\n */\nfunction writePackedDouble(arr, pbf) {\n    for (let i = 0; i < arr.length; i++) pbf.writeDouble(arr[i]);\n}\n/**\n * @param {boolean[]} arr\n * @param {Pbf} pbf\n */\nfunction writePackedBoolean(arr, pbf) {\n    for (let i = 0; i < arr.length; i++) pbf.writeBoolean(arr[i]);\n}\n/**\n * @param {number[]} arr\n * @param {Pbf} pbf\n */\nfunction writePackedFixed32(arr, pbf) {\n    for (let i = 0; i < arr.length; i++) pbf.writeFixed32(arr[i]);\n}\n/**\n * @param {number[]} arr\n * @param {Pbf} pbf\n */\nfunction writePackedSFixed32(arr, pbf) {\n    for (let i = 0; i < arr.length; i++) pbf.writeSFixed32(arr[i]);\n}\n/**\n * @param {number[]} arr\n * @param {Pbf} pbf\n */\nfunction writePackedFixed64(arr, pbf) {\n    for (let i = 0; i < arr.length; i++) pbf.writeFixed64(arr[i]);\n}\n/**\n * @param {number[]} arr\n * @param {Pbf} pbf\n */\nfunction writePackedSFixed64(arr, pbf) {\n    for (let i = 0; i < arr.length; i++) pbf.writeSFixed64(arr[i]);\n}\n\n// Buffer code below from https://github.com/feross/buffer, MIT-licensed\n\n/**\n * @param {Uint8Array} buf\n * @param {number} pos\n * @param {number} end\n */\nfunction readUtf8(buf, pos, end) {\n    let str = '';\n    let i = pos;\n\n    while (i < end) {\n        const b0 = buf[i];\n        let c = null; // codepoint\n        let bytesPerSequence =\n            b0 > 0xEF ? 4 :\n            b0 > 0xDF ? 3 :\n            b0 > 0xBF ? 2 : 1;\n\n        if (i + bytesPerSequence > end) break;\n\n        let b1, b2, b3;\n\n        if (bytesPerSequence === 1) {\n            if (b0 < 0x80) {\n                c = b0;\n            }\n        } else if (bytesPerSequence === 2) {\n            b1 = buf[i + 1];\n            if ((b1 & 0xC0) === 0x80) {\n                c = (b0 & 0x1F) << 0x6 | (b1 & 0x3F);\n                if (c <= 0x7F) {\n                    c = null;\n                }\n            }\n        } else if (bytesPerSequence === 3) {\n            b1 = buf[i + 1];\n            b2 = buf[i + 2];\n            if ((b1 & 0xC0) === 0x80 && (b2 & 0xC0) === 0x80) {\n                c = (b0 & 0xF) << 0xC | (b1 & 0x3F) << 0x6 | (b2 & 0x3F);\n                if (c <= 0x7FF || (c >= 0xD800 && c <= 0xDFFF)) {\n                    c = null;\n                }\n            }\n        } else if (bytesPerSequence === 4) {\n            b1 = buf[i + 1];\n            b2 = buf[i + 2];\n            b3 = buf[i + 3];\n            if ((b1 & 0xC0) === 0x80 && (b2 & 0xC0) === 0x80 && (b3 & 0xC0) === 0x80) {\n                c = (b0 & 0xF) << 0x12 | (b1 & 0x3F) << 0xC | (b2 & 0x3F) << 0x6 | (b3 & 0x3F);\n                if (c <= 0xFFFF || c >= 0x110000) {\n                    c = null;\n                }\n            }\n        }\n\n        if (c === null) {\n            c = 0xFFFD;\n            bytesPerSequence = 1;\n\n        } else if (c > 0xFFFF) {\n            c -= 0x10000;\n            str += String.fromCharCode(c >>> 10 & 0x3FF | 0xD800);\n            c = 0xDC00 | c & 0x3FF;\n        }\n\n        str += String.fromCharCode(c);\n        i += bytesPerSequence;\n    }\n\n    return str;\n}\n\n/**\n * @param {Uint8Array} buf\n * @param {string} str\n * @param {number} pos\n */\nfunction writeUtf8(buf, str, pos) {\n    for (let i = 0, c, lead; i < str.length; i++) {\n        c = str.charCodeAt(i); // code point\n\n        if (c > 0xD7FF && c < 0xE000) {\n            if (lead) {\n                if (c < 0xDC00) {\n                    buf[pos++] = 0xEF;\n                    buf[pos++] = 0xBF;\n                    buf[pos++] = 0xBD;\n                    lead = c;\n                    continue;\n                } else {\n                    c = lead - 0xD800 << 10 | c - 0xDC00 | 0x10000;\n                    lead = null;\n                }\n            } else {\n                if (c > 0xDBFF || (i + 1 === str.length)) {\n                    buf[pos++] = 0xEF;\n                    buf[pos++] = 0xBF;\n                    buf[pos++] = 0xBD;\n                } else {\n                    lead = c;\n                }\n                continue;\n            }\n        } else if (lead) {\n            buf[pos++] = 0xEF;\n            buf[pos++] = 0xBF;\n            buf[pos++] = 0xBD;\n            lead = null;\n        }\n\n        if (c < 0x80) {\n            buf[pos++] = c;\n        } else {\n            if (c < 0x800) {\n                buf[pos++] = c >> 0x6 | 0xC0;\n            } else {\n                if (c < 0x10000) {\n                    buf[pos++] = c >> 0xC | 0xE0;\n                } else {\n                    buf[pos++] = c >> 0x12 | 0xF0;\n                    buf[pos++] = c >> 0xC & 0x3F | 0x80;\n                }\n                buf[pos++] = c >> 0x6 & 0x3F | 0x80;\n            }\n            buf[pos++] = c & 0x3F | 0x80;\n        }\n    }\n    return pos;\n}\n","var __pow = Math.pow;\nvar __async = (__this, __arguments, generator) => {\n  return new Promise((resolve, reject) => {\n    var fulfilled = (value) => {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    };\n    var rejected = (value) => {\n      try {\n        step(generator.throw(value));\n      } catch (e) {\n        reject(e);\n      }\n    };\n    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);\n    step((generator = generator.apply(__this, __arguments)).next());\n  });\n};\n\n// node_modules/fflate/esm/browser.js\nvar u8 = Uint8Array;\nvar u16 = Uint16Array;\nvar i32 = Int32Array;\nvar fleb = new u8([\n  0,\n  0,\n  0,\n  0,\n  0,\n  0,\n  0,\n  0,\n  1,\n  1,\n  1,\n  1,\n  2,\n  2,\n  2,\n  2,\n  3,\n  3,\n  3,\n  3,\n  4,\n  4,\n  4,\n  4,\n  5,\n  5,\n  5,\n  5,\n  0,\n  /* unused */\n  0,\n  0,\n  /* impossible */\n  0\n]);\nvar fdeb = new u8([\n  0,\n  0,\n  0,\n  0,\n  1,\n  1,\n  2,\n  2,\n  3,\n  3,\n  4,\n  4,\n  5,\n  5,\n  6,\n  6,\n  7,\n  7,\n  8,\n  8,\n  9,\n  9,\n  10,\n  10,\n  11,\n  11,\n  12,\n  12,\n  13,\n  13,\n  /* unused */\n  0,\n  0\n]);\nvar clim = new u8([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]);\nvar freb = function(eb, start) {\n  var b = new u16(31);\n  for (var i = 0; i < 31; ++i) {\n    b[i] = start += 1 << eb[i - 1];\n  }\n  var r = new i32(b[30]);\n  for (var i = 1; i < 30; ++i) {\n    for (var j = b[i]; j < b[i + 1]; ++j) {\n      r[j] = j - b[i] << 5 | i;\n    }\n  }\n  return { b, r };\n};\nvar _a = freb(fleb, 2);\nvar fl = _a.b;\nvar revfl = _a.r;\nfl[28] = 258, revfl[258] = 28;\nvar _b = freb(fdeb, 0);\nvar fd = _b.b;\nvar revfd = _b.r;\nvar rev = new u16(32768);\nfor (i = 0; i < 32768; ++i) {\n  x = (i & 43690) >> 1 | (i & 21845) << 1;\n  x = (x & 52428) >> 2 | (x & 13107) << 2;\n  x = (x & 61680) >> 4 | (x & 3855) << 4;\n  rev[i] = ((x & 65280) >> 8 | (x & 255) << 8) >> 1;\n}\nvar x;\nvar i;\nvar hMap = function(cd, mb, r) {\n  var s = cd.length;\n  var i = 0;\n  var l = new u16(mb);\n  for (; i < s; ++i) {\n    if (cd[i])\n      ++l[cd[i] - 1];\n  }\n  var le = new u16(mb);\n  for (i = 1; i < mb; ++i) {\n    le[i] = le[i - 1] + l[i - 1] << 1;\n  }\n  var co;\n  if (r) {\n    co = new u16(1 << mb);\n    var rvb = 15 - mb;\n    for (i = 0; i < s; ++i) {\n      if (cd[i]) {\n        var sv = i << 4 | cd[i];\n        var r_1 = mb - cd[i];\n        var v = le[cd[i] - 1]++ << r_1;\n        for (var m = v | (1 << r_1) - 1; v <= m; ++v) {\n          co[rev[v] >> rvb] = sv;\n        }\n      }\n    }\n  } else {\n    co = new u16(s);\n    for (i = 0; i < s; ++i) {\n      if (cd[i]) {\n        co[i] = rev[le[cd[i] - 1]++] >> 15 - cd[i];\n      }\n    }\n  }\n  return co;\n};\nvar flt = new u8(288);\nfor (i = 0; i < 144; ++i)\n  flt[i] = 8;\nvar i;\nfor (i = 144; i < 256; ++i)\n  flt[i] = 9;\nvar i;\nfor (i = 256; i < 280; ++i)\n  flt[i] = 7;\nvar i;\nfor (i = 280; i < 288; ++i)\n  flt[i] = 8;\nvar i;\nvar fdt = new u8(32);\nfor (i = 0; i < 32; ++i)\n  fdt[i] = 5;\nvar i;\nvar flrm = /* @__PURE__ */ hMap(flt, 9, 1);\nvar fdrm = /* @__PURE__ */ hMap(fdt, 5, 1);\nvar max = function(a) {\n  var m = a[0];\n  for (var i = 1; i < a.length; ++i) {\n    if (a[i] > m)\n      m = a[i];\n  }\n  return m;\n};\nvar bits = function(d, p, m) {\n  var o = p / 8 | 0;\n  return (d[o] | d[o + 1] << 8) >> (p & 7) & m;\n};\nvar bits16 = function(d, p) {\n  var o = p / 8 | 0;\n  return (d[o] | d[o + 1] << 8 | d[o + 2] << 16) >> (p & 7);\n};\nvar shft = function(p) {\n  return (p + 7) / 8 | 0;\n};\nvar slc = function(v, s, e) {\n  if (s == null || s < 0)\n    s = 0;\n  if (e == null || e > v.length)\n    e = v.length;\n  var n = new u8(e - s);\n  n.set(v.subarray(s, e));\n  return n;\n};\nvar ec = [\n  \"unexpected EOF\",\n  \"invalid block type\",\n  \"invalid length/literal\",\n  \"invalid distance\",\n  \"stream finished\",\n  \"no stream handler\",\n  ,\n  \"no callback\",\n  \"invalid UTF-8 data\",\n  \"extra field too long\",\n  \"date not in range 1980-2099\",\n  \"filename too long\",\n  \"stream finishing\",\n  \"invalid zip data\"\n  // determined by unknown compression method\n];\nvar err = function(ind, msg, nt) {\n  var e = new Error(msg || ec[ind]);\n  e.code = ind;\n  if (Error.captureStackTrace)\n    Error.captureStackTrace(e, err);\n  if (!nt)\n    throw e;\n  return e;\n};\nvar inflt = function(dat, st, buf, dict) {\n  var sl = dat.length, dl = dict ? dict.length : 0;\n  if (!sl || st.f && !st.l)\n    return buf || new u8(0);\n  var noBuf = !buf || st.i != 2;\n  var noSt = st.i;\n  if (!buf)\n    buf = new u8(sl * 3);\n  var cbuf = function(l2) {\n    var bl = buf.length;\n    if (l2 > bl) {\n      var nbuf = new u8(Math.max(bl * 2, l2));\n      nbuf.set(buf);\n      buf = nbuf;\n    }\n  };\n  var final = st.f || 0, pos = st.p || 0, bt = st.b || 0, lm = st.l, dm = st.d, lbt = st.m, dbt = st.n;\n  var tbts = sl * 8;\n  do {\n    if (!lm) {\n      final = bits(dat, pos, 1);\n      var type = bits(dat, pos + 1, 3);\n      pos += 3;\n      if (!type) {\n        var s = shft(pos) + 4, l = dat[s - 4] | dat[s - 3] << 8, t = s + l;\n        if (t > sl) {\n          if (noSt)\n            err(0);\n          break;\n        }\n        if (noBuf)\n          cbuf(bt + l);\n        buf.set(dat.subarray(s, t), bt);\n        st.b = bt += l, st.p = pos = t * 8, st.f = final;\n        continue;\n      } else if (type == 1)\n        lm = flrm, dm = fdrm, lbt = 9, dbt = 5;\n      else if (type == 2) {\n        var hLit = bits(dat, pos, 31) + 257, hcLen = bits(dat, pos + 10, 15) + 4;\n        var tl = hLit + bits(dat, pos + 5, 31) + 1;\n        pos += 14;\n        var ldt = new u8(tl);\n        var clt = new u8(19);\n        for (var i = 0; i < hcLen; ++i) {\n          clt[clim[i]] = bits(dat, pos + i * 3, 7);\n        }\n        pos += hcLen * 3;\n        var clb = max(clt), clbmsk = (1 << clb) - 1;\n        var clm = hMap(clt, clb, 1);\n        for (var i = 0; i < tl; ) {\n          var r = clm[bits(dat, pos, clbmsk)];\n          pos += r & 15;\n          var s = r >> 4;\n          if (s < 16) {\n            ldt[i++] = s;\n          } else {\n            var c = 0, n = 0;\n            if (s == 16)\n              n = 3 + bits(dat, pos, 3), pos += 2, c = ldt[i - 1];\n            else if (s == 17)\n              n = 3 + bits(dat, pos, 7), pos += 3;\n            else if (s == 18)\n              n = 11 + bits(dat, pos, 127), pos += 7;\n            while (n--)\n              ldt[i++] = c;\n          }\n        }\n        var lt = ldt.subarray(0, hLit), dt = ldt.subarray(hLit);\n        lbt = max(lt);\n        dbt = max(dt);\n        lm = hMap(lt, lbt, 1);\n        dm = hMap(dt, dbt, 1);\n      } else\n        err(1);\n      if (pos > tbts) {\n        if (noSt)\n          err(0);\n        break;\n      }\n    }\n    if (noBuf)\n      cbuf(bt + 131072);\n    var lms = (1 << lbt) - 1, dms = (1 << dbt) - 1;\n    var lpos = pos;\n    for (; ; lpos = pos) {\n      var c = lm[bits16(dat, pos) & lms], sym = c >> 4;\n      pos += c & 15;\n      if (pos > tbts) {\n        if (noSt)\n          err(0);\n        break;\n      }\n      if (!c)\n        err(2);\n      if (sym < 256)\n        buf[bt++] = sym;\n      else if (sym == 256) {\n        lpos = pos, lm = null;\n        break;\n      } else {\n        var add = sym - 254;\n        if (sym > 264) {\n          var i = sym - 257, b = fleb[i];\n          add = bits(dat, pos, (1 << b) - 1) + fl[i];\n          pos += b;\n        }\n        var d = dm[bits16(dat, pos) & dms], dsym = d >> 4;\n        if (!d)\n          err(3);\n        pos += d & 15;\n        var dt = fd[dsym];\n        if (dsym > 3) {\n          var b = fdeb[dsym];\n          dt += bits16(dat, pos) & (1 << b) - 1, pos += b;\n        }\n        if (pos > tbts) {\n          if (noSt)\n            err(0);\n          break;\n        }\n        if (noBuf)\n          cbuf(bt + 131072);\n        var end = bt + add;\n        if (bt < dt) {\n          var shift2 = dl - dt, dend = Math.min(dt, end);\n          if (shift2 + bt < 0)\n            err(3);\n          for (; bt < dend; ++bt)\n            buf[bt] = dict[shift2 + bt];\n        }\n        for (; bt < end; bt += 4) {\n          buf[bt] = buf[bt - dt];\n          buf[bt + 1] = buf[bt + 1 - dt];\n          buf[bt + 2] = buf[bt + 2 - dt];\n          buf[bt + 3] = buf[bt + 3 - dt];\n        }\n        bt = end;\n      }\n    }\n    st.l = lm, st.p = lpos, st.b = bt, st.f = final;\n    if (lm)\n      final = 1, st.m = lbt, st.d = dm, st.n = dbt;\n  } while (!final);\n  return bt == buf.length ? buf : slc(buf, 0, bt);\n};\nvar et = /* @__PURE__ */ new u8(0);\nvar gzs = function(d) {\n  if (d[0] != 31 || d[1] != 139 || d[2] != 8)\n    err(6, \"invalid gzip data\");\n  var flg = d[3];\n  var st = 10;\n  if (flg & 4)\n    st += (d[10] | d[11] << 8) + 2;\n  for (var zs = (flg >> 3 & 1) + (flg >> 4 & 1); zs > 0; zs -= !d[st++])\n    ;\n  return st + (flg & 2);\n};\nvar gzl = function(d) {\n  var l = d.length;\n  return (d[l - 4] | d[l - 3] << 8 | d[l - 2] << 16 | d[l - 1] << 24) >>> 0;\n};\nvar zls = function(d, dict) {\n  if ((d[0] & 15) != 8 || d[0] >> 4 > 7 || (d[0] << 8 | d[1]) % 31)\n    err(6, \"invalid zlib data\");\n  if ((d[1] >> 5 & 1) == +!dict)\n    err(6, \"invalid zlib data: \" + (d[1] & 32 ? \"need\" : \"unexpected\") + \" dictionary\");\n  return (d[1] >> 3 & 4) + 2;\n};\nfunction inflateSync(data, opts) {\n  return inflt(data, { i: 2 }, opts && opts.out, opts && opts.dictionary);\n}\nfunction gunzipSync(data, opts) {\n  var st = gzs(data);\n  if (st + 8 > data.length)\n    err(6, \"invalid gzip data\");\n  return inflt(data.subarray(st, -8), { i: 2 }, opts && opts.out || new u8(gzl(data)), opts && opts.dictionary);\n}\nfunction unzlibSync(data, opts) {\n  return inflt(data.subarray(zls(data, opts && opts.dictionary), -4), { i: 2 }, opts && opts.out, opts && opts.dictionary);\n}\nfunction decompressSync(data, opts) {\n  return data[0] == 31 && data[1] == 139 && data[2] == 8 ? gunzipSync(data, opts) : (data[0] & 15) != 8 || data[0] >> 4 > 7 || (data[0] << 8 | data[1]) % 31 ? inflateSync(data, opts) : unzlibSync(data, opts);\n}\nvar td = typeof TextDecoder != \"undefined\" && /* @__PURE__ */ new TextDecoder();\nvar tds = 0;\ntry {\n  td.decode(et, { stream: true });\n  tds = 1;\n} catch (e) {\n}\n\n// v2.ts\nvar shift = (n, shift2) => {\n  return n * __pow(2, shift2);\n};\nvar unshift = (n, shift2) => {\n  return Math.floor(n / __pow(2, shift2));\n};\nvar getUint24 = (view, pos) => {\n  return shift(view.getUint16(pos + 1, true), 8) + view.getUint8(pos);\n};\nvar getUint48 = (view, pos) => {\n  return shift(view.getUint32(pos + 2, true), 16) + view.getUint16(pos, true);\n};\nvar compare = (tz, tx, ty, view, i) => {\n  if (tz !== view.getUint8(i))\n    return tz - view.getUint8(i);\n  const x = getUint24(view, i + 1);\n  if (tx !== x)\n    return tx - x;\n  const y = getUint24(view, i + 4);\n  if (ty !== y)\n    return ty - y;\n  return 0;\n};\nvar queryLeafdir = (view, z, x, y) => {\n  const offsetLen = queryView(view, z | 128, x, y);\n  if (offsetLen) {\n    return {\n      z,\n      x,\n      y,\n      offset: offsetLen[0],\n      length: offsetLen[1],\n      isDir: true\n    };\n  }\n  return null;\n};\nvar queryTile = (view, z, x, y) => {\n  const offsetLen = queryView(view, z, x, y);\n  if (offsetLen) {\n    return {\n      z,\n      x,\n      y,\n      offset: offsetLen[0],\n      length: offsetLen[1],\n      isDir: false\n    };\n  }\n  return null;\n};\nvar queryView = (view, z, x, y) => {\n  let m = 0;\n  let n = view.byteLength / 17 - 1;\n  while (m <= n) {\n    const k = n + m >> 1;\n    const cmp = compare(z, x, y, view, k * 17);\n    if (cmp > 0) {\n      m = k + 1;\n    } else if (cmp < 0) {\n      n = k - 1;\n    } else {\n      return [getUint48(view, k * 17 + 7), view.getUint32(k * 17 + 13, true)];\n    }\n  }\n  return null;\n};\nvar entrySort = (a, b) => {\n  if (a.isDir && !b.isDir) {\n    return 1;\n  }\n  if (!a.isDir && b.isDir) {\n    return -1;\n  }\n  if (a.z !== b.z) {\n    return a.z - b.z;\n  }\n  if (a.x !== b.x) {\n    return a.x - b.x;\n  }\n  return a.y - b.y;\n};\nvar parseEntry = (dataview, i) => {\n  const zRaw = dataview.getUint8(i * 17);\n  const z = zRaw & 127;\n  return {\n    z,\n    x: getUint24(dataview, i * 17 + 1),\n    y: getUint24(dataview, i * 17 + 4),\n    offset: getUint48(dataview, i * 17 + 7),\n    length: dataview.getUint32(i * 17 + 13, true),\n    isDir: zRaw >> 7 === 1\n  };\n};\nvar sortDir = (a) => {\n  const entries = [];\n  const view = new DataView(a);\n  for (let i = 0; i < view.byteLength / 17; i++) {\n    entries.push(parseEntry(view, i));\n  }\n  return createDirectory(entries);\n};\nvar createDirectory = (entries) => {\n  entries.sort(entrySort);\n  const buffer = new ArrayBuffer(17 * entries.length);\n  const arr = new Uint8Array(buffer);\n  for (let i = 0; i < entries.length; i++) {\n    const entry = entries[i];\n    let z = entry.z;\n    if (entry.isDir)\n      z = z | 128;\n    arr[i * 17] = z;\n    arr[i * 17 + 1] = entry.x & 255;\n    arr[i * 17 + 2] = entry.x >> 8 & 255;\n    arr[i * 17 + 3] = entry.x >> 16 & 255;\n    arr[i * 17 + 4] = entry.y & 255;\n    arr[i * 17 + 5] = entry.y >> 8 & 255;\n    arr[i * 17 + 6] = entry.y >> 16 & 255;\n    arr[i * 17 + 7] = entry.offset & 255;\n    arr[i * 17 + 8] = unshift(entry.offset, 8) & 255;\n    arr[i * 17 + 9] = unshift(entry.offset, 16) & 255;\n    arr[i * 17 + 10] = unshift(entry.offset, 24) & 255;\n    arr[i * 17 + 11] = unshift(entry.offset, 32) & 255;\n    arr[i * 17 + 12] = unshift(entry.offset, 48) & 255;\n    arr[i * 17 + 13] = entry.length & 255;\n    arr[i * 17 + 14] = entry.length >> 8 & 255;\n    arr[i * 17 + 15] = entry.length >> 16 & 255;\n    arr[i * 17 + 16] = entry.length >> 24 & 255;\n  }\n  return buffer;\n};\nvar deriveLeaf = (view, tile) => {\n  if (view.byteLength < 17)\n    return null;\n  const numEntries = view.byteLength / 17;\n  const entry = parseEntry(view, numEntries - 1);\n  if (entry.isDir) {\n    const leafLevel = entry.z;\n    const levelDiff = tile.z - leafLevel;\n    const leafX = Math.trunc(tile.x / (1 << levelDiff));\n    const leafY = Math.trunc(tile.y / (1 << levelDiff));\n    return { z: leafLevel, x: leafX, y: leafY };\n  }\n  return null;\n};\nfunction getHeader(source) {\n  return __async(this, null, function* () {\n    const resp = yield source.getBytes(0, 512e3);\n    const dataview = new DataView(resp.data);\n    const jsonSize = dataview.getUint32(4, true);\n    const rootEntries = dataview.getUint16(8, true);\n    const dec = new TextDecoder(\"utf-8\");\n    const jsonMetadata = JSON.parse(\n      dec.decode(new DataView(resp.data, 10, jsonSize))\n    );\n    let tileCompression = 0 /* Unknown */;\n    if (jsonMetadata.compression === \"gzip\") {\n      tileCompression = 2 /* Gzip */;\n    }\n    let minzoom = 0;\n    if (\"minzoom\" in jsonMetadata) {\n      minzoom = +jsonMetadata.minzoom;\n    }\n    let maxzoom = 0;\n    if (\"maxzoom\" in jsonMetadata) {\n      maxzoom = +jsonMetadata.maxzoom;\n    }\n    let centerLon = 0;\n    let centerLat = 0;\n    let centerZoom = 0;\n    let minLon = -180;\n    let minLat = -85;\n    let maxLon = 180;\n    let maxLat = 85;\n    if (jsonMetadata.bounds) {\n      const split = jsonMetadata.bounds.split(\",\");\n      minLon = +split[0];\n      minLat = +split[1];\n      maxLon = +split[2];\n      maxLat = +split[3];\n    }\n    if (jsonMetadata.center) {\n      const split = jsonMetadata.center.split(\",\");\n      centerLon = +split[0];\n      centerLat = +split[1];\n      centerZoom = +split[2];\n    }\n    const header = {\n      specVersion: dataview.getUint16(2, true),\n      rootDirectoryOffset: 10 + jsonSize,\n      rootDirectoryLength: rootEntries * 17,\n      jsonMetadataOffset: 10,\n      jsonMetadataLength: jsonSize,\n      leafDirectoryOffset: 0,\n      leafDirectoryLength: void 0,\n      tileDataOffset: 0,\n      tileDataLength: void 0,\n      numAddressedTiles: 0,\n      numTileEntries: 0,\n      numTileContents: 0,\n      clustered: false,\n      internalCompression: 1 /* None */,\n      tileCompression,\n      tileType: 1 /* Mvt */,\n      minZoom: minzoom,\n      maxZoom: maxzoom,\n      minLon,\n      minLat,\n      maxLon,\n      maxLat,\n      centerZoom,\n      centerLon,\n      centerLat,\n      etag: resp.etag\n    };\n    return header;\n  });\n}\nfunction getZxy(header, source, cache, z, x, y, signal) {\n  return __async(this, null, function* () {\n    let rootDir = yield cache.getArrayBuffer(\n      source,\n      header.rootDirectoryOffset,\n      header.rootDirectoryLength,\n      header\n    );\n    if (header.specVersion === 1) {\n      rootDir = sortDir(rootDir);\n    }\n    const entry = queryTile(new DataView(rootDir), z, x, y);\n    if (entry) {\n      const resp = yield source.getBytes(entry.offset, entry.length, signal);\n      let tileData = resp.data;\n      const view = new DataView(tileData);\n      if (view.getUint8(0) === 31 && view.getUint8(1) === 139) {\n        tileData = decompressSync(new Uint8Array(tileData));\n      }\n      return {\n        data: tileData\n      };\n    }\n    const leafcoords = deriveLeaf(new DataView(rootDir), { z, x, y });\n    if (leafcoords) {\n      const leafdirEntry = queryLeafdir(\n        new DataView(rootDir),\n        leafcoords.z,\n        leafcoords.x,\n        leafcoords.y\n      );\n      if (leafdirEntry) {\n        let leafDir = yield cache.getArrayBuffer(\n          source,\n          leafdirEntry.offset,\n          leafdirEntry.length,\n          header\n        );\n        if (header.specVersion === 1) {\n          leafDir = sortDir(leafDir);\n        }\n        const tileEntry = queryTile(new DataView(leafDir), z, x, y);\n        if (tileEntry) {\n          const resp = yield source.getBytes(\n            tileEntry.offset,\n            tileEntry.length,\n            signal\n          );\n          let tileData = resp.data;\n          const view = new DataView(tileData);\n          if (view.getUint8(0) === 31 && view.getUint8(1) === 139) {\n            tileData = decompressSync(new Uint8Array(tileData));\n          }\n          return {\n            data: tileData\n          };\n        }\n      }\n    }\n    return void 0;\n  });\n}\nvar v2_default = {\n  getHeader,\n  getZxy\n};\n\n// adapters.ts\nvar leafletRasterLayer = (source, options) => {\n  let loaded = false;\n  let mimeType = \"\";\n  const cls = L.GridLayer.extend({\n    createTile: (coord, done) => {\n      const el = document.createElement(\"img\");\n      const controller = new AbortController();\n      const signal = controller.signal;\n      el.cancel = () => {\n        controller.abort();\n      };\n      if (!loaded) {\n        source.getHeader().then((header) => {\n          if (header.tileType === 1 /* Mvt */) {\n            console.error(\n              \"Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details.\"\n            );\n          } else if (header.tileType === 2) {\n            mimeType = \"image/png\";\n          } else if (header.tileType === 3) {\n            mimeType = \"image/jpeg\";\n          } else if (header.tileType === 4) {\n            mimeType = \"image/webp\";\n          } else if (header.tileType === 5) {\n            mimeType = \"image/avif\";\n          }\n        });\n        loaded = true;\n      }\n      source.getZxy(coord.z, coord.x, coord.y, signal).then((arr) => {\n        if (arr) {\n          const blob = new Blob([arr.data], { type: mimeType });\n          const imageUrl = window.URL.createObjectURL(blob);\n          el.src = imageUrl;\n          el.cancel = void 0;\n          done(void 0, el);\n        }\n      }).catch((e) => {\n        if (e.name !== \"AbortError\") {\n          throw e;\n        }\n      });\n      return el;\n    },\n    _removeTile: function(key) {\n      const tile = this._tiles[key];\n      if (!tile) {\n        return;\n      }\n      if (tile.el.cancel)\n        tile.el.cancel();\n      tile.el.width = 0;\n      tile.el.height = 0;\n      tile.el.deleted = true;\n      L.DomUtil.remove(tile.el);\n      delete this._tiles[key];\n      this.fire(\"tileunload\", {\n        tile: tile.el,\n        coords: this._keyToTileCoords(key)\n      });\n    }\n  });\n  return new cls(options);\n};\nvar v3compat = (v4) => (requestParameters, arg2) => {\n  if (arg2 instanceof AbortController) {\n    return v4(requestParameters, arg2);\n  }\n  const abortController = new AbortController();\n  v4(requestParameters, abortController).then(\n    (result) => {\n      return arg2(\n        void 0,\n        result.data,\n        result.cacheControl || \"\",\n        result.expires || \"\"\n      );\n    },\n    (err2) => {\n      return arg2(err2);\n    }\n  ).catch((e) => {\n    return arg2(e);\n  });\n  return { cancel: () => abortController.abort() };\n};\nvar Protocol = class {\n  constructor() {\n    this.tilev4 = (params, abortController) => __async(this, null, function* () {\n      if (params.type === \"json\") {\n        const pmtilesUrl2 = params.url.substr(10);\n        let instance2 = this.tiles.get(pmtilesUrl2);\n        if (!instance2) {\n          instance2 = new PMTiles(pmtilesUrl2);\n          this.tiles.set(pmtilesUrl2, instance2);\n        }\n        const h = yield instance2.getHeader();\n        return {\n          data: {\n            tiles: [`${params.url}/{z}/{x}/{y}`],\n            minzoom: h.minZoom,\n            maxzoom: h.maxZoom,\n            bounds: [h.minLon, h.minLat, h.maxLon, h.maxLat]\n          }\n        };\n      }\n      const re = new RegExp(/pmtiles:\\/\\/(.+)\\/(\\d+)\\/(\\d+)\\/(\\d+)/);\n      const result = params.url.match(re);\n      if (!result) {\n        throw new Error(\"Invalid PMTiles protocol URL\");\n      }\n      const pmtilesUrl = result[1];\n      let instance = this.tiles.get(pmtilesUrl);\n      if (!instance) {\n        instance = new PMTiles(pmtilesUrl);\n        this.tiles.set(pmtilesUrl, instance);\n      }\n      const z = result[2];\n      const x = result[3];\n      const y = result[4];\n      const header = yield instance.getHeader();\n      const resp = yield instance == null ? void 0 : instance.getZxy(+z, +x, +y, abortController.signal);\n      if (resp) {\n        return {\n          data: new Uint8Array(resp.data),\n          cacheControl: resp.cacheControl,\n          expires: resp.expires\n        };\n      }\n      if (header.tileType === 1 /* Mvt */) {\n        return { data: new Uint8Array() };\n      }\n      return { data: null };\n    });\n    this.tile = v3compat(this.tilev4);\n    this.tiles = /* @__PURE__ */ new Map();\n  }\n  add(p) {\n    this.tiles.set(p.source.getKey(), p);\n  }\n  get(url) {\n    return this.tiles.get(url);\n  }\n};\n\n// index.ts\nfunction toNum(low, high) {\n  return (high >>> 0) * 4294967296 + (low >>> 0);\n}\nfunction readVarintRemainder(l, p) {\n  const buf = p.buf;\n  let b = buf[p.pos++];\n  let h = (b & 112) >> 4;\n  if (b < 128)\n    return toNum(l, h);\n  b = buf[p.pos++];\n  h |= (b & 127) << 3;\n  if (b < 128)\n    return toNum(l, h);\n  b = buf[p.pos++];\n  h |= (b & 127) << 10;\n  if (b < 128)\n    return toNum(l, h);\n  b = buf[p.pos++];\n  h |= (b & 127) << 17;\n  if (b < 128)\n    return toNum(l, h);\n  b = buf[p.pos++];\n  h |= (b & 127) << 24;\n  if (b < 128)\n    return toNum(l, h);\n  b = buf[p.pos++];\n  h |= (b & 1) << 31;\n  if (b < 128)\n    return toNum(l, h);\n  throw new Error(\"Expected varint not more than 10 bytes\");\n}\nfunction readVarint(p) {\n  const buf = p.buf;\n  let b = buf[p.pos++];\n  let val = b & 127;\n  if (b < 128)\n    return val;\n  b = buf[p.pos++];\n  val |= (b & 127) << 7;\n  if (b < 128)\n    return val;\n  b = buf[p.pos++];\n  val |= (b & 127) << 14;\n  if (b < 128)\n    return val;\n  b = buf[p.pos++];\n  val |= (b & 127) << 21;\n  if (b < 128)\n    return val;\n  b = buf[p.pos];\n  val |= (b & 15) << 28;\n  return readVarintRemainder(val, p);\n}\nfunction rotate(n, xy, rx, ry) {\n  if (ry === 0) {\n    if (rx === 1) {\n      xy[0] = n - 1 - xy[0];\n      xy[1] = n - 1 - xy[1];\n    }\n    const t = xy[0];\n    xy[0] = xy[1];\n    xy[1] = t;\n  }\n}\nfunction idOnLevel(z, pos) {\n  const n = __pow(2, z);\n  let rx = pos;\n  let ry = pos;\n  let t = pos;\n  const xy = [0, 0];\n  let s = 1;\n  while (s < n) {\n    rx = 1 & t / 2;\n    ry = 1 & (t ^ rx);\n    rotate(s, xy, rx, ry);\n    xy[0] += s * rx;\n    xy[1] += s * ry;\n    t = t / 4;\n    s *= 2;\n  }\n  return [z, xy[0], xy[1]];\n}\nvar tzValues = [\n  0,\n  1,\n  5,\n  21,\n  85,\n  341,\n  1365,\n  5461,\n  21845,\n  87381,\n  349525,\n  1398101,\n  5592405,\n  22369621,\n  89478485,\n  357913941,\n  1431655765,\n  5726623061,\n  22906492245,\n  91625968981,\n  366503875925,\n  1466015503701,\n  5864062014805,\n  23456248059221,\n  93824992236885,\n  375299968947541,\n  1501199875790165\n];\nfunction zxyToTileId(z, x, y) {\n  if (z > 26) {\n    throw Error(\"Tile zoom level exceeds max safe number limit (26)\");\n  }\n  if (x > __pow(2, z) - 1 || y > __pow(2, z) - 1) {\n    throw Error(\"tile x/y outside zoom level bounds\");\n  }\n  const acc = tzValues[z];\n  const n = __pow(2, z);\n  let rx = 0;\n  let ry = 0;\n  let d = 0;\n  const xy = [x, y];\n  let s = n / 2;\n  while (s > 0) {\n    rx = (xy[0] & s) > 0 ? 1 : 0;\n    ry = (xy[1] & s) > 0 ? 1 : 0;\n    d += s * s * (3 * rx ^ ry);\n    rotate(s, xy, rx, ry);\n    s = s / 2;\n  }\n  return acc + d;\n}\nfunction tileIdToZxy(i) {\n  let acc = 0;\n  const z = 0;\n  for (let z2 = 0; z2 < 27; z2++) {\n    const numTiles = (1 << z2) * (1 << z2);\n    if (acc + numTiles > i) {\n      return idOnLevel(z2, i - acc);\n    }\n    acc += numTiles;\n  }\n  throw Error(\"Tile zoom level exceeds max safe number limit (26)\");\n}\nvar Compression = /* @__PURE__ */ ((Compression2) => {\n  Compression2[Compression2[\"Unknown\"] = 0] = \"Unknown\";\n  Compression2[Compression2[\"None\"] = 1] = \"None\";\n  Compression2[Compression2[\"Gzip\"] = 2] = \"Gzip\";\n  Compression2[Compression2[\"Brotli\"] = 3] = \"Brotli\";\n  Compression2[Compression2[\"Zstd\"] = 4] = \"Zstd\";\n  return Compression2;\n})(Compression || {});\nfunction defaultDecompress(buf, compression) {\n  return __async(this, null, function* () {\n    if (compression === 1 /* None */ || compression === 0 /* Unknown */) {\n      return buf;\n    }\n    if (compression === 2 /* Gzip */) {\n      if (typeof globalThis.DecompressionStream === \"undefined\") {\n        return decompressSync(new Uint8Array(buf));\n      }\n      const stream = new Response(buf).body;\n      if (!stream) {\n        throw Error(\"Failed to read response stream\");\n      }\n      const result = stream.pipeThrough(\n        // biome-ignore lint: needed to detect DecompressionStream in browser+node+cloudflare workers\n        new globalThis.DecompressionStream(\"gzip\")\n      );\n      return new Response(result).arrayBuffer();\n    }\n    throw Error(\"Compression method not supported\");\n  });\n}\nvar TileType = /* @__PURE__ */ ((TileType2) => {\n  TileType2[TileType2[\"Unknown\"] = 0] = \"Unknown\";\n  TileType2[TileType2[\"Mvt\"] = 1] = \"Mvt\";\n  TileType2[TileType2[\"Png\"] = 2] = \"Png\";\n  TileType2[TileType2[\"Jpeg\"] = 3] = \"Jpeg\";\n  TileType2[TileType2[\"Webp\"] = 4] = \"Webp\";\n  TileType2[TileType2[\"Avif\"] = 5] = \"Avif\";\n  return TileType2;\n})(TileType || {});\nvar HEADER_SIZE_BYTES = 127;\nfunction findTile(entries, tileId) {\n  let m = 0;\n  let n = entries.length - 1;\n  while (m <= n) {\n    const k = n + m >> 1;\n    const cmp = tileId - entries[k].tileId;\n    if (cmp > 0) {\n      m = k + 1;\n    } else if (cmp < 0) {\n      n = k - 1;\n    } else {\n      return entries[k];\n    }\n  }\n  if (n >= 0) {\n    if (entries[n].runLength === 0) {\n      return entries[n];\n    }\n    if (tileId - entries[n].tileId < entries[n].runLength) {\n      return entries[n];\n    }\n  }\n  return null;\n}\nvar FileSource = class {\n  constructor(file) {\n    this.file = file;\n  }\n  getKey() {\n    return this.file.name;\n  }\n  getBytes(offset, length) {\n    return __async(this, null, function* () {\n      const blob = this.file.slice(offset, offset + length);\n      const a = yield blob.arrayBuffer();\n      return { data: a };\n    });\n  }\n};\nvar FetchSource = class {\n  constructor(url, customHeaders = new Headers()) {\n    this.url = url;\n    this.customHeaders = customHeaders;\n    this.mustReload = false;\n  }\n  getKey() {\n    return this.url;\n  }\n  setHeaders(customHeaders) {\n    this.customHeaders = customHeaders;\n  }\n  getBytes(offset, length, passedSignal, etag) {\n    return __async(this, null, function* () {\n      let controller;\n      let signal;\n      if (passedSignal) {\n        signal = passedSignal;\n      } else {\n        controller = new AbortController();\n        signal = controller.signal;\n      }\n      const requestHeaders = new Headers(this.customHeaders);\n      requestHeaders.set(\"range\", `bytes=${offset}-${offset + length - 1}`);\n      let cache;\n      if (this.mustReload) {\n        cache = \"reload\";\n      }\n      let resp = yield fetch(this.url, {\n        signal,\n        cache,\n        headers: requestHeaders\n        //biome-ignore lint: \"cache\" is incompatible between cloudflare workers and browser\n      });\n      if (offset === 0 && resp.status === 416) {\n        const contentRange = resp.headers.get(\"Content-Range\");\n        if (!contentRange || !contentRange.startsWith(\"bytes */\")) {\n          throw Error(\"Missing content-length on 416 response\");\n        }\n        const actualLength = +contentRange.substr(8);\n        resp = yield fetch(this.url, {\n          signal,\n          cache: \"reload\",\n          headers: { range: `bytes=0-${actualLength - 1}` }\n          //biome-ignore lint: \"cache\" is incompatible between cloudflare workers and browser\n        });\n      }\n      let newEtag = resp.headers.get(\"Etag\");\n      if (newEtag == null ? void 0 : newEtag.startsWith(\"W/\")) {\n        newEtag = null;\n      }\n      if (resp.status === 416 || etag && newEtag && newEtag !== etag) {\n        this.mustReload = true;\n        throw new EtagMismatch(\n          `Server returned non-matching ETag ${etag} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`\n        );\n      }\n      if (resp.status >= 300) {\n        throw Error(`Bad response code: ${resp.status}`);\n      }\n      const contentLength = resp.headers.get(\"Content-Length\");\n      if (resp.status === 200 && (!contentLength || +contentLength > length)) {\n        if (controller)\n          controller.abort();\n        throw Error(\n          \"Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.\"\n        );\n      }\n      const a = yield resp.arrayBuffer();\n      return {\n        data: a,\n        etag: newEtag || void 0,\n        cacheControl: resp.headers.get(\"Cache-Control\") || void 0,\n        expires: resp.headers.get(\"Expires\") || void 0\n      };\n    });\n  }\n};\nfunction getUint64(v, offset) {\n  const wh = v.getUint32(offset + 4, true);\n  const wl = v.getUint32(offset + 0, true);\n  return wh * __pow(2, 32) + wl;\n}\nfunction bytesToHeader(bytes, etag) {\n  const v = new DataView(bytes);\n  const specVersion = v.getUint8(7);\n  if (specVersion > 3) {\n    throw Error(\n      `Archive is spec version ${specVersion} but this library supports up to spec version 3`\n    );\n  }\n  return {\n    specVersion,\n    rootDirectoryOffset: getUint64(v, 8),\n    rootDirectoryLength: getUint64(v, 16),\n    jsonMetadataOffset: getUint64(v, 24),\n    jsonMetadataLength: getUint64(v, 32),\n    leafDirectoryOffset: getUint64(v, 40),\n    leafDirectoryLength: getUint64(v, 48),\n    tileDataOffset: getUint64(v, 56),\n    tileDataLength: getUint64(v, 64),\n    numAddressedTiles: getUint64(v, 72),\n    numTileEntries: getUint64(v, 80),\n    numTileContents: getUint64(v, 88),\n    clustered: v.getUint8(96) === 1,\n    internalCompression: v.getUint8(97),\n    tileCompression: v.getUint8(98),\n    tileType: v.getUint8(99),\n    minZoom: v.getUint8(100),\n    maxZoom: v.getUint8(101),\n    minLon: v.getInt32(102, true) / 1e7,\n    minLat: v.getInt32(106, true) / 1e7,\n    maxLon: v.getInt32(110, true) / 1e7,\n    maxLat: v.getInt32(114, true) / 1e7,\n    centerZoom: v.getUint8(118),\n    centerLon: v.getInt32(119, true) / 1e7,\n    centerLat: v.getInt32(123, true) / 1e7,\n    etag\n  };\n}\nfunction deserializeIndex(buffer) {\n  const p = { buf: new Uint8Array(buffer), pos: 0 };\n  const numEntries = readVarint(p);\n  const entries = [];\n  let lastId = 0;\n  for (let i = 0; i < numEntries; i++) {\n    const v = readVarint(p);\n    entries.push({ tileId: lastId + v, offset: 0, length: 0, runLength: 1 });\n    lastId += v;\n  }\n  for (let i = 0; i < numEntries; i++) {\n    entries[i].runLength = readVarint(p);\n  }\n  for (let i = 0; i < numEntries; i++) {\n    entries[i].length = readVarint(p);\n  }\n  for (let i = 0; i < numEntries; i++) {\n    const v = readVarint(p);\n    if (v === 0 && i > 0) {\n      entries[i].offset = entries[i - 1].offset + entries[i - 1].length;\n    } else {\n      entries[i].offset = v - 1;\n    }\n  }\n  return entries;\n}\nfunction detectVersion(a) {\n  const v = new DataView(a);\n  if (v.getUint16(2, true) === 2) {\n    console.warn(\n      \"PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade\"\n    );\n    return 2;\n  }\n  if (v.getUint16(2, true) === 1) {\n    console.warn(\n      \"PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade\"\n    );\n    return 1;\n  }\n  return 3;\n}\nvar EtagMismatch = class extends Error {\n};\nfunction getHeaderAndRoot(source, decompress) {\n  return __async(this, null, function* () {\n    const resp = yield source.getBytes(0, 16384);\n    const v = new DataView(resp.data);\n    if (v.getUint16(0, true) !== 19792) {\n      throw new Error(\"Wrong magic number for PMTiles archive\");\n    }\n    if (detectVersion(resp.data) < 3) {\n      return [yield v2_default.getHeader(source)];\n    }\n    const headerData = resp.data.slice(0, HEADER_SIZE_BYTES);\n    const header = bytesToHeader(headerData, resp.etag);\n    const rootDirData = resp.data.slice(\n      header.rootDirectoryOffset,\n      header.rootDirectoryOffset + header.rootDirectoryLength\n    );\n    const dirKey = `${source.getKey()}|${header.etag || \"\"}|${header.rootDirectoryOffset}|${header.rootDirectoryLength}`;\n    const rootDir = deserializeIndex(\n      yield decompress(rootDirData, header.internalCompression)\n    );\n    return [header, [dirKey, rootDir.length, rootDir]];\n  });\n}\nfunction getDirectory(source, decompress, offset, length, header) {\n  return __async(this, null, function* () {\n    const resp = yield source.getBytes(offset, length, void 0, header.etag);\n    const data = yield decompress(resp.data, header.internalCompression);\n    const directory = deserializeIndex(data);\n    if (directory.length === 0) {\n      throw new Error(\"Empty directory is invalid\");\n    }\n    return directory;\n  });\n}\nvar ResolvedValueCache = class {\n  constructor(maxCacheEntries = 100, prefetch = true, decompress = defaultDecompress) {\n    this.cache = /* @__PURE__ */ new Map();\n    this.maxCacheEntries = maxCacheEntries;\n    this.counter = 1;\n    this.decompress = decompress;\n  }\n  getHeader(source) {\n    return __async(this, null, function* () {\n      const cacheKey = source.getKey();\n      const cacheValue = this.cache.get(cacheKey);\n      if (cacheValue) {\n        cacheValue.lastUsed = this.counter++;\n        const data = cacheValue.data;\n        return data;\n      }\n      const res = yield getHeaderAndRoot(source, this.decompress);\n      if (res[1]) {\n        this.cache.set(res[1][0], {\n          lastUsed: this.counter++,\n          data: res[1][2]\n        });\n      }\n      this.cache.set(cacheKey, {\n        lastUsed: this.counter++,\n        data: res[0]\n      });\n      this.prune();\n      return res[0];\n    });\n  }\n  getDirectory(source, offset, length, header) {\n    return __async(this, null, function* () {\n      const cacheKey = `${source.getKey()}|${header.etag || \"\"}|${offset}|${length}`;\n      const cacheValue = this.cache.get(cacheKey);\n      if (cacheValue) {\n        cacheValue.lastUsed = this.counter++;\n        const data = cacheValue.data;\n        return data;\n      }\n      const directory = yield getDirectory(\n        source,\n        this.decompress,\n        offset,\n        length,\n        header\n      );\n      this.cache.set(cacheKey, {\n        lastUsed: this.counter++,\n        data: directory\n      });\n      this.prune();\n      return directory;\n    });\n  }\n  // for v2 backwards compatibility\n  getArrayBuffer(source, offset, length, header) {\n    return __async(this, null, function* () {\n      const cacheKey = `${source.getKey()}|${header.etag || \"\"}|${offset}|${length}`;\n      const cacheValue = this.cache.get(cacheKey);\n      if (cacheValue) {\n        cacheValue.lastUsed = this.counter++;\n        const data = yield cacheValue.data;\n        return data;\n      }\n      const resp = yield source.getBytes(offset, length, void 0, header.etag);\n      this.cache.set(cacheKey, {\n        lastUsed: this.counter++,\n        data: resp.data\n      });\n      this.prune();\n      return resp.data;\n    });\n  }\n  prune() {\n    if (this.cache.size > this.maxCacheEntries) {\n      let minUsed = Infinity;\n      let minKey = void 0;\n      this.cache.forEach((cacheValue, key) => {\n        if (cacheValue.lastUsed < minUsed) {\n          minUsed = cacheValue.lastUsed;\n          minKey = key;\n        }\n      });\n      if (minKey) {\n        this.cache.delete(minKey);\n      }\n    }\n  }\n  invalidate(source) {\n    return __async(this, null, function* () {\n      this.cache.delete(source.getKey());\n    });\n  }\n};\nvar SharedPromiseCache = class {\n  constructor(maxCacheEntries = 100, prefetch = true, decompress = defaultDecompress) {\n    this.cache = /* @__PURE__ */ new Map();\n    this.invalidations = /* @__PURE__ */ new Map();\n    this.maxCacheEntries = maxCacheEntries;\n    this.counter = 1;\n    this.decompress = decompress;\n  }\n  getHeader(source) {\n    return __async(this, null, function* () {\n      const cacheKey = source.getKey();\n      const cacheValue = this.cache.get(cacheKey);\n      if (cacheValue) {\n        cacheValue.lastUsed = this.counter++;\n        const data = yield cacheValue.data;\n        return data;\n      }\n      const p = new Promise((resolve, reject) => {\n        getHeaderAndRoot(source, this.decompress).then((res) => {\n          if (res[1]) {\n            this.cache.set(res[1][0], {\n              lastUsed: this.counter++,\n              data: Promise.resolve(res[1][2])\n            });\n          }\n          resolve(res[0]);\n          this.prune();\n        }).catch((e) => {\n          reject(e);\n        });\n      });\n      this.cache.set(cacheKey, { lastUsed: this.counter++, data: p });\n      return p;\n    });\n  }\n  getDirectory(source, offset, length, header) {\n    return __async(this, null, function* () {\n      const cacheKey = `${source.getKey()}|${header.etag || \"\"}|${offset}|${length}`;\n      const cacheValue = this.cache.get(cacheKey);\n      if (cacheValue) {\n        cacheValue.lastUsed = this.counter++;\n        const data = yield cacheValue.data;\n        return data;\n      }\n      const p = new Promise((resolve, reject) => {\n        getDirectory(source, this.decompress, offset, length, header).then((directory) => {\n          resolve(directory);\n          this.prune();\n        }).catch((e) => {\n          reject(e);\n        });\n      });\n      this.cache.set(cacheKey, { lastUsed: this.counter++, data: p });\n      return p;\n    });\n  }\n  // for v2 backwards compatibility\n  getArrayBuffer(source, offset, length, header) {\n    return __async(this, null, function* () {\n      const cacheKey = `${source.getKey()}|${header.etag || \"\"}|${offset}|${length}`;\n      const cacheValue = this.cache.get(cacheKey);\n      if (cacheValue) {\n        cacheValue.lastUsed = this.counter++;\n        const data = yield cacheValue.data;\n        return data;\n      }\n      const p = new Promise((resolve, reject) => {\n        source.getBytes(offset, length, void 0, header.etag).then((resp) => {\n          resolve(resp.data);\n          if (this.cache.has(cacheKey)) {\n          }\n          this.prune();\n        }).catch((e) => {\n          reject(e);\n        });\n      });\n      this.cache.set(cacheKey, { lastUsed: this.counter++, data: p });\n      return p;\n    });\n  }\n  prune() {\n    if (this.cache.size >= this.maxCacheEntries) {\n      let minUsed = Infinity;\n      let minKey = void 0;\n      this.cache.forEach((cacheValue, key) => {\n        if (cacheValue.lastUsed < minUsed) {\n          minUsed = cacheValue.lastUsed;\n          minKey = key;\n        }\n      });\n      if (minKey) {\n        this.cache.delete(minKey);\n      }\n    }\n  }\n  invalidate(source) {\n    return __async(this, null, function* () {\n      const key = source.getKey();\n      if (this.invalidations.get(key)) {\n        return yield this.invalidations.get(key);\n      }\n      this.cache.delete(source.getKey());\n      const p = new Promise((resolve, reject) => {\n        this.getHeader(source).then((h) => {\n          resolve();\n          this.invalidations.delete(key);\n        }).catch((e) => {\n          reject(e);\n        });\n      });\n      this.invalidations.set(key, p);\n    });\n  }\n};\nvar PMTiles = class {\n  constructor(source, cache, decompress) {\n    if (typeof source === \"string\") {\n      this.source = new FetchSource(source);\n    } else {\n      this.source = source;\n    }\n    if (decompress) {\n      this.decompress = decompress;\n    } else {\n      this.decompress = defaultDecompress;\n    }\n    if (cache) {\n      this.cache = cache;\n    } else {\n      this.cache = new SharedPromiseCache();\n    }\n  }\n  /**\n   * Return the header of the archive,\n   * including information such as tile type, min/max zoom, bounds, and summary statistics.\n   */\n  getHeader() {\n    return __async(this, null, function* () {\n      return yield this.cache.getHeader(this.source);\n    });\n  }\n  /** @hidden */\n  getZxyAttempt(z, x, y, signal) {\n    return __async(this, null, function* () {\n      const tileId = zxyToTileId(z, x, y);\n      const header = yield this.cache.getHeader(this.source);\n      if (header.specVersion < 3) {\n        return v2_default.getZxy(header, this.source, this.cache, z, x, y, signal);\n      }\n      if (z < header.minZoom || z > header.maxZoom) {\n        return void 0;\n      }\n      let dO = header.rootDirectoryOffset;\n      let dL = header.rootDirectoryLength;\n      for (let depth = 0; depth <= 3; depth++) {\n        const directory = yield this.cache.getDirectory(\n          this.source,\n          dO,\n          dL,\n          header\n        );\n        const entry = findTile(directory, tileId);\n        if (entry) {\n          if (entry.runLength > 0) {\n            const resp = yield this.source.getBytes(\n              header.tileDataOffset + entry.offset,\n              entry.length,\n              signal,\n              header.etag\n            );\n            return {\n              data: yield this.decompress(resp.data, header.tileCompression),\n              cacheControl: resp.cacheControl,\n              expires: resp.expires\n            };\n          }\n          dO = header.leafDirectoryOffset + entry.offset;\n          dL = entry.length;\n        } else {\n          return void 0;\n        }\n      }\n      throw Error(\"Maximum directory depth exceeded\");\n    });\n  }\n  /**\n   * Primary method to get a single tile bytes from an archive.\n   *\n   * Returns undefined if the tile does not exist in the archive.\n   */\n  getZxy(z, x, y, signal) {\n    return __async(this, null, function* () {\n      try {\n        return yield this.getZxyAttempt(z, x, y, signal);\n      } catch (e) {\n        if (e instanceof EtagMismatch) {\n          this.cache.invalidate(this.source);\n          return yield this.getZxyAttempt(z, x, y, signal);\n        }\n        throw e;\n      }\n    });\n  }\n  /** @hidden */\n  getMetadataAttempt() {\n    return __async(this, null, function* () {\n      const header = yield this.cache.getHeader(this.source);\n      const resp = yield this.source.getBytes(\n        header.jsonMetadataOffset,\n        header.jsonMetadataLength,\n        void 0,\n        header.etag\n      );\n      const decompressed = yield this.decompress(\n        resp.data,\n        header.internalCompression\n      );\n      const dec = new TextDecoder(\"utf-8\");\n      return JSON.parse(dec.decode(decompressed));\n    });\n  }\n  /**\n   * Return the arbitrary JSON metadata of the archive.\n   */\n  getMetadata() {\n    return __async(this, null, function* () {\n      try {\n        return yield this.getMetadataAttempt();\n      } catch (e) {\n        if (e instanceof EtagMismatch) {\n          this.cache.invalidate(this.source);\n          return yield this.getMetadataAttempt();\n        }\n        throw e;\n      }\n    });\n  }\n};\nexport {\n  Compression,\n  EtagMismatch,\n  FetchSource,\n  FileSource,\n  PMTiles,\n  Protocol,\n  ResolvedValueCache,\n  SharedPromiseCache,\n  TileType,\n  bytesToHeader,\n  findTile,\n  getUint64,\n  leafletRasterLayer,\n  readVarint,\n  tileIdToZxy,\n  zxyToTileId\n};\n","import Point from \"@mapbox/point-geometry\";\nimport { VectorTile } from \"@mapbox/vector-tile\";\nimport Protobuf from \"pbf\";\nimport { PMTiles } from \"pmtiles\";\n\nexport type JsonValue =\n  | boolean\n  | number\n  | string\n  | null\n  | JsonArray\n  | JsonObject;\nexport interface JsonObject {\n  [key: string]: JsonValue;\n}\nexport interface JsonArray extends Array<JsonValue> {}\n\nexport enum GeomType {\n  Point = 1,\n  Line = 2,\n  Polygon = 3,\n}\n\nexport interface Bbox {\n  minX: number;\n  minY: number;\n  maxX: number;\n  maxY: number;\n}\n\nexport interface Feature {\n  readonly props: JsonObject;\n  readonly bbox: Bbox;\n  readonly geomType: GeomType;\n  readonly geom: Point[][];\n  readonly numVertices: number;\n}\n\nexport interface Zxy {\n  readonly z: number;\n  readonly x: number;\n  readonly y: number;\n}\n\nexport function toIndex(c: Zxy): string {\n  return `${c.x}:${c.y}:${c.z}`;\n}\n\nexport interface TileSource {\n  get(c: Zxy, tileSize: number): Promise<Map<string, Feature[]>>;\n}\n\ninterface ZoomAbort {\n  z: number;\n  controller: AbortController;\n}\n\n// reimplement loadGeometry with a scalefactor\n// so the general tile rendering case does not need rescaling.\nconst loadGeomAndBbox = (pbf: Protobuf, geometry: number, scale: number) => {\n  pbf.pos = geometry;\n  const end = pbf.readVarint() + pbf.pos;\n  let cmd = 1;\n  let length = 0;\n  let x = 0;\n  let y = 0;\n  let x1 = Infinity;\n  let x2 = -Infinity;\n  let y1 = Infinity;\n  let y2 = -Infinity;\n\n  const lines: Point[][] = [];\n  let line: Point[] = [];\n  while (pbf.pos < end) {\n    if (length <= 0) {\n      const cmdLen = pbf.readVarint();\n      cmd = cmdLen & 0x7;\n      length = cmdLen >> 3;\n    }\n    length--;\n    if (cmd === 1 || cmd === 2) {\n      x += pbf.readSVarint() * scale;\n      y += pbf.readSVarint() * scale;\n      if (x < x1) x1 = x;\n      if (x > x2) x2 = x;\n      if (y < y1) y1 = y;\n      if (y > y2) y2 = y;\n      if (cmd === 1) {\n        if (line.length > 0) lines.push(line);\n        line = [];\n      }\n      line.push(new Point(x, y));\n    } else if (cmd === 7) {\n      if (line) line.push(line[0].clone());\n    } else throw new Error(`unknown command ${cmd}`);\n  }\n  if (line) lines.push(line);\n  return { geom: lines, bbox: { minX: x1, minY: y1, maxX: x2, maxY: y2 } };\n};\n\nfunction parseTile(\n  buffer: ArrayBuffer,\n  tileSize: number,\n): Map<string, Feature[]> {\n  const v = new VectorTile(new Protobuf(buffer));\n  const result = new Map<string, Feature[]>();\n  for (const [key, value] of Object.entries(v.layers)) {\n    const features = [];\n    // biome-ignore lint: need to use private fields of vector-tile\n    const layer = value as any;\n    for (let i = 0; i < layer.length; i++) {\n      const loaded = loadGeomAndBbox(\n        layer.feature(i)._pbf,\n        layer.feature(i)._geometry,\n        tileSize / layer.extent,\n      );\n      let numVertices = 0;\n      for (const part of loaded.geom) numVertices += part.length;\n      features.push({\n        id: layer.feature(i).id,\n        geomType: layer.feature(i).type,\n        geom: loaded.geom,\n        numVertices: numVertices,\n        bbox: loaded.bbox,\n        props: layer.feature(i).properties,\n      });\n    }\n    result.set(key, features);\n  }\n  return result;\n}\n\nexport class PmtilesSource implements TileSource {\n  p: PMTiles;\n  zoomaborts: ZoomAbort[];\n  shouldCancelZooms: boolean;\n\n  constructor(url: string | PMTiles, shouldCancelZooms: boolean) {\n    if (typeof url === \"string\") {\n      this.p = new PMTiles(url);\n    } else {\n      this.p = url;\n    }\n    this.zoomaborts = [];\n    this.shouldCancelZooms = shouldCancelZooms;\n  }\n\n  public async get(c: Zxy, tileSize: number): Promise<Map<string, Feature[]>> {\n    if (this.shouldCancelZooms) {\n      this.zoomaborts = this.zoomaborts.filter((za) => {\n        if (za.z !== c.z) {\n          za.controller.abort();\n          return false;\n        }\n        return true;\n      });\n    }\n    const controller = new AbortController();\n    this.zoomaborts.push({ z: c.z, controller: controller });\n    const signal = controller.signal;\n\n    const result = await this.p.getZxy(c.z, c.x, c.y, signal);\n\n    if (result) {\n      return parseTile(result.data, tileSize);\n    }\n    return new Map<string, Feature[]>();\n  }\n}\n\nexport class ZxySource implements TileSource {\n  url: string;\n  zoomaborts: ZoomAbort[];\n  shouldCancelZooms: boolean;\n\n  constructor(url: string, shouldCancelZooms: boolean) {\n    this.url = url;\n    this.zoomaborts = [];\n    this.shouldCancelZooms = shouldCancelZooms;\n  }\n\n  public async get(c: Zxy, tileSize: number): Promise<Map<string, Feature[]>> {\n    if (this.shouldCancelZooms) {\n      this.zoomaborts = this.zoomaborts.filter((za) => {\n        if (za.z !== c.z) {\n          za.controller.abort();\n          return false;\n        }\n        return true;\n      });\n    }\n    const url = this.url\n      .replace(\"{z}\", c.z.toString())\n      .replace(\"{x}\", c.x.toString())\n      .replace(\"{y}\", c.y.toString());\n    const controller = new AbortController();\n    this.zoomaborts.push({ z: c.z, controller: controller });\n    const signal = controller.signal;\n    return new Promise((resolve, reject) => {\n      fetch(url, { signal: signal })\n        .then((resp) => {\n          return resp.arrayBuffer();\n        })\n        .then((buffer) => {\n          const result = parseTile(buffer, tileSize);\n          resolve(result);\n        })\n        .catch((e) => {\n          reject(e);\n        });\n    });\n  }\n}\n\ninterface CacheEntry {\n  used: number;\n  data: Map<string, Feature[]>;\n}\n\ninterface PromiseOptions {\n  resolve: (result: Map<string, Feature[]>) => void;\n  reject: (e: Error) => void;\n}\n\nexport interface PickedFeature {\n  feature: Feature;\n  layerName: string;\n}\n\nconst R = 6378137;\nconst MAX_LATITUDE = 85.0511287798;\nconst MAXCOORD = R * Math.PI;\n\nconst project = (latlng: number[]) => {\n  const d = Math.PI / 180;\n  const constrainedLat = Math.max(\n    Math.min(MAX_LATITUDE, latlng[0]),\n    -MAX_LATITUDE,\n  );\n  const sin = Math.sin(constrainedLat * d);\n  return new Point(\n    R * latlng[1] * d,\n    (R * Math.log((1 + sin) / (1 - sin))) / 2,\n  );\n};\n\nfunction sqr(x: number) {\n  return x * x;\n}\n\nfunction dist2(v: Point, w: Point) {\n  return sqr(v.x - w.x) + sqr(v.y - w.y);\n}\n\nfunction distToSegmentSquared(p: Point, v: Point, w: Point) {\n  const l2 = dist2(v, w);\n  if (l2 === 0) return dist2(p, v);\n  let t = ((p.x - v.x) * (w.x - v.x) + (p.y - v.y) * (w.y - v.y)) / l2;\n  t = Math.max(0, Math.min(1, t));\n  return dist2(p, new Point(v.x + t * (w.x - v.x), v.y + t * (w.y - v.y)));\n}\n\nexport function isInRing(point: Point, ring: Point[]): boolean {\n  let inside = false;\n  for (let i = 0, j = ring.length - 1; i < ring.length; j = i++) {\n    const xi = ring[i].x;\n    const yi = ring[i].y;\n    const xj = ring[j].x;\n    const yj = ring[j].y;\n    const intersect =\n      yi > point.y !== yj > point.y &&\n      point.x < ((xj - xi) * (point.y - yi)) / (yj - yi) + xi;\n    if (intersect) inside = !inside;\n  }\n  return inside;\n}\n\nexport function isCcw(ring: Point[]): boolean {\n  let area = 0;\n  for (let i = 0; i < ring.length; i++) {\n    const j = (i + 1) % ring.length;\n    area += ring[i].x * ring[j].y;\n    area -= ring[j].x * ring[i].y;\n  }\n  return area < 0;\n}\n\nexport function pointInPolygon(point: Point, geom: Point[][]): boolean {\n  let isInCurrentExterior = false;\n  for (const ring of geom) {\n    if (isCcw(ring)) {\n      // it is an interior ring\n      if (isInRing(point, ring)) isInCurrentExterior = false;\n    } else {\n      // it is an exterior ring\n      if (isInCurrentExterior) return true;\n      if (isInRing(point, ring)) isInCurrentExterior = true;\n    }\n  }\n  return isInCurrentExterior;\n}\n\nexport function pointMinDistToPoints(point: Point, geom: Point[][]): number {\n  let min = Infinity;\n  for (const l of geom) {\n    const dist = Math.sqrt(dist2(point, l[0]));\n    if (dist < min) min = dist;\n  }\n  return min;\n}\n\nexport function pointMinDistToLines(point: Point, geom: Point[][]): number {\n  let min = Infinity;\n  for (const l of geom) {\n    for (let i = 0; i < l.length - 1; i++) {\n      const dist = Math.sqrt(distToSegmentSquared(point, l[i], l[i + 1]));\n      if (dist < min) min = dist;\n    }\n  }\n  return min;\n}\n\nexport class TileCache {\n  source: TileSource;\n  cache: Map<string, CacheEntry>;\n  inflight: Map<string, PromiseOptions[]>;\n  tileSize: number;\n\n  constructor(source: TileSource, tileSize: number) {\n    this.source = source;\n    this.cache = new Map<string, CacheEntry>();\n    this.inflight = new Map<string, PromiseOptions[]>();\n    this.tileSize = tileSize;\n  }\n\n  public async get(c: Zxy): Promise<Map<string, Feature[]>> {\n    const idx = toIndex(c);\n    return new Promise((resolve, reject) => {\n      const entry = this.cache.get(idx);\n      if (entry) {\n        entry.used = performance.now();\n        resolve(entry.data);\n      } else {\n        const ifentry = this.inflight.get(idx);\n        if (ifentry) {\n          ifentry.push({ resolve: resolve, reject: reject });\n        } else {\n          this.inflight.set(idx, []);\n          this.source\n            .get(c, this.tileSize)\n            .then((tile) => {\n              this.cache.set(idx, { used: performance.now(), data: tile });\n\n              const ifentry2 = this.inflight.get(idx);\n              if (ifentry2) {\n                for (const f of ifentry2) {\n                  f.resolve(tile);\n                }\n              }\n              this.inflight.delete(idx);\n              resolve(tile);\n\n              if (this.cache.size >= 64) {\n                let minUsed = +Infinity;\n                let minKey = undefined;\n                this.cache.forEach((value, key) => {\n                  if (value.used < minUsed) {\n                    minUsed = value.used;\n                    minKey = key;\n                  }\n                });\n                if (minKey) this.cache.delete(minKey);\n              }\n            })\n            .catch((e) => {\n              const ifentry2 = this.inflight.get(idx);\n              if (ifentry2) {\n                for (const f of ifentry2) {\n                  f.reject(e);\n                }\n              }\n              this.inflight.delete(idx);\n              reject(e);\n            });\n        }\n      }\n    });\n  }\n\n  public queryFeatures(\n    lng: number,\n    lat: number,\n    zoom: number,\n    brushSize: number,\n  ): PickedFeature[] {\n    const projected = project([lat, lng]);\n    const normalized = new Point(\n      (projected.x + MAXCOORD) / (MAXCOORD * 2),\n      1 - (projected.y + MAXCOORD) / (MAXCOORD * 2),\n    );\n    if (normalized.x > 1)\n      normalized.x = normalized.x - Math.floor(normalized.x);\n    const onZoom = normalized.mult(1 << zoom);\n    const tileX = Math.floor(onZoom.x);\n    const tileY = Math.floor(onZoom.y);\n    const idx = toIndex({ z: zoom, x: tileX, y: tileY });\n    const retval: PickedFeature[] = [];\n    const entry = this.cache.get(idx);\n    if (entry) {\n      const center = new Point(\n        (onZoom.x - tileX) * this.tileSize,\n        (onZoom.y - tileY) * this.tileSize,\n      );\n      for (const [layerName, layerArr] of entry.data.entries()) {\n        for (const feature of layerArr) {\n          if (feature.geomType === GeomType.Point) {\n            if (pointMinDistToPoints(center, feature.geom) < brushSize) {\n              retval.push({ feature, layerName: layerName });\n            }\n          } else if (feature.geomType === GeomType.Line) {\n            if (pointMinDistToLines(center, feature.geom) < brushSize) {\n              retval.push({ feature, layerName: layerName });\n            }\n          } else {\n            if (pointInPolygon(center, feature.geom)) {\n              retval.push({ feature, layerName: layerName });\n            }\n          }\n        }\n      }\n    }\n    return retval;\n  }\n}\n","import Point from \"@mapbox/point-geometry\";\nimport {\n  ArrayAttr,\n  AttrOption,\n  FontAttr,\n  FontAttrOptions,\n  NumberAttr,\n  StringAttr,\n  TextAttr,\n  TextAttrOptions,\n} from \"./attribute\";\nimport { Label, Layout } from \"./labeler\";\nimport { lineCells, simpleLabel } from \"./line\";\nimport { Sheet } from \"./task\";\nimport { linebreak } from \"./text\";\nimport { Bbox, Feature, GeomType } from \"./tilecache\";\n\nexport interface PaintSymbolizer {\n  before?(ctx: CanvasRenderingContext2D, z: number): void;\n  draw(\n    ctx: CanvasRenderingContext2D,\n    geom: Point[][],\n    z: number,\n    feature: Feature,\n  ): void;\n}\n\nexport enum Justify {\n  Left = 1,\n  Center = 2,\n  Right = 3,\n}\n\nexport enum TextPlacements {\n  N = 1,\n  Ne = 2,\n  E = 3,\n  Se = 4,\n  S = 5,\n  Sw = 6,\n  W = 7,\n  Nw = 8,\n}\n\nexport interface DrawExtra {\n  justify: Justify;\n}\n\nexport interface LabelSymbolizer {\n  /* the symbolizer can, but does not need to, inspect index to determine the right position\n   * if return undefined, no label is added\n   * return a label, but if the label collides it is not added\n   */\n  place(layout: Layout, geom: Point[][], feature: Feature): Label[] | undefined;\n}\n\nexport const createPattern = (\n  width: number,\n  height: number,\n  fn: (canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D) => void,\n) => {\n  const canvas = document.createElement(\"canvas\");\n  const ctx = canvas.getContext(\"2d\");\n  canvas.width = width;\n  canvas.height = height;\n  if (ctx !== null) fn(canvas, ctx);\n  return canvas;\n};\n\nexport class PolygonSymbolizer implements PaintSymbolizer {\n  pattern?: CanvasImageSource;\n  fill: StringAttr;\n  opacity: NumberAttr;\n  stroke: StringAttr;\n  width: NumberAttr;\n  perFeature: boolean;\n  doStroke: boolean;\n\n  constructor(options: {\n    pattern?: CanvasImageSource;\n    fill?: AttrOption<string>;\n    opacity?: AttrOption<number>;\n    stroke?: AttrOption<string>;\n    width?: AttrOption<number>;\n    perFeature?: boolean;\n  }) {\n    this.pattern = options.pattern;\n    this.fill = new StringAttr(options.fill, \"black\");\n    this.opacity = new NumberAttr(options.opacity, 1);\n    this.stroke = new StringAttr(options.stroke, \"black\");\n    this.width = new NumberAttr(options.width, 0);\n    this.perFeature =\n      (this.fill.perFeature ||\n        this.opacity.perFeature ||\n        this.stroke.perFeature ||\n        this.width.perFeature ||\n        options.perFeature) ??\n      false;\n    this.doStroke = false;\n  }\n\n  public before(ctx: CanvasRenderingContext2D, z: number) {\n    if (!this.perFeature) {\n      ctx.globalAlpha = this.opacity.get(z);\n      ctx.fillStyle = this.fill.get(z);\n      ctx.strokeStyle = this.stroke.get(z);\n      const width = this.width.get(z);\n      if (width > 0) this.doStroke = true;\n      ctx.lineWidth = width;\n    }\n    if (this.pattern) {\n      const patten = ctx.createPattern(this.pattern, \"repeat\");\n      if (patten) ctx.fillStyle = patten;\n    }\n  }\n\n  public draw(\n    ctx: CanvasRenderingContext2D,\n    geom: Point[][],\n    z: number,\n    f: Feature,\n  ) {\n    let doStroke = false;\n    if (this.perFeature) {\n      ctx.globalAlpha = this.opacity.get(z, f);\n      ctx.fillStyle = this.fill.get(z, f);\n      const width = this.width.get(z, f);\n      if (width) {\n        doStroke = true;\n        ctx.strokeStyle = this.stroke.get(z, f);\n        ctx.lineWidth = width;\n      }\n    }\n\n    const drawPath = () => {\n      ctx.fill();\n      if (doStroke || this.doStroke) {\n        ctx.stroke();\n      }\n    };\n\n    ctx.beginPath();\n    for (const poly of geom) {\n      for (let p = 0; p < poly.length; p++) {\n        const pt = poly[p];\n        if (p === 0) ctx.moveTo(pt.x, pt.y);\n        else ctx.lineTo(pt.x, pt.y);\n      }\n    }\n    drawPath();\n  }\n}\n\nexport function arr(base: number, a: number[]): (z: number) => number {\n  return (z) => {\n    const b = z - base;\n    if (b >= 0 && b < a.length) {\n      return a[b];\n    }\n    return 0;\n  };\n}\n\nfunction getStopIndex(input: number, stops: number[][]): number {\n  let idx = 0;\n  while (stops[idx + 1][0] < input) idx++;\n  return idx;\n}\n\nfunction interpolate(factor: number, start: number, end: number): number {\n  return factor * (end - start) + start;\n}\n\nfunction computeInterpolationFactor(\n  z: number,\n  idx: number,\n  base: number,\n  stops: number[][],\n): number {\n  const difference = stops[idx + 1][0] - stops[idx][0];\n  const progress = z - stops[idx][0];\n  if (difference === 0) return 0;\n  if (base === 1) return progress / difference;\n  return (base ** progress - 1) / (base ** difference - 1);\n}\n\nexport function exp(base: number, stops: number[][]): (z: number) => number {\n  return (z) => {\n    if (stops.length < 1) return 0;\n    if (z <= stops[0][0]) return stops[0][1];\n    if (z >= stops[stops.length - 1][0]) return stops[stops.length - 1][1];\n    const idx = getStopIndex(z, stops);\n    const factor = computeInterpolationFactor(z, idx, base, stops);\n    return interpolate(factor, stops[idx][1], stops[idx + 1][1]);\n  };\n}\n\nexport type Stop = [number, number] | [number, string] | [number, boolean];\nexport function step(\n  output0: number | string | boolean,\n  stops: Stop[],\n): (z: number) => number | string | boolean {\n  // Step computes discrete results by evaluating a piecewise-constant\n  // function defined by stops.\n  // Returns the output value of the stop with a stop input value just less than\n  // the input one. If the input value is less than the input of the first stop,\n  // output0 is returned\n  return (z) => {\n    if (stops.length < 1) return 0;\n    let retval = output0;\n    for (let i = 0; i < stops.length; i++) {\n      if (z >= stops[i][0]) retval = stops[i][1];\n    }\n    return retval;\n  };\n}\n\nexport function linear(stops: number[][]): (z: number) => number {\n  return exp(1, stops);\n}\n\nexport class LineSymbolizer implements PaintSymbolizer {\n  color: StringAttr;\n  width: NumberAttr;\n  opacity: NumberAttr;\n  dash: ArrayAttr<number> | null;\n  dashColor: StringAttr;\n  dashWidth: NumberAttr;\n  skip: boolean;\n  perFeature: boolean;\n  lineCap: StringAttr<CanvasLineCap>;\n  lineJoin: StringAttr<CanvasLineJoin>;\n\n  constructor(options: {\n    color?: AttrOption<string>;\n    width?: AttrOption<number>;\n    opacity?: AttrOption<number>;\n    dash?: number[];\n    dashColor?: AttrOption<string>;\n    dashWidth?: AttrOption<number>;\n    skip?: boolean;\n    perFeature?: boolean;\n    lineCap?: AttrOption<CanvasLineCap>;\n    lineJoin?: AttrOption<CanvasLineJoin>;\n  }) {\n    this.color = new StringAttr(options.color, \"black\");\n    this.width = new NumberAttr(options.width);\n    this.opacity = new NumberAttr(options.opacity);\n    this.dash = options.dash ? new ArrayAttr(options.dash) : null;\n    this.dashColor = new StringAttr(options.dashColor, \"black\");\n    this.dashWidth = new NumberAttr(options.dashWidth, 1.0);\n    this.lineCap = new StringAttr(options.lineCap, \"butt\");\n    this.lineJoin = new StringAttr(options.lineJoin, \"miter\");\n    this.skip = false;\n    this.perFeature = !!(\n      this.dash?.perFeature ||\n      this.color.perFeature ||\n      this.opacity.perFeature ||\n      this.width.perFeature ||\n      this.lineCap.perFeature ||\n      this.lineJoin.perFeature ||\n      options.perFeature\n    );\n  }\n\n  public before(ctx: CanvasRenderingContext2D, z: number) {\n    if (!this.perFeature) {\n      ctx.strokeStyle = this.color.get(z);\n      ctx.lineWidth = this.width.get(z);\n      ctx.globalAlpha = this.opacity.get(z);\n      ctx.lineCap = this.lineCap.get(z);\n      ctx.lineJoin = this.lineJoin.get(z);\n    }\n  }\n\n  public draw(\n    ctx: CanvasRenderingContext2D,\n    geom: Point[][],\n    z: number,\n    f: Feature,\n  ) {\n    if (this.skip) return;\n\n    const strokePath = () => {\n      if (this.perFeature) {\n        ctx.globalAlpha = this.opacity.get(z, f);\n        ctx.lineCap = this.lineCap.get(z, f);\n        ctx.lineJoin = this.lineJoin.get(z, f);\n      }\n      if (this.dash) {\n        ctx.save();\n        if (this.perFeature) {\n          ctx.lineWidth = this.dashWidth.get(z, f);\n          ctx.strokeStyle = this.dashColor.get(z, f);\n          ctx.setLineDash(this.dash.get(z, f));\n        } else {\n          ctx.setLineDash(this.dash.get(z));\n        }\n        ctx.stroke();\n        ctx.restore();\n      } else {\n        ctx.save();\n        if (this.perFeature) {\n          ctx.lineWidth = this.width.get(z, f);\n          ctx.strokeStyle = this.color.get(z, f);\n        }\n        ctx.stroke();\n        ctx.restore();\n      }\n    };\n\n    ctx.beginPath();\n    for (const ls of geom) {\n      for (let p = 0; p < ls.length; p++) {\n        const pt = ls[p];\n        if (p === 0) ctx.moveTo(pt.x, pt.y);\n        else ctx.lineTo(pt.x, pt.y);\n      }\n    }\n    strokePath();\n  }\n}\n\nexport interface IconSymbolizerOptions {\n  name: string;\n  sheet: Sheet;\n}\nexport class IconSymbolizer implements LabelSymbolizer {\n  name: string;\n  sheet: Sheet;\n  dpr: number;\n\n  constructor(options: IconSymbolizerOptions) {\n    this.name = options.name;\n    this.sheet = options.sheet;\n    this.dpr = window.devicePixelRatio;\n  }\n\n  public place(layout: Layout, geom: Point[][], feature: Feature) {\n    const pt = geom[0];\n    const a = new Point(geom[0][0].x, geom[0][0].y);\n    const loc = this.sheet.get(this.name);\n    const width = loc.w / this.dpr;\n    const height = loc.h / this.dpr;\n\n    const bbox = {\n      minX: a.x - width / 2,\n      minY: a.y - height / 2,\n      maxX: a.x + width / 2,\n      maxY: a.y + height / 2,\n    };\n\n    const draw = (ctx: CanvasRenderingContext2D) => {\n      ctx.globalAlpha = 1;\n      ctx.drawImage(\n        this.sheet.canvas,\n        loc.x,\n        loc.y,\n        loc.w,\n        loc.h,\n        -loc.w / 2 / this.dpr,\n        -loc.h / 2 / this.dpr,\n        loc.w / 2,\n        loc.h / 2,\n      );\n    };\n    return [{ anchor: a, bboxes: [bbox], draw: draw }];\n  }\n}\n\nexport class CircleSymbolizer implements LabelSymbolizer, PaintSymbolizer {\n  radius: NumberAttr;\n  fill: StringAttr;\n  stroke: StringAttr;\n  width: NumberAttr;\n  opacity: NumberAttr;\n\n  constructor(options: {\n    radius?: AttrOption<number>;\n    fill?: AttrOption<string>;\n    stroke?: AttrOption<string>;\n    width?: AttrOption<number>;\n    opacity?: AttrOption<number>;\n  }) {\n    this.radius = new NumberAttr(options.radius, 3);\n    this.fill = new StringAttr(options.fill, \"black\");\n    this.stroke = new StringAttr(options.stroke, \"white\");\n    this.width = new NumberAttr(options.width, 0);\n    this.opacity = new NumberAttr(options.opacity);\n  }\n\n  public draw(\n    ctx: CanvasRenderingContext2D,\n    geom: Point[][],\n    z: number,\n    f: Feature,\n  ) {\n    ctx.globalAlpha = this.opacity.get(z, f);\n\n    const radius = this.radius.get(z, f);\n    const width = this.width.get(z, f);\n    if (width > 0) {\n      ctx.strokeStyle = this.stroke.get(z, f);\n      ctx.lineWidth = width;\n      ctx.beginPath();\n      ctx.arc(geom[0][0].x, geom[0][0].y, radius + width / 2, 0, 2 * Math.PI);\n      ctx.stroke();\n    }\n\n    ctx.fillStyle = this.fill.get(z, f);\n    ctx.beginPath();\n    ctx.arc(geom[0][0].x, geom[0][0].y, radius, 0, 2 * Math.PI);\n    ctx.fill();\n  }\n\n  public place(layout: Layout, geom: Point[][], feature: Feature) {\n    const pt = geom[0];\n    const a = new Point(geom[0][0].x, geom[0][0].y);\n    const radius = this.radius.get(layout.zoom, feature);\n    const bbox = {\n      minX: a.x - radius,\n      minY: a.y - radius,\n      maxX: a.x + radius,\n      maxY: a.y + radius,\n    };\n\n    const draw = (ctx: CanvasRenderingContext2D) => {\n      this.draw(ctx, [[new Point(0, 0)]], layout.zoom, feature);\n    };\n    return [{ anchor: a, bboxes: [bbox], draw }];\n  }\n}\n\nexport class ShieldSymbolizer implements LabelSymbolizer {\n  font: FontAttr;\n  text: TextAttr;\n  background: StringAttr;\n  fill: StringAttr;\n  padding: NumberAttr;\n\n  constructor(\n    options: {\n      fill?: AttrOption<string>;\n      background?: AttrOption<string>;\n      padding?: AttrOption<number>;\n    } & FontAttrOptions &\n      TextAttrOptions,\n  ) {\n    this.font = new FontAttr(options);\n    this.text = new TextAttr(options);\n    this.fill = new StringAttr(options.fill, \"black\");\n    this.background = new StringAttr(options.background, \"white\");\n    this.padding = new NumberAttr(options.padding, 0); // TODO check falsy\n  }\n\n  public place(layout: Layout, geom: Point[][], f: Feature) {\n    const property = this.text.get(layout.zoom, f);\n    if (!property) return undefined;\n    const font = this.font.get(layout.zoom, f);\n    layout.scratch.font = font;\n    const metrics = layout.scratch.measureText(property);\n\n    const width = metrics.width;\n    const ascent = metrics.actualBoundingBoxAscent;\n    const descent = metrics.actualBoundingBoxDescent;\n\n    const pt = geom[0];\n    const a = new Point(geom[0][0].x, geom[0][0].y);\n    const p = this.padding.get(layout.zoom, f);\n    const bbox = {\n      minX: a.x - width / 2 - p,\n      minY: a.y - ascent - p,\n      maxX: a.x + width / 2 + p,\n      maxY: a.y + descent + p,\n    };\n\n    const draw = (ctx: CanvasRenderingContext2D) => {\n      ctx.globalAlpha = 1;\n      ctx.fillStyle = this.background.get(layout.zoom, f);\n      ctx.fillRect(\n        -width / 2 - p,\n        -ascent - p,\n        width + 2 * p,\n        ascent + descent + 2 * p,\n      );\n      ctx.fillStyle = this.fill.get(layout.zoom, f);\n      ctx.font = font;\n      ctx.fillText(property, -width / 2, 0);\n    };\n    return [{ anchor: a, bboxes: [bbox], draw: draw }];\n  }\n}\n\n// TODO make me work with multiple anchors\nexport class FlexSymbolizer implements LabelSymbolizer {\n  list: LabelSymbolizer[];\n\n  constructor(list: LabelSymbolizer[]) {\n    this.list = list;\n  }\n\n  public place(layout: Layout, geom: Point[][], feature: Feature) {\n    let labels = this.list[0].place(layout, geom, feature);\n    if (!labels) return undefined;\n    let label = labels[0];\n    const anchor = label.anchor;\n    let bbox = label.bboxes[0];\n    const height = bbox.maxY - bbox.minY;\n    const draws = [{ draw: label.draw, translate: { x: 0, y: 0 } }];\n\n    const newGeom = [[new Point(geom[0][0].x, geom[0][0].y + height)]];\n    for (let i = 1; i < this.list.length; i++) {\n      labels = this.list[i].place(layout, newGeom, feature);\n      if (labels) {\n        label = labels[0];\n        bbox = mergeBbox(bbox, label.bboxes[0]);\n        draws.push({ draw: label.draw, translate: { x: 0, y: height } });\n      }\n    }\n\n    const draw = (ctx: CanvasRenderingContext2D) => {\n      for (const sub of draws) {\n        ctx.save();\n        ctx.translate(sub.translate.x, sub.translate.y);\n        sub.draw(ctx);\n        ctx.restore();\n      }\n    };\n\n    return [{ anchor: anchor, bboxes: [bbox], draw: draw }];\n  }\n}\n\nconst mergeBbox = (b1: Bbox, b2: Bbox) => {\n  return {\n    minX: Math.min(b1.minX, b2.minX),\n    minY: Math.min(b1.minY, b2.minY),\n    maxX: Math.max(b1.maxX, b2.maxX),\n    maxY: Math.max(b1.maxY, b2.maxY),\n  };\n};\n\nexport class GroupSymbolizer implements LabelSymbolizer {\n  list: LabelSymbolizer[];\n\n  constructor(list: LabelSymbolizer[]) {\n    this.list = list;\n  }\n\n  public place(layout: Layout, geom: Point[][], feature: Feature) {\n    const first = this.list[0];\n    if (!first) return undefined;\n    let labels = first.place(layout, geom, feature);\n    if (!labels) return undefined;\n    let label = labels[0];\n    const anchor = label.anchor;\n    let bbox = label.bboxes[0];\n    const draws = [label.draw];\n\n    for (let i = 1; i < this.list.length; i++) {\n      labels = this.list[i].place(layout, geom, feature);\n      if (!labels) return undefined;\n      label = labels[0];\n      bbox = mergeBbox(bbox, label.bboxes[0]);\n      draws.push(label.draw);\n    }\n    const draw = (ctx: CanvasRenderingContext2D) => {\n      for (const d of draws) {\n        d(ctx);\n      }\n    };\n\n    return [{ anchor: anchor, bboxes: [bbox], draw: draw }];\n  }\n}\n\nexport class CenteredSymbolizer implements LabelSymbolizer {\n  symbolizer: LabelSymbolizer;\n\n  constructor(symbolizer: LabelSymbolizer) {\n    this.symbolizer = symbolizer;\n  }\n\n  public place(layout: Layout, geom: Point[][], feature: Feature) {\n    const a = geom[0][0];\n    const placed = this.symbolizer.place(layout, [[new Point(0, 0)]], feature);\n    if (!placed || placed.length === 0) return undefined;\n    const firstLabel = placed[0];\n    const bbox = firstLabel.bboxes[0];\n    const width = bbox.maxX - bbox.minX;\n    const height = bbox.maxY - bbox.minY;\n    const centered = {\n      minX: a.x - width / 2,\n      maxX: a.x + width / 2,\n      minY: a.y - height / 2,\n      maxY: a.y + height / 2,\n    };\n\n    const draw = (ctx: CanvasRenderingContext2D) => {\n      ctx.translate(-width / 2, height / 2 - bbox.maxY);\n      firstLabel.draw(ctx, { justify: Justify.Center });\n    };\n\n    return [{ anchor: a, bboxes: [centered], draw: draw }];\n  }\n}\n\nexport class Padding implements LabelSymbolizer {\n  symbolizer: LabelSymbolizer;\n  padding: NumberAttr;\n\n  constructor(padding: number, symbolizer: LabelSymbolizer) {\n    this.padding = new NumberAttr(padding, 0);\n    this.symbolizer = symbolizer;\n  }\n\n  public place(layout: Layout, geom: Point[][], feature: Feature) {\n    const placed = this.symbolizer.place(layout, geom, feature);\n    if (!placed || placed.length === 0) return undefined;\n    const padding = this.padding.get(layout.zoom, feature);\n    for (const label of placed) {\n      for (const bbox of label.bboxes) {\n        bbox.minX -= padding;\n        bbox.minY -= padding;\n        bbox.maxX += padding;\n        bbox.maxY += padding;\n      }\n    }\n    return placed;\n  }\n}\n\nexport interface TextSymbolizerOptions\n  extends FontAttrOptions,\n    TextAttrOptions {\n  fill?: AttrOption<string>;\n  stroke?: AttrOption<string>;\n  width?: AttrOption<number>;\n  lineHeight?: AttrOption<number>;\n  letterSpacing?: AttrOption<number>;\n  maxLineChars?: AttrOption<number>;\n  justify?: Justify;\n}\n\nexport class TextSymbolizer implements LabelSymbolizer {\n  font: FontAttr;\n  text: TextAttr;\n  fill: StringAttr;\n  stroke: StringAttr;\n  width: NumberAttr;\n  lineHeight: NumberAttr; // in ems\n  letterSpacing: NumberAttr; // in px\n  maxLineCodeUnits: NumberAttr;\n  justify?: Justify;\n\n  constructor(options: TextSymbolizerOptions) {\n    this.font = new FontAttr(options);\n    this.text = new TextAttr(options);\n\n    this.fill = new StringAttr(options.fill, \"black\");\n    this.stroke = new StringAttr(options.stroke, \"black\");\n    this.width = new NumberAttr(options.width, 0);\n    this.lineHeight = new NumberAttr(options.lineHeight, 1);\n    this.letterSpacing = new NumberAttr(options.letterSpacing, 0);\n    this.maxLineCodeUnits = new NumberAttr(options.maxLineChars, 15);\n    this.justify = options.justify;\n  }\n\n  public place(layout: Layout, geom: Point[][], feature: Feature) {\n    const property = this.text.get(layout.zoom, feature);\n    if (!property) return undefined;\n    const font = this.font.get(layout.zoom, feature);\n    layout.scratch.font = font;\n\n    const letterSpacing = this.letterSpacing.get(layout.zoom, feature);\n\n    // line breaking\n    const lines = linebreak(\n      property,\n      this.maxLineCodeUnits.get(layout.zoom, feature),\n    );\n    let longestLine = \"\";\n    let longestLineLen = 0;\n    for (const line of lines) {\n      if (line.length > longestLineLen) {\n        longestLineLen = line.length;\n        longestLine = line;\n      }\n    }\n\n    const metrics = layout.scratch.measureText(longestLine);\n    const width = metrics.width + letterSpacing * (longestLineLen - 1);\n\n    const ascent = metrics.actualBoundingBoxAscent;\n    const descent = metrics.actualBoundingBoxDescent;\n    const lineHeight =\n      (ascent + descent) * this.lineHeight.get(layout.zoom, feature);\n\n    const a = new Point(geom[0][0].x, geom[0][0].y);\n    const bbox = {\n      minX: a.x,\n      minY: a.y - ascent,\n      maxX: a.x + width,\n      maxY: a.y + descent + (lines.length - 1) * lineHeight,\n    };\n\n    // inside draw, the origin is the anchor\n    // and the anchor is the typographic baseline of the first line\n    const draw = (ctx: CanvasRenderingContext2D, extra?: DrawExtra) => {\n      ctx.globalAlpha = 1;\n      ctx.font = font;\n      ctx.fillStyle = this.fill.get(layout.zoom, feature);\n      const textStrokeWidth = this.width.get(layout.zoom, feature);\n\n      let y = 0;\n      for (const line of lines) {\n        let startX = 0;\n        if (\n          this.justify === Justify.Center ||\n          (extra && extra.justify === Justify.Center)\n        ) {\n          startX = (width - ctx.measureText(line).width) / 2;\n        } else if (\n          this.justify === Justify.Right ||\n          (extra && extra.justify === Justify.Right)\n        ) {\n          startX = width - ctx.measureText(line).width;\n        }\n        if (textStrokeWidth) {\n          ctx.lineWidth = textStrokeWidth * 2; // centered stroke\n          ctx.strokeStyle = this.stroke.get(layout.zoom, feature);\n          if (letterSpacing > 0) {\n            let xPos = startX;\n            for (const letter of line) {\n              ctx.strokeText(letter, xPos, y);\n              xPos += ctx.measureText(letter).width + letterSpacing;\n            }\n          } else {\n            ctx.strokeText(line, startX, y);\n          }\n        }\n        if (letterSpacing > 0) {\n          let xPos = startX;\n          for (const letter of line) {\n            ctx.fillText(letter, xPos, y);\n            xPos += ctx.measureText(letter).width + letterSpacing;\n          }\n        } else {\n          ctx.fillText(line, startX, y);\n        }\n        y += lineHeight;\n      }\n    };\n    return [{ anchor: a, bboxes: [bbox], draw: draw }];\n  }\n}\n\nexport class CenteredTextSymbolizer implements LabelSymbolizer {\n  centered: LabelSymbolizer;\n\n  constructor(options: TextSymbolizerOptions) {\n    this.centered = new CenteredSymbolizer(new TextSymbolizer(options));\n  }\n\n  public place(layout: Layout, geom: Point[][], feature: Feature) {\n    return this.centered.place(layout, geom, feature);\n  }\n}\n\nexport interface OffsetSymbolizerValues {\n  offsetX?: number;\n  offsetY?: number;\n  placements?: TextPlacements[];\n  justify?: Justify;\n}\n\nexport type DataDrivenOffsetSymbolizer = (\n  zoom: number,\n  feature: Feature,\n) => OffsetSymbolizerValues;\n\nexport interface OffsetSymbolizerOptions {\n  offsetX?: AttrOption<number>;\n  offsetY?: AttrOption<number>;\n  justify?: Justify;\n  placements?: TextPlacements[];\n  ddValues?: DataDrivenOffsetSymbolizer;\n}\n\nexport class OffsetSymbolizer implements LabelSymbolizer {\n  symbolizer: LabelSymbolizer;\n  offsetX: NumberAttr;\n  offsetY: NumberAttr;\n  justify?: Justify;\n  placements: TextPlacements[];\n  ddValues: DataDrivenOffsetSymbolizer;\n\n  constructor(symbolizer: LabelSymbolizer, options: OffsetSymbolizerOptions) {\n    this.symbolizer = symbolizer;\n    this.offsetX = new NumberAttr(options.offsetX, 0);\n    this.offsetY = new NumberAttr(options.offsetY, 0);\n    this.justify = options.justify ?? undefined;\n    this.placements = options.placements ?? [\n      TextPlacements.Ne,\n      TextPlacements.Sw,\n      TextPlacements.Nw,\n      TextPlacements.Se,\n      TextPlacements.N,\n      TextPlacements.E,\n      TextPlacements.S,\n      TextPlacements.W,\n    ];\n    this.ddValues =\n      options.ddValues ??\n      (() => {\n        return {};\n      });\n  }\n\n  public place(layout: Layout, geom: Point[][], feature: Feature) {\n    if (feature.geomType !== GeomType.Point) return undefined;\n    const anchor = geom[0][0];\n    const placed = this.symbolizer.place(layout, [[new Point(0, 0)]], feature);\n    if (!placed || placed.length === 0) return undefined;\n    const firstLabel = placed[0];\n    const fb = firstLabel.bboxes[0];\n\n    // Overwrite options values via the data driven function if exists\n    let offsetXvalue = this.offsetX;\n    let offsetYvalue = this.offsetY;\n    let justifyValue = this.justify;\n    let placements = this.placements;\n    const {\n      offsetX: ddOffsetX,\n      offsetY: ddOffsetY,\n      justify: ddJustify,\n      placements: ddPlacements,\n    } = this.ddValues(layout.zoom, feature) || {};\n    if (ddOffsetX) offsetXvalue = new NumberAttr(ddOffsetX, 0);\n    if (ddOffsetY) offsetYvalue = new NumberAttr(ddOffsetY, 0);\n    if (ddJustify) justifyValue = ddJustify;\n    if (ddPlacements) placements = ddPlacements;\n\n    const offsetX = offsetXvalue.get(layout.zoom, feature);\n    const offsetY = offsetYvalue.get(layout.zoom, feature);\n\n    const getBbox = (a: Point, o: Point) => {\n      return {\n        minX: a.x + o.x + fb.minX,\n        minY: a.y + o.y + fb.minY,\n        maxX: a.x + o.x + fb.maxX,\n        maxY: a.y + o.y + fb.maxY,\n      };\n    };\n\n    let origin = new Point(offsetX, offsetY);\n    let justify: Justify;\n    const draw = (ctx: CanvasRenderingContext2D) => {\n      ctx.translate(origin.x, origin.y);\n      firstLabel.draw(ctx, { justify: justify });\n    };\n\n    const placeLabelInPoint = (a: Point, o: Point) => {\n      const bbox = getBbox(a, o);\n      if (!layout.index.bboxCollides(bbox, layout.order))\n        return [{ anchor: anchor, bboxes: [bbox], draw: draw }];\n    };\n\n    for (const placement of placements) {\n      const xAxisOffset = this.computeXaxisOffset(offsetX, fb, placement);\n      const yAxisOffset = this.computeYaxisOffset(offsetY, fb, placement);\n      justify = this.computeJustify(justifyValue, placement);\n      origin = new Point(xAxisOffset, yAxisOffset);\n      return placeLabelInPoint(anchor, origin);\n    }\n\n    return undefined;\n  }\n\n  computeXaxisOffset(offsetX: number, fb: Bbox, placement: TextPlacements) {\n    const labelWidth = fb.maxX;\n    const labelHalfWidth = labelWidth / 2;\n    if ([TextPlacements.N, TextPlacements.S].includes(placement))\n      return offsetX - labelHalfWidth;\n    if (\n      [TextPlacements.Nw, TextPlacements.W, TextPlacements.Sw].includes(\n        placement,\n      )\n    )\n      return offsetX - labelWidth;\n    return offsetX;\n  }\n\n  computeYaxisOffset(offsetY: number, fb: Bbox, placement: TextPlacements) {\n    const labelHalfHeight = Math.abs(fb.minY);\n    const labelBottom = fb.maxY;\n    const labelCenterHeight = (fb.minY + fb.maxY) / 2;\n    if ([TextPlacements.E, TextPlacements.W].includes(placement))\n      return offsetY - labelCenterHeight;\n    if (\n      [TextPlacements.Nw, TextPlacements.Ne, TextPlacements.N].includes(\n        placement,\n      )\n    )\n      return offsetY - labelBottom;\n    if (\n      [TextPlacements.Sw, TextPlacements.Se, TextPlacements.S].includes(\n        placement,\n      )\n    )\n      return offsetY + labelHalfHeight;\n    return offsetY;\n  }\n\n  computeJustify(fixedJustify: Justify | undefined, placement: TextPlacements) {\n    if (fixedJustify) return fixedJustify;\n    if ([TextPlacements.N, TextPlacements.S].includes(placement))\n      return Justify.Center;\n    if (\n      [TextPlacements.Ne, TextPlacements.E, TextPlacements.Se].includes(\n        placement,\n      )\n    )\n      return Justify.Left;\n    return Justify.Right;\n  }\n}\n\nexport class OffsetTextSymbolizer implements LabelSymbolizer {\n  symbolizer: LabelSymbolizer;\n\n  constructor(options: OffsetSymbolizerOptions & TextSymbolizerOptions) {\n    this.symbolizer = new OffsetSymbolizer(\n      new TextSymbolizer(options),\n      options,\n    );\n  }\n\n  public place(layout: Layout, geom: Point[][], feature: Feature) {\n    return this.symbolizer.place(layout, geom, feature);\n  }\n}\n\nexport enum LineLabelPlacement {\n  Above = 1,\n  Center = 2,\n  Below = 3,\n}\n\nexport class LineLabelSymbolizer implements LabelSymbolizer {\n  font: FontAttr;\n  text: TextAttr;\n\n  fill: StringAttr;\n  stroke: StringAttr;\n  width: NumberAttr;\n  offset: NumberAttr;\n  position: LineLabelPlacement;\n  maxLabelCodeUnits: NumberAttr;\n  repeatDistance: NumberAttr;\n\n  constructor(\n    options: {\n      radius?: AttrOption<number>;\n      fill?: AttrOption<string>;\n      stroke?: AttrOption<string>;\n      width?: AttrOption<number>;\n      offset?: AttrOption<number>;\n      maxLabelChars?: AttrOption<number>;\n      repeatDistance?: AttrOption<number>;\n      position?: LineLabelPlacement;\n    } & TextAttrOptions &\n      FontAttrOptions,\n  ) {\n    this.font = new FontAttr(options);\n    this.text = new TextAttr(options);\n\n    this.fill = new StringAttr(options.fill, \"black\");\n    this.stroke = new StringAttr(options.stroke, \"black\");\n    this.width = new NumberAttr(options.width, 0);\n    this.offset = new NumberAttr(options.offset, 0);\n    this.position = options.position ?? LineLabelPlacement.Above;\n    this.maxLabelCodeUnits = new NumberAttr(options.maxLabelChars, 40);\n    this.repeatDistance = new NumberAttr(options.repeatDistance, 250);\n  }\n\n  public place(layout: Layout, geom: Point[][], feature: Feature) {\n    const name = this.text.get(layout.zoom, feature);\n    if (!name) return undefined;\n    if (name.length > this.maxLabelCodeUnits.get(layout.zoom, feature))\n      return undefined;\n\n    const minLabelableDim = 20;\n    const fbbox = feature.bbox;\n    if (\n      fbbox.maxY - fbbox.minY < minLabelableDim &&\n      fbbox.maxX - fbbox.minX < minLabelableDim\n    )\n      return undefined;\n\n    const font = this.font.get(layout.zoom, feature);\n    layout.scratch.font = font;\n    const metrics = layout.scratch.measureText(name);\n    const width = metrics.width;\n    const height =\n      metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent;\n\n    let repeatDistance = this.repeatDistance.get(layout.zoom, feature);\n    if (layout.overzoom > 4) repeatDistance *= 1 << (layout.overzoom - 4);\n\n    const cellSize = height * 2;\n\n    const labelCandidates = simpleLabel(geom, width, repeatDistance, cellSize);\n    if (labelCandidates.length === 0) return undefined;\n\n    const labels = [];\n    for (const candidate of labelCandidates) {\n      const dx = candidate.end.x - candidate.start.x;\n      const dy = candidate.end.y - candidate.start.y;\n\n      const cells = lineCells(\n        candidate.start,\n        candidate.end,\n        width,\n        cellSize / 2,\n      );\n      const bboxes = cells.map((c) => {\n        return {\n          minX: c.x - cellSize / 2,\n          minY: c.y - cellSize / 2,\n          maxX: c.x + cellSize / 2,\n          maxY: c.y + cellSize / 2,\n        };\n      });\n\n      const draw = (ctx: CanvasRenderingContext2D) => {\n        ctx.globalAlpha = 1;\n        // ctx.beginPath();\n        // ctx.moveTo(0, 0);\n        // ctx.lineTo(dx, dy);\n        // ctx.strokeStyle = \"red\";\n        // ctx.stroke();\n        ctx.rotate(Math.atan2(dy, dx));\n        if (dx < 0) {\n          ctx.scale(-1, -1);\n          ctx.translate(-width, 0);\n        }\n        let heightPlacement = 0;\n        if (this.position === LineLabelPlacement.Below)\n          heightPlacement += height;\n        else if (this.position === LineLabelPlacement.Center)\n          heightPlacement += height / 2;\n        ctx.translate(\n          0,\n          heightPlacement - this.offset.get(layout.zoom, feature),\n        );\n        ctx.font = font;\n        const lineWidth = this.width.get(layout.zoom, feature);\n        if (lineWidth) {\n          ctx.lineWidth = lineWidth;\n          ctx.strokeStyle = this.stroke.get(layout.zoom, feature);\n          ctx.strokeText(name, 0, 0);\n        }\n        ctx.fillStyle = this.fill.get(layout.zoom, feature);\n        ctx.fillText(name, 0, 0);\n      };\n      labels.push({\n        anchor: candidate.start,\n        bboxes: bboxes,\n        draw: draw,\n        deduplicationKey: name,\n        deduplicationDistance: repeatDistance,\n      });\n    }\n\n    return labels;\n  }\n}\n","import { mix } from \"color2k\";\nimport { LabelRule } from \"../labeler\";\nimport { PaintRule } from \"../painter\";\nimport {\n  CenteredTextSymbolizer,\n  CircleSymbolizer,\n  GroupSymbolizer,\n  LineLabelSymbolizer,\n  LineSymbolizer,\n  OffsetTextSymbolizer,\n  PolygonSymbolizer,\n  exp,\n  linear,\n} from \"../symbolizer\";\nimport { Feature, JsonObject } from \"../tilecache\";\nimport { Theme } from \"./themes\";\n\nconst getString = (props: JsonObject, key: string): string => {\n  const val = props[key];\n  if (typeof val === \"string\") return val;\n  return \"\";\n};\n\nconst getNumber = (props: JsonObject, key: string): number => {\n  const val = props[key];\n  if (typeof val === \"number\") return val;\n  return 0;\n};\n\nexport const paintRules = (t: Theme): PaintRule[] => {\n  return [\n    {\n      dataLayer: \"earth\",\n      symbolizer: new PolygonSymbolizer({\n        fill: t.earth,\n      }),\n    },\n    {\n      dataLayer: \"landuse\",\n      symbolizer: new PolygonSymbolizer({\n        fill: (z, f) => {\n          return mix(t.park_a, t.park_b, Math.min(Math.max(z / 12.0, 12), 0));\n        },\n      }),\n      filter: (z, f) => {\n        const kind = getString(f.props, \"pmap:kind\");\n        return [\"allotments\", \"village_green\", \"playground\"].includes(kind);\n      },\n    },\n    {\n      // landuse_urban_green\n      dataLayer: \"landuse\",\n      symbolizer: new PolygonSymbolizer({\n        fill: t.park_b,\n        opacity: 0.7,\n      }),\n      filter: (z, f) => {\n        const kind = getString(f.props, \"pmap:kind\");\n        return [\n          \"national_park\",\n          \"park\",\n          \"cemetery\",\n          \"protected_area\",\n          \"nature_reserve\",\n          \"forest\",\n          \"golf_course\",\n        ].includes(kind);\n      },\n    },\n    {\n      dataLayer: \"landuse\",\n      symbolizer: new PolygonSymbolizer({\n        fill: t.hospital,\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"hospital\";\n      },\n    },\n    {\n      dataLayer: \"landuse\",\n      symbolizer: new PolygonSymbolizer({\n        fill: t.industrial,\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"industrial\";\n      },\n    },\n    {\n      dataLayer: \"landuse\",\n      symbolizer: new PolygonSymbolizer({\n        fill: t.school,\n      }),\n      filter: (z, f) => {\n        const kind = getString(f.props, \"pmap:kind\");\n        return [\"school\", \"university\", \"college\"].includes(kind);\n      },\n    },\n    {\n      dataLayer: \"landuse\",\n      symbolizer: new PolygonSymbolizer({\n        fill: t.beach,\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"beach\";\n      },\n    },\n    {\n      dataLayer: \"landuse\",\n      symbolizer: new PolygonSymbolizer({\n        fill: t.zoo,\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"zoo\";\n      },\n    },\n    {\n      dataLayer: \"landuse\",\n      symbolizer: new PolygonSymbolizer({\n        fill: t.zoo,\n      }),\n      filter: (z, f) => {\n        const kind = getString(f.props, \"pmap:kind\");\n        return [\"military\", \"naval_base\", \"airfield\"].includes(kind);\n      },\n    },\n    {\n      dataLayer: \"natural\",\n      symbolizer: new PolygonSymbolizer({\n        fill: (z, f) => {\n          return mix(t.wood_a, t.wood_b, Math.min(Math.max(z / 12.0, 12), 0));\n        },\n      }),\n      filter: (z, f) => {\n        const kind = getString(f.props, \"pmap:kind\");\n        return [\"wood\", \"nature_reserve\", \"forest\"].includes(kind);\n      },\n    },\n    {\n      dataLayer: \"natural\",\n      symbolizer: new PolygonSymbolizer({\n        fill: (z, f) => {\n          return mix(t.scrub_a, t.scrub_b, Math.min(Math.max(z / 12.0, 12), 0));\n        },\n      }),\n      filter: (z, f) => {\n        const kind = getString(f.props, \"pmap:kind\");\n        return [\"scrub\", \"grassland\", \"grass\"].includes(kind);\n      },\n    },\n    {\n      dataLayer: \"natural\",\n      symbolizer: new PolygonSymbolizer({\n        fill: t.scrub_b,\n      }),\n      filter: (z, f) => {\n        const kind = getString(f.props, \"pmap:kind\");\n        return [\"scrub\", \"grassland\", \"grass\"].includes(kind);\n      },\n    },\n    {\n      dataLayer: \"natural\",\n      symbolizer: new PolygonSymbolizer({\n        fill: t.glacier,\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"glacier\";\n      },\n    },\n    {\n      dataLayer: \"natural\",\n      symbolizer: new PolygonSymbolizer({\n        fill: t.sand,\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"sand\";\n      },\n    },\n    {\n      dataLayer: \"landuse\",\n      symbolizer: new PolygonSymbolizer({\n        fill: t.aerodrome,\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"aerodrome\";\n      },\n    },\n    {\n      dataLayer: \"water\",\n      symbolizer: new PolygonSymbolizer({\n        fill: t.water,\n      }),\n    },\n    {\n      // transit_runway\n      dataLayer: \"transit\",\n      symbolizer: new LineSymbolizer({\n        color: t.runway,\n        width: (z, f) => {\n          return exp(1.6, [\n            [11, 0],\n            [13, 4],\n            [19, 30],\n          ])(z);\n        },\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind_detail\"] === \"runway\";\n      },\n    },\n    {\n      // transit_taxiway\n      dataLayer: \"transit\",\n      symbolizer: new LineSymbolizer({\n        color: t.runway,\n        width: (z, f) => {\n          return exp(1.6, [\n            [14, 0],\n            [14.5, 1],\n            [16, 6],\n          ])(z);\n        },\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind_detail\"] === \"taxiway\";\n      },\n    },\n    {\n      // transit_pier\n      dataLayer: \"transit\",\n      symbolizer: new LineSymbolizer({\n        color: t.pier,\n        width: (z, f) => {\n          return exp(1.6, [\n            [13, 0],\n            [13.5, 0, 5],\n            [21, 16],\n          ])(z);\n        },\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"pier\";\n      },\n    },\n    {\n      // physical_line_river\n      dataLayer: \"physical_line\",\n      minzoom: 14,\n      symbolizer: new LineSymbolizer({\n        color: t.water,\n        width: (z, f) => {\n          return exp(1.6, [\n            [9, 0],\n            [9.5, 1.0],\n            [18, 12],\n          ])(z);\n        },\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"river\";\n      },\n    },\n    {\n      // physical_line_river\n      dataLayer: \"physical_line\",\n      minzoom: 14,\n      symbolizer: new LineSymbolizer({\n        color: t.water,\n        width: 0.5,\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"stream\";\n      },\n    },\n    {\n      dataLayer: \"landuse\",\n      symbolizer: new PolygonSymbolizer({\n        fill: t.pedestrian,\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"pedestrian\";\n      },\n    },\n    {\n      dataLayer: \"landuse\",\n      symbolizer: new PolygonSymbolizer({\n        fill: t.pier,\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"pier\";\n      },\n    },\n    {\n      dataLayer: \"buildings\",\n      symbolizer: new PolygonSymbolizer({\n        fill: t.buildings,\n        opacity: 0.5,\n      }),\n    },\n    {\n      dataLayer: \"roads\",\n      symbolizer: new LineSymbolizer({\n        color: t.major,\n        width: (z, f) => {\n          return exp(1.6, [\n            [14, 0],\n            [20, 7],\n          ])(z);\n        },\n      }),\n      filter: (z, f) => {\n        const kind = getString(f.props, \"pmap:kind\");\n        return [\"other\", \"path\"].includes(kind);\n      },\n    },\n    {\n      dataLayer: \"roads\",\n      symbolizer: new LineSymbolizer({\n        color: t.major,\n        width: (z, f) => {\n          return exp(1.6, [\n            [13, 0],\n            [18, 8],\n          ])(z);\n        },\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"minor_road\";\n      },\n    },\n    {\n      dataLayer: \"roads\",\n      symbolizer: new LineSymbolizer({\n        color: t.major,\n        width: (z, f) => {\n          return exp(1.6, [\n            [7, 0],\n            [12, 1.2],\n            [15, 3],\n            [18, 13],\n          ])(z);\n        },\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"medium_road\";\n      },\n    },\n    {\n      dataLayer: \"roads\",\n      symbolizer: new LineSymbolizer({\n        color: t.major,\n        width: (z, f) => {\n          return exp(1.6, [\n            [6, 0],\n            [12, 1.6],\n            [15, 3],\n            [18, 13],\n          ])(z);\n        },\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"major_road\";\n      },\n    },\n    {\n      dataLayer: \"roads\",\n      symbolizer: new LineSymbolizer({\n        color: t.major,\n        width: (z, f) => {\n          return exp(1.6, [\n            [3, 0],\n            [6, 1.1],\n            [12, 1.6],\n            [15, 5],\n            [18, 15],\n          ])(z);\n        },\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"highway\";\n      },\n    },\n    {\n      dataLayer: \"boundaries\",\n      symbolizer: new LineSymbolizer({\n        dash: [3, 2],\n        color: t.boundaries,\n        width: 1,\n      }),\n      filter: (z, f) => {\n        const minAdminLevel = f.props[\"pmap:min_admin_level\"];\n        return typeof minAdminLevel === \"number\" && minAdminLevel <= 2;\n      },\n    },\n    {\n      dataLayer: \"transit\",\n      symbolizer: new LineSymbolizer({\n        dash: [0.3, 0.75],\n        color: t.railway,\n        dashWidth: (z, f) => {\n          return exp(1.6, [\n            [4, 0],\n            [7, 0.15],\n            [19, 9],\n          ])(z);\n        },\n        opacity: 0.5,\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"rail\";\n      },\n    },\n    {\n      dataLayer: \"boundaries\",\n      symbolizer: new LineSymbolizer({\n        dash: [3, 2],\n        color: t.boundaries,\n        width: 0.5,\n      }),\n      filter: (z, f) => {\n        const minAdminLevel = f.props[\"pmap:min_admin_level\"];\n        return typeof minAdminLevel === \"number\" && minAdminLevel > 2;\n      },\n    },\n  ];\n};\n\nexport const labelRules = (t: Theme): LabelRule[] => {\n  const nametags = [\"name\"];\n\n  return [\n    // {\n    //   id: \"neighbourhood\",\n    //   dataLayer: \"places\",\n    //   symbolizer: languageStack(\n    //     new CenteredTextSymbolizer({\n    //       labelProps: nametags,\n    //       fill: params.neighbourhoodLabel,\n    //       font: \"500 10px sans-serif\",\n    //       textTransform: \"uppercase\",\n    //     }),\n    //     params.neighbourhoodLabel,\n    //   ),\n    //   filter: (z, f) => {\n    //     return f.props[\"pmap:kind\"] === \"neighbourhood\";\n    //   },\n    // },\n    {\n      dataLayer: \"roads\",\n      symbolizer: new LineLabelSymbolizer({\n        labelProps: nametags,\n        fill: t.roads_label_minor,\n        font: \"400 12px sans-serif\",\n        width: 2,\n        stroke: t.roads_label_minor_halo,\n      }),\n      // TODO: sort by minzoom\n      minzoom: 16,\n      filter: (z, f) => {\n        const kind = getString(f.props, \"pmap:kind\");\n        return [\"minor_road\", \"other\", \"path\"].includes(kind);\n      },\n    },\n    {\n      dataLayer: \"roads\",\n      symbolizer: new LineLabelSymbolizer({\n        labelProps: nametags,\n        fill: t.roads_label_major,\n        font: \"400 12px sans-serif\",\n        width: 2,\n        stroke: t.roads_label_major_halo,\n      }),\n      // TODO: sort by minzoom\n      minzoom: 12,\n      filter: (z, f) => {\n        const kind = getString(f.props, \"pmap:kind\");\n        return [\"highway\", \"major_road\", \"medium_road\"].includes(kind);\n      },\n    },\n    {\n      dataLayer: \"roads\",\n      symbolizer: new LineLabelSymbolizer({\n        labelProps: nametags,\n        fill: t.roads_label_major,\n        font: \"400 12px sans-serif\",\n        width: 2,\n        stroke: t.roads_label_major_halo,\n      }),\n      // TODO: sort by minzoom\n      minzoom: 12,\n      filter: (z, f) => {\n        const kind = getString(f.props, \"pmap:kind\");\n        return [\"highway\", \"major_road\", \"medium_road\"].includes(kind);\n      },\n    },\n    {\n      dataLayer: \"physical_point\",\n      symbolizer: new CenteredTextSymbolizer({\n        labelProps: nametags,\n        fill: t.ocean_label,\n        lineHeight: 1.5,\n        letterSpacing: 1,\n        font: (z, f) => {\n          const size = linear([\n            [3, 10],\n            [10, 12],\n          ])(z);\n          return `400 ${size}px sans-serif`;\n        },\n        textTransform: \"uppercase\",\n      }),\n      filter: (z, f) => {\n        const kind = getString(f.props, \"pmap:kind\");\n        return [\"ocean\", \"bay\", \"strait\", \"fjord\"].includes(kind);\n      },\n    },\n    {\n      dataLayer: \"physical_point\",\n      symbolizer: new CenteredTextSymbolizer({\n        labelProps: nametags,\n        fill: t.ocean_label,\n        lineHeight: 1.5,\n        letterSpacing: 1,\n        font: (z, f) => {\n          const size = linear([\n            [3, 0],\n            [6, 12],\n            [10, 12],\n          ])(z);\n          return `400 ${size}px sans-serif`;\n        },\n      }),\n      filter: (z, f) => {\n        const kind = getString(f.props, \"pmap:kind\");\n        return [\"sea\", \"lake\", \"water\"].includes(kind);\n      },\n    },\n    {\n      dataLayer: \"places\",\n      symbolizer: new CenteredTextSymbolizer({\n        labelProps: (z, f) => {\n          if (z < 6) {\n            return [\"name:short\"];\n          }\n          return nametags;\n        },\n        fill: t.state_label,\n        stroke: t.state_label_halo,\n        width: 1,\n        lineHeight: 1.5,\n        font: (z: number, f?: Feature) => {\n          if (z < 6) return \"400 16px sans-serif\";\n          return \"400 12px sans-serif\";\n        },\n        textTransform: \"uppercase\",\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"region\";\n      },\n    },\n    {\n      dataLayer: \"places\",\n      symbolizer: new CenteredTextSymbolizer({\n        labelProps: nametags,\n        fill: t.country_label,\n        lineHeight: 1.5,\n        font: (z: number, f?: Feature) => {\n          if (z < 6) return \"600 12px sans-serif\";\n          return \"600 12px sans-serif\";\n        },\n        textTransform: \"uppercase\",\n      }),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"country\";\n      },\n    },\n    {\n      // places_locality\n      dataLayer: \"places\",\n      minzoom: 9,\n      symbolizer: new CenteredTextSymbolizer({\n        labelProps: nametags,\n        fill: t.city_label,\n        lineHeight: 1.5,\n        font: (z: number, f?: Feature) => {\n          if (!f) return \"400 12px sans-serif\";\n          const minZoom = f.props[\"pmap:min_zoom\"];\n          let weight = 400;\n          if (minZoom && minZoom <= 5) {\n            weight = 600;\n          }\n          let size = 12;\n          const popRank = f.props[\"pmap:population_rank\"];\n          if (popRank && popRank > 9) {\n            size = 16;\n          }\n          return `${weight} ${size}px sans-serif`;\n        },\n      }),\n      sort: (a, b) => {\n        const aRank = getNumber(a, \"pmap:population_rank\");\n        const bRank = getNumber(b, \"pmap:population_rank\");\n        return aRank - bRank;\n      },\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"locality\";\n      },\n    },\n    {\n      dataLayer: \"places\",\n      maxzoom: 8,\n      symbolizer: new GroupSymbolizer([\n        new CircleSymbolizer({\n          radius: 2,\n          fill: t.city_circle,\n          stroke: t.city_circle_stroke,\n          width: 1.5,\n        }),\n        new OffsetTextSymbolizer({\n          labelProps: nametags,\n          fill: t.city_label,\n          stroke: t.city_label_halo,\n          width: 1,\n          offsetX: 6,\n          offsetY: 4.5,\n          font: (z, f) => {\n            return \"400 12px sans-serif\";\n          },\n        }),\n      ]),\n      filter: (z, f) => {\n        return f.props[\"pmap:kind\"] === \"locality\";\n      },\n    },\n  ];\n};\n","export interface Theme {\n  background: string;\n  earth: string;\n  park_a: string;\n  park_b: string;\n  hospital: string;\n  industrial: string;\n  school: string;\n  wood_a: string;\n  wood_b: string;\n  pedestrian: string;\n  scrub_a: string;\n  scrub_b: string;\n  glacier: string;\n  sand: string;\n  beach: string;\n  aerodrome: string;\n  runway: string;\n  water: string;\n  pier: string;\n  zoo: string;\n  military: string;\n\n  tunnel_other_casing: string;\n  tunnel_minor_casing: string;\n  tunnel_link_casing: string;\n  tunnel_medium_casing: string;\n  tunnel_major_casing: string;\n  tunnel_highway_casing: string;\n  tunnel_other: string;\n  tunnel_minor: string;\n  tunnel_link: string;\n  tunnel_medium: string;\n  tunnel_major: string;\n  tunnel_highway: string;\n\n  transit_pier: string;\n  buildings: string;\n\n  minor_service_casing: string;\n  minor_casing: string;\n  link_casing: string;\n  medium_casing: string;\n  major_casing_late: string;\n  highway_casing_late: string;\n  other: string;\n  minor_service: string;\n  minor_a: string;\n  minor_b: string;\n  link: string;\n  medium: string;\n  major_casing_early: string;\n  major: string;\n  highway_casing_early: string;\n  highway: string;\n\n  railway: string;\n  boundaries: string;\n  waterway_label: string;\n\n  bridges_other_casing: string;\n  bridges_minor_casing: string;\n  bridges_link_casing: string;\n  bridges_medium_casing: string;\n  bridges_major_casing: string;\n  bridges_highway_casing: string;\n  bridges_other: string;\n  bridges_minor: string;\n  bridges_link: string;\n  bridges_medium: string;\n  bridges_major: string;\n  bridges_highway: string;\n\n  roads_label_minor: string;\n  roads_label_minor_halo: string;\n  roads_label_major: string;\n  roads_label_major_halo: string;\n  ocean_label: string;\n  peak_label: string;\n  subplace_label: string;\n  subplace_label_halo: string;\n  city_circle: string;\n  city_circle_stroke: string;\n  city_label: string;\n  city_label_halo: string;\n  state_label: string;\n  state_label_halo: string;\n  country_label: string;\n}\n\nexport const LIGHT: Theme = {\n  background: \"#cccccc\",\n  earth: \"#e0e0e0\",\n  park_a: \"#cfddd5\",\n  park_b: \"#9cd3b4\",\n  hospital: \"#e4dad9\",\n  industrial: \"#d1dde1\",\n  school: \"#e4ded7\",\n  wood_a: \"#d0ded0\",\n  wood_b: \"#a0d9a0\",\n  pedestrian: \"#e3e0d4\",\n  scrub_a: \"#cedcd7\",\n  scrub_b: \"#99d2bb\",\n  glacier: \"#e7e7e7\",\n  sand: \"#e2e0d7\",\n  beach: \"#e8e4d0\",\n  aerodrome: \"#dadbdf\",\n  runway: \"#e9e9ed\",\n  water: \"#80deea\",\n  pier: \"#e0e0e0\",\n  zoo: \"#c6dcdc\",\n  military: \"#dcdcdc\",\n\n  tunnel_other_casing: \"#e0e0e0\",\n  tunnel_minor_casing: \"#e0e0e0\",\n  tunnel_link_casing: \"#e0e0e0\",\n  tunnel_medium_casing: \"#e0e0e0\",\n  tunnel_major_casing: \"#e0e0e0\",\n  tunnel_highway_casing: \"#e0e0e0\",\n  tunnel_other: \"#d5d5d5\",\n  tunnel_minor: \"#d5d5d5\",\n  tunnel_link: \"#d5d5d5\",\n  tunnel_medium: \"#d5d5d5\",\n  tunnel_major: \"#d5d5d5\",\n  tunnel_highway: \"#d5d5d5\",\n\n  transit_pier: \"#e0e0e0\",\n  buildings: \"#cccccc\",\n\n  minor_service_casing: \"#e0e0e0\",\n  minor_casing: \"#e0e0e0\",\n  link_casing: \"#e0e0e0\",\n  medium_casing: \"#e0e0e0\",\n  major_casing_late: \"#e0e0e0\",\n  highway_casing_late: \"#e0e0e0\",\n  other: \"#ebebeb\",\n  minor_service: \"#ebebeb\",\n  minor_a: \"#ebebeb\",\n  minor_b: \"#ffffff\",\n  link: \"#ffffff\",\n  medium: \"#f5f5f5\",\n  major_casing_early: \"#e0e0e0\",\n  major: \"#ffffff\",\n  highway_casing_early: \"#e0e0e0\",\n  highway: \"#ffffff\",\n\n  railway: \"#a7b1b3\",\n  boundaries: \"#adadad\",\n  waterway_label: \"#ffffff\",\n\n  bridges_other_casing: \"#e0e0e0\",\n  bridges_minor_casing: \"#e0e0e0\",\n  bridges_link_casing: \"#e0e0e0\",\n  bridges_medium_casing: \"#e0e0e0\",\n  bridges_major_casing: \"#e0e0e0\",\n  bridges_highway_casing: \"#e0e0e0\",\n  bridges_other: \"#ebebeb\",\n  bridges_minor: \"#ffffff\",\n  bridges_link: \"#ffffff\",\n  bridges_medium: \"#f0eded\",\n  bridges_major: \"#f5f5f5\",\n  bridges_highway: \"#ffffff\",\n\n  roads_label_minor: \"#91888b\",\n  roads_label_minor_halo: \"#ffffff\",\n  roads_label_major: \"#938a8d\",\n  roads_label_major_halo: \"#ffffff\",\n  ocean_label: \"#ffffff\",\n  peak_label: \"#7e9aa0\",\n  subplace_label: \"#8f8f8f\",\n  subplace_label_halo: \"#e0e0e0\",\n  city_circle: \"#ffffff\",\n  city_circle_stroke: \"#a3a3a3\",\n  city_label: \"#5c5c5c\",\n  city_label_halo: \"#e0e0e0\",\n  state_label: \"#b3b3b3\",\n  state_label_halo: \"#e0e0e0\",\n  country_label: \"#a3a3a3\",\n};\n\nexport const DARK: Theme = {\n  background: \"#34373d\",\n  earth: \"#1f1f1f\",\n  park_a: \"#232325\",\n  park_b: \"#232325\",\n  hospital: \"#252424\",\n  industrial: \"#222222\",\n  school: \"#262323\",\n  wood_a: \"#202121\",\n  wood_b: \"#202121\",\n  pedestrian: \"#1e1e1e\",\n  scrub_a: \"#222323\",\n  scrub_b: \"#222323\",\n  glacier: \"#1c1c1c\",\n  sand: \"#212123\",\n  beach: \"#28282a\",\n  aerodrome: \"#1e1e1e\",\n  runway: \"#333333\",\n  water: \"#34373d\",\n  pier: \"#222222\",\n  zoo: \"#222323\",\n  military: \"#242323\",\n\n  tunnel_other_casing: \"#141414\",\n  tunnel_minor_casing: \"#141414\",\n  tunnel_link_casing: \"#141414\",\n  tunnel_medium_casing: \"#141414\",\n  tunnel_major_casing: \"#141414\",\n  tunnel_highway_casing: \"#141414\",\n  tunnel_other: \"#292929\",\n  tunnel_minor: \"#292929\",\n  tunnel_link: \"#292929\",\n  tunnel_medium: \"#292929\",\n  tunnel_major: \"#292929\",\n  tunnel_highway: \"#292929\",\n\n  transit_pier: \"#333333\",\n  buildings: \"#111111\",\n\n  minor_service_casing: \"#1f1f1f\",\n  minor_casing: \"#1f1f1f\",\n  link_casing: \"#1f1f1f\",\n  medium_casing: \"#1f1f1f\",\n  major_casing_late: \"#1f1f1f\",\n  highway_casing_late: \"#1f1f1f\",\n  other: \"#333333\",\n  minor_service: \"#333333\",\n  minor_a: \"#3d3d3d\",\n  minor_b: \"#333333\",\n  link: \"#3d3d3d\",\n  medium: \"#3d3d3d\",\n  major_casing_early: \"#1f1f1f\",\n  major: \"#3d3d3d\",\n  highway_casing_early: \"#1f1f1f\",\n  highway: \"#474747\",\n\n  railway: \"#000000\",\n  boundaries: \"#5b6374\",\n  waterway_label: \"#717784\",\n\n  bridges_other_casing: \"#2b2b2b\",\n  bridges_minor_casing: \"#1f1f1f\",\n  bridges_link_casing: \"#1f1f1f\",\n  bridges_medium_casing: \"#1f1f1f\",\n  bridges_major_casing: \"#1f1f1f\",\n  bridges_highway_casing: \"#1f1f1f\",\n  bridges_other: \"#333333\",\n  bridges_minor: \"#333333\",\n  bridges_link: \"#3d3d3d\",\n  bridges_medium: \"#3d3d3d\",\n  bridges_major: \"#3d3d3d\",\n  bridges_highway: \"#474747\",\n\n  roads_label_minor: \"#525252\",\n  roads_label_minor_halo: \"#1f1f1f\",\n  roads_label_major: \"#666666\",\n  roads_label_major_halo: \"#1f1f1f\",\n  ocean_label: \"#717784\",\n  peak_label: \"#898080\",\n  subplace_label: \"#525252\",\n  subplace_label_halo: \"#1f1f1f\",\n  city_circle: \"#000000\",\n  city_circle_stroke: \"#7a7a7a\",\n  city_label: \"#7a7a7a\",\n  city_label_halo: \"#212121\",\n  state_label: \"#3d3d3d\",\n  state_label_halo: \"#1f1f1f\",\n  country_label: \"#5c5c5c\",\n};\n\nexport const WHITE: Theme = {\n  background: \"#ffffff\",\n  earth: \"#ffffff\",\n  park_a: \"#fcfcfc\",\n  park_b: \"#fcfcfc\",\n  hospital: \"#f8f8f8\",\n  industrial: \"#fcfcfc\",\n  school: \"#f8f8f8\",\n  wood_a: \"#fafafa\",\n  wood_b: \"#fafafa\",\n  pedestrian: \"#fdfdfd\",\n  scrub_a: \"#fafafa\",\n  scrub_b: \"#fafafa\",\n  glacier: \"#fcfcfc\",\n  sand: \"#fafafa\",\n  beach: \"#f6f6f6\",\n  aerodrome: \"#fdfdfd\",\n  runway: \"#efefef\",\n  water: \"#dcdcdc\",\n  pier: \"#f5f5f5\",\n  zoo: \"#f7f7f7\",\n  military: \"#fcfcfc\",\n\n  tunnel_other_casing: \"#d6d6d6\",\n  tunnel_minor_casing: \"#fcfcfc\",\n  tunnel_link_casing: \"#fcfcfc\",\n  tunnel_medium_casing: \"#fcfcfc\",\n  tunnel_major_casing: \"#fcfcfc\",\n  tunnel_highway_casing: \"#fcfcfc\",\n  tunnel_other: \"#d6d6d6\",\n  tunnel_minor: \"#d6d6d6\",\n  tunnel_link: \"#d6d6d6\",\n  tunnel_medium: \"#d6d6d6\",\n  tunnel_major: \"#d6d6d6\",\n  tunnel_highway: \"#d6d6d6\",\n\n  transit_pier: \"#efefef\",\n  buildings: \"#efefef\",\n\n  minor_service_casing: \"#ffffff\",\n  minor_casing: \"#ffffff\",\n  link_casing: \"#ffffff\",\n  medium_casing: \"#ffffff\",\n  major_casing_late: \"#ffffff\",\n  highway_casing_late: \"#ffffff\",\n  other: \"#f5f5f5\",\n  minor_service: \"#f5f5f5\",\n  minor_a: \"#ebebeb\",\n  minor_b: \"#f5f5f5\",\n  link: \"#ebebeb\",\n  medium: \"#ebebeb\",\n  major_casing_early: \"#ffffff\",\n  major: \"#ebebeb\",\n  highway_casing_early: \"#ffffff\",\n  highway: \"#ebebeb\",\n\n  railway: \"#d6d6d6\",\n  boundaries: \"#adadad\",\n  waterway_label: \"#adadad\",\n\n  bridges_other_casing: \"#ffffff\",\n  bridges_minor_casing: \"#ffffff\",\n  bridges_link_casing: \"#ffffff\",\n  bridges_medium_casing: \"#ffffff\",\n  bridges_major_casing: \"#ffffff\",\n  bridges_highway_casing: \"#ffffff\",\n  bridges_other: \"#f5f5f5\",\n  bridges_minor: \"#f5f5f5\",\n  bridges_link: \"#ebebeb\",\n  bridges_medium: \"#ebebeb\",\n  bridges_major: \"#ebebeb\",\n  bridges_highway: \"#ebebeb\",\n\n  roads_label_minor: \"#adadad\",\n  roads_label_minor_halo: \"#ffffff\",\n  roads_label_major: \"#999999\",\n  roads_label_major_halo: \"#ffffff\",\n  ocean_label: \"#adadad\",\n  peak_label: \"#adadad\",\n  subplace_label: \"#8f8f8f\",\n  subplace_label_halo: \"#ffffff\",\n  city_circle: \"#ffffff\",\n  city_circle_stroke: \"#adadad\",\n  city_label: \"#5c5c5c\",\n  city_label_halo: \"#ffffff\",\n  state_label: \"#b3b3b3\",\n  state_label_halo: \"#ffffff\",\n  country_label: \"#b8b8b8\",\n};\n\nexport const GRAYSCALE: Theme = {\n  background: \"#a3a3a3\",\n  earth: \"#cccccc\",\n  park_a: \"#c2c2c2\",\n  park_b: \"#c2c2c2\",\n  hospital: \"#d0d0d0\",\n  industrial: \"#c6c6c6\",\n  school: \"#d0d0d0\",\n  wood_a: \"#c2c2c2\",\n  wood_b: \"#c2c2c2\",\n  pedestrian: \"#c4c4c4\",\n  scrub_a: \"#c2c2c2\",\n  scrub_b: \"#c2c2c2\",\n  glacier: \"#d2d2d2\",\n  sand: \"#d2d2d2\",\n  beach: \"#d2d2d2\",\n  aerodrome: \"#c9c9c9\",\n  runway: \"#f5f5f5\",\n  water: \"#a3a3a3\",\n  pier: \"#b8b8b8\",\n  zoo: \"#c7c7c7\",\n  military: \"#bfbfbf\",\n\n  tunnel_other_casing: \"#b8b8b8\",\n  tunnel_minor_casing: \"#b8b8b8\",\n  tunnel_link_casing: \"#b8b8b8\",\n  tunnel_medium_casing: \"#b8b8b8\",\n  tunnel_major_casing: \"#b8b8b8\",\n  tunnel_highway_casing: \"#b8b8b8\",\n  tunnel_other: \"#d6d6d6\",\n  tunnel_minor: \"#d6d6d6\",\n  tunnel_link: \"#d6d6d6\",\n  tunnel_medium: \"#d6d6d6\",\n  tunnel_major: \"#d6d6d6\",\n  tunnel_highway: \"#d6d6d6\",\n\n  transit_pier: \"#b8b8b8\",\n  buildings: \"#e0e0e0\",\n\n  minor_service_casing: \"#cccccc\",\n  minor_casing: \"#cccccc\",\n  link_casing: \"#cccccc\",\n  medium_casing: \"#cccccc\",\n  major_casing_late: \"#cccccc\",\n  highway_casing_late: \"#cccccc\",\n  other: \"#e0e0e0\",\n  minor_service: \"#e0e0e0\",\n  minor_a: \"#ebebeb\",\n  minor_b: \"#e0e0e0\",\n  link: \"#ebebeb\",\n  medium: \"#ebebeb\",\n  major_casing_early: \"#cccccc\",\n  major: \"#ebebeb\",\n  highway_casing_early: \"#cccccc\",\n  highway: \"#ebebeb\",\n\n  railway: \"#f5f5f5\",\n  boundaries: \"#5c5c5c\",\n  waterway_label: \"#7a7a7a\",\n\n  bridges_other_casing: \"#cccccc\",\n  bridges_minor_casing: \"#cccccc\",\n  bridges_link_casing: \"#cccccc\",\n  bridges_medium_casing: \"#cccccc\",\n  bridges_major_casing: \"#cccccc\",\n  bridges_highway_casing: \"#cccccc\",\n  bridges_other: \"#e0e0e0\",\n  bridges_minor: \"#e0e0e0\",\n  bridges_link: \"#ebebeb\",\n  bridges_medium: \"#ebebeb\",\n  bridges_major: \"#ebebeb\",\n  bridges_highway: \"#ebebeb\",\n\n  roads_label_minor: \"#999999\",\n  roads_label_minor_halo: \"#e0e0e0\",\n  roads_label_major: \"#8f8f8f\",\n  roads_label_major_halo: \"#ebebeb\",\n  ocean_label: \"#7a7a7a\",\n  peak_label: \"#5c5c5c\",\n  subplace_label: \"#7a7a7a\",\n  subplace_label_halo: \"#cccccc\",\n  city_circle: \"#c2c2c2\",\n  city_circle_stroke: \"#7a7a7a\",\n  city_label: \"#474747\",\n  city_label_halo: \"#cccccc\",\n  state_label: \"#999999\",\n  state_label_halo: \"#cccccc\",\n  country_label: \"#858585\",\n};\n\nexport const BLACK: Theme = {\n  background: \"#2b2b2b\",\n  earth: \"#141414\",\n  park_a: \"#181818\",\n  park_b: \"#181818\",\n  hospital: \"#1d1d1d\",\n  industrial: \"#101010\",\n  school: \"#111111\",\n  wood_a: \"#1a1a1a\",\n  wood_b: \"#1a1a1a\",\n  pedestrian: \"#191919\",\n  scrub_a: \"#1c1c1c\",\n  scrub_b: \"#1c1c1c\",\n  glacier: \"#191919\",\n  sand: \"#161616\",\n  beach: \"#1f1f1f\",\n  aerodrome: \"#191919\",\n  runway: \"#323232\",\n  water: \"#333333\",\n  pier: \"#0a0a0a\",\n  zoo: \"#191919\",\n  military: \"#121212\",\n\n  tunnel_other_casing: \"#101010\",\n  tunnel_minor_casing: \"#101010\",\n  tunnel_link_casing: \"#101010\",\n  tunnel_medium_casing: \"#101010\",\n  tunnel_major_casing: \"#101010\",\n  tunnel_highway_casing: \"#101010\",\n  tunnel_other: \"#292929\",\n  tunnel_minor: \"#292929\",\n  tunnel_link: \"#292929\",\n  tunnel_medium: \"#292929\",\n  tunnel_major: \"#292929\",\n  tunnel_highway: \"#292929\",\n\n  transit_pier: \"#0a0a0a\",\n  buildings: \"#0a0a0a\",\n\n  minor_service_casing: \"#141414\",\n  minor_casing: \"#141414\",\n  link_casing: \"#141414\",\n  medium_casing: \"#141414\",\n  major_casing_late: \"#141414\",\n  highway_casing_late: \"#141414\",\n  other: \"#1f1f1f\",\n  minor_service: \"#1f1f1f\",\n  minor_a: \"#292929\",\n  minor_b: \"#1f1f1f\",\n  link: \"#1f1f1f\",\n  medium: \"#292929\",\n  major_casing_early: \"#141414\",\n  major: \"#292929\",\n  highway_casing_early: \"#141414\",\n  highway: \"#292929\",\n\n  railway: \"#292929\",\n  boundaries: \"#707070\",\n  waterway_label: \"#707070\",\n\n  bridges_other_casing: \"#141414\",\n  bridges_minor_casing: \"#141414\",\n  bridges_link_casing: \"#141414\",\n  bridges_medium_casing: \"#141414\",\n  bridges_major_casing: \"#141414\",\n  bridges_highway_casing: \"#141414\",\n  bridges_other: \"#1f1f1f\",\n  bridges_minor: \"#1f1f1f\",\n  bridges_link: \"#292929\",\n  bridges_medium: \"#292929\",\n  bridges_major: \"#292929\",\n  bridges_highway: \"#292929\",\n\n  roads_label_minor: \"#525252\",\n  roads_label_minor_halo: \"#141414\",\n  roads_label_major: \"#5c5c5c\",\n  roads_label_major_halo: \"#141414\",\n  ocean_label: \"#707070\",\n  peak_label: \"#707070\",\n  subplace_label: \"#5c5c5c\",\n  subplace_label_halo: \"#141414\",\n  city_circle: \"#000000\",\n  city_circle_stroke: \"#666666\",\n  city_label: \"#999999\",\n  city_label_halo: \"#141414\",\n  state_label: \"#3d3d3d\",\n  state_label_halo: \"#141414\",\n  country_label: \"#707070\",\n};\n\nexport const SHOW: Theme = {\n  background: \"transparent\",\n  earth: \"#e0e0e0\",\n  park_a: \"#cfddd5\",\n  park_b: \"#9cd3b4\",\n  hospital: \"#e4dad9\",\n  industrial: \"#d1dde1\",\n  school: \"#e4ded7\",\n  wood_a: \"#d0ded0\",\n  wood_b: \"#a0d9a0\",\n  pedestrian: \"#e3e0d4\",\n  scrub_a: \"#cedcd7\",\n  scrub_b: \"#99d2bb\",\n  glacier: \"#e7e7e7\",\n  sand: \"#e2e0d7\",\n  beach: \"#e8e4d0\",\n  aerodrome: \"#dadbdf\",\n  runway: \"#e9e9ed\",\n  water: \"#80deea\",\n  pier: \"#e0e0e0\",\n  zoo: \"#c6dcdc\",\n  military: \"#dcdcdc\",\n\n  tunnel_other_casing: \"#e0e0e0\",\n  tunnel_minor_casing: \"#e0e0e0\",\n  tunnel_link_casing: \"#e0e0e0\",\n  tunnel_medium_casing: \"#e0e0e0\",\n  tunnel_major_casing: \"#e0e0e0\",\n  tunnel_highway_casing: \"#e0e0e0\",\n  tunnel_other: \"#d5d5d5\",\n  tunnel_minor: \"#d5d5d5\",\n  tunnel_link: \"#d5d5d5\",\n  tunnel_medium: \"#d5d5d5\",\n  tunnel_major: \"#d5d5d5\",\n  tunnel_highway: \"#d5d5d5\",\n\n  transit_pier: \"#e0e0e0\",\n  buildings: \"#cccccc\",\n\n  minor_service_casing: \"#e0e0e0\",\n  minor_casing: \"#e0e0e0\",\n  link_casing: \"#e0e0e0\",\n  medium_casing: \"#e0e0e0\",\n  major_casing_late: \"#e0e0e0\",\n  highway_casing_late: \"#e0e0e0\",\n  other: \"#ebebeb\",\n  minor_service: \"#ebebeb\",\n  minor_a: \"#ebebeb\",\n  minor_b: \"#ffffff\",\n  link: \"#ffffff\",\n  medium: \"#f5f5f5\",\n  major_casing_early: \"#e0e0e0\",\n  major: \"#ffffff\",\n  highway_casing_early: \"#e0e0e0\",\n  highway: \"#ffffff\",\n\n  railway: \"#a7b1b3\",\n  boundaries: \"#adadad\",\n  waterway_label: \"#ffffff\",\n\n  bridges_other_casing: \"#e0e0e0\",\n  bridges_minor_casing: \"#e0e0e0\",\n  bridges_link_casing: \"#e0e0e0\",\n  bridges_medium_casing: \"#e0e0e0\",\n  bridges_major_casing: \"#e0e0e0\",\n  bridges_highway_casing: \"#e0e0e0\",\n  bridges_other: \"#ebebeb\",\n  bridges_minor: \"#ffffff\",\n  bridges_link: \"#ffffff\",\n  bridges_medium: \"#f0eded\",\n  bridges_major: \"#f5f5f5\",\n  bridges_highway: \"#ffffff\",\n\n  roads_label_minor: \"#91888b\",\n  roads_label_minor_halo: \"#ffffff\",\n  roads_label_major: \"#938a8d\",\n  roads_label_major_halo: \"#ffffff\",\n  ocean_label: \"#ffffff\",\n  peak_label: \"#7e9aa0\",\n  subplace_label: \"#8f8f8f\",\n  subplace_label_halo: \"#e0e0e0\",\n  city_circle: \"#ffffff\",\n  city_circle_stroke: \"#a3a3a3\",\n  city_label: \"#5c5c5c\",\n  city_label_halo: \"#e0e0e0\",\n  state_label: \"#b3b3b3\",\n  state_label_halo: \"#e0e0e0\",\n  country_label: \"#a3a3a3\",\n};\n\nexport const themes: Record<string, Theme> = {\n  show: SHOW,\n  light: LIGHT,\n  dark: DARK,\n  white: WHITE,\n  grayscale: GRAYSCALE,\n  black: BLACK,\n};\n","\nexport default function quickselect(arr, k, left, right, compare) {\n    quickselectStep(arr, k, left || 0, right || (arr.length - 1), compare || defaultCompare);\n}\n\nfunction quickselectStep(arr, k, left, right, compare) {\n\n    while (right > left) {\n        if (right - left > 600) {\n            var n = right - left + 1;\n            var m = k - left + 1;\n            var z = Math.log(n);\n            var s = 0.5 * Math.exp(2 * z / 3);\n            var sd = 0.5 * Math.sqrt(z * s * (n - s) / n) * (m - n / 2 < 0 ? -1 : 1);\n            var newLeft = Math.max(left, Math.floor(k - m * s / n + sd));\n            var newRight = Math.min(right, Math.floor(k + (n - m) * s / n + sd));\n            quickselectStep(arr, k, newLeft, newRight, compare);\n        }\n\n        var t = arr[k];\n        var i = left;\n        var j = right;\n\n        swap(arr, left, k);\n        if (compare(arr[right], t) > 0) swap(arr, left, right);\n\n        while (i < j) {\n            swap(arr, i, j);\n            i++;\n            j--;\n            while (compare(arr[i], t) < 0) i++;\n            while (compare(arr[j], t) > 0) j--;\n        }\n\n        if (compare(arr[left], t) === 0) swap(arr, left, j);\n        else {\n            j++;\n            swap(arr, j, right);\n        }\n\n        if (j <= k) left = j + 1;\n        if (k <= j) right = j - 1;\n    }\n}\n\nfunction swap(arr, i, j) {\n    var tmp = arr[i];\n    arr[i] = arr[j];\n    arr[j] = tmp;\n}\n\nfunction defaultCompare(a, b) {\n    return a < b ? -1 : a > b ? 1 : 0;\n}\n","import quickselect from 'quickselect';\n\nexport default class RBush {\n    constructor(maxEntries = 9) {\n        // max entries in a node is 9 by default; min node fill is 40% for best performance\n        this._maxEntries = Math.max(4, maxEntries);\n        this._minEntries = Math.max(2, Math.ceil(this._maxEntries * 0.4));\n        this.clear();\n    }\n\n    all() {\n        return this._all(this.data, []);\n    }\n\n    search(bbox) {\n        let node = this.data;\n        const result = [];\n\n        if (!intersects(bbox, node)) return result;\n\n        const toBBox = this.toBBox;\n        const nodesToSearch = [];\n\n        while (node) {\n            for (let i = 0; i < node.children.length; i++) {\n                const child = node.children[i];\n                const childBBox = node.leaf ? toBBox(child) : child;\n\n                if (intersects(bbox, childBBox)) {\n                    if (node.leaf) result.push(child);\n                    else if (contains(bbox, childBBox)) this._all(child, result);\n                    else nodesToSearch.push(child);\n                }\n            }\n            node = nodesToSearch.pop();\n        }\n\n        return result;\n    }\n\n    collides(bbox) {\n        let node = this.data;\n\n        if (!intersects(bbox, node)) return false;\n\n        const nodesToSearch = [];\n        while (node) {\n            for (let i = 0; i < node.children.length; i++) {\n                const child = node.children[i];\n                const childBBox = node.leaf ? this.toBBox(child) : child;\n\n                if (intersects(bbox, childBBox)) {\n                    if (node.leaf || contains(bbox, childBBox)) return true;\n                    nodesToSearch.push(child);\n                }\n            }\n            node = nodesToSearch.pop();\n        }\n\n        return false;\n    }\n\n    load(data) {\n        if (!(data && data.length)) return this;\n\n        if (data.length < this._minEntries) {\n            for (let i = 0; i < data.length; i++) {\n                this.insert(data[i]);\n            }\n            return this;\n        }\n\n        // recursively build the tree with the given data from scratch using OMT algorithm\n        let node = this._build(data.slice(), 0, data.length - 1, 0);\n\n        if (!this.data.children.length) {\n            // save as is if tree is empty\n            this.data = node;\n\n        } else if (this.data.height === node.height) {\n            // split root if trees have the same height\n            this._splitRoot(this.data, node);\n\n        } else {\n            if (this.data.height < node.height) {\n                // swap trees if inserted one is bigger\n                const tmpNode = this.data;\n                this.data = node;\n                node = tmpNode;\n            }\n\n            // insert the small tree into the large tree at appropriate level\n            this._insert(node, this.data.height - node.height - 1, true);\n        }\n\n        return this;\n    }\n\n    insert(item) {\n        if (item) this._insert(item, this.data.height - 1);\n        return this;\n    }\n\n    clear() {\n        this.data = createNode([]);\n        return this;\n    }\n\n    remove(item, equalsFn) {\n        if (!item) return this;\n\n        let node = this.data;\n        const bbox = this.toBBox(item);\n        const path = [];\n        const indexes = [];\n        let i, parent, goingUp;\n\n        // depth-first iterative tree traversal\n        while (node || path.length) {\n\n            if (!node) { // go up\n                node = path.pop();\n                parent = path[path.length - 1];\n                i = indexes.pop();\n                goingUp = true;\n            }\n\n            if (node.leaf) { // check current node\n                const index = findItem(item, node.children, equalsFn);\n\n                if (index !== -1) {\n                    // item found, remove the item and condense tree upwards\n                    node.children.splice(index, 1);\n                    path.push(node);\n                    this._condense(path);\n                    return this;\n                }\n            }\n\n            if (!goingUp && !node.leaf && contains(node, bbox)) { // go down\n                path.push(node);\n                indexes.push(i);\n                i = 0;\n                parent = node;\n                node = node.children[0];\n\n            } else if (parent) { // go right\n                i++;\n                node = parent.children[i];\n                goingUp = false;\n\n            } else node = null; // nothing found\n        }\n\n        return this;\n    }\n\n    toBBox(item) { return item; }\n\n    compareMinX(a, b) { return a.minX - b.minX; }\n    compareMinY(a, b) { return a.minY - b.minY; }\n\n    toJSON() { return this.data; }\n\n    fromJSON(data) {\n        this.data = data;\n        return this;\n    }\n\n    _all(node, result) {\n        const nodesToSearch = [];\n        while (node) {\n            if (node.leaf) result.push(...node.children);\n            else nodesToSearch.push(...node.children);\n\n            node = nodesToSearch.pop();\n        }\n        return result;\n    }\n\n    _build(items, left, right, height) {\n\n        const N = right - left + 1;\n        let M = this._maxEntries;\n        let node;\n\n        if (N <= M) {\n            // reached leaf level; return leaf\n            node = createNode(items.slice(left, right + 1));\n            calcBBox(node, this.toBBox);\n            return node;\n        }\n\n        if (!height) {\n            // target height of the bulk-loaded tree\n            height = Math.ceil(Math.log(N) / Math.log(M));\n\n            // target number of root entries to maximize storage utilization\n            M = Math.ceil(N / Math.pow(M, height - 1));\n        }\n\n        node = createNode([]);\n        node.leaf = false;\n        node.height = height;\n\n        // split the items into M mostly square tiles\n\n        const N2 = Math.ceil(N / M);\n        const N1 = N2 * Math.ceil(Math.sqrt(M));\n\n        multiSelect(items, left, right, N1, this.compareMinX);\n\n        for (let i = left; i <= right; i += N1) {\n\n            const right2 = Math.min(i + N1 - 1, right);\n\n            multiSelect(items, i, right2, N2, this.compareMinY);\n\n            for (let j = i; j <= right2; j += N2) {\n\n                const right3 = Math.min(j + N2 - 1, right2);\n\n                // pack each entry recursively\n                node.children.push(this._build(items, j, right3, height - 1));\n            }\n        }\n\n        calcBBox(node, this.toBBox);\n\n        return node;\n    }\n\n    _chooseSubtree(bbox, node, level, path) {\n        while (true) {\n            path.push(node);\n\n            if (node.leaf || path.length - 1 === level) break;\n\n            let minArea = Infinity;\n            let minEnlargement = Infinity;\n            let targetNode;\n\n            for (let i = 0; i < node.children.length; i++) {\n                const child = node.children[i];\n                const area = bboxArea(child);\n                const enlargement = enlargedArea(bbox, child) - area;\n\n                // choose entry with the least area enlargement\n                if (enlargement < minEnlargement) {\n                    minEnlargement = enlargement;\n                    minArea = area < minArea ? area : minArea;\n                    targetNode = child;\n\n                } else if (enlargement === minEnlargement) {\n                    // otherwise choose one with the smallest area\n                    if (area < minArea) {\n                        minArea = area;\n                        targetNode = child;\n                    }\n                }\n            }\n\n            node = targetNode || node.children[0];\n        }\n\n        return node;\n    }\n\n    _insert(item, level, isNode) {\n        const bbox = isNode ? item : this.toBBox(item);\n        const insertPath = [];\n\n        // find the best node for accommodating the item, saving all nodes along the path too\n        const node = this._chooseSubtree(bbox, this.data, level, insertPath);\n\n        // put the item into the node\n        node.children.push(item);\n        extend(node, bbox);\n\n        // split on node overflow; propagate upwards if necessary\n        while (level >= 0) {\n            if (insertPath[level].children.length > this._maxEntries) {\n                this._split(insertPath, level);\n                level--;\n            } else break;\n        }\n\n        // adjust bboxes along the insertion path\n        this._adjustParentBBoxes(bbox, insertPath, level);\n    }\n\n    // split overflowed node into two\n    _split(insertPath, level) {\n        const node = insertPath[level];\n        const M = node.children.length;\n        const m = this._minEntries;\n\n        this._chooseSplitAxis(node, m, M);\n\n        const splitIndex = this._chooseSplitIndex(node, m, M);\n\n        const newNode = createNode(node.children.splice(splitIndex, node.children.length - splitIndex));\n        newNode.height = node.height;\n        newNode.leaf = node.leaf;\n\n        calcBBox(node, this.toBBox);\n        calcBBox(newNode, this.toBBox);\n\n        if (level) insertPath[level - 1].children.push(newNode);\n        else this._splitRoot(node, newNode);\n    }\n\n    _splitRoot(node, newNode) {\n        // split root node\n        this.data = createNode([node, newNode]);\n        this.data.height = node.height + 1;\n        this.data.leaf = false;\n        calcBBox(this.data, this.toBBox);\n    }\n\n    _chooseSplitIndex(node, m, M) {\n        let index;\n        let minOverlap = Infinity;\n        let minArea = Infinity;\n\n        for (let i = m; i <= M - m; i++) {\n            const bbox1 = distBBox(node, 0, i, this.toBBox);\n            const bbox2 = distBBox(node, i, M, this.toBBox);\n\n            const overlap = intersectionArea(bbox1, bbox2);\n            const area = bboxArea(bbox1) + bboxArea(bbox2);\n\n            // choose distribution with minimum overlap\n            if (overlap < minOverlap) {\n                minOverlap = overlap;\n                index = i;\n\n                minArea = area < minArea ? area : minArea;\n\n            } else if (overlap === minOverlap) {\n                // otherwise choose distribution with minimum area\n                if (area < minArea) {\n                    minArea = area;\n                    index = i;\n                }\n            }\n        }\n\n        return index || M - m;\n    }\n\n    // sorts node children by the best axis for split\n    _chooseSplitAxis(node, m, M) {\n        const compareMinX = node.leaf ? this.compareMinX : compareNodeMinX;\n        const compareMinY = node.leaf ? this.compareMinY : compareNodeMinY;\n        const xMargin = this._allDistMargin(node, m, M, compareMinX);\n        const yMargin = this._allDistMargin(node, m, M, compareMinY);\n\n        // if total distributions margin value is minimal for x, sort by minX,\n        // otherwise it's already sorted by minY\n        if (xMargin < yMargin) node.children.sort(compareMinX);\n    }\n\n    // total margin of all possible split distributions where each node is at least m full\n    _allDistMargin(node, m, M, compare) {\n        node.children.sort(compare);\n\n        const toBBox = this.toBBox;\n        const leftBBox = distBBox(node, 0, m, toBBox);\n        const rightBBox = distBBox(node, M - m, M, toBBox);\n        let margin = bboxMargin(leftBBox) + bboxMargin(rightBBox);\n\n        for (let i = m; i < M - m; i++) {\n            const child = node.children[i];\n            extend(leftBBox, node.leaf ? toBBox(child) : child);\n            margin += bboxMargin(leftBBox);\n        }\n\n        for (let i = M - m - 1; i >= m; i--) {\n            const child = node.children[i];\n            extend(rightBBox, node.leaf ? toBBox(child) : child);\n            margin += bboxMargin(rightBBox);\n        }\n\n        return margin;\n    }\n\n    _adjustParentBBoxes(bbox, path, level) {\n        // adjust bboxes along the given tree path\n        for (let i = level; i >= 0; i--) {\n            extend(path[i], bbox);\n        }\n    }\n\n    _condense(path) {\n        // go through the path, removing empty nodes and updating bboxes\n        for (let i = path.length - 1, siblings; i >= 0; i--) {\n            if (path[i].children.length === 0) {\n                if (i > 0) {\n                    siblings = path[i - 1].children;\n                    siblings.splice(siblings.indexOf(path[i]), 1);\n\n                } else this.clear();\n\n            } else calcBBox(path[i], this.toBBox);\n        }\n    }\n}\n\nfunction findItem(item, items, equalsFn) {\n    if (!equalsFn) return items.indexOf(item);\n\n    for (let i = 0; i < items.length; i++) {\n        if (equalsFn(item, items[i])) return i;\n    }\n    return -1;\n}\n\n// calculate node's bbox from bboxes of its children\nfunction calcBBox(node, toBBox) {\n    distBBox(node, 0, node.children.length, toBBox, node);\n}\n\n// min bounding rectangle of node children from k to p-1\nfunction distBBox(node, k, p, toBBox, destNode) {\n    if (!destNode) destNode = createNode(null);\n    destNode.minX = Infinity;\n    destNode.minY = Infinity;\n    destNode.maxX = -Infinity;\n    destNode.maxY = -Infinity;\n\n    for (let i = k; i < p; i++) {\n        const child = node.children[i];\n        extend(destNode, node.leaf ? toBBox(child) : child);\n    }\n\n    return destNode;\n}\n\nfunction extend(a, b) {\n    a.minX = Math.min(a.minX, b.minX);\n    a.minY = Math.min(a.minY, b.minY);\n    a.maxX = Math.max(a.maxX, b.maxX);\n    a.maxY = Math.max(a.maxY, b.maxY);\n    return a;\n}\n\nfunction compareNodeMinX(a, b) { return a.minX - b.minX; }\nfunction compareNodeMinY(a, b) { return a.minY - b.minY; }\n\nfunction bboxArea(a)   { return (a.maxX - a.minX) * (a.maxY - a.minY); }\nfunction bboxMargin(a) { return (a.maxX - a.minX) + (a.maxY - a.minY); }\n\nfunction enlargedArea(a, b) {\n    return (Math.max(b.maxX, a.maxX) - Math.min(b.minX, a.minX)) *\n           (Math.max(b.maxY, a.maxY) - Math.min(b.minY, a.minY));\n}\n\nfunction intersectionArea(a, b) {\n    const minX = Math.max(a.minX, b.minX);\n    const minY = Math.max(a.minY, b.minY);\n    const maxX = Math.min(a.maxX, b.maxX);\n    const maxY = Math.min(a.maxY, b.maxY);\n\n    return Math.max(0, maxX - minX) *\n           Math.max(0, maxY - minY);\n}\n\nfunction contains(a, b) {\n    return a.minX <= b.minX &&\n           a.minY <= b.minY &&\n           b.maxX <= a.maxX &&\n           b.maxY <= a.maxY;\n}\n\nfunction intersects(a, b) {\n    return b.minX <= a.maxX &&\n           b.minY <= a.maxY &&\n           b.maxX >= a.minX &&\n           b.maxY >= a.minY;\n}\n\nfunction createNode(children) {\n    return {\n        children,\n        height: 1,\n        leaf: true,\n        minX: Infinity,\n        minY: Infinity,\n        maxX: -Infinity,\n        maxY: -Infinity\n    };\n}\n\n// sort an array so that items come in groups of n unsorted items, with groups sorted between each other;\n// combines selection algorithm with binary divide & conquer approach\n\nfunction multiSelect(arr, left, right, n, compare) {\n    const stack = [left, right];\n\n    while (stack.length) {\n        right = stack.pop();\n        left = stack.pop();\n\n        if (right - left <= n) continue;\n\n        const mid = left + Math.ceil((right - left) / n / 2) * n;\n        quickselect(arr, mid, left, right, compare);\n\n        stack.push(left, mid, mid, right);\n    }\n}\n","import Point from \"@mapbox/point-geometry\";\nimport { PMTiles } from \"pmtiles\";\nimport {\n  Bbox,\n  Feature,\n  PmtilesSource,\n  TileCache,\n  TileSource,\n  Zxy,\n  ZxySource,\n} from \"./tilecache\";\n\n/*\n * PreparedTile\n * For a given display Z:\n * layers: map of names-> features with coordinates in CSS pixel units.\n * translate: how to get layers coordinates to global Z coordinates.\n * dataTile: the Z,X,Y of the data tile.\n * window? if present, use as bounding box or canvas clipping area.\n */\nexport interface PreparedTile {\n  z: number; // the display zoom level that it is for\n  origin: Point; // the top-left corner in global CSS pixel coordinates\n  data: Map<string, Feature[]>; // return a map to Iterable\n  scale: number; // over or underzooming scale\n  dim: number; // the effective size of this tile on the zoom level\n  dataTile: Zxy; // the key of the raw tile\n}\n\nexport interface TileTransform {\n  dataTile: Zxy;\n  origin: Point;\n  scale: number;\n  dim: number;\n}\n\n// TODO make this lazy\nexport const transformGeom = (\n  geom: Array<Array<Point>>,\n  scale: number,\n  translate: Point,\n) => {\n  const retval = [];\n  for (const arr of geom) {\n    const loop = [];\n    for (const coord of arr) {\n      loop.push(coord.clone().mult(scale).add(translate));\n    }\n    retval.push(loop);\n  }\n  return retval;\n};\n\nexport const wrap = (val: number, z: number) => {\n  const dim = 1 << z;\n  if (val < 0) return dim + val;\n  if (val >= dim) return val % dim;\n  return val;\n};\n\n/*\n * @class View\n * expresses relationship between canvas coordinates and data tiles.\n */\nexport class View {\n  levelDiff: number;\n  tileCache: TileCache;\n  maxDataLevel: number;\n\n  constructor(tileCache: TileCache, maxDataLevel: number, levelDiff: number) {\n    this.tileCache = tileCache;\n    this.maxDataLevel = maxDataLevel;\n    this.levelDiff = levelDiff;\n  }\n\n  public dataTilesForBounds(\n    displayZoom: number,\n    bounds: Bbox,\n  ): Array<TileTransform> {\n    const fractional = 2 ** displayZoom / 2 ** Math.ceil(displayZoom);\n    const needed = [];\n    let scale = 1;\n    const dim = this.tileCache.tileSize;\n    if (displayZoom < this.levelDiff) {\n      scale = (1 / (1 << (this.levelDiff - displayZoom))) * fractional;\n      needed.push({\n        dataTile: { z: 0, x: 0, y: 0 },\n        origin: new Point(0, 0),\n        scale: scale,\n        dim: dim * scale,\n      });\n    } else if (displayZoom <= this.levelDiff + this.maxDataLevel) {\n      const f = 1 << this.levelDiff;\n\n      const basetileSize = 256 * fractional;\n\n      const dataZoom = Math.ceil(displayZoom) - this.levelDiff;\n\n      const mintileX = Math.floor(bounds.minX / f / basetileSize);\n      const mintileY = Math.floor(bounds.minY / f / basetileSize);\n      const maxtileX = Math.floor(bounds.maxX / f / basetileSize);\n      const maxtileY = Math.floor(bounds.maxY / f / basetileSize);\n      for (let tx = mintileX; tx <= maxtileX; tx++) {\n        for (let ty = mintileY; ty <= maxtileY; ty++) {\n          const origin = new Point(\n            tx * f * basetileSize,\n            ty * f * basetileSize,\n          );\n          needed.push({\n            dataTile: {\n              z: dataZoom,\n              x: wrap(tx, dataZoom),\n              y: wrap(ty, dataZoom),\n            },\n            origin: origin,\n            scale: fractional,\n            dim: dim * fractional,\n          });\n        }\n      }\n    } else {\n      const f = 1 << this.levelDiff;\n      scale =\n        (1 << (Math.ceil(displayZoom) - this.maxDataLevel - this.levelDiff)) *\n        fractional;\n      const mintileX = Math.floor(bounds.minX / f / 256 / scale);\n      const mintileY = Math.floor(bounds.minY / f / 256 / scale);\n      const maxtileX = Math.floor(bounds.maxX / f / 256 / scale);\n      const maxtileY = Math.floor(bounds.maxY / f / 256 / scale);\n      for (let tx = mintileX; tx <= maxtileX; tx++) {\n        for (let ty = mintileY; ty <= maxtileY; ty++) {\n          const origin = new Point(tx * f * 256 * scale, ty * f * 256 * scale);\n          needed.push({\n            dataTile: {\n              z: this.maxDataLevel,\n              x: wrap(tx, this.maxDataLevel),\n              y: wrap(ty, this.maxDataLevel),\n            },\n            origin: origin,\n            scale: scale,\n            dim: dim * scale,\n          });\n        }\n      }\n    }\n    return needed;\n  }\n\n  public dataTileForDisplayTile(displayTile: Zxy): TileTransform {\n    let dataTile: Zxy;\n    let scale = 1;\n    let dim = this.tileCache.tileSize;\n    let origin: Point;\n    if (displayTile.z < this.levelDiff) {\n      dataTile = { z: 0, x: 0, y: 0 };\n      scale = 1 / (1 << (this.levelDiff - displayTile.z));\n      origin = new Point(0, 0);\n      dim = dim * scale;\n    } else if (displayTile.z <= this.levelDiff + this.maxDataLevel) {\n      const f = 1 << this.levelDiff;\n      dataTile = {\n        z: displayTile.z - this.levelDiff,\n        x: Math.floor(displayTile.x / f),\n        y: Math.floor(displayTile.y / f),\n      };\n      origin = new Point(dataTile.x * f * 256, dataTile.y * f * 256);\n    } else {\n      scale = 1 << (displayTile.z - this.maxDataLevel - this.levelDiff);\n      const f = 1 << this.levelDiff;\n      dataTile = {\n        z: this.maxDataLevel,\n        x: Math.floor(displayTile.x / f / scale),\n        y: Math.floor(displayTile.y / f / scale),\n      };\n      origin = new Point(\n        dataTile.x * f * scale * 256,\n        dataTile.y * f * scale * 256,\n      );\n      dim = dim * scale;\n    }\n    return { dataTile: dataTile, scale: scale, origin: origin, dim: dim };\n  }\n\n  public async getBbox(\n    displayZoom: number,\n    bounds: Bbox,\n  ): Promise<Array<PreparedTile>> {\n    const needed = this.dataTilesForBounds(displayZoom, bounds);\n    const result = await Promise.all(\n      needed.map((tt) => this.tileCache.get(tt.dataTile)),\n    );\n    return result.map((data, i) => {\n      const tt = needed[i];\n      return {\n        data: data,\n        z: displayZoom,\n        dataTile: tt.dataTile,\n        scale: tt.scale,\n        dim: tt.dim,\n        origin: tt.origin,\n      };\n    });\n  }\n\n  public async getDisplayTile(displayTile: Zxy): Promise<PreparedTile> {\n    const tt = this.dataTileForDisplayTile(displayTile);\n    const data = await this.tileCache.get(tt.dataTile);\n    return {\n      data: data,\n      z: displayTile.z,\n      dataTile: tt.dataTile,\n      scale: tt.scale,\n      origin: tt.origin,\n      dim: tt.dim,\n    };\n  }\n\n  public queryFeatures(\n    lng: number,\n    lat: number,\n    displayZoom: number,\n    brushSize: number,\n  ) {\n    const roundedZoom = Math.round(displayZoom);\n    const dataZoom = Math.min(roundedZoom - this.levelDiff, this.maxDataLevel);\n    const brushSizeAtZoom = brushSize / (1 << (roundedZoom - dataZoom));\n    return this.tileCache.queryFeatures(lng, lat, dataZoom, brushSizeAtZoom);\n  }\n}\n\nexport interface SourceOptions {\n  levelDiff?: number;\n  maxDataZoom?: number;\n  url?: PMTiles | string;\n  sources?: Record<string, SourceOptions>;\n}\n\nexport const sourcesToViews = (options: SourceOptions) => {\n  const sourceToViews = (o: SourceOptions): View => {\n    const levelDiff = o.levelDiff === undefined ? 1 : o.levelDiff;\n    const maxDataZoom = o.maxDataZoom || 15;\n    let source: TileSource;\n    if (typeof o.url === \"string\") {\n      if (new URL(o.url, \"http://example.com\").pathname.endsWith(\".pmtiles\")) {\n        source = new PmtilesSource(o.url, true);\n      } else {\n        source = new ZxySource(o.url, true);\n      }\n    } else if (o.url) {\n      source = new PmtilesSource(o.url, true);\n    } else {\n      throw new Error(`Invalid source ${o.url}`);\n    }\n\n    const cache = new TileCache(source, (256 * 1) << levelDiff);\n    return new View(cache, maxDataZoom, levelDiff);\n  };\n\n  const sources = new Map<string, View>();\n  if (options.sources) {\n    for (const key in options.sources) {\n      sources.set(key, sourceToViews(options.sources[key]));\n    }\n  } else {\n    sources.set(\"\", sourceToViews(options));\n  }\n  return sources;\n};\n","import Point from \"@mapbox/point-geometry\";\nimport rBush from \"rbush\";\nimport { Filter } from \"./painter\";\nimport { DrawExtra, LabelSymbolizer } from \"./symbolizer\";\nimport { Bbox, JsonObject, toIndex } from \"./tilecache\";\nimport { PreparedTile, transformGeom } from \"./view\";\n\ntype TileInvalidationCallback = (tiles: Set<string>) => void;\n\n// the anchor should be contained within, or on the boundary of,\n// one of the bounding boxes. This is not enforced by library,\n// but is required for label deduplication.\nexport interface Label {\n  anchor: Point;\n  bboxes: Bbox[];\n  draw: (ctx: CanvasRenderingContext2D, drawExtra?: DrawExtra) => void;\n  deduplicationKey?: string;\n  deduplicationDistance?: number;\n}\n\nexport interface IndexedLabel {\n  anchor: Point;\n  bboxes: Bbox[];\n  draw: (ctx: CanvasRenderingContext2D) => void;\n  order: number;\n  tileKey: string;\n  deduplicationKey?: string;\n  deduplicationDistance?: number;\n}\n\ntype TreeItem = Bbox & { indexedLabel: IndexedLabel };\n\nexport interface Layout {\n  index: Index;\n  order: number;\n  scratch: CanvasRenderingContext2D;\n  zoom: number;\n  overzoom: number;\n}\n\nexport interface LabelRule {\n  id?: string;\n  minzoom?: number;\n  maxzoom?: number;\n  dataSource?: string;\n  dataLayer: string;\n  symbolizer: LabelSymbolizer;\n  filter?: Filter;\n  visible?: boolean;\n  sort?: (a: JsonObject, b: JsonObject) => number;\n}\n\nexport const covering = (\n  displayZoom: number,\n  tileWidth: number,\n  bbox: Bbox,\n) => {\n  const res = 256;\n  const f = tileWidth / res;\n\n  const minx = Math.floor(bbox.minX / res);\n  const miny = Math.floor(bbox.minY / res);\n  const maxx = Math.floor(bbox.maxX / res);\n  const maxy = Math.floor(bbox.maxY / res);\n  const leveldiff = Math.log2(f);\n\n  const retval = [];\n  for (let x = minx; x <= maxx; x++) {\n    const wrappedX = x % (1 << displayZoom);\n    for (let y = miny; y <= maxy; y++) {\n      retval.push({\n        display: toIndex({ z: displayZoom, x: wrappedX, y: y }),\n        key: toIndex({\n          z: displayZoom - leveldiff,\n          x: Math.floor(wrappedX / f),\n          y: Math.floor(y / f),\n        }),\n      });\n    }\n  }\n  return retval;\n};\n\nexport class Index {\n  tree: rBush<TreeItem>;\n  current: Map<string, Set<IndexedLabel>>;\n  dim: number;\n  maxLabeledTiles: number;\n\n  constructor(dim: number, maxLabeledTiles: number) {\n    this.tree = new rBush();\n    this.current = new Map();\n    this.dim = dim;\n    this.maxLabeledTiles = maxLabeledTiles;\n  }\n\n  public hasPrefix(tileKey: string): boolean {\n    for (const key of this.current.keys()) {\n      if (key.startsWith(tileKey)) return true;\n    }\n    return false;\n  }\n\n  public has(tileKey: string): boolean {\n    return this.current.has(tileKey);\n  }\n\n  public size(): number {\n    return this.current.size;\n  }\n\n  public keys() {\n    return this.current.keys();\n  }\n\n  public searchBbox(bbox: Bbox, order: number): Set<IndexedLabel> {\n    const labels = new Set<IndexedLabel>();\n    for (const match of this.tree.search(bbox)) {\n      if (match.indexedLabel.order <= order) {\n        labels.add(match.indexedLabel);\n      }\n    }\n    return labels;\n  }\n\n  public searchLabel(label: Label, order: number): Set<IndexedLabel> {\n    const labels = new Set<IndexedLabel>();\n    for (const bbox of label.bboxes) {\n      for (const match of this.tree.search(bbox)) {\n        if (match.indexedLabel.order <= order) {\n          labels.add(match.indexedLabel);\n        }\n      }\n    }\n    return labels;\n  }\n\n  public bboxCollides(bbox: Bbox, order: number): boolean {\n    for (const match of this.tree.search(bbox)) {\n      if (match.indexedLabel.order <= order) return true;\n    }\n    return false;\n  }\n\n  public labelCollides(label: Label, order: number): boolean {\n    for (const bbox of label.bboxes) {\n      for (const match of this.tree.search(bbox)) {\n        if (match.indexedLabel.order <= order) return true;\n      }\n    }\n    return false;\n  }\n\n  public deduplicationCollides(label: Label): boolean {\n    // create a bbox around anchor to find potential matches.\n    // this is depending on precondition: (anchor is contained within, or on boundary of, a label bbox)\n    if (!label.deduplicationKey || !label.deduplicationDistance) return false;\n    const dist = label.deduplicationDistance;\n    const testBbox = {\n      minX: label.anchor.x - dist,\n      minY: label.anchor.y - dist,\n      maxX: label.anchor.x + dist,\n      maxY: label.anchor.y + dist,\n    };\n    for (const collision of this.tree.search(testBbox)) {\n      if (collision.indexedLabel.deduplicationKey === label.deduplicationKey) {\n        if (collision.indexedLabel.anchor.dist(label.anchor) < dist) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  public makeEntry(tileKey: string) {\n    if (this.current.get(tileKey)) {\n      console.log(\"consistency error 1\");\n    }\n    const newSet = new Set<IndexedLabel>();\n    this.current.set(tileKey, newSet);\n  }\n\n  // can put in multiple due to antimeridian wrapping\n  public insert(label: Label, order: number, tileKey: string): void {\n    const indexedLabel = {\n      anchor: label.anchor,\n      bboxes: label.bboxes,\n      draw: label.draw,\n      order: order,\n      tileKey: tileKey,\n      deduplicationKey: label.deduplicationKey,\n      deduplicationDistance: label.deduplicationDistance,\n    };\n    let entry = this.current.get(tileKey);\n    if (!entry) {\n      const newSet = new Set<IndexedLabel>();\n      this.current.set(tileKey, newSet);\n      entry = newSet;\n    }\n    entry.add(indexedLabel);\n\n    let wrapsLeft = false;\n    let wrapsRight = false;\n    for (const bbox of label.bboxes) {\n      this.tree.insert({\n        minX: bbox.minX,\n        minY: bbox.minY,\n        maxX: bbox.maxX,\n        maxY: bbox.maxY,\n        indexedLabel: indexedLabel,\n      });\n      if (bbox.minX < 0) wrapsLeft = true;\n      if (bbox.maxX > this.dim) wrapsRight = true;\n    }\n\n    if (wrapsLeft || wrapsRight) {\n      const shift = wrapsLeft ? this.dim : -this.dim;\n\n      const newBboxes = [];\n      for (const bbox of label.bboxes) {\n        newBboxes.push({\n          minX: bbox.minX + shift,\n          minY: bbox.minY,\n          maxX: bbox.maxX + shift,\n          maxY: bbox.maxY,\n        });\n      }\n      const duplicateLabel = {\n        anchor: new Point(label.anchor.x + shift, label.anchor.y),\n        bboxes: newBboxes,\n        draw: label.draw,\n        order: order,\n        tileKey: tileKey,\n      };\n      const entry = this.current.get(tileKey);\n      if (entry) entry.add(duplicateLabel);\n      for (const bbox of newBboxes) {\n        this.tree.insert({\n          minX: bbox.minX,\n          minY: bbox.minY,\n          maxX: bbox.maxX,\n          maxY: bbox.maxY,\n          indexedLabel: duplicateLabel,\n        });\n      }\n    }\n  }\n\n  public pruneOrNoop(keyAdded: string) {\n    const added = keyAdded.split(\":\");\n    let maxKey = undefined;\n    let maxDist = 0;\n    let keysForDs = 0;\n\n    for (const existingKey of this.current.keys()) {\n      const existing = existingKey.split(\":\");\n      if (existing[3] === added[3]) {\n        keysForDs++;\n        const dist = Math.sqrt(\n          (+existing[0] - +added[0]) ** 2 + (+existing[1] - +added[1]) ** 2,\n        );\n        if (dist > maxDist) {\n          maxDist = dist;\n          maxKey = existingKey;\n        }\n      }\n\n      if (maxKey && keysForDs > this.maxLabeledTiles) {\n        this.pruneKey(maxKey);\n      }\n    }\n  }\n\n  public pruneKey(keyToRemove: string): void {\n    const indexedLabels = this.current.get(keyToRemove);\n    if (!indexedLabels) return; // TODO: not that clean...\n    const entriesToDelete = [];\n    for (const entry of this.tree.all()) {\n      if (indexedLabels.has(entry.indexedLabel)) {\n        entriesToDelete.push(entry);\n      }\n    }\n    for (const entry of entriesToDelete) {\n      this.tree.remove(entry);\n    }\n    this.current.delete(keyToRemove);\n  }\n\n  // NOTE: technically this is incorrect\n  // with antimeridian wrapping, since we should also remove\n  // the duplicate label; but i am having a hard time\n  // imagining where this will happen in practical usage\n  public removeLabel(labelToRemove: IndexedLabel): void {\n    const entriesToDelete = [];\n    for (const entry of this.tree.all()) {\n      if (labelToRemove === entry.indexedLabel) {\n        entriesToDelete.push(entry);\n      }\n    }\n    for (const entry of entriesToDelete) {\n      this.tree.remove(entry);\n    }\n    const c = this.current.get(labelToRemove.tileKey);\n    if (c) c.delete(labelToRemove);\n  }\n}\n\nexport class Labeler {\n  index: Index;\n  z: number;\n  scratch: CanvasRenderingContext2D;\n  labelRules: LabelRule[];\n  callback?: TileInvalidationCallback;\n\n  constructor(\n    z: number,\n    scratch: CanvasRenderingContext2D,\n    labelRules: LabelRule[],\n    maxLabeledTiles: number,\n    callback?: TileInvalidationCallback,\n  ) {\n    this.index = new Index((256 * 1) << z, maxLabeledTiles);\n    this.z = z;\n    this.scratch = scratch;\n    this.labelRules = labelRules;\n    this.callback = callback;\n  }\n\n  private layout(preparedTilemap: Map<string, PreparedTile[]>): number {\n    const start = performance.now();\n\n    const keysAdding = new Set<string>();\n    // if it already exists... short circuit\n    for (const [k, preparedTiles] of preparedTilemap) {\n      for (const preparedTile of preparedTiles) {\n        const key = `${toIndex(preparedTile.dataTile)}:${k}`;\n        if (!this.index.has(key)) {\n          this.index.makeEntry(key);\n          keysAdding.add(key);\n        }\n      }\n    }\n\n    const tilesInvalidated = new Set<string>();\n    for (const [order, rule] of this.labelRules.entries()) {\n      if (rule.visible === false) continue;\n      if (rule.minzoom && this.z < rule.minzoom) continue;\n      if (rule.maxzoom && this.z > rule.maxzoom) continue;\n\n      const dsName = rule.dataSource || \"\";\n      const preparedTiles = preparedTilemap.get(dsName);\n      if (!preparedTiles) continue;\n\n      for (const preparedTile of preparedTiles) {\n        const key = `${toIndex(preparedTile.dataTile)}:${dsName}`;\n        if (!keysAdding.has(key)) continue;\n\n        const layer = preparedTile.data.get(rule.dataLayer);\n        if (layer === undefined) continue;\n\n        const feats = layer;\n        if (rule.sort)\n          feats.sort((a, b) => {\n            if (rule.sort) {\n              return rule.sort(a.props, b.props);\n            }\n            return 0;\n          });\n\n        const layout = {\n          index: this.index,\n          zoom: this.z,\n          scratch: this.scratch,\n          order: order,\n          overzoom: this.z - preparedTile.dataTile.z,\n        };\n        for (const feature of feats) {\n          if (rule.filter && !rule.filter(this.z, feature)) continue;\n          const transformed = transformGeom(\n            feature.geom,\n            preparedTile.scale,\n            preparedTile.origin,\n          );\n          const labels = rule.symbolizer.place(layout, transformed, feature);\n          if (!labels) continue;\n\n          for (const label of labels) {\n            let labelAdded = false;\n            if (\n              label.deduplicationKey &&\n              this.index.deduplicationCollides(label)\n            ) {\n              continue;\n            }\n\n            // does the label collide with anything?\n            if (this.index.labelCollides(label, Infinity)) {\n              if (!this.index.labelCollides(label, order)) {\n                const conflicts = this.index.searchLabel(label, Infinity);\n                for (const conflict of conflicts) {\n                  this.index.removeLabel(conflict);\n                  for (const bbox of conflict.bboxes) {\n                    this.findInvalidatedTiles(\n                      tilesInvalidated,\n                      preparedTile.dim,\n                      bbox,\n                      key,\n                    );\n                  }\n                }\n                this.index.insert(label, order, key);\n                labelAdded = true;\n              }\n              // label not added.\n            } else {\n              this.index.insert(label, order, key);\n              labelAdded = true;\n            }\n\n            if (labelAdded) {\n              for (const bbox of label.bboxes) {\n                if (\n                  bbox.maxX > preparedTile.origin.x + preparedTile.dim ||\n                  bbox.minX < preparedTile.origin.x ||\n                  bbox.minY < preparedTile.origin.y ||\n                  bbox.maxY > preparedTile.origin.y + preparedTile.dim\n                ) {\n                  this.findInvalidatedTiles(\n                    tilesInvalidated,\n                    preparedTile.dim,\n                    bbox,\n                    key,\n                  );\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n\n    for (const key of keysAdding) {\n      this.index.pruneOrNoop(key);\n    }\n\n    if (tilesInvalidated.size > 0 && this.callback) {\n      this.callback(tilesInvalidated);\n    }\n    return performance.now() - start;\n  }\n\n  private findInvalidatedTiles(\n    tilesInvalidated: Set<string>,\n    dim: number,\n    bbox: Bbox,\n    key: string,\n  ) {\n    const touched = covering(this.z, dim, bbox);\n    for (const s of touched) {\n      if (s.key !== key && this.index.hasPrefix(s.key)) {\n        tilesInvalidated.add(s.display);\n      }\n    }\n  }\n\n  public add(preparedTilemap: Map<string, PreparedTile[]>): number {\n    let allAdded = true;\n    for (const [k, preparedTiles] of preparedTilemap) {\n      for (const preparedTile of preparedTiles) {\n        if (!this.index.has(`${toIndex(preparedTile.dataTile)}:${k}`))\n          allAdded = false;\n      }\n    }\n\n    if (allAdded) {\n      return 0;\n    }\n    const timing = this.layout(preparedTilemap);\n    return timing;\n  }\n}\n\nexport class Labelers {\n  labelers: Map<number, Labeler>;\n  scratch: CanvasRenderingContext2D;\n  labelRules: LabelRule[];\n  maxLabeledTiles: number;\n  callback: TileInvalidationCallback;\n\n  constructor(\n    scratch: CanvasRenderingContext2D,\n    labelRules: LabelRule[],\n    maxLabeledTiles: number,\n    callback: TileInvalidationCallback,\n  ) {\n    this.labelers = new Map<number, Labeler>();\n    this.scratch = scratch;\n    this.labelRules = labelRules;\n    this.maxLabeledTiles = maxLabeledTiles;\n    this.callback = callback;\n  }\n\n  public add(z: number, preparedTilemap: Map<string, PreparedTile[]>): number {\n    let labeler = this.labelers.get(z);\n    if (labeler) {\n      return labeler.add(preparedTilemap);\n    }\n    labeler = new Labeler(\n      z,\n      this.scratch,\n      this.labelRules,\n      this.maxLabeledTiles,\n      this.callback,\n    );\n    this.labelers.set(z, labeler);\n    return labeler.add(preparedTilemap);\n  }\n\n  public getIndex(z: number) {\n    const labeler = this.labelers.get(z);\n    if (labeler) return labeler.index; // TODO cleanup\n  }\n}\n","import Point from \"@mapbox/point-geometry\";\nimport { Index } from \"./labeler\";\nimport { PaintSymbolizer } from \"./symbolizer\";\nimport { Bbox, Feature } from \"./tilecache\";\nimport { PreparedTile, transformGeom } from \"./view\";\n\nexport type Filter = (zoom: number, feature: Feature) => boolean;\n\nexport interface PaintRule {\n  id?: string;\n  minzoom?: number;\n  maxzoom?: number;\n  dataSource?: string;\n  dataLayer: string;\n  symbolizer: PaintSymbolizer;\n  filter?: Filter;\n}\n\nexport function paint(\n  ctx: CanvasRenderingContext2D,\n  z: number,\n  preparedTilemap: Map<string, PreparedTile[]>,\n  labelData: Index | null,\n  rules: PaintRule[],\n  bbox: Bbox,\n  origin: Point,\n  clip: boolean,\n  debug?: string,\n) {\n  const start = performance.now();\n  ctx.save();\n  ctx.miterLimit = 2;\n\n  for (const rule of rules) {\n    if (rule.minzoom && z < rule.minzoom) continue;\n    if (rule.maxzoom && z > rule.maxzoom) continue;\n    const preparedTiles = preparedTilemap.get(rule.dataSource || \"\");\n    if (!preparedTiles) continue;\n    for (const preparedTile of preparedTiles) {\n      const layer = preparedTile.data.get(rule.dataLayer);\n      if (layer === undefined) continue;\n      if (rule.symbolizer.before) rule.symbolizer.before(ctx, preparedTile.z);\n\n      const po = preparedTile.origin;\n      const dim = preparedTile.dim;\n      const ps = preparedTile.scale;\n      ctx.save();\n\n      // apply clipping to the tile\n      // find the smallest of all the origins\n      if (clip) {\n        ctx.beginPath();\n        const minX = Math.max(po.x - origin.x, bbox.minX - origin.x); // - 0.5;\n        const minY = Math.max(po.y - origin.y, bbox.minY - origin.y); // - 0.5;\n        const maxX = Math.min(po.x - origin.x + dim, bbox.maxX - origin.x); // + 0.5;\n        const maxY = Math.min(po.y - origin.y + dim, bbox.maxY - origin.y); // + 0.5;\n        ctx.rect(minX, minY, maxX - minX, maxY - minY);\n        ctx.clip();\n      }\n\n      ctx.translate(po.x - origin.x, po.y - origin.y);\n\n      // TODO fix seams in static mode\n      // if (clip) {\n      //     // small fudge factor in static mode to fix seams\n      //     ctx.translate(dim / 2, dim / 2);\n      //     ctx.scale(1 + 1 / dim, 1 + 1 / dim);\n      //     ctx.translate(-dim / 2, -dim / 2);\n      // }\n\n      for (const feature of layer) {\n        let geom = feature.geom;\n        const fbox = feature.bbox;\n        if (\n          fbox.maxX * ps + po.x < bbox.minX ||\n          fbox.minX * ps + po.x > bbox.maxX ||\n          fbox.minY * ps + po.y > bbox.maxY ||\n          fbox.maxY * ps + po.y < bbox.minY\n        ) {\n          continue;\n        }\n        if (rule.filter && !rule.filter(preparedTile.z, feature)) continue;\n        if (ps !== 1) {\n          geom = transformGeom(geom, ps, new Point(0, 0));\n        }\n        rule.symbolizer.draw(ctx, geom, preparedTile.z, feature);\n      }\n      ctx.restore();\n    }\n  }\n\n  if (clip) {\n    ctx.beginPath();\n    ctx.rect(\n      bbox.minX - origin.x,\n      bbox.minY - origin.y,\n      bbox.maxX - bbox.minX,\n      bbox.maxY - bbox.minY,\n    );\n    ctx.clip();\n  }\n\n  if (labelData) {\n    const matches = labelData.searchBbox(bbox, Infinity);\n    for (const label of matches) {\n      ctx.save();\n      ctx.translate(label.anchor.x - origin.x, label.anchor.y - origin.y);\n      label.draw(ctx);\n      ctx.restore();\n      if (debug) {\n        ctx.lineWidth = 0.5;\n        ctx.strokeStyle = debug;\n        ctx.fillStyle = debug;\n        ctx.globalAlpha = 1;\n        ctx.fillRect(\n          label.anchor.x - origin.x - 2,\n          label.anchor.y - origin.y - 2,\n          4,\n          4,\n        );\n        for (const bbox of label.bboxes) {\n          ctx.strokeRect(\n            bbox.minX - origin.x,\n            bbox.minY - origin.y,\n            bbox.maxX - bbox.minX,\n            bbox.maxY - bbox.minY,\n          );\n        }\n      }\n    }\n  }\n  ctx.restore();\n  return performance.now() - start;\n}\n","import Point from \"@mapbox/point-geometry\";\n\nimport { PMTiles } from \"pmtiles\";\nimport { labelRules, paintRules } from \"../default_style/style\";\nimport { themes } from \"../default_style/themes\";\nimport { LabelRule, Labeler } from \"../labeler\";\nimport { PaintRule, paint } from \"../painter\";\nimport { PreparedTile, SourceOptions, View, sourcesToViews } from \"../view\";\n\nconst R = 6378137;\nconst MAX_LATITUDE = 85.0511287798;\nconst MAXCOORD = R * Math.PI;\n\nconst project = (latlng: Point): Point => {\n  const d = Math.PI / 180;\n  const constrainedLat = Math.max(\n    Math.min(MAX_LATITUDE, latlng.y),\n    -MAX_LATITUDE,\n  );\n  const sin = Math.sin(constrainedLat * d);\n  return new Point(R * latlng.x * d, (R * Math.log((1 + sin) / (1 - sin))) / 2);\n};\n\nconst unproject = (point: Point) => {\n  const d = 180 / Math.PI;\n  return {\n    lat: (2 * Math.atan(Math.exp(point.y / R)) - Math.PI / 2) * d,\n    lng: (point.x * d) / R,\n  };\n};\n\nconst instancedProject = (origin: Point, displayZoom: number) => {\n  return (latlng: Point) => {\n    const projected = project(latlng);\n    const normalized = new Point(\n      (projected.x + MAXCOORD) / (MAXCOORD * 2),\n      1 - (projected.y + MAXCOORD) / (MAXCOORD * 2),\n    );\n    return normalized.mult(2 ** displayZoom * 256).sub(origin);\n  };\n};\n\nconst instancedUnproject = (origin: Point, displayZoom: number) => {\n  return (point: Point) => {\n    const normalized = new Point(point.x, point.y)\n      .add(origin)\n      .div(2 ** displayZoom * 256);\n    const projected = new Point(\n      normalized.x * (MAXCOORD * 2) - MAXCOORD,\n      (1 - normalized.y) * (MAXCOORD * 2) - MAXCOORD,\n    );\n    return unproject(projected);\n  };\n};\n\nexport const getZoom = (degreesLng: number, cssPixels: number): number => {\n  const d = cssPixels * (360 / degreesLng);\n  return Math.log2(d / 256);\n};\n\ninterface StaticOptions {\n  debug?: string;\n  lang?: string;\n  maxDataZoom?: number;\n  url?: PMTiles | string;\n  sources?: Record<string, SourceOptions>;\n  paintRules?: PaintRule[];\n  labelRules?: LabelRule[];\n  language?: string[];\n  backgroundColor?: string;\n  theme?: string;\n}\n\nexport class Static {\n  paintRules: PaintRule[];\n  labelRules: LabelRule[];\n  views: Map<string, View>;\n  debug?: string;\n  backgroundColor?: string;\n\n  constructor(options: StaticOptions) {\n    if (options.theme) {\n      const theme = themes[options.theme];\n      this.paintRules = paintRules(theme);\n      this.labelRules = labelRules(theme);\n      this.backgroundColor = theme.background;\n    } else {\n      this.paintRules = options.paintRules || [];\n      this.labelRules = options.labelRules || [];\n      this.backgroundColor = options.backgroundColor;\n    }\n\n    this.views = sourcesToViews(options);\n    this.debug = options.debug || \"\";\n  }\n\n  async drawContext(\n    ctx: CanvasRenderingContext2D,\n    width: number,\n    height: number,\n    latlng: Point,\n    displayZoom: number,\n  ) {\n    const center = project(latlng);\n    const normalizedCenter = new Point(\n      (center.x + MAXCOORD) / (MAXCOORD * 2),\n      1 - (center.y + MAXCOORD) / (MAXCOORD * 2),\n    );\n\n    // the origin of the painter call in global Z coordinates\n    const origin = normalizedCenter\n      .clone()\n      .mult(2 ** displayZoom * 256)\n      .sub(new Point(width / 2, height / 2));\n\n    // the bounds of the painter call in global Z coordinates\n    const bbox = {\n      minX: origin.x,\n      minY: origin.y,\n      maxX: origin.x + width,\n      maxY: origin.y + height,\n    };\n\n    const promises = [];\n    for (const [k, v] of this.views) {\n      const promise = v.getBbox(displayZoom, bbox);\n      promises.push({ key: k, promise: promise });\n    }\n    const tileResponses = await Promise.all(\n      promises.map((o) => {\n        return o.promise.then(\n          (v: PreparedTile[]) => {\n            return { status: \"fulfilled\", value: v, key: o.key };\n          },\n          (error: Error) => {\n            return { status: \"rejected\", value: [], reason: error, key: o.key };\n          },\n        );\n      }),\n    );\n\n    const preparedTilemap = new Map<string, PreparedTile[]>();\n    for (const tileResponse of tileResponses) {\n      if (tileResponse.status === \"fulfilled\") {\n        preparedTilemap.set(tileResponse.key, tileResponse.value);\n      }\n    }\n\n    const start = performance.now();\n    const labeler = new Labeler(\n      displayZoom,\n      ctx,\n      this.labelRules,\n      16,\n      undefined,\n    ); // because need ctx to measure\n\n    const layoutTime = labeler.add(preparedTilemap);\n\n    if (this.backgroundColor) {\n      ctx.save();\n      ctx.fillStyle = this.backgroundColor;\n      ctx.fillRect(0, 0, width, height);\n      ctx.restore();\n    }\n\n    const paintRules = this.paintRules;\n\n    const p = paint(\n      ctx,\n      displayZoom,\n      preparedTilemap,\n      labeler.index,\n      paintRules,\n      bbox,\n      origin,\n      true,\n      this.debug,\n    );\n\n    if (this.debug) {\n      ctx.save();\n      ctx.translate(-origin.x, -origin.y);\n      ctx.strokeStyle = this.debug;\n      ctx.fillStyle = this.debug;\n      ctx.font = \"12px sans-serif\";\n      let idx = 0;\n      for (const [k, v] of preparedTilemap) {\n        for (const preparedTile of v) {\n          ctx.strokeRect(\n            preparedTile.origin.x,\n            preparedTile.origin.y,\n            preparedTile.dim,\n            preparedTile.dim,\n          );\n          const dt = preparedTile.dataTile;\n          ctx.fillText(\n            `${k + (k ? \" \" : \"\") + dt.z} ${dt.x} ${dt.y}`,\n            preparedTile.origin.x + 4,\n            preparedTile.origin.y + 14 * (1 + idx),\n          );\n        }\n        idx++;\n      }\n      ctx.restore();\n    }\n\n    // TODO this API isn't so elegant\n    return {\n      elapsed: performance.now() - start,\n      project: instancedProject(origin, displayZoom),\n      unproject: instancedUnproject(origin, displayZoom),\n    };\n  }\n\n  async drawCanvas(\n    canvas: HTMLCanvasElement,\n    latlng: Point,\n    displayZoom: number,\n    options: StaticOptions = {},\n  ) {\n    const dpr = window.devicePixelRatio;\n    const width = canvas.clientWidth;\n    const height = canvas.clientHeight;\n    if (!(canvas.width === width * dpr && canvas.height === height * dpr)) {\n      canvas.width = width * dpr;\n      canvas.height = height * dpr;\n    }\n    if (options.lang) canvas.lang = options.lang;\n    const ctx = canvas.getContext(\"2d\");\n    if (!ctx) {\n      console.error(\"Failed to initialize canvas2d context.\");\n      return;\n    }\n    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);\n    return this.drawContext(ctx, width, height, latlng, displayZoom);\n  }\n\n  async drawContextBounds(\n    ctx: CanvasRenderingContext2D,\n    topLeft: Point,\n    bottomRight: Point,\n    width: number,\n    height: number,\n  ) {\n    const deltaDegrees = bottomRight.x - topLeft.x;\n    const center = new Point(\n      (topLeft.x + bottomRight.x) / 2,\n      (topLeft.y + bottomRight.y) / 2,\n    );\n    return this.drawContext(\n      ctx,\n      width,\n      height,\n      center,\n      getZoom(deltaDegrees, width),\n    );\n  }\n\n  async drawCanvasBounds(\n    canvas: HTMLCanvasElement,\n    topLeft: Point,\n    bottomRight: Point,\n    width: number,\n    options: StaticOptions = {},\n  ) {\n    const deltaDegrees = bottomRight.x - topLeft.x;\n    const center = new Point(\n      (topLeft.x + bottomRight.x) / 2,\n      (topLeft.y + bottomRight.y) / 2,\n    );\n    return this.drawCanvas(\n      canvas,\n      center,\n      getZoom(deltaDegrees, width),\n      options,\n    );\n  }\n}\n","// biome-ignore lint: leaflet 1.x\ndeclare const L: any;\n\nimport Point from \"@mapbox/point-geometry\";\n\nimport type { Coords } from \"leaflet\";\nimport { PMTiles } from \"pmtiles\";\nimport { labelRules, paintRules } from \"../default_style/style\";\nimport { themes } from \"../default_style/themes\";\nimport { LabelRule, Labelers } from \"../labeler\";\nimport { PaintRule, paint } from \"../painter\";\nimport { PreparedTile, SourceOptions, sourcesToViews } from \"../view\";\nimport { PickedFeature } from \"../tilecache\";\n\nconst timer = (duration: number) => {\n  return new Promise<void>((resolve) => {\n    setTimeout(() => {\n      resolve();\n    }, duration);\n  });\n};\n\n// replacement for Promise.allSettled (requires ES2020+)\n// this is called for every tile render,\n// so ensure font loading failure does not make map rendering fail\ntype Status = {\n  status: string;\n  value?: unknown;\n  reason: Error;\n};\n\nconst reflect = (promise: Promise<Status>) => {\n  return promise.then(\n    (v) => {\n      return { status: \"fulfilled\", value: v };\n    },\n    (error) => {\n      return { status: \"rejected\", reason: error };\n    },\n  );\n};\n\ntype DoneCallback = (error?: Error, tile?: HTMLElement) => void;\ntype KeyedHtmlCanvasElement = HTMLCanvasElement & { key: string };\n\nexport interface LeafletLayerOptions extends L.GridLayerOptions {\n  bounds?: L.LatLngBoundsExpression;\n  attribution?: string;\n  debug?: string;\n  lang?: string;\n  tileDelay?: number;\n  language?: string[];\n  noWrap?: boolean;\n  paintRules?: PaintRule[];\n  labelRules?: LabelRule[];\n  tasks?: Promise<Status>[];\n  maxDataZoom?: number;\n  url?: PMTiles | string;\n  sources?: Record<string, SourceOptions>;\n  theme?: string;\n  backgroundColor?: string;\n}\n\nconst leafletLayer = (options: LeafletLayerOptions = {}) => {\n  class LeafletLayer extends L.GridLayer {\n    public paintRules: PaintRule[];\n    public labelRules: LabelRule[];\n    public backgroundColor?: string;\n\n    constructor(options: LeafletLayerOptions = {}) {\n      if (options.noWrap && !options.bounds)\n        options.bounds = [\n          [-90, -180],\n          [90, 180],\n        ];\n      if (options.attribution == null)\n        options.attribution =\n          '<a href=\"https://protomaps.com\">Protomaps</a> © <a href=\"https://openstreetmap.org/copyright\">OpenStreetMap</a>';\n      super(options);\n\n      if (options.theme) {\n        const theme = themes[options.theme];\n        this.paintRules = paintRules(theme);\n        this.labelRules = labelRules(theme);\n        this.backgroundColor = theme.background;\n      } else {\n        this.paintRules = options.paintRules || [];\n        this.labelRules = options.labelRules || [];\n        this.backgroundColor = options.backgroundColor;\n      }\n\n      this.lastRequestedZ = undefined;\n      this.tasks = options.tasks || [];\n\n      this.views = sourcesToViews(options);\n\n      this.debug = options.debug;\n      const scratch = document.createElement(\"canvas\").getContext(\"2d\");\n      this.scratch = scratch;\n      this.onTilesInvalidated = (tiles: Set<string>) => {\n        for (const t of tiles) {\n          this.rerenderTile(t);\n        }\n      };\n      this.labelers = new Labelers(\n        this.scratch,\n        this.labelRules,\n        16,\n        this.onTilesInvalidated,\n      );\n      this.tileSize = 256 * window.devicePixelRatio;\n      this.tileDelay = options.tileDelay || 3;\n      this.lang = options.lang;\n    }\n\n    public async renderTile(\n      coords: Coords,\n      element: KeyedHtmlCanvasElement,\n      key: string,\n      done = () => {},\n    ) {\n      this.lastRequestedZ = coords.z;\n\n      const promises = [];\n      for (const [k, v] of this.views) {\n        const promise = v.getDisplayTile(coords);\n        promises.push({ key: k, promise: promise });\n      }\n      const tileResponses = await Promise.all(\n        promises.map((o) => {\n          return o.promise.then(\n            (v: PreparedTile[]) => {\n              return { status: \"fulfilled\", value: v, key: o.key };\n            },\n            (error: Error) => {\n              return { status: \"rejected\", reason: error, key: o.key };\n            },\n          );\n        }),\n      );\n\n      const preparedTilemap = new Map<string, PreparedTile[]>();\n      for (const tileResponse of tileResponses) {\n        if (tileResponse.status === \"fulfilled\") {\n          preparedTilemap.set(tileResponse.key, [tileResponse.value]);\n        } else {\n          if (tileResponse.reason.name === \"AbortError\") {\n            // do nothing\n          } else {\n            console.error(tileResponse.reason);\n          }\n        }\n      }\n\n      if (element.key !== key) return;\n      if (this.lastRequestedZ !== coords.z) return;\n\n      await Promise.all(this.tasks.map(reflect));\n\n      if (element.key !== key) return;\n      if (this.lastRequestedZ !== coords.z) return;\n\n      const layoutTime = this.labelers.add(coords.z, preparedTilemap);\n\n      if (element.key !== key) return;\n      if (this.lastRequestedZ !== coords.z) return;\n\n      const labelData = this.labelers.getIndex(coords.z);\n\n      if (!this._map) return; // the layer has been removed from the map\n\n      const center = this._map.getCenter().wrap();\n      const pixelBounds = this._getTiledPixelBounds(center);\n      const tileRange = this._pxBoundsToTileRange(pixelBounds);\n      const tileCenter = tileRange.getCenter();\n      const priority = coords.distanceTo(tileCenter) * this.tileDelay;\n\n      await timer(priority);\n\n      if (element.key !== key) return;\n      if (this.lastRequestedZ !== coords.z) return;\n\n      const buf = 16;\n      const bbox = {\n        minX: 256 * coords.x - buf,\n        minY: 256 * coords.y - buf,\n        maxX: 256 * (coords.x + 1) + buf,\n        maxY: 256 * (coords.y + 1) + buf,\n      };\n      const origin = new Point(256 * coords.x, 256 * coords.y);\n\n      element.width = this.tileSize;\n      element.height = this.tileSize;\n      const ctx = element.getContext(\"2d\");\n      if (!ctx) {\n        console.error(\"Failed to get Canvas context\");\n        return;\n      }\n      ctx.setTransform(this.tileSize / 256, 0, 0, this.tileSize / 256, 0, 0);\n      ctx.clearRect(0, 0, 256, 256);\n\n      if (this.backgroundColor) {\n        ctx.save();\n        ctx.fillStyle = this.backgroundColor;\n        ctx.fillRect(0, 0, 256, 256);\n        ctx.restore();\n      }\n\n      let paintingTime = 0;\n\n      const paintRules = this.paintRules;\n\n      paintingTime = paint(\n        ctx,\n        coords.z,\n        preparedTilemap,\n        this.xray ? null : labelData,\n        paintRules,\n        bbox,\n        origin,\n        false,\n        this.debug,\n      );\n\n      if (this.debug) {\n        ctx.save();\n        ctx.fillStyle = this.debug;\n        ctx.font = \"600 12px sans-serif\";\n        ctx.fillText(`${coords.z} ${coords.x} ${coords.y}`, 4, 14);\n\n        ctx.font = \"12px sans-serif\";\n        let ypos = 28;\n        for (const [k, v] of preparedTilemap) {\n          const dt = v[0].dataTile;\n          ctx.fillText(`${k + (k ? \" \" : \"\") + dt.z} ${dt.x} ${dt.y}`, 4, ypos);\n          ypos += 14;\n        }\n\n        ctx.font = \"600 10px sans-serif\";\n        if (paintingTime > 8) {\n          ctx.fillText(`${paintingTime.toFixed()} ms paint`, 4, ypos);\n          ypos += 14;\n        }\n\n        if (layoutTime > 8) {\n          ctx.fillText(`${layoutTime.toFixed()} ms layout`, 4, ypos);\n        }\n        ctx.strokeStyle = this.debug;\n\n        ctx.lineWidth = 0.5;\n        ctx.beginPath();\n        ctx.moveTo(0, 0);\n        ctx.lineTo(0, 256);\n        ctx.stroke();\n\n        ctx.lineWidth = 0.5;\n        ctx.beginPath();\n        ctx.moveTo(0, 0);\n        ctx.lineTo(256, 0);\n        ctx.stroke();\n\n        ctx.restore();\n      }\n      done();\n    }\n\n    public rerenderTile(key: string) {\n      for (const unwrappedK in this._tiles) {\n        const wrappedCoord = this._wrapCoords(\n          this._keyToTileCoords(unwrappedK),\n        );\n        if (key === this._tileCoordsToKey(wrappedCoord)) {\n          this.renderTile(wrappedCoord, this._tiles[unwrappedK].el, key);\n        }\n      }\n    }\n\n    // a primitive way to check the features at a certain point.\n    // it does not support hover states, cursor changes, or changing the style of the selected feature,\n    // so is only appropriate for debugging or very basic use cases.\n    // those features are outside of the scope of this library:\n    // for fully pickable, interactive features, use MapLibre GL JS instead.\n    public queryTileFeaturesDebug(\n      lng: number,\n      lat: number,\n      brushSize = 16,\n    ): Map<string, PickedFeature[]> {\n      const featuresBySourceName = new Map<string, PickedFeature[]>();\n      for (const [sourceName, view] of this.views) {\n        featuresBySourceName.set(\n          sourceName,\n          view.queryFeatures(lng, lat, this._map.getZoom(), brushSize),\n        );\n      }\n      return featuresBySourceName;\n    }\n\n    public clearLayout() {\n      this.labelers = new Labelers(\n        this.scratch,\n        this.labelRules,\n        16,\n        this.onTilesInvalidated,\n      );\n    }\n\n    public rerenderTiles() {\n      for (const unwrappedK in this._tiles) {\n        const wrappedCoord = this._wrapCoords(\n          this._keyToTileCoords(unwrappedK),\n        );\n        const key = this._tileCoordsToKey(wrappedCoord);\n        this.renderTile(wrappedCoord, this._tiles[unwrappedK].el, key);\n      }\n    }\n\n    public createTile(coords: Coords, showTile: DoneCallback) {\n      const element = L.DomUtil.create(\"canvas\", \"leaflet-tile\");\n      element.lang = this.lang;\n\n      const key = this._tileCoordsToKey(coords);\n      element.key = key;\n\n      this.renderTile(coords, element, key, () => {\n        showTile(undefined, element);\n      });\n\n      return element;\n    }\n\n    public _removeTile(key: string) {\n      const tile = this._tiles[key];\n      if (!tile) {\n        return;\n      }\n      tile.el.removed = true;\n      tile.el.key = undefined;\n      L.DomUtil.removeClass(tile.el, \"leaflet-tile-loaded\");\n      tile.el.width = tile.el.height = 0;\n      L.DomUtil.remove(tile.el);\n      delete this._tiles[key];\n      this.fire(\"tileunload\", {\n        tile: tile.el,\n        coords: this._keyToTileCoords(key),\n      });\n    }\n  }\n  return new LeafletLayer(options);\n};\n\nexport { leafletLayer };\n","\nexport default function potpack(boxes) {\n\n    // calculate total box area and maximum box width\n    let area = 0;\n    let maxWidth = 0;\n\n    for (const box of boxes) {\n        area += box.w * box.h;\n        maxWidth = Math.max(maxWidth, box.w);\n    }\n\n    // sort the boxes for insertion by height, descending\n    boxes.sort((a, b) => b.h - a.h);\n\n    // aim for a squarish resulting container,\n    // slightly adjusted for sub-100% space utilization\n    const startWidth = Math.max(Math.ceil(Math.sqrt(area / 0.95)), maxWidth);\n\n    // start with a single empty space, unbounded at the bottom\n    const spaces = [{x: 0, y: 0, w: startWidth, h: Infinity}];\n\n    let width = 0;\n    let height = 0;\n\n    for (const box of boxes) {\n        // look through spaces backwards so that we check smaller spaces first\n        for (let i = spaces.length - 1; i >= 0; i--) {\n            const space = spaces[i];\n\n            // look for empty spaces that can accommodate the current box\n            if (box.w > space.w || box.h > space.h) continue;\n\n            // found the space; add the box to its top-left corner\n            // |-------|-------|\n            // |  box  |       |\n            // |_______|       |\n            // |         space |\n            // |_______________|\n            box.x = space.x;\n            box.y = space.y;\n\n            height = Math.max(height, box.y + box.h);\n            width = Math.max(width, box.x + box.w);\n\n            if (box.w === space.w && box.h === space.h) {\n                // space matches the box exactly; remove it\n                const last = spaces.pop();\n                if (i < spaces.length) spaces[i] = last;\n\n            } else if (box.h === space.h) {\n                // space matches the box height; update it accordingly\n                // |-------|---------------|\n                // |  box  | updated space |\n                // |_______|_______________|\n                space.x += box.w;\n                space.w -= box.w;\n\n            } else if (box.w === space.w) {\n                // space matches the box width; update it accordingly\n                // |---------------|\n                // |      box      |\n                // |_______________|\n                // | updated space |\n                // |_______________|\n                space.y += box.h;\n                space.h -= box.h;\n\n            } else {\n                // otherwise the box splits the space into two spaces\n                // |-------|-----------|\n                // |  box  | new space |\n                // |_______|___________|\n                // | updated space     |\n                // |___________________|\n                spaces.push({\n                    x: space.x + box.w,\n                    y: space.y,\n                    w: space.w - box.w,\n                    h: box.h\n                });\n                space.y += box.h;\n                space.h -= box.h;\n            }\n            break;\n        }\n    }\n\n    return {\n        w: width, // container width\n        h: height, // container height\n        fill: (area / (width * height)) || 0 // space utilization\n    };\n}\n","import potpack from \"potpack\";\n\n// https://github.com/tangrams/tangram/blob/master/src/styles/text/font_manager.js\nexport const Font = (name: string, url: string, weight: string) => {\n  const ff = new FontFace(name, `url(${url})`, { weight: weight });\n  document.fonts.add(ff);\n  return ff.load();\n};\n\ninterface Sprite {\n  x: number;\n  y: number;\n  w: number;\n  h: number;\n}\n\ninterface PotPackInput {\n  x?: number;\n  y?: number;\n  w: number;\n  h: number;\n  id: string;\n  img: HTMLImageElement;\n}\n\nconst mkimg = async (src: string): Promise<HTMLImageElement> => {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.onload = () => resolve(img);\n    img.onerror = () => reject(\"Invalid SVG\");\n    img.src = src;\n  });\n};\n\nconst MISSING = `\n<svg width=\"20px\" height=\"20px\" viewBox=\"0 0 50 50\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n    <rect width=\"50\" height=\"50\" fill=\"#cccccc\"/>\n    <g transform=\"translate(5,5)\">\n        <path fill=\"none\" stroke=\"#666666\" stroke-width=\"7\" d=\"m11,12a8.5,8 0 1,1 17,0q0,4-4,6t-4.5,4.5-.4,4v.2m0,3v7\"/>\n    </g>\n</svg>\n`;\n\nexport class Sheet {\n  src: string;\n  canvas: HTMLCanvasElement;\n  mapping: Map<string, Sprite>;\n  missingBox: Sprite;\n\n  constructor(src: string) {\n    this.src = src;\n    this.canvas = document.createElement(\"canvas\");\n    this.mapping = new Map<string, Sprite>();\n    this.missingBox = { x: 0, y: 0, w: 0, h: 0 };\n  }\n\n  async load() {\n    let src = this.src;\n    const scale = window.devicePixelRatio;\n    if (src.endsWith(\".html\")) {\n      const c = await fetch(src);\n      src = await c.text();\n    }\n    const tree = new window.DOMParser().parseFromString(src, \"text/html\");\n    const icons = Array.from(tree.body.children);\n\n    const missingImg = await mkimg(\n      `data:image/svg+xml;base64,${btoa(MISSING)}`,\n    );\n\n    const boxes: PotPackInput[] = [\n      {\n        w: missingImg.width * scale,\n        h: missingImg.height * scale,\n        img: missingImg,\n        id: \"\",\n      },\n    ];\n\n    const serializer = new XMLSerializer();\n    for (const ps of icons) {\n      const svg64 = btoa(serializer.serializeToString(ps));\n      const image64 = `data:image/svg+xml;base64,${svg64}`;\n      const img = await mkimg(image64);\n      boxes.push({\n        w: img.width * scale,\n        h: img.height * scale,\n        img: img,\n        id: ps.id,\n      });\n    }\n\n    const packresult = potpack(boxes);\n    this.canvas.width = packresult.w;\n    this.canvas.height = packresult.h;\n    const ctx = this.canvas.getContext(\"2d\");\n    if (ctx) {\n      for (const box of boxes) {\n        if (box.x !== undefined && box.y !== undefined) {\n          ctx.drawImage(box.img, box.x, box.y, box.w, box.h);\n          if (box.id)\n            this.mapping.set(box.id, {\n              x: box.x,\n              y: box.y,\n              w: box.w,\n              h: box.h,\n            });\n          else this.missingBox = { x: box.x, y: box.y, w: box.w, h: box.h };\n        }\n      }\n    }\n    return this;\n  }\n\n  get(name: string): Sprite {\n    let result = this.mapping.get(name);\n    if (!result) result = this.missingBox;\n    return result;\n  }\n}\n"],"mappings":"4tBAAA,IAAAA,GAAA,GAAAC,GAAAD,GAAA,wBAAAE,GAAA,2BAAAC,EAAA,qBAAAC,GAAA,mBAAAC,GAAA,SAAAC,GAAA,aAAAC,GAAA,oBAAAC,GAAA,mBAAAC,GAAA,UAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,aAAAC,GAAA,uBAAAC,GAAA,wBAAAC,EAAA,mBAAAC,EAAA,qBAAAC,GAAA,yBAAAC,GAAA,YAAAC,GAAA,kBAAAC,GAAA,sBAAAC,EAAA,UAAAC,GAAA,qBAAAC,GAAA,WAAAC,GAAA,mBAAAC,GAAA,mBAAAC,GAAA,cAAAC,GAAA,SAAAC,GAAA,cAAAC,GAAA,QAAAC,GAAA,aAAAC,GAAA,kBAAAC,GAAA,QAAAC,EAAA,YAAAC,GAAA,UAAAC,GAAA,aAAAC,GAAA,eAAAC,GAAA,iBAAAC,GAAA,WAAAC,GAAA,UAAAC,GAAA,eAAAC,GAAA,mBAAAC,GAAA,wBAAAC,GAAA,yBAAAC,GAAA,mBAAAC,GAAA,SAAAC,GAAA,YAAAC,EAAA,kBAAAC,GAAA,SAAAC,KCWe,SAARC,EAAuBC,EAAGC,EAAG,CAChC,KAAK,EAAID,EACT,KAAK,EAAIC,CACb,CAHwBC,EAAAH,EAAA,SAKxBA,EAAM,UAAY,CAMd,OAAQ,CAAE,OAAO,IAAIA,EAAM,KAAK,EAAG,KAAK,CAAC,CAAG,EAQ5C,IAAII,EAAG,CAAE,OAAO,KAAK,MAAM,EAAE,KAAKA,CAAC,CAAG,EAQtC,IAAIA,EAAG,CAAE,OAAO,KAAK,MAAM,EAAE,KAAKA,CAAC,CAAG,EAQtC,YAAYA,EAAG,CAAE,OAAO,KAAK,MAAM,EAAE,aAAaA,CAAC,CAAG,EAQtD,WAAWA,EAAG,CAAE,OAAO,KAAK,MAAM,EAAE,YAAYA,CAAC,CAAG,EAQpD,KAAKC,EAAG,CAAE,OAAO,KAAK,MAAM,EAAE,MAAMA,CAAC,CAAG,EAQxC,IAAIA,EAAG,CAAE,OAAO,KAAK,MAAM,EAAE,KAAKA,CAAC,CAAG,EAQtC,OAAOC,EAAG,CAAE,OAAO,KAAK,MAAM,EAAE,QAAQA,CAAC,CAAG,EAS5C,aAAaA,EAAGF,EAAG,CAAE,OAAO,KAAK,MAAM,EAAE,cAAcE,EAAGF,CAAC,CAAG,EAO9D,QAAQG,EAAG,CAAE,OAAO,KAAK,MAAM,EAAE,SAASA,CAAC,CAAG,EAS9C,MAAO,CAAE,OAAO,KAAK,MAAM,EAAE,MAAM,CAAG,EAQtC,MAAO,CAAE,OAAO,KAAK,MAAM,EAAE,MAAM,CAAG,EAOtC,OAAQ,CAAE,OAAO,KAAK,MAAM,EAAE,OAAO,CAAG,EAQxC,KAAM,CACF,OAAO,KAAK,KAAK,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,CAAC,CACtD,EAQA,OAAOC,EAAO,CACV,OAAO,KAAK,IAAMA,EAAM,GACjB,KAAK,IAAMA,EAAM,CAC5B,EAOA,KAAKJ,EAAG,CACJ,OAAO,KAAK,KAAK,KAAK,QAAQA,CAAC,CAAC,CACpC,EASA,QAAQA,EAAG,CACP,IAAMK,EAAKL,EAAE,EAAI,KAAK,EAClBM,EAAKN,EAAE,EAAI,KAAK,EACpB,OAAOK,EAAKA,EAAKC,EAAKA,CAC1B,EAOA,OAAQ,CACJ,OAAO,KAAK,MAAM,KAAK,EAAG,KAAK,CAAC,CACpC,EAOA,QAAQC,EAAG,CACP,OAAO,KAAK,MAAM,KAAK,EAAIA,EAAE,EAAG,KAAK,EAAIA,EAAE,CAAC,CAChD,EAOA,UAAUA,EAAG,CACT,OAAO,KAAK,aAAaA,EAAE,EAAGA,EAAE,CAAC,CACrC,EASA,aAAaV,EAAGC,EAAG,CACf,OAAO,KAAK,MACR,KAAK,EAAIA,EAAI,KAAK,EAAID,EACtB,KAAK,EAAIA,EAAI,KAAK,EAAIC,CAAC,CAC/B,EAGA,SAASK,EAAG,CACR,IAAMN,EAAIM,EAAE,CAAC,EAAI,KAAK,EAAIA,EAAE,CAAC,EAAI,KAAK,EAClCL,EAAIK,EAAE,CAAC,EAAI,KAAK,EAAIA,EAAE,CAAC,EAAI,KAAK,EACpC,YAAK,EAAIN,EACT,KAAK,EAAIC,EACF,IACX,EAGA,KAAKE,EAAG,CACJ,YAAK,GAAKA,EAAE,EACZ,KAAK,GAAKA,EAAE,EACL,IACX,EAGA,KAAKA,EAAG,CACJ,YAAK,GAAKA,EAAE,EACZ,KAAK,GAAKA,EAAE,EACL,IACX,EAGA,MAAMC,EAAG,CACL,YAAK,GAAKA,EACV,KAAK,GAAKA,EACH,IACX,EAGA,KAAKA,EAAG,CACJ,YAAK,GAAKA,EACV,KAAK,GAAKA,EACH,IACX,EAGA,aAAaD,EAAG,CACZ,YAAK,GAAKA,EAAE,EACZ,KAAK,GAAKA,EAAE,EACL,IACX,EAGA,YAAYA,EAAG,CACX,YAAK,GAAKA,EAAE,EACZ,KAAK,GAAKA,EAAE,EACL,IACX,EAEA,OAAQ,CACJ,YAAK,KAAK,KAAK,IAAI,CAAC,EACb,IACX,EAEA,OAAQ,CACJ,IAAMF,EAAI,KAAK,EACf,YAAK,EAAI,KAAK,EACd,KAAK,EAAI,CAACA,EACH,IACX,EAGA,QAAQU,EAAO,CACX,IAAMC,EAAM,KAAK,IAAID,CAAK,EACtBE,EAAM,KAAK,IAAIF,CAAK,EACpBX,EAAIY,EAAM,KAAK,EAAIC,EAAM,KAAK,EAC9BZ,EAAIY,EAAM,KAAK,EAAID,EAAM,KAAK,EAClC,YAAK,EAAIZ,EACT,KAAK,EAAIC,EACF,IACX,EAMA,cAAcU,EAAOR,EAAG,CACpB,IAAMS,EAAM,KAAK,IAAID,CAAK,EACtBE,EAAM,KAAK,IAAIF,CAAK,EACpBX,EAAIG,EAAE,EAAIS,GAAO,KAAK,EAAIT,EAAE,GAAKU,GAAO,KAAK,EAAIV,EAAE,GACnDF,EAAIE,EAAE,EAAIU,GAAO,KAAK,EAAIV,EAAE,GAAKS,GAAO,KAAK,EAAIT,EAAE,GACvD,YAAK,EAAIH,EACT,KAAK,EAAIC,EACF,IACX,EAEA,QAAS,CACL,YAAK,EAAI,KAAK,MAAM,KAAK,CAAC,EAC1B,KAAK,EAAI,KAAK,MAAM,KAAK,CAAC,EACnB,IACX,EAEA,YAAaF,CACjB,EAaAA,EAAM,QAAU,SAAUI,EAAG,CACzB,GAAIA,aAAaJ,EACb,OAA6BI,EAEjC,GAAI,MAAM,QAAQA,CAAC,EACf,OAAO,IAAIJ,EAAM,CAACI,EAAE,CAAC,EAAG,CAACA,EAAE,CAAC,CAAC,EAEjC,GAAIA,EAAE,IAAM,QAAaA,EAAE,IAAM,OAC7B,OAAO,IAAIJ,EAAM,CAACI,EAAE,EAAG,CAACA,EAAE,CAAC,EAE/B,MAAM,IAAI,MAAM,wCAAwC,CAC5D,EC3TA,SAASW,EAAMC,EAAaC,EAAcC,EAAuB,CAC/D,OAAOC,KAAKC,IAAID,KAAKE,IAAIL,EAAKE,CAAK,EAAGD,CAAI,CAC5C,CAFSF,EAAAA,EAAAA,SCPT,IAAMO,GAAN,MAAMA,WAAmBC,KAAM,CAC7BC,YAAYC,EAAe,CACzB,MAAO,2BAA0BA,CAAM,GAAE,CAC3C,CACF,EAJ+BC,EAAAC,GAAA,cAA/B,IAAML,GAANK,GAMAC,GAAeN,GCEf,SAASO,GAAYJ,EAAiD,CACpE,GAAI,OAAOA,GAAU,SAAU,MAAM,IAAIH,GAAWG,CAAK,EACzD,GAAIA,EAAMK,KAAI,EAAGC,YAAW,IAAO,cAAe,MAAO,CAAC,EAAG,EAAG,EAAG,CAAC,EAEpE,IAAIC,EAAkBP,EAAMK,KAAI,EAChCE,EAAkBC,GAAgBC,KAAKT,CAAK,EAAIU,GAAUV,CAAK,EAAIA,EAEnE,IAAMW,EAAkBC,GAAgBC,KAAKN,CAAe,EAC5D,GAAII,EAAiB,CACnB,IAAMG,EAAMC,MAAMC,KAAKL,CAAe,EAAEM,MAAM,CAAC,EAC/C,MAAO,CACL,GAAGH,EAAIG,MAAM,EAAG,CAAC,EAAEC,IAAKC,GAAMC,SAASC,GAAEF,EAAG,CAAC,EAAG,EAAE,CAAC,EACnDC,SAASC,GAAEP,EAAI,CAAC,GAAK,IAAK,CAAC,EAAG,EAAE,EAAI,GAAG,CAE3C,CAEA,IAAMQ,EAAWC,GAASV,KAAKN,CAAe,EAC9C,GAAIe,EAAU,CACZ,IAAMR,EAAMC,MAAMC,KAAKM,CAAQ,EAAEL,MAAM,CAAC,EACxC,MAAO,CACL,GAAGH,EAAIG,MAAM,EAAG,CAAC,EAAEC,IAAKC,GAAMC,SAASD,EAAG,EAAE,CAAC,EAC7CC,SAASN,EAAI,CAAC,GAAK,KAAM,EAAE,EAAI,GAAG,CAEtC,CAEA,IAAMU,EAAYC,GAAUZ,KAAKN,CAAe,EAChD,GAAIiB,EAAW,CACb,IAAMV,EAAMC,MAAMC,KAAKQ,CAAS,EAAEP,MAAM,CAAC,EACzC,MAAO,CACL,GAAGH,EAAIG,MAAM,EAAG,CAAC,EAAEC,IAAKC,GAAMC,SAASD,EAAG,EAAE,CAAC,EAC7CO,WAAWZ,EAAI,CAAC,GAAK,GAAG,CAAC,CAE7B,CAEA,IAAMa,EAAYC,GAAUf,KAAKN,CAAe,EAChD,GAAIoB,EAAW,CACb,GAAM,CAACE,EAAGC,EAAGC,EAAGC,CAAC,EAAIjB,MAAMC,KAAKW,CAAS,EAAEV,MAAM,CAAC,EAAEC,IAAIQ,UAAU,EAClE,GAAIpC,EAAM,EAAG,IAAKwC,CAAC,IAAMA,EAAG,MAAM,IAAIjC,GAAWG,CAAK,EACtD,GAAIV,EAAM,EAAG,IAAKyC,CAAC,IAAMA,EAAG,MAAM,IAAIlC,GAAWG,CAAK,EACtD,MAAO,CAAC,GAAGiC,GAASJ,EAAGC,EAAGC,CAAC,EAAGG,OAAOC,MAAMH,CAAC,EAAI,EAAIA,CAAC,CAMvD,CAEA,MAAM,IAAInC,GAAWG,CAAK,CAC5B,CAhDSI,EAAAA,GAAAA,eAkDT,SAASgC,GAAKC,EAAa,CACzB,IAAID,EAAO,KACPE,EAAID,EAAIE,OAEZ,KAAOD,GACLF,EAAQA,EAAO,GAAMC,EAAIG,WAAW,EAAEF,CAAC,EAMzC,OAAQF,IAAS,GAAK,IACxB,CAZSA,EAAAA,GAAAA,QAcT,IAAMK,GAActB,EAAAA,GAAcC,SAASD,EAAEuB,QAAQ,KAAM,EAAE,EAAG,EAAE,EAA9CvB,cAEdwB,GACJ,szCACGC,MAAM,GAAG,EACTC,OAAO,CAACC,EAAKC,IAAS,CACrB,IAAMC,EAAMP,GAAWM,EAAKE,UAAU,EAAG,CAAC,CAAC,EACrCC,EAAMT,GAAWM,EAAKE,UAAU,CAAC,CAAC,EAAEE,SAAS,EAAE,EAIjDC,EAAS,GACb,QAASd,EAAI,EAAGA,EAAI,EAAIY,EAAIX,OAAQD,IAClCc,GAAU,IAGZN,OAAAA,EAAIE,CAAG,EAAK,GAAEI,CAAO,GAAEF,CAAI,GACpBJ,CACT,EAAG,CAAA,CAA+B,EAKtC,SAASpC,GAAUV,EAAuB,CACxC,IAAMqD,EAAsBrD,EAAMM,YAAW,EAAGD,KAAI,EAC9CiD,EAASX,GAAmBP,GAAKiB,CAAmB,CAAC,EAC3D,GAAI,CAACC,EAAQ,MAAM,IAAIzD,GAAWG,CAAK,EACvC,MAAQ,IAAGsD,CAAO,EACpB,CALS5C,EAAAA,GAAAA,aAOT,IAAMW,GAAIA,EAAAA,CAACgB,EAAakB,IACtBxC,MAAMC,KAAKD,MAAMwC,CAAM,CAAC,EACrBrC,IAAI,IAAMmB,CAAG,EACbmB,KAAK,EAAE,EAHFnC,KAKJT,GAAkB,IAAI6C,OAAQ,KAAIpC,GAAE,aAAc,CAAC,CAAE,eAAe,GAAG,EACvEE,GAAW,IAAIkC,OAAQ,KAAIpC,GAAE,gBAAiB,CAAC,CAAE,kBAAkB,GAAG,EACtEI,GAAY,IAAIgC,OACnB,0BAAyBpC,GACxB,kBACA,CACF,CAAE,8BACF,GACF,EACMO,GACJ,iFACIpB,GAAkB,YAElBkD,GAAc1D,EAAAA,GACXN,KAAKiE,MAAM3D,EAAQ,GAAG,EADXA,cAIdiC,GAAWA,EAAAA,CACf2B,EACAC,EACAC,IAC6B,CAC7B,IAAI/B,EAAI+B,EAAY,IACpB,GAAID,IAAe,EAEjB,MAAO,CAAC9B,EAAGA,EAAGA,CAAC,EAAEb,IAAIwC,EAAU,EAIjC,IAAMK,GAAcH,EAAM,IAAO,KAAO,IAAO,GACzCI,GAAU,EAAItE,KAAKuE,IAAI,EAAIlC,EAAI,CAAC,IAAM8B,EAAa,KACnDK,EAAkBF,GAAU,EAAItE,KAAKuE,IAAKF,EAAW,EAAK,CAAC,GAE7DI,EAAM,EACNC,EAAQ,EACRC,EAAO,EAEPN,GAAY,GAAKA,EAAW,GAC9BI,EAAMH,EACNI,EAAQF,GACCH,GAAY,GAAKA,EAAW,GACrCI,EAAMD,EACNE,EAAQJ,GACCD,GAAY,GAAKA,EAAW,GACrCK,EAAQJ,EACRK,EAAOH,GACEH,GAAY,GAAKA,EAAW,GACrCK,EAAQF,EACRG,EAAOL,GACED,GAAY,GAAKA,EAAW,GACrCI,EAAMD,EACNG,EAAOL,GACED,GAAY,GAAKA,EAAW,IACrCI,EAAMH,EACNK,EAAOH,GAGT,IAAMI,EAAwBvC,EAAIiC,EAAS,EACrCO,EAAWJ,EAAMG,EACjBE,EAAaJ,EAAQE,EACrBG,EAAYJ,EAAOC,EAEzB,MAAO,CAACC,EAAUC,EAAYC,CAAS,EAAEvD,IAAIwC,EAAU,CAKzD,EAlDiBzB,YQlHjB,SAASyC,GAAKC,EAAaC,EAAeC,EAAcC,EAAuB,CAC7E,MAAQ,QAAOC,EAAM,EAAG,IAAKJ,CAAG,EAAEK,QAAO,CAAG,KAAID,EAC9C,EACA,IACAH,CACF,EAAEI,QAAO,CAAG,KAAID,EAAM,EAAG,IAAKF,CAAI,EAAEG,QAAO,CAAG,KAAIC,WAChDF,EAAM,EAAG,EAAGD,CAAK,EAAEE,QAAQ,CAAC,CAC9B,CAAE,GACJ,CARSN,EAAAA,GAAAA,QCJT,SAASQ,GAAIC,EAAgBC,EAAgBC,EAAwB,CACnE,IAAMC,EAAYA,EAAAA,CAACC,EAAWC,IAE5BA,IAAU,EAAID,EAAIA,EAAI,IAFND,aAIZ,CAACG,EAAIC,EAAIC,EAAIC,CAAE,EAAIC,GAAYV,CAAM,EAAEW,IAAIR,CAAS,EACpD,CAACS,EAAIC,EAAIC,EAAIC,CAAE,EAAIL,GAAYT,CAAM,EAAEU,IAAIR,CAAS,EAIpDa,EAAaD,EAAKN,EAClBQ,EAAmBf,EAAS,EAAI,EAKhCgB,IAHJD,EAAmBD,IAAe,GAC9BC,EACAA,EAAmBD,GAAc,EAAIC,EAAmBD,IAC5B,GAAK,EACjCG,EAAU,EAAID,EAEdE,GAAKd,EAAKa,EAAUP,EAAKM,GAAW,IACpCG,GAAKd,EAAKY,EAAUN,EAAKK,GAAW,IACpCI,GAAKd,EAAKW,EAAUL,EAAKI,GAAW,IACpCK,EAAIR,EAAKb,EAASO,GAAM,EAAIP,GAElC,OAAOX,GAAK6B,EAAGC,EAAGC,EAAGC,CAAC,CACxB,CAzBSxB,EAAAA,GAAAA,OYFF,IAAMyB,GAAN,MAAMA,EAAsC,CAIjD,YAAYC,EAA8BC,EAAiB,CACzD,KAAK,IAAMD,GAAA,KAAAA,EAAKC,EAChB,KAAK,WAAa,OAAO,KAAK,KAAQ,YAAc,KAAK,IAAI,SAAW,CAC1E,CAEO,IAAIC,EAAWC,EAAgB,CACpC,OAAI,OAAO,KAAK,KAAQ,WACf,KAAK,IAAID,EAAGC,CAAC,EAEf,KAAK,GACd,CACF,EAfmDC,EAAAL,GAAA,cAA5C,IAAMM,EAANN,GAiBMO,GAAN,MAAMA,EAAW,CAItB,YAAYN,EAAmCC,EAAe,EAAG,CAC/D,KAAK,MAAQD,GAAA,KAAAA,EAAKC,EAClB,KAAK,WACH,OAAO,KAAK,OAAU,YAAc,KAAK,MAAM,SAAW,CAC9D,CAEO,IAAIC,EAAWC,EAAqB,CACzC,OAAI,OAAO,KAAK,OAAU,WACjB,KAAK,MAAMD,EAAGC,CAAC,EAEjB,KAAK,KACd,CACF,EAhBwBC,EAAAE,GAAA,cAAjB,IAAMC,EAAND,GAuBME,GAAN,MAAMA,EAAS,CAIpB,YAAYC,EAA2B,CAhDzC,IAAAC,EAiDI,KAAK,YAAaA,EAAAD,GAAA,YAAAA,EAAS,aAAT,KAAAC,EAAuB,CAAC,MAAM,EAChD,KAAK,cAAgBD,GAAA,YAAAA,EAAS,aAChC,CAEO,IAAIP,EAAWC,EAAgC,CACpD,IAAIQ,EAEAC,EACA,OAAO,KAAK,YAAe,WAC7BA,EAAa,KAAK,WAAWV,EAAGC,CAAC,EAEjCS,EAAa,KAAK,WAEpB,QAAWC,KAAYD,EACrB,GACE,OAAO,UAAU,eAAe,KAAKT,EAAE,MAAOU,CAAQ,GACtD,OAAOV,EAAE,MAAMU,CAAQ,GAAM,SAC7B,CACAF,EAASR,EAAE,MAAMU,CAAQ,EACzB,KACF,CAEF,IAAIC,EACJ,OAAI,OAAO,KAAK,eAAkB,WAChCA,EAAY,KAAK,cAAcZ,EAAGC,CAAC,EAEnCW,EAAY,KAAK,cAEfH,GAAUG,IAAc,YAAaH,EAASA,EAAO,YAAY,EAC5DA,GAAUG,IAAc,YAAaH,EAASA,EAAO,YAAY,EACjEA,GAAUG,IAAc,eAK/BH,EAJmBA,EAAO,YAAY,EAAE,MAAM,GAAG,EACpB,IAAKI,GACzBA,EAAK,CAAC,EAAE,YAAY,EAAIA,EAAK,MAAM,CAAC,CAC5C,EACkB,KAAK,GAAG,GAEtBJ,CACT,CACF,EA5CsBP,EAAAI,GAAA,YAAf,IAAMQ,GAANR,GAsDMS,GAAN,MAAMA,EAAS,CAOpB,YAAYR,EAA2B,CAzGzC,IAAAC,EAAAQ,EA0GQT,GAAA,MAAAA,EAAS,KACX,KAAK,KAAOA,EAAQ,MAEpB,KAAK,QAASC,EAAAD,GAAA,YAAAA,EAAS,aAAT,KAAAC,EAAuB,aACrC,KAAK,MAAOQ,EAAAT,GAAA,YAAAA,EAAS,WAAT,KAAAS,EAAqB,GACjC,KAAK,OAAST,GAAA,YAAAA,EAAS,WACvB,KAAK,MAAQA,GAAA,YAAAA,EAAS,UAE1B,CAEO,IAAIP,EAAWC,EAAa,CACjC,GAAI,KAAK,KACP,OAAI,OAAO,KAAK,MAAS,WAChB,KAAK,KAAKD,EAAGC,CAAC,EAEhB,KAAK,KAEd,IAAIgB,EAAQ,GACR,KAAK,QACH,OAAO,KAAK,OAAU,WACxBA,EAAQ,GAAG,KAAK,MAAMjB,EAAGC,CAAC,CAAC,IAE3BgB,EAAQ,GAAG,KAAK,KAAK,KAIzB,IAAIC,EAAS,GACT,KAAK,SACH,OAAO,KAAK,QAAW,WACzBA,EAAS,GAAG,KAAK,OAAOlB,EAAGC,CAAC,CAAC,IAE7BiB,EAAS,GAAG,KAAK,MAAM,KAI3B,IAAIC,EACA,OAAO,KAAK,MAAS,WACvBA,EAAO,KAAK,KAAKnB,EAAGC,CAAC,EAErBkB,EAAO,KAAK,KAGd,IAAIC,EACJ,OAAI,OAAO,KAAK,QAAW,WACzBA,EAAS,KAAK,OAAOpB,EAAGC,CAAC,EAEzBmB,EAAS,KAAK,OAGT,GAAGH,CAAK,GAAGC,CAAM,GAAGC,CAAI,MAAMC,CAAM,EAC7C,CACF,EA3DsBlB,EAAAa,GAAA,YAAf,IAAMM,GAANN,GA6DMO,GAAN,MAAMA,EAAsB,CAIjC,YAAYxB,EAAoBC,EAAoB,CAAC,EAAG,CACtD,KAAK,MAAQD,GAAA,KAAAA,EAAKC,EAClB,KAAK,WACH,OAAO,KAAK,OAAU,YAAc,KAAK,MAAM,SAAW,CAC9D,CAEO,IAAIC,EAAWC,EAAkB,CACtC,OAAI,OAAO,KAAK,OAAU,WACjB,KAAK,MAAMD,EAAGC,CAAC,EAEjB,KAAK,KACd,CACF,EAhBmCC,EAAAoB,GAAA,aAA5B,IAAMC,GAAND,GCpJP,IAAME,GAAYC,EAAA,CAChBC,EACAC,EACAC,IACuB,CACvB,IAAMC,EAAS,CAAC,EACZC,EACAC,EACAC,EACAC,EAAI,EACJC,EAAI,EACJC,EAAI,EACJC,EAAQ,EACRC,EAAQ,EACRC,EAAM,EACNC,EAAM,EACNC,EAAM,EACNC,EAAM,EACNC,EAAK,EACLC,EAAS,EACTC,EAAS,EAEb,GAAIlB,EAAI,OAAS,EAAG,MAAO,CAAC,EAC5B,GAAIA,EAAI,SAAW,EACjB,OAAAS,EAAI,KAAK,KAAMU,EAAAnB,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EAAM,GAAKmB,EAAAnB,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EAAM,EAAC,EAE9D,CACL,CACE,OAAQS,EACR,WAAY,EACZ,cAAe,EACf,SAAU,EACV,YAAaA,CACf,CACF,EAIF,IADAC,EAAQ,KAAK,KAAMS,EAAAnB,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EAAM,GAAKmB,EAAAnB,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EAAM,EAAC,EACpEO,EAAI,EAAGC,EAAIR,EAAI,OAAS,EAAGO,EAAIC,EAAGD,IACrCH,EAAIJ,EAAIO,EAAI,CAAC,EACbF,EAAIL,EAAIO,CAAC,EACTD,EAAIN,EAAIO,EAAI,CAAC,EACbK,EAAMP,EAAE,EAAID,EAAE,EACdS,EAAMR,EAAE,EAAID,EAAE,EACdU,EAAMR,EAAE,EAAID,EAAE,EACdU,EAAMT,EAAE,EAAID,EAAE,EACdM,EAAQ,KAAK,KAAKG,EAAMA,EAAMC,EAAMA,CAAG,EACvCN,GAAKC,EAELM,EAAK,KAAK,MAAMJ,EAAME,EAAMD,EAAME,IAAQL,EAAQC,EAAM,GACpDK,EAAKf,GAAiBQ,EAAIS,EAAShB,KACrCC,EAAO,KAAK,CACV,OAAQM,EAAIS,EACZ,cAAeA,EACf,WAAYD,EACZ,SAAUV,EAAI,EACd,YAAaE,CACf,CAAC,EACDQ,EAASV,EACTW,EAAST,GAEXC,EAAQC,EAGV,OAAIJ,EAAIU,EAAS,GACfd,EAAO,KAAK,CACV,OAAQM,EAAIS,EAASP,EACrB,WAAYM,EACZ,cAAeC,EACf,SAAUX,EAAI,EACd,YAAaE,EAAIE,CACnB,CAAC,EAEIR,CACT,EA1EkB,aAiFX,SAASiB,GACdC,EACAC,EACAC,EACAC,EACkB,CAClB,IAAMC,EAAa,CAAC,EAEpB,QAAWC,KAAML,EAAK,CACpB,IAAMM,EAAW7B,GAAU4B,EAAI,KAAK,GAAK,GAAIJ,CAAO,EACpD,QAAWM,KAAWD,EACpB,GAAIC,EAAQ,QAAUN,EAAUE,EAAU,CACxC,IAAMK,EAAQ,IAAIC,EAChBJ,EAAGE,EAAQ,UAAU,EAAE,EACvBF,EAAGE,EAAQ,UAAU,EAAE,CACzB,EACMG,EAAML,EAAGE,EAAQ,SAAW,CAAC,EAC7BI,EAAa,IAAIF,GACpBC,EAAI,EAAIF,EAAM,GAAKD,EAAQ,QAC3BG,EAAI,EAAIF,EAAM,GAAKD,EAAQ,MAC9B,EAIA,QACMrB,EAAIiB,EACRjB,EAAIqB,EAAQ,OAASN,EACrBf,GAAKgB,EAELE,EAAW,KAAK,CACd,MAAOI,EAAM,IAAIG,EAAW,KAAKzB,CAAC,CAAC,EACnC,IAAKsB,EAAM,IAAIG,EAAW,KAAKzB,EAAIe,CAAO,CAAC,CAC7C,CAAC,CAEL,CAEJ,CAEA,OAAOG,CACT,CAvCgB1B,EAAAqB,GAAA,eAyCT,SAASa,GAAU7B,EAAUC,EAAU6B,EAAgBC,EAAiB,CAE7E,IAAMC,EAAK/B,EAAE,EAAID,EAAE,EACbiC,EAAKhC,EAAE,EAAID,EAAE,EACbkC,EAAO,KAAK,KAAMnB,EAAAd,EAAE,EAAID,EAAE,EAAM,GAAKe,EAAAd,EAAE,EAAID,EAAE,EAAM,EAAC,EAEpDmC,EAAS,CAAC,EAGhB,QAAShC,EAAI,EAAGA,EAAI2B,EAASC,EAAS5B,GAAK,EAAI4B,EAAS,CACtD,IAAMK,EAAUjC,EAAI,EAAK+B,EACzBC,EAAO,KAAK,CAAE,EAAGnC,EAAE,EAAIoC,EAASJ,EAAI,EAAGhC,EAAE,EAAIoC,EAASH,CAAG,CAAC,CAC5D,CACA,OAAOE,CACT,CAdgBxC,EAAAkC,GAAA,aCpIT,SAASQ,GAAUC,EAAaC,EAA4B,CACjE,GAAID,EAAI,QAAUC,EAAU,MAAO,CAACD,CAAG,EACvC,IAAME,EAAWD,EAAW,EACtBE,EAAcH,EAAI,YAAY,IAAKE,CAAQ,EAC3CE,EAAaJ,EAAI,QAAQ,IAAKE,CAAQ,EAC5C,GAAIC,IAAgB,IAAMC,IAAe,GACvC,MAAO,CAACJ,CAAG,EAEb,IAAIK,EACAC,EACJ,OACEF,IAAe,IACdD,GAAe,GAAKD,EAAWC,EAAcC,EAAaF,GAE3DG,EAAQL,EAAI,UAAU,EAAGG,CAAW,EACpCG,EAAQN,EAAI,UAAUG,EAAc,EAAGH,EAAI,MAAM,IAEjDK,EAAQL,EAAI,UAAU,EAAGI,CAAU,EACnCE,EAAQN,EAAI,UAAUI,EAAa,EAAGJ,EAAI,MAAM,GAE3C,CAACK,EAAO,GAAGN,GAAUO,EAAOL,CAAQ,CAAC,CAC9C,CArBgBM,EAAAR,GAAA,aAuBhB,IAAMS,GACJ,kLACIC,GAAU,IAAI,OAAO,KAAKD,EAAS,KAAK,ECpBvC,IAAME,GAAN,MAAMA,EAAkB,CAQ3B,YAAYC,EAAKC,EAAKC,EAAQC,EAAMC,EAAQ,CAIxC,KAAK,WAAa,CAAC,EAEnB,KAAK,OAASF,EAEd,KAAK,KAAO,EAGZ,KAAK,GAAK,OAEV,KAAK,KAAOF,EACZ,KAAK,UAAY,GACjB,KAAK,MAAQG,EACb,KAAK,QAAUC,EAEfJ,EAAI,WAAWK,GAAa,KAAMJ,CAAG,CACzC,CAEA,cAAe,CACX,IAAMD,EAAM,KAAK,KACjBA,EAAI,IAAM,KAAK,UAEf,IAAMC,EAAMD,EAAI,WAAW,EAAIA,EAAI,IAG7BM,EAAQ,CAAC,EAGXC,EAEAC,EAAM,EACNC,EAAS,EACTC,EAAI,EACJC,EAAI,EAER,KAAOX,EAAI,IAAMC,GAAK,CAClB,GAAIQ,GAAU,EAAG,CACb,IAAMG,EAASZ,EAAI,WAAW,EAC9BQ,EAAMI,EAAS,EACfH,EAASG,GAAU,CACvB,CAIA,GAFAH,IAEID,IAAQ,GAAKA,IAAQ,EACrBE,GAAKV,EAAI,YAAY,EACrBW,GAAKX,EAAI,YAAY,EAEjBQ,IAAQ,IACJD,GAAMD,EAAM,KAAKC,CAAI,EACzBA,EAAO,CAAC,GAGRA,GAAMA,EAAK,KAAK,IAAIM,EAAMH,EAAGC,CAAC,CAAC,UAE5BH,IAAQ,EAGXD,GACAA,EAAK,KAAKA,EAAK,CAAC,EAAE,MAAM,CAAC,MAI7B,OAAM,IAAI,MAAM,mBAAmBC,CAAG,EAAE,CAEhD,CAEA,OAAID,GAAMD,EAAM,KAAKC,CAAI,EAElBD,CACX,CAEA,MAAO,CACH,IAAMN,EAAM,KAAK,KACjBA,EAAI,IAAM,KAAK,UAEf,IAAMC,EAAMD,EAAI,WAAW,EAAIA,EAAI,IAC/BQ,EAAM,EACNC,EAAS,EACTC,EAAI,EACJC,EAAI,EACJG,EAAK,IACLC,EAAK,KACLC,EAAK,IACLC,EAAK,KAET,KAAOjB,EAAI,IAAMC,GAAK,CAClB,GAAIQ,GAAU,EAAG,CACb,IAAMG,EAASZ,EAAI,WAAW,EAC9BQ,EAAMI,EAAS,EACfH,EAASG,GAAU,CACvB,CAIA,GAFAH,IAEID,IAAQ,GAAKA,IAAQ,EACrBE,GAAKV,EAAI,YAAY,EACrBW,GAAKX,EAAI,YAAY,EACjBU,EAAII,IAAIA,EAAKJ,GACbA,EAAIK,IAAIA,EAAKL,GACbC,EAAIK,IAAIA,EAAKL,GACbA,EAAIM,IAAIA,EAAKN,WAEVH,IAAQ,EACf,MAAM,IAAI,MAAM,mBAAmBA,CAAG,EAAE,CAEhD,CAEA,MAAO,CAACM,EAAIE,EAAID,EAAIE,CAAE,CAC1B,CAQA,UAAUP,EAAGC,EAAGO,EAAG,CACf,IAAMC,EAAO,KAAK,OAAS,KAAK,IAAI,EAAGD,CAAC,EACpCE,EAAK,KAAK,OAASV,EACnBW,EAAK,KAAK,OAASV,EACnBW,EAAW,KAAK,aAAa,EAGjC,SAASC,EAAaC,EAAG,CACrB,MAAO,EACFA,EAAE,EAAIJ,GAAM,IAAMD,EAAO,IAC1B,IAAM,KAAK,GAAK,KAAK,KAAK,KAAK,KAAK,GAAKK,EAAE,EAAIH,GAAM,EAAIF,GAAQ,KAAK,EAAE,CAAC,EAAI,EACjF,CACJ,CALSM,EAAAF,EAAA,gBAQT,SAASG,EAAYnB,EAAM,CACvB,OAAOA,EAAK,IAAIgB,CAAY,CAChC,CAFSE,EAAAC,EAAA,eAKT,IAAIC,EAEJ,GAAI,KAAK,OAAS,EAAG,CACjB,IAAMC,EAAS,CAAC,EAChB,QAAWrB,KAAQe,EACfM,EAAO,KAAKrB,EAAK,CAAC,CAAC,EAEvB,IAAMsB,EAAcH,EAAYE,CAAM,EACtCD,EAAWC,EAAO,SAAW,EACzB,CAAC,KAAM,QAAS,YAAaC,EAAY,CAAC,CAAC,EAC3C,CAAC,KAAM,aAAc,YAAAA,CAAW,CAExC,SAAW,KAAK,OAAS,EAAG,CAExB,IAAMA,EAAcP,EAAS,IAAII,CAAW,EAC5CC,EAAWE,EAAY,SAAW,EAC9B,CAAC,KAAM,aAAc,YAAaA,EAAY,CAAC,CAAC,EAChD,CAAC,KAAM,kBAAmB,YAAAA,CAAW,CAE7C,SAAW,KAAK,OAAS,EAAG,CACxB,IAAMC,EAAWC,GAAcT,CAAQ,EACjCO,EAAc,CAAC,EACrB,QAAWG,KAAWF,EAClBD,EAAY,KAAKG,EAAQ,IAAIN,CAAW,CAAC,EAE7CC,EAAWE,EAAY,SAAW,EAC9B,CAAC,KAAM,UAAW,YAAaA,EAAY,CAAC,CAAC,EAC7C,CAAC,KAAM,eAAgB,YAAAA,CAAW,CAC1C,KAEI,OAAM,IAAI,MAAM,sBAAsB,EAI1C,IAAMI,EAAS,CACX,KAAM,UACN,SAAAN,EACA,WAAY,KAAK,UACrB,EAEA,OAAI,KAAK,IAAM,OACXM,EAAO,GAAK,KAAK,IAGdA,CACX,CACJ,EAlM+BR,EAAA1B,GAAA,qBAAxB,IAAMmC,GAANnC,GAqMPmC,GAAkB,MAAQ,CAAC,UAAW,QAAS,aAAc,SAAS,EAOtE,SAAS7B,GAAY8B,EAAKC,EAASpC,EAAK,CAChCmC,IAAQ,EAAGC,EAAQ,GAAKpC,EAAI,WAAW,EAClCmC,IAAQ,EAAGE,GAAQrC,EAAKoC,CAAO,EAC/BD,IAAQ,EAAGC,EAAQ,KAAqCpC,EAAI,WAAW,EACvEmC,IAAQ,IAAGC,EAAQ,UAAYpC,EAAI,IAChD,CALSyB,EAAApB,GAAA,eAWT,SAASgC,GAAQrC,EAAKoC,EAAS,CAC3B,IAAMnC,EAAMD,EAAI,WAAW,EAAIA,EAAI,IAEnC,KAAOA,EAAI,IAAMC,GAAK,CAClB,IAAMqC,EAAMF,EAAQ,MAAMpC,EAAI,WAAW,CAAC,EACtCuC,EAAQH,EAAQ,QAAQpC,EAAI,WAAW,CAAC,EAC5CoC,EAAQ,WAAWE,CAAG,EAAIC,CAC9B,CACJ,CARSd,EAAAY,GAAA,WAaF,SAASN,GAAcS,EAAO,CACjC,IAAMC,EAAMD,EAAM,OAElB,GAAIC,GAAO,EAAG,MAAO,CAACD,CAAK,EAE3B,IAAMV,EAAW,CAAC,EACdE,EAASU,EAEb,QAASC,EAAI,EAAGA,EAAIF,EAAKE,IAAK,CAC1B,IAAMC,EAAOC,GAAWL,EAAMG,CAAC,CAAC,EAC5BC,IAAS,IAETF,IAAQ,SAAWA,EAAME,EAAO,GAEhCF,IAAQE,EAAO,GACXZ,GAASF,EAAS,KAAKE,CAAO,EAClCA,EAAU,CAACQ,EAAMG,CAAC,CAAC,GAEZX,GACPA,EAAQ,KAAKQ,EAAMG,CAAC,CAAC,EAE7B,CACA,OAAIX,GAASF,EAAS,KAAKE,CAAO,EAE3BF,CACX,CAzBgBL,EAAAM,GAAA,iBA4BhB,SAASc,GAAWC,EAAM,CACtB,IAAIC,EAAM,EACV,QAASJ,EAAI,EAAGF,EAAMK,EAAK,OAAQE,EAAIP,EAAM,EAAGQ,EAAIC,EAAIP,EAAIF,EAAKO,EAAIL,IACjEM,EAAKH,EAAKH,CAAC,EACXO,EAAKJ,EAAKE,CAAC,EACXD,IAAQG,EAAG,EAAID,EAAG,IAAMA,EAAG,EAAIC,EAAG,GAEtC,OAAOH,CACX,CARStB,EAAAoB,GAAA,cAUF,IAAMM,GAAN,MAAMA,EAAgB,CAKzB,YAAYnD,EAAKC,EAAK,CAElB,KAAK,QAAU,EACf,KAAK,KAAO,GACZ,KAAK,OAAS,KACd,KAAK,OAAS,EAGd,KAAK,KAAOD,EAGZ,KAAK,MAAQ,CAAC,EAGd,KAAK,QAAU,CAAC,EAGhB,KAAK,UAAY,CAAC,EAElBA,EAAI,WAAWoD,GAAW,KAAMnD,CAAG,EAEnC,KAAK,OAAS,KAAK,UAAU,MACjC,CAKA,QAAQ0C,EAAG,CACP,GAAIA,EAAI,GAAKA,GAAK,KAAK,UAAU,OAAQ,MAAM,IAAI,MAAM,6BAA6B,EAEtF,KAAK,KAAK,IAAM,KAAK,UAAUA,CAAC,EAEhC,IAAM1C,EAAM,KAAK,KAAK,WAAW,EAAI,KAAK,KAAK,IAC/C,OAAO,IAAIiC,GAAkB,KAAK,KAAMjC,EAAK,KAAK,OAAQ,KAAK,MAAO,KAAK,OAAO,CACtF,CACJ,EAxC6BwB,EAAA0B,GAAA,mBAAtB,IAAME,GAANF,GA+CP,SAASC,GAAUjB,EAAKmB,EAAOtD,EAAK,CAC5BmC,IAAQ,GAAImB,EAAM,QAAUtD,EAAI,WAAW,EACtCmC,IAAQ,EAAGmB,EAAM,KAAOtD,EAAI,WAAW,EACvCmC,IAAQ,EAAGmB,EAAM,OAAStD,EAAI,WAAW,EACzCmC,IAAQ,EAAGmB,EAAM,UAAU,KAAKtD,EAAI,GAAG,EACvCmC,IAAQ,EAAGmB,EAAM,MAAM,KAAKtD,EAAI,WAAW,CAAC,EAC5CmC,IAAQ,GAAGmB,EAAM,QAAQ,KAAKC,GAAiBvD,CAAG,CAAC,CAChE,CAPSyB,EAAA2B,GAAA,aAYT,SAASG,GAAiBvD,EAAK,CAC3B,IAAIuC,EAAQ,KACNtC,EAAMD,EAAI,WAAW,EAAIA,EAAI,IAEnC,KAAOA,EAAI,IAAMC,GAAK,CAClB,IAAMkC,EAAMnC,EAAI,WAAW,GAAK,EAEhCuC,EAAQJ,IAAQ,EAAInC,EAAI,WAAW,EAC/BmC,IAAQ,EAAInC,EAAI,UAAU,EAC1BmC,IAAQ,EAAInC,EAAI,WAAW,EAC3BmC,IAAQ,EAAInC,EAAI,aAAa,EAC7BmC,IAAQ,EAAInC,EAAI,WAAW,EAC3BmC,IAAQ,EAAInC,EAAI,YAAY,EAC5BmC,IAAQ,EAAInC,EAAI,YAAY,EAAI,IACxC,CAEA,OAAOuC,CACX,CAjBSd,EAAA8B,GAAA,oBAmBF,IAAMC,GAAN,MAAMA,EAAW,CAKpB,YAAYxD,EAAKC,EAAK,CAElB,KAAK,OAASD,EAAI,WAAWyD,GAAU,CAAC,EAAGxD,CAAG,CAClD,CACJ,EATwBwB,EAAA+B,GAAA,cAAjB,IAAME,GAANF,GAgBP,SAASC,GAAStB,EAAKwB,EAAQ3D,EAAK,CAChC,GAAImC,IAAQ,EAAG,CACX,IAAMmB,EAAQ,IAAID,GAAgBrD,EAAKA,EAAI,WAAW,EAAIA,EAAI,GAAG,EAC7DsD,EAAM,SAAQK,EAAOL,EAAM,IAAI,EAAIA,EAC3C,CACJ,CALS7B,EAAAgC,GAAA,YC5WT,IAAMG,GAAiB,sBAIjBC,GAA0B,GAC1BC,GAAkB,OAAO,aAAgB,YAAc,KAAO,IAAI,YAAY,OAAO,EAErFC,GAAc,EACdC,GAAc,EACdC,GAAc,EACdC,GAAc,EAECC,GAArB,MAAqBA,EAAI,CAIrB,YAAYC,EAAM,IAAI,WAAW,EAAE,EAAG,CAClC,KAAK,IAAM,YAAY,OAAOA,CAAG,EAAIA,EAAM,IAAI,WAAWA,CAAG,EAC7D,KAAK,SAAW,IAAI,SAAS,KAAK,IAAI,MAAM,EAC5C,KAAK,IAAM,EACX,KAAK,KAAO,EACZ,KAAK,OAAS,KAAK,IAAI,MAC3B,CAUA,WAAWC,EAAWC,EAAQC,EAAM,KAAK,OAAQ,CAC7C,KAAO,KAAK,IAAMA,GAAK,CACnB,IAAMC,EAAM,KAAK,WAAW,EACxBC,EAAMD,GAAO,EACbE,EAAW,KAAK,IAEpB,KAAK,KAAOF,EAAM,EAClBH,EAAUI,EAAKH,EAAQ,IAAI,EAEvB,KAAK,MAAQI,GAAU,KAAK,KAAKF,CAAG,CAC5C,CACA,OAAOF,CACX,CAOA,YAAYD,EAAWC,EAAQ,CAC3B,OAAO,KAAK,WAAWD,EAAWC,EAAQ,KAAK,WAAW,EAAI,KAAK,GAAG,CAC1E,CAEA,aAAc,CACV,IAAME,EAAM,KAAK,SAAS,UAAU,KAAK,IAAK,EAAI,EAClD,YAAK,KAAO,EACLA,CACX,CAEA,cAAe,CACX,IAAMA,EAAM,KAAK,SAAS,SAAS,KAAK,IAAK,EAAI,EACjD,YAAK,KAAO,EACLA,CACX,CAIA,aAAc,CACV,IAAMA,EAAM,KAAK,SAAS,UAAU,KAAK,IAAK,EAAI,EAAI,KAAK,SAAS,UAAU,KAAK,IAAM,EAAG,EAAI,EAAI,WACpG,YAAK,KAAO,EACLA,CACX,CAEA,cAAe,CACX,IAAMA,EAAM,KAAK,SAAS,UAAU,KAAK,IAAK,EAAI,EAAI,KAAK,SAAS,SAAS,KAAK,IAAM,EAAG,EAAI,EAAI,WACnG,YAAK,KAAO,EACLA,CACX,CAEA,WAAY,CACR,IAAMA,EAAM,KAAK,SAAS,WAAW,KAAK,IAAK,EAAI,EACnD,YAAK,KAAO,EACLA,CACX,CAEA,YAAa,CACT,IAAMA,EAAM,KAAK,SAAS,WAAW,KAAK,IAAK,EAAI,EACnD,YAAK,KAAO,EACLA,CACX,CAKA,WAAWG,EAAU,CACjB,IAAMP,EAAM,KAAK,IACbI,EAAKI,EAKqC,OAH9CA,EAAIR,EAAI,KAAK,KAAK,EAAGI,EAAQI,EAAI,IAAiBA,EAAI,MACtDA,EAAIR,EAAI,KAAK,KAAK,EAAGI,IAAQI,EAAI,MAAS,EAAQA,EAAI,OACtDA,EAAIR,EAAI,KAAK,KAAK,EAAGI,IAAQI,EAAI,MAAS,GAAQA,EAAI,OACtDA,EAAIR,EAAI,KAAK,KAAK,EAAGI,IAAQI,EAAI,MAAS,GAAQA,EAAI,KAAaJ,GACnEI,EAAIR,EAAI,KAAK,GAAG,EAAKI,IAAQI,EAAI,KAAS,GAEnCC,GAAoBL,EAAKG,EAAU,IAAI,EAClD,CAEA,cAAe,CACX,OAAO,KAAK,WAAW,EAAI,CAC/B,CAEA,aAAc,CACV,IAAMG,EAAM,KAAK,WAAW,EAC5B,OAAOA,EAAM,IAAM,GAAKA,EAAM,GAAK,GAAKA,EAAM,CAClD,CAEA,aAAc,CACV,MAAO,EAAQ,KAAK,WAAW,CACnC,CAEA,YAAa,CACT,IAAMP,EAAM,KAAK,WAAW,EAAI,KAAK,IAC/BQ,EAAM,KAAK,IAGjB,OAFA,KAAK,IAAMR,EAEPA,EAAMQ,GAAOlB,IAA2BC,GAEjCA,GAAgB,OAAO,KAAK,IAAI,SAASiB,EAAKR,CAAG,CAAC,EAGtDS,GAAS,KAAK,IAAKD,EAAKR,CAAG,CACtC,CAEA,WAAY,CACR,IAAMA,EAAM,KAAK,WAAW,EAAI,KAAK,IACjCU,EAAS,KAAK,IAAI,SAAS,KAAK,IAAKV,CAAG,EAC5C,YAAK,IAAMA,EACJU,CACX,CAQA,iBAAiBC,EAAM,CAAC,EAAGP,EAAU,CACjC,IAAMJ,EAAM,KAAK,cAAc,EAC/B,KAAO,KAAK,IAAMA,GAAKW,EAAI,KAAK,KAAK,WAAWP,CAAQ,CAAC,EACzD,OAAOO,CACX,CAEA,kBAAkBA,EAAM,CAAC,EAAG,CACxB,IAAMX,EAAM,KAAK,cAAc,EAC/B,KAAO,KAAK,IAAMA,GAAKW,EAAI,KAAK,KAAK,YAAY,CAAC,EAClD,OAAOA,CACX,CAEA,kBAAkBA,EAAM,CAAC,EAAG,CACxB,IAAMX,EAAM,KAAK,cAAc,EAC/B,KAAO,KAAK,IAAMA,GAAKW,EAAI,KAAK,KAAK,YAAY,CAAC,EAClD,OAAOA,CACX,CAEA,gBAAgBA,EAAM,CAAC,EAAG,CACtB,IAAMX,EAAM,KAAK,cAAc,EAC/B,KAAO,KAAK,IAAMA,GAAKW,EAAI,KAAK,KAAK,UAAU,CAAC,EAChD,OAAOA,CACX,CAEA,iBAAiBA,EAAM,CAAC,EAAG,CACvB,IAAMX,EAAM,KAAK,cAAc,EAC/B,KAAO,KAAK,IAAMA,GAAKW,EAAI,KAAK,KAAK,WAAW,CAAC,EACjD,OAAOA,CACX,CAEA,kBAAkBA,EAAM,CAAC,EAAG,CACxB,IAAMX,EAAM,KAAK,cAAc,EAC/B,KAAO,KAAK,IAAMA,GAAKW,EAAI,KAAK,KAAK,YAAY,CAAC,EAClD,OAAOA,CACX,CAEA,mBAAmBA,EAAM,CAAC,EAAG,CACzB,IAAMX,EAAM,KAAK,cAAc,EAC/B,KAAO,KAAK,IAAMA,GAAKW,EAAI,KAAK,KAAK,aAAa,CAAC,EACnD,OAAOA,CACX,CAEA,kBAAkBA,EAAM,CAAC,EAAG,CACxB,IAAMX,EAAM,KAAK,cAAc,EAC/B,KAAO,KAAK,IAAMA,GAAKW,EAAI,KAAK,KAAK,YAAY,CAAC,EAClD,OAAOA,CACX,CAEA,mBAAmBA,EAAM,CAAC,EAAG,CACzB,IAAMX,EAAM,KAAK,cAAc,EAC/B,KAAO,KAAK,IAAMA,GAAKW,EAAI,KAAK,KAAK,aAAa,CAAC,EACnD,OAAOA,CACX,CACA,eAAgB,CACZ,OAAO,KAAK,OAASjB,GAAY,KAAK,WAAW,EAAI,KAAK,IAAM,KAAK,IAAM,CAC/E,CAGA,KAAKO,EAAK,CACN,IAAMW,EAAOX,EAAM,EACnB,GAAIW,IAASpB,GAAY,KAAO,KAAK,IAAI,KAAK,KAAK,EAAI,KAAM,SACpDoB,IAASlB,GAAW,KAAK,IAAM,KAAK,WAAW,EAAI,KAAK,YACxDkB,IAASjB,GAAa,KAAK,KAAO,UAClCiB,IAASnB,GAAa,KAAK,KAAO,MACtC,OAAM,IAAI,MAAM,uBAAuBmB,CAAI,EAAE,CACtD,CAQA,SAASV,EAAKU,EAAM,CAChB,KAAK,YAAaV,GAAO,EAAKU,CAAI,CACtC,CAGA,QAAQC,EAAK,CACT,IAAIC,EAAS,KAAK,QAAU,GAE5B,KAAOA,EAAS,KAAK,IAAMD,GAAKC,GAAU,EAE1C,GAAIA,IAAW,KAAK,OAAQ,CACxB,IAAMjB,EAAM,IAAI,WAAWiB,CAAM,EACjCjB,EAAI,IAAI,KAAK,GAAG,EAChB,KAAK,IAAMA,EACX,KAAK,SAAW,IAAI,SAASA,EAAI,MAAM,EACvC,KAAK,OAASiB,CAClB,CACJ,CAEA,QAAS,CACL,YAAK,OAAS,KAAK,IACnB,KAAK,IAAM,EACJ,KAAK,IAAI,SAAS,EAAG,KAAK,MAAM,CAC3C,CAGA,aAAab,EAAK,CACd,KAAK,QAAQ,CAAC,EACd,KAAK,SAAS,SAAS,KAAK,IAAKA,EAAK,EAAI,EAC1C,KAAK,KAAO,CAChB,CAGA,cAAcA,EAAK,CACf,KAAK,QAAQ,CAAC,EACd,KAAK,SAAS,SAAS,KAAK,IAAKA,EAAK,EAAI,EAC1C,KAAK,KAAO,CAChB,CAGA,aAAaA,EAAK,CACd,KAAK,QAAQ,CAAC,EACd,KAAK,SAAS,SAAS,KAAK,IAAKA,EAAM,GAAI,EAAI,EAC/C,KAAK,SAAS,SAAS,KAAK,IAAM,EAAG,KAAK,MAAMA,EAAMZ,EAAc,EAAG,EAAI,EAC3E,KAAK,KAAO,CAChB,CAGA,cAAcY,EAAK,CACf,KAAK,QAAQ,CAAC,EACd,KAAK,SAAS,SAAS,KAAK,IAAKA,EAAM,GAAI,EAAI,EAC/C,KAAK,SAAS,SAAS,KAAK,IAAM,EAAG,KAAK,MAAMA,EAAMZ,EAAc,EAAG,EAAI,EAC3E,KAAK,KAAO,CAChB,CAGA,YAAYY,EAAK,CAGb,GAFAA,EAAM,CAACA,GAAO,EAEVA,EAAM,WAAaA,EAAM,EAAG,CAC5Bc,GAAed,EAAK,IAAI,EACxB,MACJ,CAEA,KAAK,QAAQ,CAAC,EAEd,KAAK,IAAI,KAAK,KAAK,EAAcA,EAAM,KAASA,EAAM,IAAO,IAAO,GAAQ,EAAAA,GAAO,OACnF,KAAK,IAAI,KAAK,KAAK,GAAMA,KAAS,GAAK,KAASA,EAAM,IAAO,IAAO,GAAQ,EAAAA,GAAO,OACnF,KAAK,IAAI,KAAK,KAAK,GAAMA,KAAS,GAAK,KAASA,EAAM,IAAO,IAAO,GAAQ,EAAAA,GAAO,OACnF,KAAK,IAAI,KAAK,KAAK,EAAOA,IAAQ,EAAK,MAC3C,CAGA,aAAaA,EAAK,CACd,KAAK,YAAYA,EAAM,EAAI,CAACA,EAAM,EAAI,EAAIA,EAAM,CAAC,CACrD,CAGA,aAAaA,EAAK,CACd,KAAK,YAAY,CAACA,CAAG,CACzB,CAGA,YAAYe,EAAK,CACbA,EAAM,OAAOA,CAAG,EAChB,KAAK,QAAQA,EAAI,OAAS,CAAC,EAE3B,KAAK,MAEL,IAAMb,EAAW,KAAK,IAEtB,KAAK,IAAMc,GAAU,KAAK,IAAKD,EAAK,KAAK,GAAG,EAC5C,IAAME,EAAM,KAAK,IAAMf,EAEnBe,GAAO,KAAMC,GAAuBhB,EAAUe,EAAK,IAAI,EAG3D,KAAK,IAAMf,EAAW,EACtB,KAAK,YAAYe,CAAG,EACpB,KAAK,KAAOA,CAChB,CAGA,WAAWjB,EAAK,CACZ,KAAK,QAAQ,CAAC,EACd,KAAK,SAAS,WAAW,KAAK,IAAKA,EAAK,EAAI,EAC5C,KAAK,KAAO,CAChB,CAGA,YAAYA,EAAK,CACb,KAAK,QAAQ,CAAC,EACd,KAAK,SAAS,WAAW,KAAK,IAAKA,EAAK,EAAI,EAC5C,KAAK,KAAO,CAChB,CAGA,WAAWS,EAAQ,CACf,IAAMQ,EAAMR,EAAO,OACnB,KAAK,YAAYQ,CAAG,EACpB,KAAK,QAAQA,CAAG,EAChB,QAASE,EAAI,EAAGA,EAAIF,EAAKE,IAAK,KAAK,IAAI,KAAK,KAAK,EAAIV,EAAOU,CAAC,CACjE,CAOA,gBAAgBC,EAAIC,EAAK,CACrB,KAAK,MAGL,IAAMnB,EAAW,KAAK,IACtBkB,EAAGC,EAAK,IAAI,EACZ,IAAMJ,EAAM,KAAK,IAAMf,EAEnBe,GAAO,KAAMC,GAAuBhB,EAAUe,EAAK,IAAI,EAG3D,KAAK,IAAMf,EAAW,EACtB,KAAK,YAAYe,CAAG,EACpB,KAAK,KAAOA,CAChB,CAQA,aAAahB,EAAKmB,EAAIC,EAAK,CACvB,KAAK,SAASpB,EAAKR,EAAS,EAC5B,KAAK,gBAAgB2B,EAAIC,CAAG,CAChC,CAMA,kBAAkBpB,EAAKS,EAAK,CACpBA,EAAI,QAAQ,KAAK,aAAaT,EAAKqB,GAAmBZ,CAAG,CACjE,CAKA,mBAAmBT,EAAKS,EAAK,CACrBA,EAAI,QAAQ,KAAK,aAAaT,EAAKsB,GAAoBb,CAAG,CAClE,CAKA,mBAAmBT,EAAKS,EAAK,CACrBA,EAAI,QAAQ,KAAK,aAAaT,EAAKuB,GAAoBd,CAAG,CAClE,CAKA,iBAAiBT,EAAKS,EAAK,CACnBA,EAAI,QAAQ,KAAK,aAAaT,EAAKwB,GAAkBf,CAAG,CAChE,CAKA,kBAAkBT,EAAKS,EAAK,CACpBA,EAAI,QAAQ,KAAK,aAAaT,EAAKyB,GAAmBhB,CAAG,CACjE,CAKA,mBAAmBT,EAAKS,EAAK,CACrBA,EAAI,QAAQ,KAAK,aAAaT,EAAK0B,GAAoBjB,CAAG,CAClE,CAKA,oBAAoBT,EAAKS,EAAK,CACtBA,EAAI,QAAQ,KAAK,aAAaT,EAAK2B,GAAqBlB,CAAG,CACnE,CAKA,mBAAmBT,EAAKS,EAAK,CACrBA,EAAI,QAAQ,KAAK,aAAaT,EAAK4B,GAAoBnB,CAAG,CAClE,CAKA,oBAAoBT,EAAKS,EAAK,CACtBA,EAAI,QAAQ,KAAK,aAAaT,EAAK6B,GAAqBpB,CAAG,CACnE,CAMA,gBAAgBT,EAAKQ,EAAQ,CACzB,KAAK,SAASR,EAAKR,EAAS,EAC5B,KAAK,WAAWgB,CAAM,CAC1B,CAKA,kBAAkBR,EAAKD,EAAK,CACxB,KAAK,SAASC,EAAKP,EAAW,EAC9B,KAAK,aAAaM,CAAG,CACzB,CAKA,mBAAmBC,EAAKD,EAAK,CACzB,KAAK,SAASC,EAAKP,EAAW,EAC9B,KAAK,cAAcM,CAAG,CAC1B,CAKA,kBAAkBC,EAAKD,EAAK,CACxB,KAAK,SAASC,EAAKT,EAAW,EAC9B,KAAK,aAAaQ,CAAG,CACzB,CAKA,mBAAmBC,EAAKD,EAAK,CACzB,KAAK,SAASC,EAAKT,EAAW,EAC9B,KAAK,cAAcQ,CAAG,CAC1B,CAKA,iBAAiBC,EAAKD,EAAK,CACvB,KAAK,SAASC,EAAKV,EAAU,EAC7B,KAAK,YAAYS,CAAG,CACxB,CAKA,kBAAkBC,EAAKD,EAAK,CACxB,KAAK,SAASC,EAAKV,EAAU,EAC7B,KAAK,aAAaS,CAAG,CACzB,CAKA,iBAAiBC,EAAKc,EAAK,CACvB,KAAK,SAASd,EAAKR,EAAS,EAC5B,KAAK,YAAYsB,CAAG,CACxB,CAKA,gBAAgBd,EAAKD,EAAK,CACtB,KAAK,SAASC,EAAKP,EAAW,EAC9B,KAAK,WAAWM,CAAG,CACvB,CAKA,iBAAiBC,EAAKD,EAAK,CACvB,KAAK,SAASC,EAAKT,EAAW,EAC9B,KAAK,YAAYQ,CAAG,CACxB,CAKA,kBAAkBC,EAAKD,EAAK,CACxB,KAAK,iBAAiBC,EAAK,CAACD,CAAG,CACnC,CACJ,EApgByB+B,EAAApC,GAAA,OAAzB,IAAqBqC,GAArBrC,GA2gBA,SAASU,GAAoB4B,EAAGC,EAAGC,EAAG,CAClC,IAAMvC,EAAMuC,EAAE,IACVC,EAAGhC,EAOkC,GALzCA,EAAIR,EAAIuC,EAAE,KAAK,EAAGC,GAAMhC,EAAI,MAAS,EAAQA,EAAI,MACjDA,EAAIR,EAAIuC,EAAE,KAAK,EAAGC,IAAMhC,EAAI,MAAS,EAAQA,EAAI,OACjDA,EAAIR,EAAIuC,EAAE,KAAK,EAAGC,IAAMhC,EAAI,MAAS,GAAQA,EAAI,OACjDA,EAAIR,EAAIuC,EAAE,KAAK,EAAGC,IAAMhC,EAAI,MAAS,GAAQA,EAAI,OACjDA,EAAIR,EAAIuC,EAAE,KAAK,EAAGC,IAAMhC,EAAI,MAAS,GAAQA,EAAI,OACjDA,EAAIR,EAAIuC,EAAE,KAAK,EAAGC,IAAMhC,EAAI,IAAS,GAAQA,EAAI,KAAM,OAAOiC,GAAMJ,EAAGG,EAAGF,CAAC,EAE3E,MAAM,IAAI,MAAM,wCAAwC,CAC5D,CAZSH,EAAA1B,GAAA,uBAmBT,SAASgC,GAAMC,EAAKC,EAAMpC,EAAU,CAChC,OAAOA,EAAWoC,EAAO,YAAeD,IAAQ,IAAOC,IAAS,GAAK,YAAgBD,IAAQ,EACjG,CAFSP,EAAAM,GAAA,SAQT,SAASvB,GAAed,EAAKwC,EAAK,CAC9B,IAAIF,EAAKC,EAiBT,GAfIvC,GAAO,GACPsC,EAAQtC,EAAM,WAAe,EAC7BuC,EAAQvC,EAAM,WAAe,IAE7BsC,EAAO,EAAE,CAACtC,EAAM,YAChBuC,EAAO,EAAE,CAACvC,EAAM,YAEZsC,EAAM,WACNA,EAAOA,EAAM,EAAK,GAElBA,EAAM,EACNC,EAAQA,EAAO,EAAK,IAIxBvC,GAAO,qBAAuBA,EAAM,qBACpC,MAAM,IAAI,MAAM,wCAAyC,EAG7DwC,EAAI,QAAQ,EAAE,EAEdC,GAAkBH,EAAKC,EAAMC,CAAG,EAChCE,GAAmBH,EAAMC,CAAG,CAChC,CA1BST,EAAAjB,GAAA,kBAiCT,SAAS2B,GAAkBH,EAAKC,EAAMC,EAAK,CACvCA,EAAI,IAAIA,EAAI,KAAK,EAAIF,EAAM,IAAO,IAAMA,KAAS,EACjDE,EAAI,IAAIA,EAAI,KAAK,EAAIF,EAAM,IAAO,IAAMA,KAAS,EACjDE,EAAI,IAAIA,EAAI,KAAK,EAAIF,EAAM,IAAO,IAAMA,KAAS,EACjDE,EAAI,IAAIA,EAAI,KAAK,EAAIF,EAAM,IAAO,IAAMA,KAAS,EACjDE,EAAI,IAAIA,EAAI,GAAG,EAAMF,EAAM,GAC/B,CANSP,EAAAU,GAAA,qBAYT,SAASC,GAAmBH,EAAMC,EAAK,CACnC,IAAMG,GAAOJ,EAAO,IAAS,EAE7BC,EAAI,IAAIA,EAAI,KAAK,GAAKG,IAAgBJ,KAAU,GAAK,IAAO,GAASA,IACrEC,EAAI,IAAIA,EAAI,KAAK,EAAKD,EAAO,MAASA,KAAU,GAAK,IAAO,GAASA,IACrEC,EAAI,IAAIA,EAAI,KAAK,EAAKD,EAAO,MAASA,KAAU,GAAK,IAAO,GAASA,IACrEC,EAAI,IAAIA,EAAI,KAAK,EAAKD,EAAO,MAASA,KAAU,GAAK,IAAO,GAASA,IACrEC,EAAI,IAAIA,EAAI,KAAK,EAAKD,EAAO,MAASA,KAAU,GAAK,IAAO,GAASA,IACrEC,EAAI,IAAIA,EAAI,KAAK,EAAKD,EAAO,QACjC,CATSR,EAAAW,GAAA,sBAgBT,SAASxB,GAAuBhB,EAAUe,EAAKuB,EAAK,CAChD,IAAMI,EACF3B,GAAO,MAAS,EAChBA,GAAO,QAAW,EAClBA,GAAO,UAAY,EAAI,KAAK,MAAM,KAAK,IAAIA,CAAG,GAAK,KAAK,IAAM,EAAE,EAGpEuB,EAAI,QAAQI,CAAQ,EACpB,QAASzB,EAAIqB,EAAI,IAAM,EAAGrB,GAAKjB,EAAUiB,IAAKqB,EAAI,IAAIrB,EAAIyB,CAAQ,EAAIJ,EAAI,IAAIrB,CAAC,CACnF,CATSY,EAAAb,GAAA,0BAeT,SAASI,GAAkBZ,EAAK8B,EAAK,CACjC,QAASrB,EAAI,EAAGA,EAAIT,EAAI,OAAQS,IAAKqB,EAAI,YAAY9B,EAAIS,CAAC,CAAC,CAC/D,CAFSY,EAAAT,GAAA,qBAOT,SAASC,GAAmBb,EAAK8B,EAAK,CAClC,QAASrB,EAAI,EAAGA,EAAIT,EAAI,OAAQS,IAAKqB,EAAI,aAAa9B,EAAIS,CAAC,CAAC,CAChE,CAFSY,EAAAR,GAAA,sBAOT,SAASE,GAAiBf,EAAK8B,EAAK,CAChC,QAASrB,EAAI,EAAGA,EAAIT,EAAI,OAAQS,IAAKqB,EAAI,WAAW9B,EAAIS,CAAC,CAAC,CAC9D,CAFSY,EAAAN,GAAA,oBAOT,SAASC,GAAkBhB,EAAK8B,EAAK,CACjC,QAASrB,EAAI,EAAGA,EAAIT,EAAI,OAAQS,IAAKqB,EAAI,YAAY9B,EAAIS,CAAC,CAAC,CAC/D,CAFSY,EAAAL,GAAA,qBAOT,SAASF,GAAmBd,EAAK8B,EAAK,CAClC,QAASrB,EAAI,EAAGA,EAAIT,EAAI,OAAQS,IAAKqB,EAAI,aAAa9B,EAAIS,CAAC,CAAC,CAChE,CAFSY,EAAAP,GAAA,sBAOT,SAASG,GAAmBjB,EAAK8B,EAAK,CAClC,QAASrB,EAAI,EAAGA,EAAIT,EAAI,OAAQS,IAAKqB,EAAI,aAAa9B,EAAIS,CAAC,CAAC,CAChE,CAFSY,EAAAJ,GAAA,sBAOT,SAASC,GAAoBlB,EAAK8B,EAAK,CACnC,QAASrB,EAAI,EAAGA,EAAIT,EAAI,OAAQS,IAAKqB,EAAI,cAAc9B,EAAIS,CAAC,CAAC,CACjE,CAFSY,EAAAH,GAAA,uBAOT,SAASC,GAAmBnB,EAAK8B,EAAK,CAClC,QAASrB,EAAI,EAAGA,EAAIT,EAAI,OAAQS,IAAKqB,EAAI,aAAa9B,EAAIS,CAAC,CAAC,CAChE,CAFSY,EAAAF,GAAA,sBAOT,SAASC,GAAoBpB,EAAK8B,EAAK,CACnC,QAASrB,EAAI,EAAGA,EAAIT,EAAI,OAAQS,IAAKqB,EAAI,cAAc9B,EAAIS,CAAC,CAAC,CACjE,CAFSY,EAAAD,GAAA,uBAWT,SAAStB,GAASZ,EAAKW,EAAKR,EAAK,CAC7B,IAAIgB,EAAM,GACNI,EAAIZ,EAER,KAAOY,EAAIpB,GAAK,CACZ,IAAM8C,EAAKjD,EAAIuB,CAAC,EACZ2B,EAAI,KACJC,EACAF,EAAK,IAAO,EACZA,EAAK,IAAO,EACZA,EAAK,IAAO,EAAI,EAEpB,GAAI1B,EAAI4B,EAAmBhD,EAAK,MAEhC,IAAIiD,EAAIC,EAAIC,EAERH,IAAqB,EACjBF,EAAK,MACLC,EAAID,GAEDE,IAAqB,GAC5BC,EAAKpD,EAAIuB,EAAI,CAAC,GACT6B,EAAK,OAAU,MAChBF,GAAKD,EAAK,KAAS,EAAOG,EAAK,GAC3BF,GAAK,MACLA,EAAI,QAGLC,IAAqB,GAC5BC,EAAKpD,EAAIuB,EAAI,CAAC,EACd8B,EAAKrD,EAAIuB,EAAI,CAAC,GACT6B,EAAK,OAAU,MAASC,EAAK,OAAU,MACxCH,GAAKD,EAAK,KAAQ,IAAOG,EAAK,KAAS,EAAOC,EAAK,IAC/CH,GAAK,MAAUA,GAAK,OAAUA,GAAK,SACnCA,EAAI,QAGLC,IAAqB,IAC5BC,EAAKpD,EAAIuB,EAAI,CAAC,EACd8B,EAAKrD,EAAIuB,EAAI,CAAC,EACd+B,EAAKtD,EAAIuB,EAAI,CAAC,GACT6B,EAAK,OAAU,MAASC,EAAK,OAAU,MAASC,EAAK,OAAU,MAChEJ,GAAKD,EAAK,KAAQ,IAAQG,EAAK,KAAS,IAAOC,EAAK,KAAS,EAAOC,EAAK,IACrEJ,GAAK,OAAUA,GAAK,WACpBA,EAAI,QAKZA,IAAM,MACNA,EAAI,MACJC,EAAmB,GAEZD,EAAI,QACXA,GAAK,MACL/B,GAAO,OAAO,aAAa+B,IAAM,GAAK,KAAQ,KAAM,EACpDA,EAAI,MAASA,EAAI,MAGrB/B,GAAO,OAAO,aAAa+B,CAAC,EAC5B3B,GAAK4B,CACT,CAEA,OAAOhC,CACX,CAhESgB,EAAAvB,GAAA,YAuET,SAASQ,GAAUpB,EAAKmB,EAAKR,EAAK,CAC9B,QAASY,EAAI,EAAG2B,EAAGK,EAAMhC,EAAIJ,EAAI,OAAQI,IAAK,CAG1C,GAFA2B,EAAI/B,EAAI,WAAWI,CAAC,EAEhB2B,EAAI,OAAUA,EAAI,MAClB,GAAIK,EACA,GAAIL,EAAI,MAAQ,CACZlD,EAAIW,GAAK,EAAI,IACbX,EAAIW,GAAK,EAAI,IACbX,EAAIW,GAAK,EAAI,IACb4C,EAAOL,EACP,QACJ,MACIA,EAAIK,EAAO,OAAU,GAAKL,EAAI,MAAS,MACvCK,EAAO,SAER,CACCL,EAAI,OAAW3B,EAAI,IAAMJ,EAAI,QAC7BnB,EAAIW,GAAK,EAAI,IACbX,EAAIW,GAAK,EAAI,IACbX,EAAIW,GAAK,EAAI,KAEb4C,EAAOL,EAEX,QACJ,MACOK,IACPvD,EAAIW,GAAK,EAAI,IACbX,EAAIW,GAAK,EAAI,IACbX,EAAIW,GAAK,EAAI,IACb4C,EAAO,MAGPL,EAAI,IACJlD,EAAIW,GAAK,EAAIuC,GAETA,EAAI,KACJlD,EAAIW,GAAK,EAAIuC,GAAK,EAAM,KAEpBA,EAAI,MACJlD,EAAIW,GAAK,EAAIuC,GAAK,GAAM,KAExBlD,EAAIW,GAAK,EAAIuC,GAAK,GAAO,IACzBlD,EAAIW,GAAK,EAAIuC,GAAK,GAAM,GAAO,KAEnClD,EAAIW,GAAK,EAAIuC,GAAK,EAAM,GAAO,KAEnClD,EAAIW,GAAK,EAAIuC,EAAI,GAAO,IAEhC,CACA,OAAOvC,CACX,CAnDSwB,EAAAf,GAAA,aC1wBT,IAAIoC,GAAQ,KAAK,IACbC,EAAUC,EAAA,CAACC,EAAQC,EAAaC,IAC3B,IAAI,QAAQ,CAACC,EAASC,IAAW,CACtC,IAAIC,EAAYN,EAACO,GAAU,CACzB,GAAI,CACFC,EAAKL,EAAU,KAAKI,CAAK,CAAC,CAC5B,OAASE,EAAG,CACVJ,EAAOI,CAAC,CACV,CACF,EANgB,aAOZC,EAAWV,EAACO,GAAU,CACxB,GAAI,CACFC,EAAKL,EAAU,MAAMI,CAAK,CAAC,CAC7B,OAASE,EAAG,CACVJ,EAAOI,CAAC,CACV,CACF,EANe,YAOXD,EAAOR,EAACW,GAAMA,EAAE,KAAOP,EAAQO,EAAE,KAAK,EAAI,QAAQ,QAAQA,EAAE,KAAK,EAAE,KAAKL,EAAWI,CAAQ,EAApF,QACXF,GAAML,EAAYA,EAAU,MAAMF,EAAQC,CAAW,GAAG,KAAK,CAAC,CAChE,CAAC,EAlBW,WAsBVU,EAAK,WACLC,GAAM,YACNC,GAAM,WACNC,GAAO,IAAIH,EAAG,CAChB,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EAEA,EACA,EAEA,CACF,CAAC,EACGI,GAAO,IAAIJ,EAAG,CAChB,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GAEA,EACA,CACF,CAAC,EACGK,GAAO,IAAIL,EAAG,CAAC,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,EAAE,CAAC,EAChFM,GAAOlB,EAAA,SAASmB,EAAIC,EAAO,CAE7B,QADIC,EAAI,IAAIR,GAAI,EAAE,EACTS,EAAI,EAAGA,EAAI,GAAI,EAAEA,EACxBD,EAAEC,CAAC,EAAIF,GAAS,GAAKD,EAAGG,EAAI,CAAC,EAG/B,QADI,EAAI,IAAIR,GAAIO,EAAE,EAAE,CAAC,EACZC,EAAI,EAAGA,EAAI,GAAI,EAAEA,EACxB,QAASC,EAAIF,EAAEC,CAAC,EAAGC,EAAIF,EAAEC,EAAI,CAAC,EAAG,EAAEC,EACjC,EAAEA,CAAC,EAAIA,EAAIF,EAAEC,CAAC,GAAK,EAAIA,EAG3B,MAAO,CAAE,EAAAD,EAAG,CAAE,CAChB,EAZW,QAaPG,GAAKN,GAAKH,GAAM,CAAC,EACjBU,GAAKD,GAAG,EACRE,GAAQF,GAAG,EACfC,GAAG,EAAE,EAAI,IAAKC,GAAM,GAAG,EAAI,GAC3B,IAAIC,GAAKT,GAAKF,GAAM,CAAC,EACjBY,GAAKD,GAAG,EACRE,GAAQF,GAAG,EACXG,GAAM,IAAIjB,GAAI,KAAK,EACvB,IAAKS,EAAI,EAAGA,EAAI,MAAO,EAAEA,EACvBX,GAAKW,EAAI,QAAU,GAAKA,EAAI,QAAU,EACtCX,GAAKA,EAAI,QAAU,GAAKA,EAAI,QAAU,EACtCA,GAAKA,EAAI,QAAU,GAAKA,EAAI,OAAS,EACrCmB,GAAIR,CAAC,IAAMX,EAAI,QAAU,GAAKA,EAAI,MAAQ,IAAM,EAElD,IAAIA,EACAW,EACAS,GAAO/B,EAAA,SAASgC,EAAIC,EAAIC,EAAG,CAI7B,QAHIC,EAAIH,EAAG,OACPV,EAAI,EACJc,EAAI,IAAIvB,GAAIoB,CAAE,EACXX,EAAIa,EAAG,EAAEb,EACVU,EAAGV,CAAC,GACN,EAAEc,EAAEJ,EAAGV,CAAC,EAAI,CAAC,EAEjB,IAAIe,EAAK,IAAIxB,GAAIoB,CAAE,EACnB,IAAKX,EAAI,EAAGA,EAAIW,EAAI,EAAEX,EACpBe,EAAGf,CAAC,EAAIe,EAAGf,EAAI,CAAC,EAAIc,EAAEd,EAAI,CAAC,GAAK,EAElC,IAAIgB,EACJ,GAAIJ,EAAG,CACLI,EAAK,IAAIzB,GAAI,GAAKoB,CAAE,EACpB,IAAIM,EAAM,GAAKN,EACf,IAAKX,EAAI,EAAGA,EAAIa,EAAG,EAAEb,EACnB,GAAIU,EAAGV,CAAC,EAIN,QAHIkB,EAAKlB,GAAK,EAAIU,EAAGV,CAAC,EAClBmB,EAAMR,EAAKD,EAAGV,CAAC,EACfoB,EAAIL,EAAGL,EAAGV,CAAC,EAAI,CAAC,KAAOmB,EAClBE,EAAID,GAAK,GAAKD,GAAO,EAAGC,GAAKC,EAAG,EAAED,EACzCJ,EAAGR,GAAIY,CAAC,GAAKH,CAAG,EAAIC,CAI5B,KAEE,KADAF,EAAK,IAAIzB,GAAIsB,CAAC,EACTb,EAAI,EAAGA,EAAIa,EAAG,EAAEb,EACfU,EAAGV,CAAC,IACNgB,EAAGhB,CAAC,EAAIQ,GAAIO,EAAGL,EAAGV,CAAC,EAAI,CAAC,GAAG,GAAK,GAAKU,EAAGV,CAAC,GAI/C,OAAOgB,CACT,EAnCW,QAoCPM,GAAM,IAAIhC,EAAG,GAAG,EACpB,IAAKU,EAAI,EAAGA,EAAI,IAAK,EAAEA,EACrBsB,GAAItB,CAAC,EAAI,EACX,IAAIA,EACJ,IAAKA,EAAI,IAAKA,EAAI,IAAK,EAAEA,EACvBsB,GAAItB,CAAC,EAAI,EACX,IAAIA,EACJ,IAAKA,EAAI,IAAKA,EAAI,IAAK,EAAEA,EACvBsB,GAAItB,CAAC,EAAI,EACX,IAAIA,EACJ,IAAKA,EAAI,IAAKA,EAAI,IAAK,EAAEA,EACvBsB,GAAItB,CAAC,EAAI,EACX,IAAIA,EACAuB,GAAM,IAAIjC,EAAG,EAAE,EACnB,IAAKU,EAAI,EAAGA,EAAI,GAAI,EAAEA,EACpBuB,GAAIvB,CAAC,EAAI,EACX,IAAIA,EACAwB,GAAuBf,GAAKa,GAAK,EAAG,CAAC,EACrCG,GAAuBhB,GAAKc,GAAK,EAAG,CAAC,EACrCG,GAAMhD,EAAA,SAASiD,EAAG,CAEpB,QADIN,EAAIM,EAAE,CAAC,EACF3B,EAAI,EAAGA,EAAI2B,EAAE,OAAQ,EAAE3B,EAC1B2B,EAAE3B,CAAC,EAAIqB,IACTA,EAAIM,EAAE3B,CAAC,GAEX,OAAOqB,CACT,EAPU,OAQNO,EAAOlD,EAAA,SAASmD,EAAGC,EAAGT,EAAG,CAC3B,IAAIU,EAAID,EAAI,EAAI,EAChB,OAAQD,EAAEE,CAAC,EAAIF,EAAEE,EAAI,CAAC,GAAK,KAAOD,EAAI,GAAKT,CAC7C,EAHW,QAIPW,GAAStD,EAAA,SAASmD,EAAGC,EAAG,CAC1B,IAAIC,EAAID,EAAI,EAAI,EAChB,OAAQD,EAAEE,CAAC,EAAIF,EAAEE,EAAI,CAAC,GAAK,EAAIF,EAAEE,EAAI,CAAC,GAAK,MAAQD,EAAI,EACzD,EAHa,UAITG,GAAOvD,EAAA,SAASoD,EAAG,CACrB,OAAQA,EAAI,GAAK,EAAI,CACvB,EAFW,QAGPI,GAAMxD,EAAA,SAAS0C,EAAGP,EAAG1B,EAAG,EACtB0B,GAAK,MAAQA,EAAI,KACnBA,EAAI,IACF1B,GAAK,MAAQA,EAAIiC,EAAE,UACrBjC,EAAIiC,EAAE,QACR,IAAI,EAAI,IAAI9B,EAAGH,EAAI0B,CAAC,EACpB,SAAE,IAAIO,EAAE,SAASP,EAAG1B,CAAC,CAAC,EACf,CACT,EARU,OASNgD,GAAK,CACP,iBACA,qBACA,yBACA,mBACA,kBACA,oBACA,CACA,cACA,qBACA,uBACA,8BACA,oBACA,mBACA,kBAEF,EACIC,EAAM1D,EAAA,SAAS2D,EAAKC,EAAKC,EAAI,CAC/B,IAAIpD,EAAI,IAAI,MAAMmD,GAAOH,GAAGE,CAAG,CAAC,EAIhC,GAHAlD,EAAE,KAAOkD,EACL,MAAM,mBACR,MAAM,kBAAkBlD,EAAGiD,CAAG,EAC5B,CAACG,EACH,MAAMpD,EACR,OAAOA,CACT,EARU,OASNqD,GAAQ9D,EAAA,SAAS+D,EAAKC,EAAIC,EAAKC,EAAM,CACvC,IAAIC,EAAKJ,EAAI,OAAQK,EAAKF,EAAOA,EAAK,OAAS,EAC/C,GAAI,CAACC,GAAMH,EAAG,GAAK,CAACA,EAAG,EACrB,OAAOC,GAAO,IAAIrD,EAAG,CAAC,EACxB,IAAIyD,EAAQ,CAACJ,GAAOD,EAAG,GAAK,EACxBM,EAAON,EAAG,EACTC,IACHA,EAAM,IAAIrD,EAAGuD,EAAK,CAAC,GACrB,IAAII,EAAOvE,EAAA,SAASwE,GAAI,CACtB,IAAIC,GAAKR,EAAI,OACb,GAAIO,GAAKC,GAAI,CACX,IAAIC,GAAO,IAAI9D,EAAG,KAAK,IAAI6D,GAAK,EAAGD,EAAE,CAAC,EACtCE,GAAK,IAAIT,CAAG,EACZA,EAAMS,EACR,CACF,EAPW,QAQPC,EAAQX,EAAG,GAAK,EAAGY,EAAMZ,EAAG,GAAK,EAAGa,EAAKb,EAAG,GAAK,EAAGc,EAAKd,EAAG,EAAGe,EAAKf,EAAG,EAAGgB,EAAMhB,EAAG,EAAGiB,EAAMjB,EAAG,EAC/FkB,EAAOf,EAAK,EAChB,EAAG,CACD,GAAI,CAACW,EAAI,CACPH,EAAQzB,EAAKa,EAAKa,EAAK,CAAC,EACxB,IAAIO,EAAOjC,EAAKa,EAAKa,EAAM,EAAG,CAAC,EAE/B,GADAA,GAAO,EACFO,EAYE,GAAIA,GAAQ,EACjBL,EAAKhC,GAAMiC,EAAKhC,GAAMiC,EAAM,EAAGC,EAAM,UAC9BE,GAAQ,EAAG,CAClB,IAAIC,EAAOlC,EAAKa,EAAKa,EAAK,EAAE,EAAI,IAAKS,EAAQnC,EAAKa,EAAKa,EAAM,GAAI,EAAE,EAAI,EACnEU,EAAKF,EAAOlC,EAAKa,EAAKa,EAAM,EAAG,EAAE,EAAI,EACzCA,GAAO,GAGP,QAFIW,EAAM,IAAI3E,EAAG0E,CAAE,EACfE,EAAM,IAAI5E,EAAG,EAAE,EACVU,EAAI,EAAGA,EAAI+D,EAAO,EAAE/D,EAC3BkE,EAAIvE,GAAKK,CAAC,CAAC,EAAI4B,EAAKa,EAAKa,EAAMtD,EAAI,EAAG,CAAC,EAEzCsD,GAAOS,EAAQ,EAGf,QAFII,EAAMzC,GAAIwC,CAAG,EAAGE,IAAU,GAAKD,GAAO,EACtCE,GAAM5D,GAAKyD,EAAKC,EAAK,CAAC,EACjBnE,EAAI,EAAGA,EAAIgE,GAAM,CACxB,IAAIpD,GAAIyD,GAAIzC,EAAKa,EAAKa,EAAKc,EAAM,CAAC,EAClCd,GAAO1C,GAAI,GACX,IAAIC,EAAID,IAAK,EACb,GAAIC,EAAI,GACNoD,EAAIjE,GAAG,EAAIa,MACN,CACL,IAAIyD,EAAI,EAAGC,GAAI,EAOf,IANI1D,GAAK,IACP0D,GAAI,EAAI3C,EAAKa,EAAKa,EAAK,CAAC,EAAGA,GAAO,EAAGgB,EAAIL,EAAIjE,EAAI,CAAC,GAC3Ca,GAAK,IACZ0D,GAAI,EAAI3C,EAAKa,EAAKa,EAAK,CAAC,EAAGA,GAAO,GAC3BzC,GAAK,KACZ0D,GAAI,GAAK3C,EAAKa,EAAKa,EAAK,GAAG,EAAGA,GAAO,GAChCiB,MACLN,EAAIjE,GAAG,EAAIsE,CACf,CACF,CACA,IAAIE,GAAKP,EAAI,SAAS,EAAGH,CAAI,EAAGW,EAAKR,EAAI,SAASH,CAAI,EACtDJ,EAAMhC,GAAI8C,EAAE,EACZb,EAAMjC,GAAI+C,CAAE,EACZjB,EAAK/C,GAAK+D,GAAId,EAAK,CAAC,EACpBD,EAAKhD,GAAKgE,EAAId,EAAK,CAAC,CACtB,MACEvB,EAAI,CAAC,MAlDI,CACT,IAAIvB,EAAIoB,GAAKqB,CAAG,EAAI,EAAGxC,EAAI2B,EAAI5B,EAAI,CAAC,EAAI4B,EAAI5B,EAAI,CAAC,GAAK,EAAG6D,EAAI7D,EAAIC,EACjE,GAAI4D,EAAI7B,EAAI,CACNG,GACFZ,EAAI,CAAC,EACP,KACF,CACIW,GACFE,EAAKM,EAAKzC,CAAC,EACb6B,EAAI,IAAIF,EAAI,SAAS5B,EAAG6D,CAAC,EAAGnB,CAAE,EAC9Bb,EAAG,EAAIa,GAAMzC,EAAG4B,EAAG,EAAIY,EAAMoB,EAAI,EAAGhC,EAAG,EAAIW,EAC3C,QACF,CAuCA,GAAIC,EAAMM,EAAM,CACVZ,GACFZ,EAAI,CAAC,EACP,KACF,CACF,CACIW,GACFE,EAAKM,EAAK,MAAM,EAGlB,QAFIoB,IAAO,GAAKjB,GAAO,EAAGkB,IAAO,GAAKjB,GAAO,EACzCkB,GAAOvB,GACFuB,GAAOvB,EAAK,CACnB,IAAIgB,EAAId,EAAGxB,GAAOS,EAAKa,CAAG,EAAIqB,EAAG,EAAGG,EAAMR,GAAK,EAE/C,GADAhB,GAAOgB,EAAI,GACPhB,EAAMM,EAAM,CACVZ,GACFZ,EAAI,CAAC,EACP,KACF,CAGA,GAFKkC,GACHlC,EAAI,CAAC,EACH0C,EAAM,IACRnC,EAAIY,GAAI,EAAIuB,UACLA,GAAO,IAAK,CACnBD,GAAOvB,EAAKE,EAAK,KACjB,KACF,KAAO,CACL,IAAIuB,GAAMD,EAAM,IAChB,GAAIA,EAAM,IAAK,CACb,IAAI9E,EAAI8E,EAAM,IAAK/E,GAAIN,GAAKO,CAAC,EAC7B+E,GAAMnD,EAAKa,EAAKa,GAAM,GAAKvD,IAAK,CAAC,EAAII,GAAGH,CAAC,EACzCsD,GAAOvD,EACT,CACA,IAAI8B,GAAI4B,EAAGzB,GAAOS,EAAKa,CAAG,EAAIsB,EAAG,EAAGI,GAAOnD,IAAK,EAC3CA,IACHO,EAAI,CAAC,EACPkB,GAAOzB,GAAI,GACX,IAAI4C,EAAKnE,GAAG0E,EAAI,EAChB,GAAIA,GAAO,EAAG,CACZ,IAAIjF,GAAIL,GAAKsF,EAAI,EACjBP,GAAMzC,GAAOS,EAAKa,CAAG,GAAK,GAAKvD,IAAK,EAAGuD,GAAOvD,EAChD,CACA,GAAIuD,EAAMM,EAAM,CACVZ,GACFZ,EAAI,CAAC,EACP,KACF,CACIW,GACFE,EAAKM,EAAK,MAAM,EAClB,IAAI0B,GAAM1B,EAAKwB,GACf,GAAIxB,EAAKkB,EAAI,CACX,IAAIS,GAASpC,EAAK2B,EAAIU,GAAO,KAAK,IAAIV,EAAIQ,EAAG,EAG7C,IAFIC,GAAS3B,EAAK,GAChBnB,EAAI,CAAC,EACAmB,EAAK4B,GAAM,EAAE5B,EAClBZ,EAAIY,CAAE,EAAIX,EAAKsC,GAAS3B,CAAE,CAC9B,CACA,KAAOA,EAAK0B,GAAK1B,GAAM,EACrBZ,EAAIY,CAAE,EAAIZ,EAAIY,EAAKkB,CAAE,EACrB9B,EAAIY,EAAK,CAAC,EAAIZ,EAAIY,EAAK,EAAIkB,CAAE,EAC7B9B,EAAIY,EAAK,CAAC,EAAIZ,EAAIY,EAAK,EAAIkB,CAAE,EAC7B9B,EAAIY,EAAK,CAAC,EAAIZ,EAAIY,EAAK,EAAIkB,CAAE,EAE/BlB,EAAK0B,EACP,CACF,CACAvC,EAAG,EAAIc,EAAId,EAAG,EAAImC,GAAMnC,EAAG,EAAIa,EAAIb,EAAG,EAAIW,EACtCG,IACFH,EAAQ,EAAGX,EAAG,EAAIgB,EAAKhB,EAAG,EAAIe,EAAIf,EAAG,EAAIiB,EAC7C,OAAS,CAACN,GACV,OAAOE,GAAMZ,EAAI,OAASA,EAAMT,GAAIS,EAAK,EAAGY,CAAE,CAChD,EAhJY,SAiJR6B,GAAqB,IAAI9F,EAAG,CAAC,EAC7B+F,GAAM3G,EAAA,SAASmD,EAAG,EAChBA,EAAE,CAAC,GAAK,IAAMA,EAAE,CAAC,GAAK,KAAOA,EAAE,CAAC,GAAK,IACvCO,EAAI,EAAG,mBAAmB,EAC5B,IAAIkD,EAAMzD,EAAE,CAAC,EACTa,EAAK,GACL4C,EAAM,IACR5C,IAAOb,EAAE,EAAE,EAAIA,EAAE,EAAE,GAAK,GAAK,GAC/B,QAAS0D,GAAMD,GAAO,EAAI,IAAMA,GAAO,EAAI,GAAIC,EAAK,EAAGA,GAAM,CAAC1D,EAAEa,GAAI,EAClE,CACF,OAAOA,GAAM4C,EAAM,EACrB,EAVU,OAWNE,GAAM9G,EAAA,SAASmD,EAAG,CACpB,IAAIf,EAAIe,EAAE,OACV,OAAQA,EAAEf,EAAI,CAAC,EAAIe,EAAEf,EAAI,CAAC,GAAK,EAAIe,EAAEf,EAAI,CAAC,GAAK,GAAKe,EAAEf,EAAI,CAAC,GAAK,MAAQ,CAC1E,EAHU,OAIN2E,GAAM/G,EAAA,SAASmD,EAAGe,EAAM,CAC1B,QAAKf,EAAE,CAAC,EAAI,KAAO,GAAKA,EAAE,CAAC,GAAK,EAAI,IAAMA,EAAE,CAAC,GAAK,EAAIA,EAAE,CAAC,GAAK,KAC5DO,EAAI,EAAG,mBAAmB,GACvBP,EAAE,CAAC,GAAK,EAAI,IAAM,CAAC,CAACe,GACvBR,EAAI,EAAG,uBAAyBP,EAAE,CAAC,EAAI,GAAK,OAAS,cAAgB,aAAa,GAC5EA,EAAE,CAAC,GAAK,EAAI,GAAK,CAC3B,EANU,OAOV,SAAS6D,GAAYC,EAAMC,EAAM,CAC/B,OAAOpD,GAAMmD,EAAM,CAAE,EAAG,CAAE,EAAGC,GAAQA,EAAK,IAAKA,GAAQA,EAAK,UAAU,CACxE,CAFSlH,EAAAgH,GAAA,eAGT,SAASG,GAAWF,EAAMC,EAAM,CAC9B,IAAIlD,EAAK2C,GAAIM,CAAI,EACjB,OAAIjD,EAAK,EAAIiD,EAAK,QAChBvD,EAAI,EAAG,mBAAmB,EACrBI,GAAMmD,EAAK,SAASjD,EAAI,EAAE,EAAG,CAAE,EAAG,CAAE,EAAGkD,GAAQA,EAAK,KAAO,IAAItG,EAAGkG,GAAIG,CAAI,CAAC,EAAGC,GAAQA,EAAK,UAAU,CAC9G,CALSlH,EAAAmH,GAAA,cAMT,SAASC,GAAWH,EAAMC,EAAM,CAC9B,OAAOpD,GAAMmD,EAAK,SAASF,GAAIE,EAAMC,GAAQA,EAAK,UAAU,EAAG,EAAE,EAAG,CAAE,EAAG,CAAE,EAAGA,GAAQA,EAAK,IAAKA,GAAQA,EAAK,UAAU,CACzH,CAFSlH,EAAAoH,GAAA,cAGT,SAASC,GAAeJ,EAAMC,EAAM,CAClC,OAAOD,EAAK,CAAC,GAAK,IAAMA,EAAK,CAAC,GAAK,KAAOA,EAAK,CAAC,GAAK,EAAIE,GAAWF,EAAMC,CAAI,GAAKD,EAAK,CAAC,EAAI,KAAO,GAAKA,EAAK,CAAC,GAAK,EAAI,IAAMA,EAAK,CAAC,GAAK,EAAIA,EAAK,CAAC,GAAK,GAAKD,GAAYC,EAAMC,CAAI,EAAIE,GAAWH,EAAMC,CAAI,CAC9M,CAFSlH,EAAAqH,GAAA,kBAGT,IAAIC,GAAK,OAAO,aAAe,aAA+B,IAAI,YAC9DC,GAAM,EACV,GAAI,CACFD,GAAG,OAAOZ,GAAI,CAAE,OAAQ,EAAK,CAAC,EAC9Ba,GAAM,CACR,OAAS9G,EAAG,CACZ,CAGA,IAAI+G,GAAQxH,EAAA,CAAC6F,EAAGW,IACPX,EAAI/F,GAAM,EAAG0G,CAAM,EADhB,SAGRiB,GAAUzH,EAAA,CAAC6F,EAAGW,IACT,KAAK,MAAMX,EAAI/F,GAAM,EAAG0G,CAAM,CAAC,EAD1B,WAGVkB,GAAY1H,EAAA,CAAC2H,EAAM/C,IACd4C,GAAMG,EAAK,UAAU/C,EAAM,EAAG,EAAI,EAAG,CAAC,EAAI+C,EAAK,SAAS/C,CAAG,EADpD,aAGZgD,GAAY5H,EAAA,CAAC2H,EAAM/C,IACd4C,GAAMG,EAAK,UAAU/C,EAAM,EAAG,EAAI,EAAG,EAAE,EAAI+C,EAAK,UAAU/C,EAAK,EAAI,EAD5D,aAGZiD,GAAU7H,EAAA,CAAC8H,EAAIC,EAAIC,EAAIL,EAAMrG,IAAM,CACrC,GAAIwG,IAAOH,EAAK,SAASrG,CAAC,EACxB,OAAOwG,EAAKH,EAAK,SAASrG,CAAC,EAC7B,IAAMX,EAAI+G,GAAUC,EAAMrG,EAAI,CAAC,EAC/B,GAAIyG,IAAOpH,EACT,OAAOoH,EAAKpH,EACd,IAAMsH,EAAIP,GAAUC,EAAMrG,EAAI,CAAC,EAC/B,OAAI0G,IAAOC,EACFD,EAAKC,EACP,CACT,EAVc,WAWVC,GAAelI,EAAA,CAAC2H,EAAMQ,EAAGxH,EAAGsH,IAAM,CACpC,IAAMG,EAAYC,GAAUV,EAAMQ,EAAI,IAAKxH,EAAGsH,CAAC,EAC/C,OAAIG,EACK,CACL,EAAAD,EACA,EAAAxH,EACA,EAAAsH,EACA,OAAQG,EAAU,CAAC,EACnB,OAAQA,EAAU,CAAC,EACnB,MAAO,EACT,EAEK,IACT,EAbmB,gBAcfE,GAAYtI,EAAA,CAAC2H,EAAMQ,EAAGxH,EAAGsH,IAAM,CACjC,IAAMG,EAAYC,GAAUV,EAAMQ,EAAGxH,EAAGsH,CAAC,EACzC,OAAIG,EACK,CACL,EAAAD,EACA,EAAAxH,EACA,EAAAsH,EACA,OAAQG,EAAU,CAAC,EACnB,OAAQA,EAAU,CAAC,EACnB,MAAO,EACT,EAEK,IACT,EAbgB,aAcZC,GAAYrI,EAAA,CAAC2H,EAAMQ,EAAGxH,EAAGsH,IAAM,CACjC,IAAItF,EAAI,EACJkD,EAAI8B,EAAK,WAAa,GAAK,EAC/B,KAAOhF,GAAKkD,GAAG,CACb,IAAM0C,EAAI1C,EAAIlD,GAAK,EACb6F,EAAMX,GAAQM,EAAGxH,EAAGsH,EAAGN,EAAMY,EAAI,EAAE,EACzC,GAAIC,EAAM,EACR7F,EAAI4F,EAAI,UACCC,EAAM,EACf3C,EAAI0C,EAAI,MAER,OAAO,CAACX,GAAUD,EAAMY,EAAI,GAAK,CAAC,EAAGZ,EAAK,UAAUY,EAAI,GAAK,GAAI,EAAI,CAAC,CAE1E,CACA,OAAO,IACT,EAfgB,aAgBZE,GAAYzI,EAAA,CAACiD,EAAG5B,IACd4B,EAAE,OAAS,CAAC5B,EAAE,MACT,EAEL,CAAC4B,EAAE,OAAS5B,EAAE,MACT,GAEL4B,EAAE,IAAM5B,EAAE,EACL4B,EAAE,EAAI5B,EAAE,EAEb4B,EAAE,IAAM5B,EAAE,EACL4B,EAAE,EAAI5B,EAAE,EAEV4B,EAAE,EAAI5B,EAAE,EAbD,aAeZqH,GAAa1I,EAAA,CAAC2I,EAAUrH,IAAM,CAChC,IAAMsH,EAAOD,EAAS,SAASrH,EAAI,EAAE,EAErC,MAAO,CACL,EAFQsH,EAAO,IAGf,EAAGlB,GAAUiB,EAAUrH,EAAI,GAAK,CAAC,EACjC,EAAGoG,GAAUiB,EAAUrH,EAAI,GAAK,CAAC,EACjC,OAAQsG,GAAUe,EAAUrH,EAAI,GAAK,CAAC,EACtC,OAAQqH,EAAS,UAAUrH,EAAI,GAAK,GAAI,EAAI,EAC5C,MAAOsH,GAAQ,IAAM,CACvB,CACF,EAXiB,cAYbC,GAAU7I,EAACiD,GAAM,CACnB,IAAM6F,EAAU,CAAC,EACXnB,EAAO,IAAI,SAAS1E,CAAC,EAC3B,QAAS3B,EAAI,EAAGA,EAAIqG,EAAK,WAAa,GAAIrG,IACxCwH,EAAQ,KAAKJ,GAAWf,EAAMrG,CAAC,CAAC,EAElC,OAAOyH,GAAgBD,CAAO,CAChC,EAPc,WAQVC,GAAkB/I,EAAC8I,GAAY,CACjCA,EAAQ,KAAKL,EAAS,EACtB,IAAMO,EAAS,IAAI,YAAY,GAAKF,EAAQ,MAAM,EAC5CG,EAAM,IAAI,WAAWD,CAAM,EACjC,QAAS1H,EAAI,EAAGA,EAAIwH,EAAQ,OAAQxH,IAAK,CACvC,IAAM4H,EAAQJ,EAAQxH,CAAC,EACnB6G,EAAIe,EAAM,EACVA,EAAM,QACRf,EAAIA,EAAI,KACVc,EAAI3H,EAAI,EAAE,EAAI6G,EACdc,EAAI3H,EAAI,GAAK,CAAC,EAAI4H,EAAM,EAAI,IAC5BD,EAAI3H,EAAI,GAAK,CAAC,EAAI4H,EAAM,GAAK,EAAI,IACjCD,EAAI3H,EAAI,GAAK,CAAC,EAAI4H,EAAM,GAAK,GAAK,IAClCD,EAAI3H,EAAI,GAAK,CAAC,EAAI4H,EAAM,EAAI,IAC5BD,EAAI3H,EAAI,GAAK,CAAC,EAAI4H,EAAM,GAAK,EAAI,IACjCD,EAAI3H,EAAI,GAAK,CAAC,EAAI4H,EAAM,GAAK,GAAK,IAClCD,EAAI3H,EAAI,GAAK,CAAC,EAAI4H,EAAM,OAAS,IACjCD,EAAI3H,EAAI,GAAK,CAAC,EAAImG,GAAQyB,EAAM,OAAQ,CAAC,EAAI,IAC7CD,EAAI3H,EAAI,GAAK,CAAC,EAAImG,GAAQyB,EAAM,OAAQ,EAAE,EAAI,IAC9CD,EAAI3H,EAAI,GAAK,EAAE,EAAImG,GAAQyB,EAAM,OAAQ,EAAE,EAAI,IAC/CD,EAAI3H,EAAI,GAAK,EAAE,EAAImG,GAAQyB,EAAM,OAAQ,EAAE,EAAI,IAC/CD,EAAI3H,EAAI,GAAK,EAAE,EAAImG,GAAQyB,EAAM,OAAQ,EAAE,EAAI,IAC/CD,EAAI3H,EAAI,GAAK,EAAE,EAAI4H,EAAM,OAAS,IAClCD,EAAI3H,EAAI,GAAK,EAAE,EAAI4H,EAAM,QAAU,EAAI,IACvCD,EAAI3H,EAAI,GAAK,EAAE,EAAI4H,EAAM,QAAU,GAAK,IACxCD,EAAI3H,EAAI,GAAK,EAAE,EAAI4H,EAAM,QAAU,GAAK,GAC1C,CACA,OAAOF,CACT,EA5BsB,mBA6BlBG,GAAanJ,EAAA,CAAC2H,EAAMyB,IAAS,CAC/B,GAAIzB,EAAK,WAAa,GACpB,OAAO,KACT,IAAM0B,EAAa1B,EAAK,WAAa,GAC/BuB,EAAQR,GAAWf,EAAM0B,EAAa,CAAC,EAC7C,GAAIH,EAAM,MAAO,CACf,IAAMI,EAAYJ,EAAM,EAClBK,EAAYH,EAAK,EAAIE,EACrBE,EAAQ,KAAK,MAAMJ,EAAK,GAAK,GAAKG,EAAU,EAC5CE,EAAQ,KAAK,MAAML,EAAK,GAAK,GAAKG,EAAU,EAClD,MAAO,CAAE,EAAGD,EAAW,EAAGE,EAAO,EAAGC,CAAM,CAC5C,CACA,OAAO,IACT,EAbiB,cAcjB,SAASC,GAAUC,EAAQ,CACzB,OAAO5J,EAAQ,KAAM,KAAM,WAAa,CACtC,IAAM6J,EAAO,MAAMD,EAAO,SAAS,EAAG,KAAK,EACrChB,EAAW,IAAI,SAASiB,EAAK,IAAI,EACjCC,EAAWlB,EAAS,UAAU,EAAG,EAAI,EACrCmB,EAAcnB,EAAS,UAAU,EAAG,EAAI,EACxCoB,EAAM,IAAI,YAAY,OAAO,EAC7BC,EAAe,KAAK,MACxBD,EAAI,OAAO,IAAI,SAASH,EAAK,KAAM,GAAIC,CAAQ,CAAC,CAClD,EACII,EAAkB,EAClBD,EAAa,cAAgB,SAC/BC,EAAkB,GAEpB,IAAIC,EAAU,EACV,YAAaF,IACfE,EAAU,CAACF,EAAa,SAE1B,IAAIG,EAAU,EACV,YAAaH,IACfG,EAAU,CAACH,EAAa,SAE1B,IAAII,EAAY,EACZC,EAAY,EACZC,EAAa,EACbC,EAAS,KACTC,EAAS,IACTC,EAAS,IACTC,EAAS,GACb,GAAIV,EAAa,OAAQ,CACvB,IAAMW,EAAQX,EAAa,OAAO,MAAM,GAAG,EAC3CO,EAAS,CAACI,EAAM,CAAC,EACjBH,EAAS,CAACG,EAAM,CAAC,EACjBF,EAAS,CAACE,EAAM,CAAC,EACjBD,EAAS,CAACC,EAAM,CAAC,CACnB,CACA,GAAIX,EAAa,OAAQ,CACvB,IAAMW,EAAQX,EAAa,OAAO,MAAM,GAAG,EAC3CI,EAAY,CAACO,EAAM,CAAC,EACpBN,EAAY,CAACM,EAAM,CAAC,EACpBL,EAAa,CAACK,EAAM,CAAC,CACvB,CA6BA,MA5Be,CACb,YAAahC,EAAS,UAAU,EAAG,EAAI,EACvC,oBAAqB,GAAKkB,EAC1B,oBAAqBC,EAAc,GACnC,mBAAoB,GACpB,mBAAoBD,EACpB,oBAAqB,EACrB,oBAAqB,OACrB,eAAgB,EAChB,eAAgB,OAChB,kBAAmB,EACnB,eAAgB,EAChB,gBAAiB,EACjB,UAAW,GACX,oBAAqB,EACrB,gBAAAI,EACA,SAAU,EACV,QAASC,EACT,QAASC,EACT,OAAAI,EACA,OAAAC,EACA,OAAAC,EACA,OAAAC,EACA,WAAAJ,EACA,UAAAF,EACA,UAAAC,EACA,KAAMT,EAAK,IACb,CAEF,CAAC,CACH,CAxES5J,EAAA0J,GAAA,aAyET,SAASkB,GAAOC,EAAQlB,EAAQmB,EAAO3C,EAAGxH,EAAGsH,EAAG8C,EAAQ,CACtD,OAAOhL,EAAQ,KAAM,KAAM,WAAa,CACtC,IAAIiL,EAAU,MAAMF,EAAM,eACxBnB,EACAkB,EAAO,oBACPA,EAAO,oBACPA,CACF,EACIA,EAAO,cAAgB,IACzBG,EAAUnC,GAAQmC,CAAO,GAE3B,IAAM9B,EAAQZ,GAAU,IAAI,SAAS0C,CAAO,EAAG7C,EAAGxH,EAAGsH,CAAC,EACtD,GAAIiB,EAAO,CAET,IAAI+B,GADS,MAAMtB,EAAO,SAAST,EAAM,OAAQA,EAAM,OAAQ6B,CAAM,GACjD,KACdpD,EAAO,IAAI,SAASsD,CAAQ,EAClC,OAAItD,EAAK,SAAS,CAAC,IAAM,IAAMA,EAAK,SAAS,CAAC,IAAM,MAClDsD,EAAW5D,GAAe,IAAI,WAAW4D,CAAQ,CAAC,GAE7C,CACL,KAAMA,CACR,CACF,CACA,IAAMC,EAAa/B,GAAW,IAAI,SAAS6B,CAAO,EAAG,CAAE,EAAA7C,EAAG,EAAAxH,EAAG,EAAAsH,CAAE,CAAC,EAChE,GAAIiD,EAAY,CACd,IAAMC,EAAejD,GACnB,IAAI,SAAS8C,CAAO,EACpBE,EAAW,EACXA,EAAW,EACXA,EAAW,CACb,EACA,GAAIC,EAAc,CAChB,IAAIC,EAAU,MAAMN,EAAM,eACxBnB,EACAwB,EAAa,OACbA,EAAa,OACbN,CACF,EACIA,EAAO,cAAgB,IACzBO,EAAUvC,GAAQuC,CAAO,GAE3B,IAAMC,EAAY/C,GAAU,IAAI,SAAS8C,CAAO,EAAGjD,EAAGxH,EAAGsH,CAAC,EAC1D,GAAIoD,EAAW,CAMb,IAAIJ,GALS,MAAMtB,EAAO,SACxB0B,EAAU,OACVA,EAAU,OACVN,CACF,GACoB,KACdpD,EAAO,IAAI,SAASsD,CAAQ,EAClC,OAAItD,EAAK,SAAS,CAAC,IAAM,IAAMA,EAAK,SAAS,CAAC,IAAM,MAClDsD,EAAW5D,GAAe,IAAI,WAAW4D,CAAQ,CAAC,GAE7C,CACL,KAAMA,CACR,CACF,CACF,CACF,CAEF,CAAC,CACH,CA7DSjL,EAAA4K,GAAA,UA8DT,IAAIU,GAAa,CACf,UAAA5B,GACA,OAAAkB,EACF,EAqJA,SAASW,GAAMC,EAAKC,EAAM,CACxB,OAAQA,IAAS,GAAK,YAAcD,IAAQ,EAC9C,CAFSE,EAAAH,GAAA,SAGT,SAASI,GAAoBC,EAAGC,EAAG,CACjC,IAAMC,EAAMD,EAAE,IACVE,EAAID,EAAID,EAAE,KAAK,EACfG,GAAKD,EAAI,MAAQ,EAqBrB,GApBIA,EAAI,MAERA,EAAID,EAAID,EAAE,KAAK,EACfG,IAAMD,EAAI,MAAQ,EACdA,EAAI,OAERA,EAAID,EAAID,EAAE,KAAK,EACfG,IAAMD,EAAI,MAAQ,GACdA,EAAI,OAERA,EAAID,EAAID,EAAE,KAAK,EACfG,IAAMD,EAAI,MAAQ,GACdA,EAAI,OAERA,EAAID,EAAID,EAAE,KAAK,EACfG,IAAMD,EAAI,MAAQ,GACdA,EAAI,OAERA,EAAID,EAAID,EAAE,KAAK,EACfG,IAAMD,EAAI,IAAM,GACZA,EAAI,KACN,OAAOR,GAAMK,EAAGI,CAAC,EACnB,MAAM,IAAI,MAAM,wCAAwC,CAC1D,CA3BSN,EAAAC,GAAA,uBA4BT,SAASM,GAAWJ,EAAG,CACrB,IAAMC,EAAMD,EAAE,IACVE,EAAID,EAAID,EAAE,KAAK,EACfK,EAAMH,EAAI,IAad,OAZIA,EAAI,MAERA,EAAID,EAAID,EAAE,KAAK,EACfK,IAAQH,EAAI,MAAQ,EAChBA,EAAI,OAERA,EAAID,EAAID,EAAE,KAAK,EACfK,IAAQH,EAAI,MAAQ,GAChBA,EAAI,OAERA,EAAID,EAAID,EAAE,KAAK,EACfK,IAAQH,EAAI,MAAQ,GAChBA,EAAI,KACCG,GACTH,EAAID,EAAID,EAAE,GAAG,EACbK,IAAQH,EAAI,KAAO,GACZJ,GAAoBO,EAAKL,CAAC,EACnC,CArBSH,EAAAO,GAAA,cAsBT,SAASE,GAAOC,EAAGC,EAAIC,EAAIC,EAAI,CAC7B,GAAIA,IAAO,EAAG,CACRD,IAAO,IACTD,EAAG,CAAC,EAAID,EAAI,EAAIC,EAAG,CAAC,EACpBA,EAAG,CAAC,EAAID,EAAI,EAAIC,EAAG,CAAC,GAEtB,IAAMG,EAAIH,EAAG,CAAC,EACdA,EAAG,CAAC,EAAIA,EAAG,CAAC,EACZA,EAAG,CAAC,EAAIG,CACV,CACF,CAVSd,EAAAS,GAAA,UA6BT,IAAIM,GAAW,CACb,EACA,EACA,EACA,GACA,GACA,IACA,KACA,KACA,MACA,MACA,OACA,QACA,QACA,SACA,SACA,UACA,WACA,WACA,YACA,YACA,aACA,cACA,cACA,eACA,eACA,gBACA,eACF,EACA,SAASC,GAAYC,EAAGC,EAAGC,EAAG,CAC5B,GAAIF,EAAI,GACN,MAAM,MAAM,oDAAoD,EAElE,GAAIC,EAAIE,GAAM,EAAGH,CAAC,EAAI,GAAKE,EAAIC,GAAM,EAAGH,CAAC,EAAI,EAC3C,MAAM,MAAM,oCAAoC,EAElD,IAAMI,EAAMN,GAASE,CAAC,EAChBK,EAAIF,GAAM,EAAGH,CAAC,EAChBM,EAAK,EACLC,EAAK,EACLC,EAAI,EACFC,EAAK,CAACR,EAAGC,CAAC,EACZQ,EAAIL,EAAI,EACZ,KAAOK,EAAI,GACTJ,GAAMG,EAAG,CAAC,EAAIC,GAAK,EAAI,EAAI,EAC3BH,GAAME,EAAG,CAAC,EAAIC,GAAK,EAAI,EAAI,EAC3BF,GAAKE,EAAIA,GAAK,EAAIJ,EAAKC,GACvBI,GAAOD,EAAGD,EAAIH,EAAIC,CAAE,EACpBG,EAAIA,EAAI,EAEV,OAAON,EAAMI,CACf,CAtBSI,EAAAb,GAAA,eA2CT,SAASc,GAAkBC,EAAKC,EAAa,CAC3C,OAAOC,EAAQ,KAAM,KAAM,WAAa,CACtC,GAAID,IAAgB,GAAgBA,IAAgB,EAClD,OAAOD,EAET,GAAIC,IAAgB,EAAc,CAChC,GAAI,OAAO,WAAW,qBAAwB,YAC5C,OAAOE,GAAe,IAAI,WAAWH,CAAG,CAAC,EAE3C,IAAMI,EAAS,IAAI,SAASJ,CAAG,EAAE,KACjC,GAAI,CAACI,EACH,MAAM,MAAM,gCAAgC,EAE9C,IAAMC,EAASD,EAAO,YAEpB,IAAI,WAAW,oBAAoB,MAAM,CAC3C,EACA,OAAO,IAAI,SAASC,CAAM,EAAE,YAAY,CAC1C,CACA,MAAM,MAAM,kCAAkC,CAChD,CAAC,CACH,CArBSC,EAAAP,GAAA,qBA+BT,IAAIQ,GAAoB,IACxB,SAASC,GAASC,EAASC,EAAQ,CACjC,IAAIC,EAAI,EACJ,EAAIF,EAAQ,OAAS,EACzB,KAAOE,GAAK,GAAG,CACb,IAAMC,EAAI,EAAID,GAAK,EACbE,EAAMH,EAASD,EAAQG,CAAC,EAAE,OAChC,GAAIC,EAAM,EACRF,EAAIC,EAAI,UACCC,EAAM,EACf,EAAID,EAAI,MAER,QAAOH,EAAQG,CAAC,CAEpB,CACA,OAAI,GAAK,IACHH,EAAQ,CAAC,EAAE,YAAc,GAGzBC,EAASD,EAAQ,CAAC,EAAE,OAASA,EAAQ,CAAC,EAAE,WACnCA,EAAQ,CAAC,EAGb,IACT,CAvBSK,EAAAN,GAAA,YAthCT,IAAAO,GA6jCIC,IAAcD,GAAA,KAAM,CACtB,YAAYE,EAAKC,EAAgB,IAAI,QAAW,CAC9C,KAAK,IAAMD,EACX,KAAK,cAAgBC,EACrB,KAAK,WAAa,EACpB,CACA,QAAS,CACP,OAAO,KAAK,GACd,CACA,WAAWA,EAAe,CACxB,KAAK,cAAgBA,CACvB,CACA,SAASC,EAAQC,EAAQC,EAAcC,EAAM,CAC3C,OAAOC,EAAQ,KAAM,KAAM,WAAa,CACtC,IAAIC,EACAC,EACAJ,EACFI,EAASJ,GAETG,EAAa,IAAI,gBACjBC,EAASD,EAAW,QAEtB,IAAME,EAAiB,IAAI,QAAQ,KAAK,aAAa,EACrDA,EAAe,IAAI,QAAS,SAASP,CAAM,IAAIA,EAASC,EAAS,CAAC,EAAE,EACpE,IAAIO,EACA,KAAK,aACPA,EAAQ,UAEV,IAAIC,EAAO,MAAM,MAAM,KAAK,IAAK,CAC/B,OAAAH,EACA,MAAAE,EACA,QAASD,CAEX,CAAC,EACD,GAAIP,IAAW,GAAKS,EAAK,SAAW,IAAK,CACvC,IAAMC,EAAeD,EAAK,QAAQ,IAAI,eAAe,EACrD,GAAI,CAACC,GAAgB,CAACA,EAAa,WAAW,UAAU,EACtD,MAAM,MAAM,wCAAwC,EAEtD,IAAMC,EAAe,CAACD,EAAa,OAAO,CAAC,EAC3CD,EAAO,MAAM,MAAM,KAAK,IAAK,CAC3B,OAAAH,EACA,MAAO,SACP,QAAS,CAAE,MAAO,WAAWK,EAAe,CAAC,EAAG,CAElD,CAAC,CACH,CACA,IAAIC,EAAUH,EAAK,QAAQ,IAAI,MAAM,EAIrC,GAHIG,GAAW,MAAgBA,EAAQ,WAAW,IAAI,IACpDA,EAAU,MAERH,EAAK,SAAW,KAAON,GAAQS,GAAWA,IAAYT,EACxD,WAAK,WAAa,GACZ,IAAIU,GACR,qCAAqCV,CAAI,yGAC3C,EAEF,GAAIM,EAAK,QAAU,IACjB,MAAM,MAAM,sBAAsBA,EAAK,MAAM,EAAE,EAEjD,IAAMK,EAAgBL,EAAK,QAAQ,IAAI,gBAAgB,EACvD,GAAIA,EAAK,SAAW,MAAQ,CAACK,GAAiB,CAACA,EAAgBb,GAC7D,MAAII,GACFA,EAAW,MAAM,EACb,MACJ,2IACF,EAGF,MAAO,CACL,KAFQ,MAAMI,EAAK,YAAY,EAG/B,KAAMG,GAAW,OACjB,aAAcH,EAAK,QAAQ,IAAI,eAAe,GAAK,OACnD,QAASA,EAAK,QAAQ,IAAI,SAAS,GAAK,MAC1C,CACF,CAAC,CACH,CACF,EA7EwBM,EAAAnB,GAAA,eAANA,IA8ElB,SAASoB,EAAUC,EAAGjB,EAAQ,CAC5B,IAAMkB,EAAKD,EAAE,UAAUjB,EAAS,EAAG,EAAI,EACjCmB,EAAKF,EAAE,UAAUjB,EAAS,EAAG,EAAI,EACvC,OAAOkB,EAAKE,GAAM,EAAG,EAAE,EAAID,CAC7B,CAJSJ,EAAAC,EAAA,aAKT,SAASK,GAAcC,EAAOnB,EAAM,CAClC,IAAMc,EAAI,IAAI,SAASK,CAAK,EACtBC,EAAcN,EAAE,SAAS,CAAC,EAChC,GAAIM,EAAc,EAChB,MAAM,MACJ,2BAA2BA,CAAW,iDACxC,EAEF,MAAO,CACL,YAAAA,EACA,oBAAqBP,EAAUC,EAAG,CAAC,EACnC,oBAAqBD,EAAUC,EAAG,EAAE,EACpC,mBAAoBD,EAAUC,EAAG,EAAE,EACnC,mBAAoBD,EAAUC,EAAG,EAAE,EACnC,oBAAqBD,EAAUC,EAAG,EAAE,EACpC,oBAAqBD,EAAUC,EAAG,EAAE,EACpC,eAAgBD,EAAUC,EAAG,EAAE,EAC/B,eAAgBD,EAAUC,EAAG,EAAE,EAC/B,kBAAmBD,EAAUC,EAAG,EAAE,EAClC,eAAgBD,EAAUC,EAAG,EAAE,EAC/B,gBAAiBD,EAAUC,EAAG,EAAE,EAChC,UAAWA,EAAE,SAAS,EAAE,IAAM,EAC9B,oBAAqBA,EAAE,SAAS,EAAE,EAClC,gBAAiBA,EAAE,SAAS,EAAE,EAC9B,SAAUA,EAAE,SAAS,EAAE,EACvB,QAASA,EAAE,SAAS,GAAG,EACvB,QAASA,EAAE,SAAS,GAAG,EACvB,OAAQA,EAAE,SAAS,IAAK,EAAI,EAAI,IAChC,OAAQA,EAAE,SAAS,IAAK,EAAI,EAAI,IAChC,OAAQA,EAAE,SAAS,IAAK,EAAI,EAAI,IAChC,OAAQA,EAAE,SAAS,IAAK,EAAI,EAAI,IAChC,WAAYA,EAAE,SAAS,GAAG,EAC1B,UAAWA,EAAE,SAAS,IAAK,EAAI,EAAI,IACnC,UAAWA,EAAE,SAAS,IAAK,EAAI,EAAI,IACnC,KAAAd,CACF,CACF,CApCSY,EAAAM,GAAA,iBAqCT,SAASG,GAAiBC,EAAQ,CAChC,IAAMC,EAAI,CAAE,IAAK,IAAI,WAAWD,CAAM,EAAG,IAAK,CAAE,EAC1CE,EAAaC,GAAWF,CAAC,EACzBG,EAAU,CAAC,EACbC,EAAS,EACb,QAASC,EAAI,EAAGA,EAAIJ,EAAYI,IAAK,CACnC,IAAMd,EAAIW,GAAWF,CAAC,EACtBG,EAAQ,KAAK,CAAE,OAAQC,EAASb,EAAG,OAAQ,EAAG,OAAQ,EAAG,UAAW,CAAE,CAAC,EACvEa,GAAUb,CACZ,CACA,QAASc,EAAI,EAAGA,EAAIJ,EAAYI,IAC9BF,EAAQE,CAAC,EAAE,UAAYH,GAAWF,CAAC,EAErC,QAASK,EAAI,EAAGA,EAAIJ,EAAYI,IAC9BF,EAAQE,CAAC,EAAE,OAASH,GAAWF,CAAC,EAElC,QAASK,EAAI,EAAGA,EAAIJ,EAAYI,IAAK,CACnC,IAAMd,EAAIW,GAAWF,CAAC,EAClBT,IAAM,GAAKc,EAAI,EACjBF,EAAQE,CAAC,EAAE,OAASF,EAAQE,EAAI,CAAC,EAAE,OAASF,EAAQE,EAAI,CAAC,EAAE,OAE3DF,EAAQE,CAAC,EAAE,OAASd,EAAI,CAE5B,CACA,OAAOY,CACT,CAzBSd,EAAAS,GAAA,oBA0BT,SAASQ,GAAcC,EAAG,CACxB,IAAMhB,EAAI,IAAI,SAASgB,CAAC,EACxB,OAAIhB,EAAE,UAAU,EAAG,EAAI,IAAM,GAC3B,QAAQ,KACN,0GACF,EACO,GAELA,EAAE,UAAU,EAAG,EAAI,IAAM,GAC3B,QAAQ,KACN,0GACF,EACO,GAEF,CACT,CAfSF,EAAAiB,GAAA,iBA/sCT,IAAApC,GA+tCIiB,IAAejB,GAAA,cAAc,KAAM,CACvC,EADuCmB,EAAAnB,GAAA,gBAApBA,IAEnB,SAASsC,GAAiBC,EAAQC,EAAY,CAC5C,OAAOhC,EAAQ,KAAM,KAAM,WAAa,CACtC,IAAMK,EAAO,MAAM0B,EAAO,SAAS,EAAG,KAAK,EAE3C,GADU,IAAI,SAAS1B,EAAK,IAAI,EAC1B,UAAU,EAAG,EAAI,IAAM,MAC3B,MAAM,IAAI,MAAM,wCAAwC,EAE1D,GAAIuB,GAAcvB,EAAK,IAAI,EAAI,EAC7B,MAAO,CAAC,MAAM4B,GAAW,UAAUF,CAAM,CAAC,EAE5C,IAAMG,EAAa7B,EAAK,KAAK,MAAM,EAAG8B,EAAiB,EACjDC,EAASnB,GAAciB,EAAY7B,EAAK,IAAI,EAC5CgC,EAAchC,EAAK,KAAK,MAC5B+B,EAAO,oBACPA,EAAO,oBAAsBA,EAAO,mBACtC,EACME,EAAS,GAAGP,EAAO,OAAO,CAAC,IAAIK,EAAO,MAAQ,EAAE,IAAIA,EAAO,mBAAmB,IAAIA,EAAO,mBAAmB,GAC5GG,EAAUnB,GACd,MAAMY,EAAWK,EAAaD,EAAO,mBAAmB,CAC1D,EACA,MAAO,CAACA,EAAQ,CAACE,EAAQC,EAAQ,OAAQA,CAAO,CAAC,CACnD,CAAC,CACH,CAtBS5B,EAAAmB,GAAA,oBAuBT,SAASU,GAAaT,EAAQC,EAAYpC,EAAQC,EAAQuC,EAAQ,CAChE,OAAOpC,EAAQ,KAAM,KAAM,WAAa,CACtC,IAAMK,EAAO,MAAM0B,EAAO,SAASnC,EAAQC,EAAQ,OAAQuC,EAAO,IAAI,EAChEK,EAAO,MAAMT,EAAW3B,EAAK,KAAM+B,EAAO,mBAAmB,EAC7DM,EAAYtB,GAAiBqB,CAAI,EACvC,GAAIC,EAAU,SAAW,EACvB,MAAM,IAAI,MAAM,4BAA4B,EAE9C,OAAOA,CACT,CAAC,CACH,CAVS/B,EAAA6B,GAAA,gBAxvCT,IAAAG,GAk2CIC,IAAqBD,GAAA,KAAM,CAC7B,YAAYE,EAAkB,IAAKC,EAAW,GAAMC,EAAaC,GAAmB,CAClF,KAAK,MAAwB,IAAI,IACjC,KAAK,cAAgC,IAAI,IACzC,KAAK,gBAAkBH,EACvB,KAAK,QAAU,EACf,KAAK,WAAaE,CACpB,CACA,UAAUE,EAAQ,CAChB,OAAOC,EAAQ,KAAM,KAAM,WAAa,CACtC,IAAMC,EAAWF,EAAO,OAAO,EACzBG,EAAa,KAAK,MAAM,IAAID,CAAQ,EAC1C,GAAIC,EACF,OAAAA,EAAW,SAAW,KAAK,UACd,MAAMA,EAAW,KAGhC,IAAMC,EAAI,IAAI,QAAQ,CAACC,EAASC,IAAW,CACzCC,GAAiBP,EAAQ,KAAK,UAAU,EAAE,KAAMQ,GAAQ,CAClDA,EAAI,CAAC,GACP,KAAK,MAAM,IAAIA,EAAI,CAAC,EAAE,CAAC,EAAG,CACxB,SAAU,KAAK,UACf,KAAM,QAAQ,QAAQA,EAAI,CAAC,EAAE,CAAC,CAAC,CACjC,CAAC,EAEHH,EAAQG,EAAI,CAAC,CAAC,EACd,KAAK,MAAM,CACb,CAAC,EAAE,MAAOC,GAAM,CACdH,EAAOG,CAAC,CACV,CAAC,CACH,CAAC,EACD,YAAK,MAAM,IAAIP,EAAU,CAAE,SAAU,KAAK,UAAW,KAAME,CAAE,CAAC,EACvDA,CACT,CAAC,CACH,CACA,aAAaJ,EAAQU,EAAQC,EAAQC,EAAQ,CAC3C,OAAOX,EAAQ,KAAM,KAAM,WAAa,CACtC,IAAMC,EAAW,GAAGF,EAAO,OAAO,CAAC,IAAIY,EAAO,MAAQ,EAAE,IAAIF,CAAM,IAAIC,CAAM,GACtER,EAAa,KAAK,MAAM,IAAID,CAAQ,EAC1C,GAAIC,EACF,OAAAA,EAAW,SAAW,KAAK,UACd,MAAMA,EAAW,KAGhC,IAAMC,EAAI,IAAI,QAAQ,CAACC,EAASC,IAAW,CACzCO,GAAab,EAAQ,KAAK,WAAYU,EAAQC,EAAQC,CAAM,EAAE,KAAME,GAAc,CAChFT,EAAQS,CAAS,EACjB,KAAK,MAAM,CACb,CAAC,EAAE,MAAOL,GAAM,CACdH,EAAOG,CAAC,CACV,CAAC,CACH,CAAC,EACD,YAAK,MAAM,IAAIP,EAAU,CAAE,SAAU,KAAK,UAAW,KAAME,CAAE,CAAC,EACvDA,CACT,CAAC,CACH,CAEA,eAAeJ,EAAQU,EAAQC,EAAQC,EAAQ,CAC7C,OAAOX,EAAQ,KAAM,KAAM,WAAa,CACtC,IAAMC,EAAW,GAAGF,EAAO,OAAO,CAAC,IAAIY,EAAO,MAAQ,EAAE,IAAIF,CAAM,IAAIC,CAAM,GACtER,EAAa,KAAK,MAAM,IAAID,CAAQ,EAC1C,GAAIC,EACF,OAAAA,EAAW,SAAW,KAAK,UACd,MAAMA,EAAW,KAGhC,IAAMC,EAAI,IAAI,QAAQ,CAACC,EAASC,IAAW,CACzCN,EAAO,SAASU,EAAQC,EAAQ,OAAQC,EAAO,IAAI,EAAE,KAAMG,GAAS,CAClEV,EAAQU,EAAK,IAAI,EACb,KAAK,MAAM,IAAIb,CAAQ,EAE3B,KAAK,MAAM,CACb,CAAC,EAAE,MAAOO,GAAM,CACdH,EAAOG,CAAC,CACV,CAAC,CACH,CAAC,EACD,YAAK,MAAM,IAAIP,EAAU,CAAE,SAAU,KAAK,UAAW,KAAME,CAAE,CAAC,EACvDA,CACT,CAAC,CACH,CACA,OAAQ,CACN,GAAI,KAAK,MAAM,MAAQ,KAAK,gBAAiB,CAC3C,IAAIY,EAAU,IACVC,EACJ,KAAK,MAAM,QAAQ,CAACd,EAAYe,IAAQ,CAClCf,EAAW,SAAWa,IACxBA,EAAUb,EAAW,SACrBc,EAASC,EAEb,CAAC,EACGD,GACF,KAAK,MAAM,OAAOA,CAAM,CAE5B,CACF,CACA,WAAWjB,EAAQ,CACjB,OAAOC,EAAQ,KAAM,KAAM,WAAa,CACtC,IAAMiB,EAAMlB,EAAO,OAAO,EAC1B,GAAI,KAAK,cAAc,IAAIkB,CAAG,EAC5B,OAAO,MAAM,KAAK,cAAc,IAAIA,CAAG,EAEzC,KAAK,MAAM,OAAOlB,EAAO,OAAO,CAAC,EACjC,IAAMI,EAAI,IAAI,QAAQ,CAACC,EAASC,IAAW,CACzC,KAAK,UAAUN,CAAM,EAAE,KAAMmB,GAAM,CACjCd,EAAQ,EACR,KAAK,cAAc,OAAOa,CAAG,CAC/B,CAAC,EAAE,MAAOT,GAAM,CACdH,EAAOG,CAAC,CACV,CAAC,CACH,CAAC,EACD,KAAK,cAAc,IAAIS,EAAKd,CAAC,CAC/B,CAAC,CACH,CACF,EAjH+BgB,EAAA1B,GAAA,sBAANA,IAl2CzBA,GAo9CI2B,IAAU3B,GAAA,KAAM,CAClB,YAAYM,EAAQsB,EAAOxB,EAAY,CACjC,OAAOE,GAAW,SACpB,KAAK,OAAS,IAAIuB,GAAYvB,CAAM,EAEpC,KAAK,OAASA,EAEZF,EACF,KAAK,WAAaA,EAElB,KAAK,WAAaC,GAEhBuB,EACF,KAAK,MAAQA,EAEb,KAAK,MAAQ,IAAI3B,EAErB,CAKA,WAAY,CACV,OAAOM,EAAQ,KAAM,KAAM,WAAa,CACtC,OAAO,MAAM,KAAK,MAAM,UAAU,KAAK,MAAM,CAC/C,CAAC,CACH,CAEA,cAAcuB,EAAGC,EAAGC,EAAGC,EAAQ,CAC7B,OAAO1B,EAAQ,KAAM,KAAM,WAAa,CACtC,IAAM2B,EAASC,GAAYL,EAAGC,EAAGC,CAAC,EAC5Bd,EAAS,MAAM,KAAK,MAAM,UAAU,KAAK,MAAM,EACrD,GAAIA,EAAO,YAAc,EACvB,OAAOkB,GAAW,OAAOlB,EAAQ,KAAK,OAAQ,KAAK,MAAOY,EAAGC,EAAGC,EAAGC,CAAM,EAE3E,GAAIH,EAAIZ,EAAO,SAAWY,EAAIZ,EAAO,QACnC,OAEF,IAAImB,EAAKnB,EAAO,oBACZoB,EAAKpB,EAAO,oBAChB,QAASqB,EAAQ,EAAGA,GAAS,EAAGA,IAAS,CACvC,IAAMnB,EAAY,MAAM,KAAK,MAAM,aACjC,KAAK,OACLiB,EACAC,EACApB,CACF,EACMsB,EAAQC,GAASrB,EAAWc,CAAM,EACxC,GAAIM,EAAO,CACT,GAAIA,EAAM,UAAY,EAAG,CACvB,IAAMnB,EAAO,MAAM,KAAK,OAAO,SAC7BH,EAAO,eAAiBsB,EAAM,OAC9BA,EAAM,OACNP,EACAf,EAAO,IACT,EACA,MAAO,CACL,KAAM,MAAM,KAAK,WAAWG,EAAK,KAAMH,EAAO,eAAe,EAC7D,aAAcG,EAAK,aACnB,QAASA,EAAK,OAChB,CACF,CACAgB,EAAKnB,EAAO,oBAAsBsB,EAAM,OACxCF,EAAKE,EAAM,MACb,KACE,OAEJ,CACA,MAAM,MAAM,kCAAkC,CAChD,CAAC,CACH,CAMA,OAAOV,EAAGC,EAAGC,EAAGC,EAAQ,CACtB,OAAO1B,EAAQ,KAAM,KAAM,WAAa,CACtC,GAAI,CACF,OAAO,MAAM,KAAK,cAAcuB,EAAGC,EAAGC,EAAGC,CAAM,CACjD,OAASlB,EAAG,CACV,GAAIA,aAAa2B,GACf,YAAK,MAAM,WAAW,KAAK,MAAM,EAC1B,MAAM,KAAK,cAAcZ,EAAGC,EAAGC,EAAGC,CAAM,EAEjD,MAAMlB,CACR,CACF,CAAC,CACH,CAEA,oBAAqB,CACnB,OAAOR,EAAQ,KAAM,KAAM,WAAa,CACtC,IAAMW,EAAS,MAAM,KAAK,MAAM,UAAU,KAAK,MAAM,EAC/CG,EAAO,MAAM,KAAK,OAAO,SAC7BH,EAAO,mBACPA,EAAO,mBACP,OACAA,EAAO,IACT,EACMyB,EAAe,MAAM,KAAK,WAC9BtB,EAAK,KACLH,EAAO,mBACT,EACM0B,EAAM,IAAI,YAAY,OAAO,EACnC,OAAO,KAAK,MAAMA,EAAI,OAAOD,CAAY,CAAC,CAC5C,CAAC,CACH,CAIA,aAAc,CACZ,OAAOpC,EAAQ,KAAM,KAAM,WAAa,CACtC,GAAI,CACF,OAAO,MAAM,KAAK,mBAAmB,CACvC,OAAS,EAAG,CACV,GAAI,aAAamC,GACf,YAAK,MAAM,WAAW,KAAK,MAAM,EAC1B,MAAM,KAAK,mBAAmB,EAEvC,MAAM,CACR,CACF,CAAC,CACH,CACF,EA3HoBhB,EAAA1B,GAAA,WAANA,ICn8CP,IAAK6C,QACVA,IAAA,MAAQ,GAAR,QACAA,IAAA,KAAO,GAAP,OACAA,IAAA,QAAU,GAAV,UAHUA,QAAA,IA2BL,SAASC,EAAQC,EAAgB,CACtC,MAAO,GAAGA,EAAE,CAAC,IAAIA,EAAE,CAAC,IAAIA,EAAE,CAAC,EAC7B,CAFgBC,EAAAF,EAAA,WAehB,IAAMG,GAAkBD,EAAA,CAACE,EAAeC,EAAkBC,IAAkB,CAC1EF,EAAI,IAAMC,EACV,IAAME,EAAMH,EAAI,WAAW,EAAIA,EAAI,IAC/BI,EAAM,EACNC,EAAS,EACTC,EAAI,EACJC,EAAI,EACJC,EAAK,IACLC,EAAK,KACLC,EAAK,IACLC,EAAK,KAEHC,EAAmB,CAAC,EACtBC,EAAgB,CAAC,EACrB,KAAOb,EAAI,IAAMG,GAAK,CACpB,GAAIE,GAAU,EAAG,CACf,IAAMS,EAASd,EAAI,WAAW,EAC9BI,EAAMU,EAAS,EACfT,EAASS,GAAU,CACrB,CAEA,GADAT,IACID,IAAQ,GAAKA,IAAQ,EACvBE,GAAKN,EAAI,YAAY,EAAIE,EACzBK,GAAKP,EAAI,YAAY,EAAIE,EACrBI,EAAIE,IAAIA,EAAKF,GACbA,EAAIG,IAAIA,EAAKH,GACbC,EAAIG,IAAIA,EAAKH,GACbA,EAAII,IAAIA,EAAKJ,GACbH,IAAQ,IACNS,EAAK,OAAS,GAAGD,EAAM,KAAKC,CAAI,EACpCA,EAAO,CAAC,GAEVA,EAAK,KAAK,IAAIE,EAAMT,EAAGC,CAAC,CAAC,UAChBH,IAAQ,EACbS,GAAMA,EAAK,KAAKA,EAAK,CAAC,EAAE,MAAM,CAAC,MAC9B,OAAM,IAAI,MAAM,mBAAmBT,CAAG,EAAE,CACjD,CACA,OAAIS,GAAMD,EAAM,KAAKC,CAAI,EAClB,CAAE,KAAMD,EAAO,KAAM,CAAE,KAAMJ,EAAI,KAAME,EAAI,KAAMD,EAAI,KAAME,CAAG,CAAE,CACzE,EAvCwB,mBAyCxB,SAASK,GACPC,EACAC,EACwB,CACxB,IAAMC,EAAI,IAAIC,GAAW,IAAIC,GAASJ,CAAM,CAAC,EACvCK,EAAS,IAAI,IACnB,OAAW,CAACC,EAAKC,CAAK,IAAK,OAAO,QAAQL,EAAE,MAAM,EAAG,CACnD,IAAMM,EAAW,CAAC,EAEZC,EAAQF,EACd,QAASG,EAAI,EAAGA,EAAID,EAAM,OAAQC,IAAK,CACrC,IAAMC,EAAS7B,GACb2B,EAAM,QAAQC,CAAC,EAAE,KACjBD,EAAM,QAAQC,CAAC,EAAE,UACjBT,EAAWQ,EAAM,MACnB,EACIG,EAAc,EAClB,QAAWC,KAAQF,EAAO,KAAMC,GAAeC,EAAK,OACpDL,EAAS,KAAK,CACZ,GAAIC,EAAM,QAAQC,CAAC,EAAE,GACrB,SAAUD,EAAM,QAAQC,CAAC,EAAE,KAC3B,KAAMC,EAAO,KACb,YAAaC,EACb,KAAMD,EAAO,KACb,MAAOF,EAAM,QAAQC,CAAC,EAAE,UAC1B,CAAC,CACH,CACAL,EAAO,IAAIC,EAAKE,CAAQ,CAC1B,CACA,OAAOH,CACT,CA9BSxB,EAAAkB,GAAA,aAgCF,IAAMe,GAAN,MAAMA,EAAoC,CAK/C,YAAYC,EAAuBC,EAA4B,CACzD,OAAOD,GAAQ,SACjB,KAAK,EAAI,IAAIE,GAAQF,CAAG,EAExB,KAAK,EAAIA,EAEX,KAAK,WAAa,CAAC,EACnB,KAAK,kBAAoBC,CAC3B,CAEa,IAAIpC,EAAQqB,EAAmD,QAAAiB,EAAA,sBACtE,KAAK,oBACP,KAAK,WAAa,KAAK,WAAW,OAAQC,GACpCA,EAAG,IAAMvC,EAAE,GACbuC,EAAG,WAAW,MAAM,EACb,IAEF,EACR,GAEH,IAAMC,EAAa,IAAI,gBACvB,KAAK,WAAW,KAAK,CAAE,EAAGxC,EAAE,EAAG,WAAYwC,CAAW,CAAC,EACvD,IAAMC,EAASD,EAAW,OAEpBf,EAAS,MAAM,KAAK,EAAE,OAAOzB,EAAE,EAAGA,EAAE,EAAGA,EAAE,EAAGyC,CAAM,EAExD,OAAIhB,EACKN,GAAUM,EAAO,KAAMJ,CAAQ,EAEjC,IAAI,GACb,GACF,EApCiDpB,EAAAiC,GAAA,iBAA1C,IAAMQ,GAANR,GAsCMS,GAAN,MAAMA,EAAgC,CAK3C,YAAYR,EAAaC,EAA4B,CACnD,KAAK,IAAMD,EACX,KAAK,WAAa,CAAC,EACnB,KAAK,kBAAoBC,CAC3B,CAEa,IAAIpC,EAAQqB,EAAmD,QAAAiB,EAAA,sBACtE,KAAK,oBACP,KAAK,WAAa,KAAK,WAAW,OAAQC,GACpCA,EAAG,IAAMvC,EAAE,GACbuC,EAAG,WAAW,MAAM,EACb,IAEF,EACR,GAEH,IAAMJ,EAAM,KAAK,IACd,QAAQ,MAAOnC,EAAE,EAAE,SAAS,CAAC,EAC7B,QAAQ,MAAOA,EAAE,EAAE,SAAS,CAAC,EAC7B,QAAQ,MAAOA,EAAE,EAAE,SAAS,CAAC,EAC1BwC,EAAa,IAAI,gBACvB,KAAK,WAAW,KAAK,CAAE,EAAGxC,EAAE,EAAG,WAAYwC,CAAW,CAAC,EACvD,IAAMC,EAASD,EAAW,OAC1B,OAAO,IAAI,QAAQ,CAACI,EAASC,IAAW,CACtC,MAAMV,EAAK,CAAE,OAAQM,CAAO,CAAC,EAC1B,KAAMK,GACEA,EAAK,YAAY,CACzB,EACA,KAAM1B,GAAW,CAChB,IAAMK,EAASN,GAAUC,EAAQC,CAAQ,EACzCuB,EAAQnB,CAAM,CAChB,CAAC,EACA,MAAOsB,GAAM,CACZF,EAAOE,CAAC,CACV,CAAC,CACL,CAAC,CACH,GACF,EA1C6C9C,EAAA0C,GAAA,aAAtC,IAAMK,GAANL,GA2DDM,GAAI,QACJC,GAAe,cACfC,GAAWF,GAAI,KAAK,GAEpBG,GAAUnD,EAACoD,GAAqB,CACpC,IAAMC,EAAI,KAAK,GAAK,IACdC,EAAiB,KAAK,IAC1B,KAAK,IAAIL,GAAcG,EAAO,CAAC,CAAC,EAChC,CAACH,EACH,EACMM,EAAM,KAAK,IAAID,EAAiBD,CAAC,EACvC,OAAO,IAAIpC,EACT+B,GAAII,EAAO,CAAC,EAAIC,EACfL,GAAI,KAAK,KAAK,EAAIO,IAAQ,EAAIA,EAAI,EAAK,CAC1C,CACF,EAXgB,WAahB,SAASC,GAAIhD,EAAW,CACtB,OAAOA,EAAIA,CACb,CAFSR,EAAAwD,GAAA,OAIT,SAASC,GAAMpC,EAAUqC,EAAU,CACjC,OAAOF,GAAInC,EAAE,EAAIqC,EAAE,CAAC,EAAIF,GAAInC,EAAE,EAAIqC,EAAE,CAAC,CACvC,CAFS1D,EAAAyD,GAAA,SAIT,SAASE,GAAqBC,EAAUvC,EAAUqC,EAAU,CAC1D,IAAMG,EAAKJ,GAAMpC,EAAGqC,CAAC,EACrB,GAAIG,IAAO,EAAG,OAAOJ,GAAMG,EAAGvC,CAAC,EAC/B,IAAIyC,IAAMF,EAAE,EAAIvC,EAAE,IAAMqC,EAAE,EAAIrC,EAAE,IAAMuC,EAAE,EAAIvC,EAAE,IAAMqC,EAAE,EAAIrC,EAAE,IAAMwC,EAClE,OAAAC,EAAI,KAAK,IAAI,EAAG,KAAK,IAAI,EAAGA,CAAC,CAAC,EACvBL,GAAMG,EAAG,IAAI3C,EAAMI,EAAE,EAAIyC,GAAKJ,EAAE,EAAIrC,EAAE,GAAIA,EAAE,EAAIyC,GAAKJ,EAAE,EAAIrC,EAAE,EAAE,CAAC,CACzE,CANSrB,EAAA2D,GAAA,wBAQF,SAASI,GAASC,EAAcC,EAAwB,CAC7D,IAAIC,EAAS,GACb,QAASrC,EAAI,EAAGsC,EAAIF,EAAK,OAAS,EAAGpC,EAAIoC,EAAK,OAAQE,EAAItC,IAAK,CAC7D,IAAMuC,EAAKH,EAAKpC,CAAC,EAAE,EACbwC,EAAKJ,EAAKpC,CAAC,EAAE,EACbyC,EAAKL,EAAKE,CAAC,EAAE,EACbI,EAAKN,EAAKE,CAAC,EAAE,EAEjBE,EAAKL,EAAM,GAAMO,EAAKP,EAAM,GAC5BA,EAAM,GAAMM,EAAKF,IAAOJ,EAAM,EAAIK,IAAQE,EAAKF,GAAMD,IACxCF,EAAS,CAACA,EAC3B,CACA,OAAOA,CACT,CAbgBlE,EAAA+D,GAAA,YAeT,SAASS,GAAMP,EAAwB,CAC5C,IAAIQ,EAAO,EACX,QAAS5C,EAAI,EAAGA,EAAIoC,EAAK,OAAQpC,IAAK,CACpC,IAAMsC,GAAKtC,EAAI,GAAKoC,EAAK,OACzBQ,GAAQR,EAAKpC,CAAC,EAAE,EAAIoC,EAAKE,CAAC,EAAE,EAC5BM,GAAQR,EAAKE,CAAC,EAAE,EAAIF,EAAKpC,CAAC,EAAE,CAC9B,CACA,OAAO4C,EAAO,CAChB,CARgBzE,EAAAwE,GAAA,SAUT,SAASE,GAAeV,EAAcW,EAA0B,CACrE,IAAIC,EAAsB,GAC1B,QAAWX,KAAQU,EACjB,GAAIH,GAAMP,CAAI,EAERF,GAASC,EAAOC,CAAI,IAAGW,EAAsB,QAC5C,CAEL,GAAIA,EAAqB,MAAO,GAC5Bb,GAASC,EAAOC,CAAI,IAAGW,EAAsB,GACnD,CAEF,OAAOA,CACT,CAbgB5E,EAAA0E,GAAA,kBAeT,SAASG,GAAqBb,EAAcW,EAAyB,CAC1E,IAAIG,EAAM,IACV,QAAWC,KAAKJ,EAAM,CACpB,IAAMK,EAAO,KAAK,KAAKvB,GAAMO,EAAOe,EAAE,CAAC,CAAC,CAAC,EACrCC,EAAOF,IAAKA,EAAME,EACxB,CACA,OAAOF,CACT,CAPgB9E,EAAA6E,GAAA,wBAST,SAASI,GAAoBjB,EAAcW,EAAyB,CACzE,IAAIG,EAAM,IACV,QAAWC,KAAKJ,EACd,QAAS9C,EAAI,EAAGA,EAAIkD,EAAE,OAAS,EAAGlD,IAAK,CACrC,IAAMmD,EAAO,KAAK,KAAKrB,GAAqBK,EAAOe,EAAElD,CAAC,EAAGkD,EAAElD,EAAI,CAAC,CAAC,CAAC,EAC9DmD,EAAOF,IAAKA,EAAME,EACxB,CAEF,OAAOF,CACT,CATgB9E,EAAAiF,GAAA,uBAWT,IAAMC,GAAN,MAAMA,EAAU,CAMrB,YAAYC,EAAoB/D,EAAkB,CAChD,KAAK,OAAS+D,EACd,KAAK,MAAQ,IAAI,IACjB,KAAK,SAAW,IAAI,IACpB,KAAK,SAAW/D,CAClB,CAEa,IAAIrB,EAAyC,QAAAsC,EAAA,sBACxD,IAAM+C,EAAMtF,EAAQC,CAAC,EACrB,OAAO,IAAI,QAAQ,CAAC4C,EAASC,IAAW,CACtC,IAAMyC,EAAQ,KAAK,MAAM,IAAID,CAAG,EAChC,GAAIC,EACFA,EAAM,KAAO,YAAY,IAAI,EAC7B1C,EAAQ0C,EAAM,IAAI,MACb,CACL,IAAMC,EAAU,KAAK,SAAS,IAAIF,CAAG,EACjCE,EACFA,EAAQ,KAAK,CAAE,QAAS3C,EAAS,OAAQC,CAAO,CAAC,GAEjD,KAAK,SAAS,IAAIwC,EAAK,CAAC,CAAC,EACzB,KAAK,OACF,IAAIrF,EAAG,KAAK,QAAQ,EACpB,KAAMwF,GAAS,CACd,KAAK,MAAM,IAAIH,EAAK,CAAE,KAAM,YAAY,IAAI,EAAG,KAAMG,CAAK,CAAC,EAE3D,IAAMC,EAAW,KAAK,SAAS,IAAIJ,CAAG,EACtC,GAAII,EACF,QAAW,KAAKA,EACd,EAAE,QAAQD,CAAI,EAMlB,GAHA,KAAK,SAAS,OAAOH,CAAG,EACxBzC,EAAQ4C,CAAI,EAER,KAAK,MAAM,MAAQ,GAAI,CACzB,IAAIE,EAAU,IACVC,EACJ,KAAK,MAAM,QAAQ,CAAChE,EAAOD,IAAQ,CAC7BC,EAAM,KAAO+D,IACfA,EAAU/D,EAAM,KAChBgE,EAASjE,EAEb,CAAC,EACGiE,GAAQ,KAAK,MAAM,OAAOA,CAAM,CACtC,CACF,CAAC,EACA,MAAO5C,GAAM,CACZ,IAAM0C,EAAW,KAAK,SAAS,IAAIJ,CAAG,EACtC,GAAII,EACF,QAAW,KAAKA,EACd,EAAE,OAAO1C,CAAC,EAGd,KAAK,SAAS,OAAOsC,CAAG,EACxBxC,EAAOE,CAAC,CACV,CAAC,EAEP,CACF,CAAC,CACH,GAEO,cACL6C,EACAC,EACAC,EACAC,EACiB,CACjB,IAAMC,EAAY5C,GAAQ,CAACyC,EAAKD,CAAG,CAAC,EAC9BK,EAAa,IAAI/E,GACpB8E,EAAU,EAAI7C,KAAaA,GAAW,GACvC,GAAK6C,EAAU,EAAI7C,KAAaA,GAAW,EAC7C,EACI8C,EAAW,EAAI,IACjBA,EAAW,EAAIA,EAAW,EAAI,KAAK,MAAMA,EAAW,CAAC,GACvD,IAAMC,EAASD,EAAW,KAAK,GAAKH,CAAI,EAClCK,EAAQ,KAAK,MAAMD,EAAO,CAAC,EAC3BE,EAAQ,KAAK,MAAMF,EAAO,CAAC,EAC3Bb,EAAMtF,EAAQ,CAAE,EAAG+F,EAAM,EAAGK,EAAO,EAAGC,CAAM,CAAC,EAC7CC,EAA0B,CAAC,EAC3Bf,EAAQ,KAAK,MAAM,IAAID,CAAG,EAChC,GAAIC,EAAO,CACT,IAAMgB,EAAS,IAAIpF,GAChBgF,EAAO,EAAIC,GAAS,KAAK,UACzBD,EAAO,EAAIE,GAAS,KAAK,QAC5B,EACA,OAAW,CAACG,EAAWC,CAAQ,IAAKlB,EAAM,KAAK,QAAQ,EACrD,QAAWmB,KAAWD,EAChBC,EAAQ,WAAa,EACnB3B,GAAqBwB,EAAQG,EAAQ,IAAI,EAAIV,GAC/CM,EAAO,KAAK,CAAE,QAAAI,EAAS,UAAWF,CAAU,CAAC,EAEtCE,EAAQ,WAAa,EAC1BvB,GAAoBoB,EAAQG,EAAQ,IAAI,EAAIV,GAC9CM,EAAO,KAAK,CAAE,QAAAI,EAAS,UAAWF,CAAU,CAAC,EAG3C5B,GAAe2B,EAAQG,EAAQ,IAAI,GACrCJ,EAAO,KAAK,CAAE,QAAAI,EAAS,UAAWF,CAAU,CAAC,CAKvD,CACA,OAAOF,CACT,CACF,EA/GuBpG,EAAAkF,GAAA,aAAhB,IAAMuB,GAANvB,GCvSA,IAAKwB,QACVA,IAAA,KAAO,GAAP,OACAA,IAAA,OAAS,GAAT,SACAA,IAAA,MAAQ,GAAR,QAHUA,QAAA,IAMAC,QACVA,IAAA,EAAI,GAAJ,IACAA,IAAA,GAAK,GAAL,KACAA,IAAA,EAAI,GAAJ,IACAA,IAAA,GAAK,GAAL,KACAA,IAAA,EAAI,GAAJ,IACAA,IAAA,GAAK,GAAL,KACAA,IAAA,EAAI,GAAJ,IACAA,IAAA,GAAK,GAAL,KARUA,QAAA,IAuBCC,GAAgBC,EAAA,CAC3BC,EACAC,EACAC,IACG,CACH,IAAMC,EAAS,SAAS,cAAc,QAAQ,EACxCC,EAAMD,EAAO,WAAW,IAAI,EAClC,OAAAA,EAAO,MAAQH,EACfG,EAAO,OAASF,EACZG,IAAQ,MAAMF,EAAGC,EAAQC,CAAG,EACzBD,CACT,EAX6B,iBAahBE,GAAN,MAAMA,EAA6C,CASxD,YAAYC,EAOT,CArFL,IAAAC,EAsFI,KAAK,QAAUD,EAAQ,QACvB,KAAK,KAAO,IAAIE,EAAWF,EAAQ,KAAM,OAAO,EAChD,KAAK,QAAU,IAAIG,EAAWH,EAAQ,QAAS,CAAC,EAChD,KAAK,OAAS,IAAIE,EAAWF,EAAQ,OAAQ,OAAO,EACpD,KAAK,MAAQ,IAAIG,EAAWH,EAAQ,MAAO,CAAC,EAC5C,KAAK,YACFC,EAAA,KAAK,KAAK,YACT,KAAK,QAAQ,YACb,KAAK,OAAO,YACZ,KAAK,MAAM,YACXD,EAAQ,aAJT,KAAAC,EAKD,GACF,KAAK,SAAW,EAClB,CAEO,OAAOH,EAA+BM,EAAW,CACtD,GAAI,CAAC,KAAK,WAAY,CACpBN,EAAI,YAAc,KAAK,QAAQ,IAAIM,CAAC,EACpCN,EAAI,UAAY,KAAK,KAAK,IAAIM,CAAC,EAC/BN,EAAI,YAAc,KAAK,OAAO,IAAIM,CAAC,EACnC,IAAMV,EAAQ,KAAK,MAAM,IAAIU,CAAC,EAC1BV,EAAQ,IAAG,KAAK,SAAW,IAC/BI,EAAI,UAAYJ,CAClB,CACA,GAAI,KAAK,QAAS,CAChB,IAAMW,EAASP,EAAI,cAAc,KAAK,QAAS,QAAQ,EACnDO,IAAQP,EAAI,UAAYO,EAC9B,CACF,CAEO,KACLP,EACAQ,EACAF,EACAG,EACA,CACA,IAAIC,EAAW,GACf,GAAI,KAAK,WAAY,CACnBV,EAAI,YAAc,KAAK,QAAQ,IAAIM,EAAGG,CAAC,EACvCT,EAAI,UAAY,KAAK,KAAK,IAAIM,EAAGG,CAAC,EAClC,IAAMb,EAAQ,KAAK,MAAM,IAAIU,EAAGG,CAAC,EAC7Bb,IACFc,EAAW,GACXV,EAAI,YAAc,KAAK,OAAO,IAAIM,EAAGG,CAAC,EACtCT,EAAI,UAAYJ,EAEpB,CAEA,IAAMe,EAAWhB,EAAA,IAAM,CACrBK,EAAI,KAAK,GACLU,GAAY,KAAK,WACnBV,EAAI,OAAO,CAEf,EALiB,YAOjBA,EAAI,UAAU,EACd,QAAWY,KAAQJ,EACjB,QAASK,EAAI,EAAGA,EAAID,EAAK,OAAQC,IAAK,CACpC,IAAMC,EAAKF,EAAKC,CAAC,EACbA,IAAM,EAAGb,EAAI,OAAOc,EAAG,EAAGA,EAAG,CAAC,EAC7Bd,EAAI,OAAOc,EAAG,EAAGA,EAAG,CAAC,CAC5B,CAEFH,EAAS,CACX,CACF,EAlF0DhB,EAAAM,GAAA,qBAAnD,IAAMc,EAANd,GAoFA,SAASe,GAAIC,EAAcC,EAAoC,CACpE,OAAQZ,GAAM,CACZ,IAAMa,EAAIb,EAAIW,EACd,OAAIE,GAAK,GAAKA,EAAID,EAAE,OACXA,EAAEC,CAAC,EAEL,CACT,CACF,CARgBxB,EAAAqB,GAAA,OAUhB,SAASI,GAAaC,EAAeC,EAA2B,CAC9D,IAAIC,EAAM,EACV,KAAOD,EAAMC,EAAM,CAAC,EAAE,CAAC,EAAIF,GAAOE,IAClC,OAAOA,CACT,CAJS5B,EAAAyB,GAAA,gBAMT,SAASI,GAAYC,EAAgBC,EAAeC,EAAqB,CACvE,OAAOF,GAAUE,EAAMD,GAASA,CAClC,CAFS/B,EAAA6B,GAAA,eAIT,SAASI,GACPtB,EACAiB,EACAN,EACAK,EACQ,CACR,IAAMO,EAAaP,EAAMC,EAAM,CAAC,EAAE,CAAC,EAAID,EAAMC,CAAG,EAAE,CAAC,EAC7CO,EAAWxB,EAAIgB,EAAMC,CAAG,EAAE,CAAC,EACjC,OAAIM,IAAe,EAAU,EACzBZ,IAAS,EAAUa,EAAWD,GAC1BE,EAAAd,EAAQa,GAAW,IAAMC,EAAAd,EAAQY,GAAa,EACxD,CAXSlC,EAAAiC,GAAA,8BAaF,SAASI,EAAIf,EAAcK,EAA0C,CAC1E,OAAQhB,GAAM,CACZ,GAAIgB,EAAM,OAAS,EAAG,MAAO,GAC7B,GAAIhB,GAAKgB,EAAM,CAAC,EAAE,CAAC,EAAG,OAAOA,EAAM,CAAC,EAAE,CAAC,EACvC,GAAIhB,GAAKgB,EAAMA,EAAM,OAAS,CAAC,EAAE,CAAC,EAAG,OAAOA,EAAMA,EAAM,OAAS,CAAC,EAAE,CAAC,EACrE,IAAMC,EAAMH,GAAad,EAAGgB,CAAK,EAC3BG,EAASG,GAA2BtB,EAAGiB,EAAKN,EAAMK,CAAK,EAC7D,OAAOE,GAAYC,EAAQH,EAAMC,CAAG,EAAE,CAAC,EAAGD,EAAMC,EAAM,CAAC,EAAE,CAAC,CAAC,CAC7D,CACF,CATgB5B,EAAAqC,EAAA,OAYT,SAASC,GACdC,EACAZ,EAC0C,CAM1C,OAAQhB,GAAM,CACZ,GAAIgB,EAAM,OAAS,EAAG,MAAO,GAC7B,IAAIa,EAASD,EACb,QAASE,EAAI,EAAGA,EAAId,EAAM,OAAQc,IAC5B9B,GAAKgB,EAAMc,CAAC,EAAE,CAAC,IAAGD,EAASb,EAAMc,CAAC,EAAE,CAAC,GAE3C,OAAOD,CACT,CACF,CAjBgBxC,EAAAsC,GAAA,QAmBT,SAASI,GAAOf,EAA0C,CAC/D,OAAOU,EAAI,EAAGV,CAAK,CACrB,CAFgB3B,EAAA0C,GAAA,UAIT,IAAMC,GAAN,MAAMA,EAA0C,CAYrD,YAAYpC,EAWT,CApPL,IAAAC,EAqPI,KAAK,MAAQ,IAAIC,EAAWF,EAAQ,MAAO,OAAO,EAClD,KAAK,MAAQ,IAAIG,EAAWH,EAAQ,KAAK,EACzC,KAAK,QAAU,IAAIG,EAAWH,EAAQ,OAAO,EAC7C,KAAK,KAAOA,EAAQ,KAAO,IAAIqC,GAAUrC,EAAQ,IAAI,EAAI,KACzD,KAAK,UAAY,IAAIE,EAAWF,EAAQ,UAAW,OAAO,EAC1D,KAAK,UAAY,IAAIG,EAAWH,EAAQ,UAAW,CAAG,EACtD,KAAK,QAAU,IAAIE,EAAWF,EAAQ,QAAS,MAAM,EACrD,KAAK,SAAW,IAAIE,EAAWF,EAAQ,SAAU,OAAO,EACxD,KAAK,KAAO,GACZ,KAAK,WAAa,CAAC,GACjBC,EAAA,KAAK,OAAL,MAAAA,EAAW,YACX,KAAK,MAAM,YACX,KAAK,QAAQ,YACb,KAAK,MAAM,YACX,KAAK,QAAQ,YACb,KAAK,SAAS,YACdD,EAAQ,WAEZ,CAEO,OAAOF,EAA+BM,EAAW,CACjD,KAAK,aACRN,EAAI,YAAc,KAAK,MAAM,IAAIM,CAAC,EAClCN,EAAI,UAAY,KAAK,MAAM,IAAIM,CAAC,EAChCN,EAAI,YAAc,KAAK,QAAQ,IAAIM,CAAC,EACpCN,EAAI,QAAU,KAAK,QAAQ,IAAIM,CAAC,EAChCN,EAAI,SAAW,KAAK,SAAS,IAAIM,CAAC,EAEtC,CAEO,KACLN,EACAQ,EACAF,EACAG,EACA,CACA,GAAI,KAAK,KAAM,OAEf,IAAM+B,EAAa7C,EAAA,IAAM,CACnB,KAAK,aACPK,EAAI,YAAc,KAAK,QAAQ,IAAIM,EAAGG,CAAC,EACvCT,EAAI,QAAU,KAAK,QAAQ,IAAIM,EAAGG,CAAC,EACnCT,EAAI,SAAW,KAAK,SAAS,IAAIM,EAAGG,CAAC,GAEnC,KAAK,MACPT,EAAI,KAAK,EACL,KAAK,YACPA,EAAI,UAAY,KAAK,UAAU,IAAIM,EAAGG,CAAC,EACvCT,EAAI,YAAc,KAAK,UAAU,IAAIM,EAAGG,CAAC,EACzCT,EAAI,YAAY,KAAK,KAAK,IAAIM,EAAGG,CAAC,CAAC,GAEnCT,EAAI,YAAY,KAAK,KAAK,IAAIM,CAAC,CAAC,EAElCN,EAAI,OAAO,EACXA,EAAI,QAAQ,IAEZA,EAAI,KAAK,EACL,KAAK,aACPA,EAAI,UAAY,KAAK,MAAM,IAAIM,EAAGG,CAAC,EACnCT,EAAI,YAAc,KAAK,MAAM,IAAIM,EAAGG,CAAC,GAEvCT,EAAI,OAAO,EACXA,EAAI,QAAQ,EAEhB,EA1BmB,cA4BnBA,EAAI,UAAU,EACd,QAAWyC,KAAMjC,EACf,QAASK,EAAI,EAAGA,EAAI4B,EAAG,OAAQ5B,IAAK,CAClC,IAAMC,EAAK2B,EAAG5B,CAAC,EACXA,IAAM,EAAGb,EAAI,OAAOc,EAAG,EAAGA,EAAG,CAAC,EAC7Bd,EAAI,OAAOc,EAAG,EAAGA,EAAG,CAAC,CAC5B,CAEF0B,EAAW,CACb,CACF,EApGuD7C,EAAA2C,GAAA,kBAAhD,IAAMI,EAANJ,GA0GMK,GAAN,MAAMA,EAA0C,CAKrD,YAAYzC,EAAgC,CAC1C,KAAK,KAAOA,EAAQ,KACpB,KAAK,MAAQA,EAAQ,MACrB,KAAK,IAAM,OAAO,gBACpB,CAEO,MAAM0C,EAAgBpC,EAAiBqC,EAAkB,CAC9D,IAAM/B,EAAKN,EAAK,CAAC,EACXU,EAAI,IAAI4B,EAAMtC,EAAK,CAAC,EAAE,CAAC,EAAE,EAAGA,EAAK,CAAC,EAAE,CAAC,EAAE,CAAC,EACxCuC,EAAM,KAAK,MAAM,IAAI,KAAK,IAAI,EAC9BnD,EAAQmD,EAAI,EAAI,KAAK,IACrBlD,EAASkD,EAAI,EAAI,KAAK,IAEtBC,EAAO,CACX,KAAM9B,EAAE,EAAItB,EAAQ,EACpB,KAAMsB,EAAE,EAAIrB,EAAS,EACrB,KAAMqB,EAAE,EAAItB,EAAQ,EACpB,KAAMsB,EAAE,EAAIrB,EAAS,CACvB,EAgBA,MAAO,CAAC,CAAE,OAAQqB,EAAG,OAAQ,CAAC8B,CAAI,EAAG,KAdxBrD,EAACK,GAAkC,CAC9CA,EAAI,YAAc,EAClBA,EAAI,UACF,KAAK,MAAM,OACX+C,EAAI,EACJA,EAAI,EACJA,EAAI,EACJA,EAAI,EACJ,CAACA,EAAI,EAAI,EAAI,KAAK,IAClB,CAACA,EAAI,EAAI,EAAI,KAAK,IAClBA,EAAI,EAAI,EACRA,EAAI,EAAI,CACV,CACF,EAba,OAcmC,CAAC,CACnD,CACF,EAzCuDpD,EAAAgD,GAAA,kBAAhD,IAAMM,GAANN,GA2CMO,GAAN,MAAMA,EAA6D,CAOxE,YAAYhD,EAMT,CACD,KAAK,OAAS,IAAIG,EAAWH,EAAQ,OAAQ,CAAC,EAC9C,KAAK,KAAO,IAAIE,EAAWF,EAAQ,KAAM,OAAO,EAChD,KAAK,OAAS,IAAIE,EAAWF,EAAQ,OAAQ,OAAO,EACpD,KAAK,MAAQ,IAAIG,EAAWH,EAAQ,MAAO,CAAC,EAC5C,KAAK,QAAU,IAAIG,EAAWH,EAAQ,OAAO,CAC/C,CAEO,KACLF,EACAQ,EACAF,EACAG,EACA,CACAT,EAAI,YAAc,KAAK,QAAQ,IAAIM,EAAGG,CAAC,EAEvC,IAAM0C,EAAS,KAAK,OAAO,IAAI7C,EAAGG,CAAC,EAC7Bb,EAAQ,KAAK,MAAM,IAAIU,EAAGG,CAAC,EAC7Bb,EAAQ,IACVI,EAAI,YAAc,KAAK,OAAO,IAAIM,EAAGG,CAAC,EACtCT,EAAI,UAAYJ,EAChBI,EAAI,UAAU,EACdA,EAAI,IAAIQ,EAAK,CAAC,EAAE,CAAC,EAAE,EAAGA,EAAK,CAAC,EAAE,CAAC,EAAE,EAAG2C,EAASvD,EAAQ,EAAG,EAAG,EAAI,KAAK,EAAE,EACtEI,EAAI,OAAO,GAGbA,EAAI,UAAY,KAAK,KAAK,IAAIM,EAAGG,CAAC,EAClCT,EAAI,UAAU,EACdA,EAAI,IAAIQ,EAAK,CAAC,EAAE,CAAC,EAAE,EAAGA,EAAK,CAAC,EAAE,CAAC,EAAE,EAAG2C,EAAQ,EAAG,EAAI,KAAK,EAAE,EAC1DnD,EAAI,KAAK,CACX,CAEO,MAAM4C,EAAgBpC,EAAiBqC,EAAkB,CAC9D,IAAM/B,EAAKN,EAAK,CAAC,EACXU,EAAI,IAAI4B,EAAMtC,EAAK,CAAC,EAAE,CAAC,EAAE,EAAGA,EAAK,CAAC,EAAE,CAAC,EAAE,CAAC,EACxC2C,EAAS,KAAK,OAAO,IAAIP,EAAO,KAAMC,CAAO,EAC7CG,EAAO,CACX,KAAM9B,EAAE,EAAIiC,EACZ,KAAMjC,EAAE,EAAIiC,EACZ,KAAMjC,EAAE,EAAIiC,EACZ,KAAMjC,EAAE,EAAIiC,CACd,EAKA,MAAO,CAAC,CAAE,OAAQjC,EAAG,OAAQ,CAAC8B,CAAI,EAAG,KAHxBrD,EAACK,GAAkC,CAC9C,KAAK,KAAKA,EAAK,CAAC,CAAC,IAAI8C,EAAM,EAAG,CAAC,CAAC,CAAC,EAAGF,EAAO,KAAMC,CAAO,CAC1D,EAFa,OAG6B,CAAC,CAC7C,CACF,EA7D0ElD,EAAAuD,GAAA,oBAAnE,IAAME,GAANF,GA+DMG,GAAN,MAAMA,EAA4C,CAOvD,YACEnD,EAMA,CACA,KAAK,KAAO,IAAIoD,GAASpD,CAAO,EAChC,KAAK,KAAO,IAAIqD,GAASrD,CAAO,EAChC,KAAK,KAAO,IAAIE,EAAWF,EAAQ,KAAM,OAAO,EAChD,KAAK,WAAa,IAAIE,EAAWF,EAAQ,WAAY,OAAO,EAC5D,KAAK,QAAU,IAAIG,EAAWH,EAAQ,QAAS,CAAC,CAClD,CAEO,MAAM0C,EAAgBpC,EAAiBC,EAAY,CACxD,IAAM+C,EAAW,KAAK,KAAK,IAAIZ,EAAO,KAAMnC,CAAC,EAC7C,GAAI,CAAC+C,EAAU,OACf,IAAMC,EAAO,KAAK,KAAK,IAAIb,EAAO,KAAMnC,CAAC,EACzCmC,EAAO,QAAQ,KAAOa,EACtB,IAAMC,EAAUd,EAAO,QAAQ,YAAYY,CAAQ,EAE7C5D,EAAQ8D,EAAQ,MAChBC,EAASD,EAAQ,wBACjBE,EAAUF,EAAQ,yBAElB5C,EAAKN,EAAK,CAAC,EACXU,EAAI,IAAI4B,EAAMtC,EAAK,CAAC,EAAE,CAAC,EAAE,EAAGA,EAAK,CAAC,EAAE,CAAC,EAAE,CAAC,EACxCK,EAAI,KAAK,QAAQ,IAAI+B,EAAO,KAAMnC,CAAC,EACnCuC,EAAO,CACX,KAAM9B,EAAE,EAAItB,EAAQ,EAAIiB,EACxB,KAAMK,EAAE,EAAIyC,EAAS9C,EACrB,KAAMK,EAAE,EAAItB,EAAQ,EAAIiB,EACxB,KAAMK,EAAE,EAAI0C,EAAU/C,CACxB,EAeA,MAAO,CAAC,CAAE,OAAQK,EAAG,OAAQ,CAAC8B,CAAI,EAAG,KAbxBrD,EAACK,GAAkC,CAC9CA,EAAI,YAAc,EAClBA,EAAI,UAAY,KAAK,WAAW,IAAI4C,EAAO,KAAMnC,CAAC,EAClDT,EAAI,SACF,CAACJ,EAAQ,EAAIiB,EACb,CAAC8C,EAAS9C,EACVjB,EAAQ,EAAIiB,EACZ8C,EAASC,EAAU,EAAI/C,CACzB,EACAb,EAAI,UAAY,KAAK,KAAK,IAAI4C,EAAO,KAAMnC,CAAC,EAC5CT,EAAI,KAAOyD,EACXzD,EAAI,SAASwD,EAAU,CAAC5D,EAAQ,EAAG,CAAC,CACtC,EAZa,OAamC,CAAC,CACnD,CACF,EA1DyDD,EAAA0D,GAAA,oBAAlD,IAAMQ,GAANR,GA6DMS,GAAN,MAAMA,EAA0C,CAGrD,YAAYC,EAAyB,CACnC,KAAK,KAAOA,CACd,CAEO,MAAMnB,EAAgBpC,EAAiBqC,EAAkB,CAC9D,IAAImB,EAAS,KAAK,KAAK,CAAC,EAAE,MAAMpB,EAAQpC,EAAMqC,CAAO,EACrD,GAAI,CAACmB,EAAQ,OACb,IAAIC,EAAQD,EAAO,CAAC,EACdE,EAASD,EAAM,OACjBjB,EAAOiB,EAAM,OAAO,CAAC,EACnBpE,EAASmD,EAAK,KAAOA,EAAK,KAC1BmB,EAAQ,CAAC,CAAE,KAAMF,EAAM,KAAM,UAAW,CAAE,EAAG,EAAG,EAAG,CAAE,CAAE,CAAC,EAExDG,EAAU,CAAC,CAAC,IAAItB,EAAMtC,EAAK,CAAC,EAAE,CAAC,EAAE,EAAGA,EAAK,CAAC,EAAE,CAAC,EAAE,EAAIX,CAAM,CAAC,CAAC,EACjE,QAASuC,EAAI,EAAGA,EAAI,KAAK,KAAK,OAAQA,IACpC4B,EAAS,KAAK,KAAK5B,CAAC,EAAE,MAAMQ,EAAQwB,EAASvB,CAAO,EAChDmB,IACFC,EAAQD,EAAO,CAAC,EAChBhB,EAAOqB,GAAUrB,EAAMiB,EAAM,OAAO,CAAC,CAAC,EACtCE,EAAM,KAAK,CAAE,KAAMF,EAAM,KAAM,UAAW,CAAE,EAAG,EAAG,EAAGpE,CAAO,CAAE,CAAC,GAanE,MAAO,CAAC,CAAE,OAAQqE,EAAQ,OAAQ,CAAClB,CAAI,EAAG,KAT7BrD,EAACK,GAAkC,CAC9C,QAAWsE,KAAOH,EAChBnE,EAAI,KAAK,EACTA,EAAI,UAAUsE,EAAI,UAAU,EAAGA,EAAI,UAAU,CAAC,EAC9CA,EAAI,KAAKtE,CAAG,EACZA,EAAI,QAAQ,CAEhB,EAPa,OASwC,CAAC,CACxD,CACF,EArCuDL,EAAAmE,GAAA,kBAAhD,IAAMS,GAANT,GAuCDO,GAAY1E,EAAA,CAAC6E,EAAUC,KACpB,CACL,KAAM,KAAK,IAAID,EAAG,KAAMC,EAAG,IAAI,EAC/B,KAAM,KAAK,IAAID,EAAG,KAAMC,EAAG,IAAI,EAC/B,KAAM,KAAK,IAAID,EAAG,KAAMC,EAAG,IAAI,EAC/B,KAAM,KAAK,IAAID,EAAG,KAAMC,EAAG,IAAI,CACjC,GANgB,aASLC,GAAN,MAAMA,EAA2C,CAGtD,YAAYX,EAAyB,CACnC,KAAK,KAAOA,CACd,CAEO,MAAMnB,EAAgBpC,EAAiBqC,EAAkB,CAC9D,IAAM8B,EAAQ,KAAK,KAAK,CAAC,EACzB,GAAI,CAACA,EAAO,OACZ,IAAIX,EAASW,EAAM,MAAM/B,EAAQpC,EAAMqC,CAAO,EAC9C,GAAI,CAACmB,EAAQ,OACb,IAAIC,EAAQD,EAAO,CAAC,EACdE,EAASD,EAAM,OACjBjB,EAAOiB,EAAM,OAAO,CAAC,EACnBE,EAAQ,CAACF,EAAM,IAAI,EAEzB,QAAS7B,EAAI,EAAGA,EAAI,KAAK,KAAK,OAAQA,IAAK,CAEzC,GADA4B,EAAS,KAAK,KAAK5B,CAAC,EAAE,MAAMQ,EAAQpC,EAAMqC,CAAO,EAC7C,CAACmB,EAAQ,OACbC,EAAQD,EAAO,CAAC,EAChBhB,EAAOqB,GAAUrB,EAAMiB,EAAM,OAAO,CAAC,CAAC,EACtCE,EAAM,KAAKF,EAAM,IAAI,CACvB,CAOA,MAAO,CAAC,CAAE,OAAQC,EAAQ,OAAQ,CAAClB,CAAI,EAAG,KAN7BrD,EAACK,GAAkC,CAC9C,QAAW,KAAKmE,EACd,EAAEnE,CAAG,CAET,EAJa,OAMwC,CAAC,CACxD,CACF,EAhCwDL,EAAA+E,GAAA,mBAAjD,IAAME,GAANF,GAkCMG,GAAN,MAAMA,EAA8C,CAGzD,YAAYC,EAA6B,CACvC,KAAK,WAAaA,CACpB,CAEO,MAAMlC,EAAgBpC,EAAiBqC,EAAkB,CAC9D,IAAM3B,EAAIV,EAAK,CAAC,EAAE,CAAC,EACbuE,EAAS,KAAK,WAAW,MAAMnC,EAAQ,CAAC,CAAC,IAAIE,EAAM,EAAG,CAAC,CAAC,CAAC,EAAGD,CAAO,EACzE,GAAI,CAACkC,GAAUA,EAAO,SAAW,EAAG,OACpC,IAAMC,EAAaD,EAAO,CAAC,EACrB/B,EAAOgC,EAAW,OAAO,CAAC,EAC1BpF,EAAQoD,EAAK,KAAOA,EAAK,KACzBnD,EAASmD,EAAK,KAAOA,EAAK,KAC1BiC,EAAW,CACf,KAAM/D,EAAE,EAAItB,EAAQ,EACpB,KAAMsB,EAAE,EAAItB,EAAQ,EACpB,KAAMsB,EAAE,EAAIrB,EAAS,EACrB,KAAMqB,EAAE,EAAIrB,EAAS,CACvB,EAOA,MAAO,CAAC,CAAE,OAAQqB,EAAG,OAAQ,CAAC+D,CAAQ,EAAG,KAL5BtF,EAACK,GAAkC,CAC9CA,EAAI,UAAU,CAACJ,EAAQ,EAAGC,EAAS,EAAImD,EAAK,IAAI,EAChDgC,EAAW,KAAKhF,EAAK,CAAE,QAAS,CAAe,CAAC,CAClD,EAHa,OAKuC,CAAC,CACvD,CACF,EA7B2DL,EAAAkF,GAAA,sBAApD,IAAMK,GAANL,GA+BMM,GAAN,MAAMA,EAAmC,CAI9C,YAAYC,EAAiBN,EAA6B,CACxD,KAAK,QAAU,IAAIzE,EAAW+E,EAAS,CAAC,EACxC,KAAK,WAAaN,CACpB,CAEO,MAAMlC,EAAgBpC,EAAiBqC,EAAkB,CAC9D,IAAMkC,EAAS,KAAK,WAAW,MAAMnC,EAAQpC,EAAMqC,CAAO,EAC1D,GAAI,CAACkC,GAAUA,EAAO,SAAW,EAAG,OACpC,IAAMK,EAAU,KAAK,QAAQ,IAAIxC,EAAO,KAAMC,CAAO,EACrD,QAAWoB,KAASc,EAClB,QAAW/B,KAAQiB,EAAM,OACvBjB,EAAK,MAAQoC,EACbpC,EAAK,MAAQoC,EACbpC,EAAK,MAAQoC,EACbpC,EAAK,MAAQoC,EAGjB,OAAOL,CACT,CACF,EAvBgDpF,EAAAwF,GAAA,WAAzC,IAAME,GAANF,GAqCMG,GAAN,MAAMA,EAA0C,CAWrD,YAAYpF,EAAgC,CAC1C,KAAK,KAAO,IAAIoD,GAASpD,CAAO,EAChC,KAAK,KAAO,IAAIqD,GAASrD,CAAO,EAEhC,KAAK,KAAO,IAAIE,EAAWF,EAAQ,KAAM,OAAO,EAChD,KAAK,OAAS,IAAIE,EAAWF,EAAQ,OAAQ,OAAO,EACpD,KAAK,MAAQ,IAAIG,EAAWH,EAAQ,MAAO,CAAC,EAC5C,KAAK,WAAa,IAAIG,EAAWH,EAAQ,WAAY,CAAC,EACtD,KAAK,cAAgB,IAAIG,EAAWH,EAAQ,cAAe,CAAC,EAC5D,KAAK,iBAAmB,IAAIG,EAAWH,EAAQ,aAAc,EAAE,EAC/D,KAAK,QAAUA,EAAQ,OACzB,CAEO,MAAM0C,EAAgBpC,EAAiBqC,EAAkB,CAC9D,IAAMW,EAAW,KAAK,KAAK,IAAIZ,EAAO,KAAMC,CAAO,EACnD,GAAI,CAACW,EAAU,OACf,IAAMC,EAAO,KAAK,KAAK,IAAIb,EAAO,KAAMC,CAAO,EAC/CD,EAAO,QAAQ,KAAOa,EAEtB,IAAM8B,EAAgB,KAAK,cAAc,IAAI3C,EAAO,KAAMC,CAAO,EAG3D2C,EAAQC,GACZjC,EACA,KAAK,iBAAiB,IAAIZ,EAAO,KAAMC,CAAO,CAChD,EACI6C,EAAc,GACdC,EAAiB,EACrB,QAAWC,KAAQJ,EACbI,EAAK,OAASD,IAChBA,EAAiBC,EAAK,OACtBF,EAAcE,GAIlB,IAAMlC,EAAUd,EAAO,QAAQ,YAAY8C,CAAW,EAChD9F,EAAQ8D,EAAQ,MAAQ6B,GAAiBI,EAAiB,GAE1DhC,EAASD,EAAQ,wBACjBE,EAAUF,EAAQ,yBAClBmC,GACHlC,EAASC,GAAW,KAAK,WAAW,IAAIhB,EAAO,KAAMC,CAAO,EAEzD3B,EAAI,IAAI4B,EAAMtC,EAAK,CAAC,EAAE,CAAC,EAAE,EAAGA,EAAK,CAAC,EAAE,CAAC,EAAE,CAAC,EACxCwC,EAAO,CACX,KAAM9B,EAAE,EACR,KAAMA,EAAE,EAAIyC,EACZ,KAAMzC,EAAE,EAAItB,EACZ,KAAMsB,EAAE,EAAI0C,GAAW4B,EAAM,OAAS,GAAKK,CAC7C,EAiDA,MAAO,CAAC,CAAE,OAAQ3E,EAAG,OAAQ,CAAC8B,CAAI,EAAG,KA7CxBrD,EAAA,CAACK,EAA+B8F,IAAsB,CACjE9F,EAAI,YAAc,EAClBA,EAAI,KAAOyD,EACXzD,EAAI,UAAY,KAAK,KAAK,IAAI4C,EAAO,KAAMC,CAAO,EAClD,IAAMkD,EAAkB,KAAK,MAAM,IAAInD,EAAO,KAAMC,CAAO,EAEvDmD,EAAI,EACR,QAAWJ,KAAQJ,EAAO,CACxB,IAAIS,EAAS,EAYb,GAVE,KAAK,UAAY,GAChBH,GAASA,EAAM,UAAY,EAE5BG,GAAUrG,EAAQI,EAAI,YAAY4F,CAAI,EAAE,OAAS,GAEjD,KAAK,UAAY,GAChBE,GAASA,EAAM,UAAY,KAE5BG,EAASrG,EAAQI,EAAI,YAAY4F,CAAI,EAAE,OAErCG,EAGF,GAFA/F,EAAI,UAAY+F,EAAkB,EAClC/F,EAAI,YAAc,KAAK,OAAO,IAAI4C,EAAO,KAAMC,CAAO,EAClD0C,EAAgB,EAAG,CACrB,IAAIW,EAAOD,EACX,QAAWE,KAAUP,EACnB5F,EAAI,WAAWmG,EAAQD,EAAMF,CAAC,EAC9BE,GAAQlG,EAAI,YAAYmG,CAAM,EAAE,MAAQZ,CAE5C,MACEvF,EAAI,WAAW4F,EAAMK,EAAQD,CAAC,EAGlC,GAAIT,EAAgB,EAAG,CACrB,IAAIW,EAAOD,EACX,QAAWE,KAAUP,EACnB5F,EAAI,SAASmG,EAAQD,EAAMF,CAAC,EAC5BE,GAAQlG,EAAI,YAAYmG,CAAM,EAAE,MAAQZ,CAE5C,MACEvF,EAAI,SAAS4F,EAAMK,EAAQD,CAAC,EAE9BA,GAAKH,CACP,CACF,EA5Ca,OA6CmC,CAAC,CACnD,CACF,EA/GuDlG,EAAA2F,GAAA,kBAAhD,IAAMc,GAANd,GAiHMe,GAAN,MAAMA,EAAkD,CAG7D,YAAYnG,EAAgC,CAC1C,KAAK,SAAW,IAAIgF,GAAmB,IAAIkB,GAAelG,CAAO,CAAC,CACpE,CAEO,MAAM0C,EAAgBpC,EAAiBqC,EAAkB,CAC9D,OAAO,KAAK,SAAS,MAAMD,EAAQpC,EAAMqC,CAAO,CAClD,CACF,EAV+DlD,EAAA0G,GAAA,0BAAxD,IAAMC,EAAND,GAgCME,GAAN,MAAMA,EAA4C,CAQvD,YAAYzB,EAA6B5E,EAAkC,CA7xB7E,IAAAC,EAAAqG,EAAAC,EA8xBI,KAAK,WAAa3B,EAClB,KAAK,QAAU,IAAIzE,EAAWH,EAAQ,QAAS,CAAC,EAChD,KAAK,QAAU,IAAIG,EAAWH,EAAQ,QAAS,CAAC,EAChD,KAAK,SAAUC,EAAAD,EAAQ,UAAR,KAAAC,EAAmB,OAClC,KAAK,YAAaqG,EAAAtG,EAAQ,aAAR,KAAAsG,EAAsB,CACtC,EACA,EACA,EACA,EACA,EACA,EACA,EACA,CACF,EACA,KAAK,UACHC,EAAAvG,EAAQ,WAAR,KAAAuG,EACC,KACQ,CAAC,EAEd,CAEO,MAAM7D,EAAgBpC,EAAiBqC,EAAkB,CAC9D,GAAIA,EAAQ,WAAa,EAAgB,OACzC,IAAMqB,EAAS1D,EAAK,CAAC,EAAE,CAAC,EAClBuE,EAAS,KAAK,WAAW,MAAMnC,EAAQ,CAAC,CAAC,IAAIE,EAAM,EAAG,CAAC,CAAC,CAAC,EAAGD,CAAO,EACzE,GAAI,CAACkC,GAAUA,EAAO,SAAW,EAAG,OACpC,IAAMC,EAAaD,EAAO,CAAC,EACrB2B,EAAK1B,EAAW,OAAO,CAAC,EAG1B2B,EAAe,KAAK,QACpBC,EAAe,KAAK,QACpBC,EAAe,KAAK,QACpBC,EAAa,KAAK,WAChB,CACJ,QAASC,EACT,QAASC,EACT,QAASC,EACT,WAAYC,CACd,EAAI,KAAK,SAAStE,EAAO,KAAMC,CAAO,GAAK,CAAC,EACxCkE,IAAWJ,EAAe,IAAItG,EAAW0G,EAAW,CAAC,GACrDC,IAAWJ,EAAe,IAAIvG,EAAW2G,EAAW,CAAC,GACrDC,IAAWJ,EAAeI,GAC1BC,IAAcJ,EAAaI,GAE/B,IAAMC,EAAUR,EAAa,IAAI/D,EAAO,KAAMC,CAAO,EAC/CuE,EAAUR,EAAa,IAAIhE,EAAO,KAAMC,CAAO,EAE/CwE,EAAU1H,EAAA,CAACuB,EAAUoG,KAClB,CACL,KAAMpG,EAAE,EAAIoG,EAAE,EAAIZ,EAAG,KACrB,KAAMxF,EAAE,EAAIoG,EAAE,EAAIZ,EAAG,KACrB,KAAMxF,EAAE,EAAIoG,EAAE,EAAIZ,EAAG,KACrB,KAAMxF,EAAE,EAAIoG,EAAE,EAAIZ,EAAG,IACvB,GANc,WASZa,EAAS,IAAIzE,EAAMqE,EAASC,CAAO,EACnCI,EACEC,EAAO9H,EAACK,GAAkC,CAC9CA,EAAI,UAAUuH,EAAO,EAAGA,EAAO,CAAC,EAChCvC,EAAW,KAAKhF,EAAK,CAAE,QAASwH,CAAQ,CAAC,CAC3C,EAHa,QAKPE,EAAoB/H,EAAA,CAACuB,EAAUoG,IAAa,CAChD,IAAMtE,EAAOqE,EAAQnG,EAAGoG,CAAC,EACzB,GAAI,CAAC1E,EAAO,MAAM,aAAaI,EAAMJ,EAAO,KAAK,EAC/C,MAAO,CAAC,CAAE,OAAQsB,EAAQ,OAAQ,CAAClB,CAAI,EAAG,KAAMyE,CAAK,CAAC,CAC1D,EAJ0B,qBAM1B,QAAWE,KAAab,EAAY,CAClC,IAAMc,EAAc,KAAK,mBAAmBT,EAAST,EAAIiB,CAAS,EAC5DE,EAAc,KAAK,mBAAmBT,EAASV,EAAIiB,CAAS,EAClE,OAAAH,EAAU,KAAK,eAAeX,EAAcc,CAAS,EACrDJ,EAAS,IAAIzE,EAAM8E,EAAaC,CAAW,EACpCH,EAAkBxD,EAAQqD,CAAM,CACzC,CAGF,CAEA,mBAAmBJ,EAAiBT,EAAUiB,EAA2B,CACvE,IAAMG,EAAapB,EAAG,KAChBqB,EAAiBD,EAAa,EACpC,MAAI,CAAC,EAAkB,CAAgB,EAAE,SAASH,CAAS,EAClDR,EAAUY,EAEjB,CAAC,EAAmB,EAAkB,CAAiB,EAAE,SACvDJ,CACF,EAEOR,EAAUW,EACZX,CACT,CAEA,mBAAmBC,EAAiBV,EAAUiB,EAA2B,CACvE,IAAMK,EAAkB,KAAK,IAAItB,EAAG,IAAI,EAClCuB,EAAcvB,EAAG,KACjBwB,GAAqBxB,EAAG,KAAOA,EAAG,MAAQ,EAChD,MAAI,CAAC,EAAkB,CAAgB,EAAE,SAASiB,CAAS,EAClDP,EAAUc,EAEjB,CAAC,EAAmB,EAAmB,CAAgB,EAAE,SACvDP,CACF,EAEOP,EAAUa,EAEjB,CAAC,EAAmB,EAAmB,CAAgB,EAAE,SACvDN,CACF,EAEOP,EAAUY,EACZZ,CACT,CAEA,eAAee,EAAmCR,EAA2B,CAC3E,OAAIQ,IACA,CAAC,EAAkB,CAAgB,EAAE,SAASR,CAAS,EAClD,EAEP,CAAC,EAAmB,EAAkB,CAAiB,EAAE,SACvDA,CACF,EAEO,EACF,EACT,CACF,EAzIyDhI,EAAA4G,GAAA,oBAAlD,IAAM6B,GAAN7B,GA2IM8B,GAAN,MAAMA,EAAgD,CAG3D,YAAYnI,EAA0D,CACpE,KAAK,WAAa,IAAIkI,GACpB,IAAIhC,GAAelG,CAAO,EAC1BA,CACF,CACF,CAEO,MAAM0C,EAAgBpC,EAAiBqC,EAAkB,CAC9D,OAAO,KAAK,WAAW,MAAMD,EAAQpC,EAAMqC,CAAO,CACpD,CACF,EAb6DlD,EAAA0I,GAAA,wBAAtD,IAAMC,GAAND,GAeKE,QACVA,IAAA,MAAQ,GAAR,QACAA,IAAA,OAAS,GAAT,SACAA,IAAA,MAAQ,GAAR,QAHUA,QAAA,IAMCC,GAAN,MAAMA,EAA+C,CAY1D,YACEtI,EAWA,CA78BJ,IAAAC,EA88BI,KAAK,KAAO,IAAImD,GAASpD,CAAO,EAChC,KAAK,KAAO,IAAIqD,GAASrD,CAAO,EAEhC,KAAK,KAAO,IAAIE,EAAWF,EAAQ,KAAM,OAAO,EAChD,KAAK,OAAS,IAAIE,EAAWF,EAAQ,OAAQ,OAAO,EACpD,KAAK,MAAQ,IAAIG,EAAWH,EAAQ,MAAO,CAAC,EAC5C,KAAK,OAAS,IAAIG,EAAWH,EAAQ,OAAQ,CAAC,EAC9C,KAAK,UAAWC,EAAAD,EAAQ,WAAR,KAAAC,EAAoB,EACpC,KAAK,kBAAoB,IAAIE,EAAWH,EAAQ,cAAe,EAAE,EACjE,KAAK,eAAiB,IAAIG,EAAWH,EAAQ,eAAgB,GAAG,CAClE,CAEO,MAAM0C,EAAgBpC,EAAiBqC,EAAkB,CAC9D,IAAM4F,EAAO,KAAK,KAAK,IAAI7F,EAAO,KAAMC,CAAO,EAE/C,GADI,CAAC4F,GACDA,EAAK,OAAS,KAAK,kBAAkB,IAAI7F,EAAO,KAAMC,CAAO,EAC/D,OAEF,IAAM6F,EAAkB,GAClBC,EAAQ9F,EAAQ,KACtB,GACE8F,EAAM,KAAOA,EAAM,KAAOD,GAC1BC,EAAM,KAAOA,EAAM,KAAOD,EAE1B,OAEF,IAAMjF,EAAO,KAAK,KAAK,IAAIb,EAAO,KAAMC,CAAO,EAC/CD,EAAO,QAAQ,KAAOa,EACtB,IAAMC,EAAUd,EAAO,QAAQ,YAAY6F,CAAI,EACzC7I,EAAQ8D,EAAQ,MAChB7D,EACJ6D,EAAQ,wBAA0BA,EAAQ,yBAExCkF,EAAiB,KAAK,eAAe,IAAIhG,EAAO,KAAMC,CAAO,EAC7DD,EAAO,SAAW,IAAGgG,GAAkB,GAAMhG,EAAO,SAAW,GAEnE,IAAMiG,EAAWhJ,EAAS,EAEpBiJ,EAAkBC,GAAYvI,EAAMZ,EAAOgJ,EAAgBC,CAAQ,EACzE,GAAIC,EAAgB,SAAW,EAAG,OAElC,IAAM9E,EAAS,CAAC,EAChB,QAAWgF,KAAaF,EAAiB,CACvC,IAAMG,EAAKD,EAAU,IAAI,EAAIA,EAAU,MAAM,EACvCE,EAAKF,EAAU,IAAI,EAAIA,EAAU,MAAM,EAQvCG,EANQC,GACZJ,EAAU,MACVA,EAAU,IACVpJ,EACAiJ,EAAW,CACb,EACqB,IAAKQ,IACjB,CACL,KAAMA,EAAE,EAAIR,EAAW,EACvB,KAAMQ,EAAE,EAAIR,EAAW,EACvB,KAAMQ,EAAE,EAAIR,EAAW,EACvB,KAAMQ,EAAE,EAAIR,EAAW,CACzB,EACD,EAEKpB,EAAO9H,EAACK,GAAkC,CAC9CA,EAAI,YAAc,EAMlBA,EAAI,OAAO,KAAK,MAAMkJ,EAAID,CAAE,CAAC,EACzBA,EAAK,IACPjJ,EAAI,MAAM,GAAI,EAAE,EAChBA,EAAI,UAAU,CAACJ,EAAO,CAAC,GAEzB,IAAI0J,EAAkB,EAClB,KAAK,WAAa,EACpBA,GAAmBzJ,EACZ,KAAK,WAAa,IACzByJ,GAAmBzJ,EAAS,GAC9BG,EAAI,UACF,EACAsJ,EAAkB,KAAK,OAAO,IAAI1G,EAAO,KAAMC,CAAO,CACxD,EACA7C,EAAI,KAAOyD,EACX,IAAM8F,EAAY,KAAK,MAAM,IAAI3G,EAAO,KAAMC,CAAO,EACjD0G,IACFvJ,EAAI,UAAYuJ,EAChBvJ,EAAI,YAAc,KAAK,OAAO,IAAI4C,EAAO,KAAMC,CAAO,EACtD7C,EAAI,WAAWyI,EAAM,EAAG,CAAC,GAE3BzI,EAAI,UAAY,KAAK,KAAK,IAAI4C,EAAO,KAAMC,CAAO,EAClD7C,EAAI,SAASyI,EAAM,EAAG,CAAC,CACzB,EA9Ba,QA+BbzE,EAAO,KAAK,CACV,OAAQgF,EAAU,MAClB,OAAQG,EACR,KAAM1B,EACN,iBAAkBgB,EAClB,sBAAuBG,CACzB,CAAC,CACH,CAEA,OAAO5E,CACT,CACF,EAhI4DrE,EAAA6I,GAAA,uBAArD,IAAMgB,EAANhB,GCp6BP,IAAMiB,EAAYC,EAAA,CAACC,EAAmBC,IAAwB,CAC5D,IAAMC,EAAMF,EAAMC,CAAG,EACrB,OAAI,OAAOC,GAAQ,SAAiBA,EAC7B,EACT,EAJkB,aAMZC,GAAYJ,EAAA,CAACC,EAAmBC,IAAwB,CAC5D,IAAMC,EAAMF,EAAMC,CAAG,EACrB,OAAI,OAAOC,GAAQ,SAAiBA,EAC7B,CACT,EAJkB,aAMLE,GAAaL,EAACM,GAClB,CACL,CACE,UAAW,QACX,WAAY,IAAIC,EAAkB,CAChC,KAAMD,EAAE,KACV,CAAC,CACH,EACA,CACE,UAAW,UACX,WAAY,IAAIC,EAAkB,CAChC,KAAMP,EAAA,CAACQ,EAAGC,IACDC,GAAIJ,EAAE,OAAQA,EAAE,OAAQ,KAAK,IAAI,KAAK,IAAIE,EAAI,GAAM,EAAE,EAAG,CAAC,CAAC,EAD9D,OAGR,CAAC,EACD,OAAQR,EAAA,CAACQ,EAAGC,IAAM,CAChB,IAAME,EAAOZ,EAAUU,EAAE,MAAO,WAAW,EAC3C,MAAO,CAAC,aAAc,gBAAiB,YAAY,EAAE,SAASE,CAAI,CACpE,EAHQ,SAIV,EACA,CAEE,UAAW,UACX,WAAY,IAAIJ,EAAkB,CAChC,KAAMD,EAAE,OACR,QAAS,EACX,CAAC,EACD,OAAQN,EAAA,CAACQ,EAAGC,IAAM,CAChB,IAAME,EAAOZ,EAAUU,EAAE,MAAO,WAAW,EAC3C,MAAO,CACL,gBACA,OACA,WACA,iBACA,iBACA,SACA,aACF,EAAE,SAASE,CAAI,CACjB,EAXQ,SAYV,EACA,CACE,UAAW,UACX,WAAY,IAAIJ,EAAkB,CAChC,KAAMD,EAAE,QACV,CAAC,EACD,OAAQN,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,WAD1B,SAGV,EACA,CACE,UAAW,UACX,WAAY,IAAIF,EAAkB,CAChC,KAAMD,EAAE,UACV,CAAC,EACD,OAAQN,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,aAD1B,SAGV,EACA,CACE,UAAW,UACX,WAAY,IAAIF,EAAkB,CAChC,KAAMD,EAAE,MACV,CAAC,EACD,OAAQN,EAAA,CAACQ,EAAGC,IAAM,CAChB,IAAME,EAAOZ,EAAUU,EAAE,MAAO,WAAW,EAC3C,MAAO,CAAC,SAAU,aAAc,SAAS,EAAE,SAASE,CAAI,CAC1D,EAHQ,SAIV,EACA,CACE,UAAW,UACX,WAAY,IAAIJ,EAAkB,CAChC,KAAMD,EAAE,KACV,CAAC,EACD,OAAQN,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,QAD1B,SAGV,EACA,CACE,UAAW,UACX,WAAY,IAAIF,EAAkB,CAChC,KAAMD,EAAE,GACV,CAAC,EACD,OAAQN,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,MAD1B,SAGV,EACA,CACE,UAAW,UACX,WAAY,IAAIF,EAAkB,CAChC,KAAMD,EAAE,GACV,CAAC,EACD,OAAQN,EAAA,CAACQ,EAAGC,IAAM,CAChB,IAAME,EAAOZ,EAAUU,EAAE,MAAO,WAAW,EAC3C,MAAO,CAAC,WAAY,aAAc,UAAU,EAAE,SAASE,CAAI,CAC7D,EAHQ,SAIV,EACA,CACE,UAAW,UACX,WAAY,IAAIJ,EAAkB,CAChC,KAAMP,EAAA,CAACQ,EAAGC,IACDC,GAAIJ,EAAE,OAAQA,EAAE,OAAQ,KAAK,IAAI,KAAK,IAAIE,EAAI,GAAM,EAAE,EAAG,CAAC,CAAC,EAD9D,OAGR,CAAC,EACD,OAAQR,EAAA,CAACQ,EAAGC,IAAM,CAChB,IAAME,EAAOZ,EAAUU,EAAE,MAAO,WAAW,EAC3C,MAAO,CAAC,OAAQ,iBAAkB,QAAQ,EAAE,SAASE,CAAI,CAC3D,EAHQ,SAIV,EACA,CACE,UAAW,UACX,WAAY,IAAIJ,EAAkB,CAChC,KAAMP,EAAA,CAACQ,EAAGC,IACDC,GAAIJ,EAAE,QAASA,EAAE,QAAS,KAAK,IAAI,KAAK,IAAIE,EAAI,GAAM,EAAE,EAAG,CAAC,CAAC,EADhE,OAGR,CAAC,EACD,OAAQR,EAAA,CAACQ,EAAGC,IAAM,CAChB,IAAME,EAAOZ,EAAUU,EAAE,MAAO,WAAW,EAC3C,MAAO,CAAC,QAAS,YAAa,OAAO,EAAE,SAASE,CAAI,CACtD,EAHQ,SAIV,EACA,CACE,UAAW,UACX,WAAY,IAAIJ,EAAkB,CAChC,KAAMD,EAAE,OACV,CAAC,EACD,OAAQN,EAAA,CAACQ,EAAGC,IAAM,CAChB,IAAME,EAAOZ,EAAUU,EAAE,MAAO,WAAW,EAC3C,MAAO,CAAC,QAAS,YAAa,OAAO,EAAE,SAASE,CAAI,CACtD,EAHQ,SAIV,EACA,CACE,UAAW,UACX,WAAY,IAAIJ,EAAkB,CAChC,KAAMD,EAAE,OACV,CAAC,EACD,OAAQN,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,UAD1B,SAGV,EACA,CACE,UAAW,UACX,WAAY,IAAIF,EAAkB,CAChC,KAAMD,EAAE,IACV,CAAC,EACD,OAAQN,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,OAD1B,SAGV,EACA,CACE,UAAW,UACX,WAAY,IAAIF,EAAkB,CAChC,KAAMD,EAAE,SACV,CAAC,EACD,OAAQN,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,YAD1B,SAGV,EACA,CACE,UAAW,QACX,WAAY,IAAIF,EAAkB,CAChC,KAAMD,EAAE,KACV,CAAC,CACH,EACA,CAEE,UAAW,UACX,WAAY,IAAIM,EAAe,CAC7B,MAAON,EAAE,OACT,MAAON,EAAA,CAACQ,EAAGC,IACFI,EAAI,IAAK,CACd,CAAC,GAAI,CAAC,EACN,CAAC,GAAI,CAAC,EACN,CAAC,GAAI,EAAE,CACT,CAAC,EAAEL,CAAC,EALC,QAOT,CAAC,EACD,OAAQR,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,kBAAkB,IAAM,SADjC,SAGV,EACA,CAEE,UAAW,UACX,WAAY,IAAIG,EAAe,CAC7B,MAAON,EAAE,OACT,MAAON,EAAA,CAACQ,EAAGC,IACFI,EAAI,IAAK,CACd,CAAC,GAAI,CAAC,EACN,CAAC,KAAM,CAAC,EACR,CAAC,GAAI,CAAC,CACR,CAAC,EAAEL,CAAC,EALC,QAOT,CAAC,EACD,OAAQR,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,kBAAkB,IAAM,UADjC,SAGV,EACA,CAEE,UAAW,UACX,WAAY,IAAIG,EAAe,CAC7B,MAAON,EAAE,KACT,MAAON,EAAA,CAACQ,EAAGC,IACFI,EAAI,IAAK,CACd,CAAC,GAAI,CAAC,EACN,CAAC,KAAM,EAAG,CAAC,EACX,CAAC,GAAI,EAAE,CACT,CAAC,EAAEL,CAAC,EALC,QAOT,CAAC,EACD,OAAQR,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,OAD1B,SAGV,EACA,CAEE,UAAW,gBACX,QAAS,GACT,WAAY,IAAIG,EAAe,CAC7B,MAAON,EAAE,MACT,MAAON,EAAA,CAACQ,EAAGC,IACFI,EAAI,IAAK,CACd,CAAC,EAAG,CAAC,EACL,CAAC,IAAK,CAAG,EACT,CAAC,GAAI,EAAE,CACT,CAAC,EAAEL,CAAC,EALC,QAOT,CAAC,EACD,OAAQR,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,QAD1B,SAGV,EACA,CAEE,UAAW,gBACX,QAAS,GACT,WAAY,IAAIG,EAAe,CAC7B,MAAON,EAAE,MACT,MAAO,EACT,CAAC,EACD,OAAQN,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,SAD1B,SAGV,EACA,CACE,UAAW,UACX,WAAY,IAAIF,EAAkB,CAChC,KAAMD,EAAE,UACV,CAAC,EACD,OAAQN,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,aAD1B,SAGV,EACA,CACE,UAAW,UACX,WAAY,IAAIF,EAAkB,CAChC,KAAMD,EAAE,IACV,CAAC,EACD,OAAQN,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,OAD1B,SAGV,EACA,CACE,UAAW,YACX,WAAY,IAAIF,EAAkB,CAChC,KAAMD,EAAE,UACR,QAAS,EACX,CAAC,CACH,EACA,CACE,UAAW,QACX,WAAY,IAAIM,EAAe,CAC7B,MAAON,EAAE,MACT,MAAON,EAAA,CAACQ,EAAGC,IACFI,EAAI,IAAK,CACd,CAAC,GAAI,CAAC,EACN,CAAC,GAAI,CAAC,CACR,CAAC,EAAEL,CAAC,EAJC,QAMT,CAAC,EACD,OAAQR,EAAA,CAACQ,EAAGC,IAAM,CAChB,IAAME,EAAOZ,EAAUU,EAAE,MAAO,WAAW,EAC3C,MAAO,CAAC,QAAS,MAAM,EAAE,SAASE,CAAI,CACxC,EAHQ,SAIV,EACA,CACE,UAAW,QACX,WAAY,IAAIC,EAAe,CAC7B,MAAON,EAAE,MACT,MAAON,EAAA,CAACQ,EAAGC,IACFI,EAAI,IAAK,CACd,CAAC,GAAI,CAAC,EACN,CAAC,GAAI,CAAC,CACR,CAAC,EAAEL,CAAC,EAJC,QAMT,CAAC,EACD,OAAQR,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,aAD1B,SAGV,EACA,CACE,UAAW,QACX,WAAY,IAAIG,EAAe,CAC7B,MAAON,EAAE,MACT,MAAON,EAAA,CAACQ,EAAGC,IACFI,EAAI,IAAK,CACd,CAAC,EAAG,CAAC,EACL,CAAC,GAAI,GAAG,EACR,CAAC,GAAI,CAAC,EACN,CAAC,GAAI,EAAE,CACT,CAAC,EAAEL,CAAC,EANC,QAQT,CAAC,EACD,OAAQR,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,cAD1B,SAGV,EACA,CACE,UAAW,QACX,WAAY,IAAIG,EAAe,CAC7B,MAAON,EAAE,MACT,MAAON,EAAA,CAACQ,EAAGC,IACFI,EAAI,IAAK,CACd,CAAC,EAAG,CAAC,EACL,CAAC,GAAI,GAAG,EACR,CAAC,GAAI,CAAC,EACN,CAAC,GAAI,EAAE,CACT,CAAC,EAAEL,CAAC,EANC,QAQT,CAAC,EACD,OAAQR,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,aAD1B,SAGV,EACA,CACE,UAAW,QACX,WAAY,IAAIG,EAAe,CAC7B,MAAON,EAAE,MACT,MAAON,EAAA,CAACQ,EAAGC,IACFI,EAAI,IAAK,CACd,CAAC,EAAG,CAAC,EACL,CAAC,EAAG,GAAG,EACP,CAAC,GAAI,GAAG,EACR,CAAC,GAAI,CAAC,EACN,CAAC,GAAI,EAAE,CACT,CAAC,EAAEL,CAAC,EAPC,QAST,CAAC,EACD,OAAQR,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,UAD1B,SAGV,EACA,CACE,UAAW,aACX,WAAY,IAAIG,EAAe,CAC7B,KAAM,CAAC,EAAG,CAAC,EACX,MAAON,EAAE,WACT,MAAO,CACT,CAAC,EACD,OAAQN,EAAA,CAACQ,EAAGC,IAAM,CAChB,IAAMK,EAAgBL,EAAE,MAAM,sBAAsB,EACpD,OAAO,OAAOK,GAAkB,UAAYA,GAAiB,CAC/D,EAHQ,SAIV,EACA,CACE,UAAW,UACX,WAAY,IAAIF,EAAe,CAC7B,KAAM,CAAC,GAAK,GAAI,EAChB,MAAON,EAAE,QACT,UAAWN,EAAA,CAACQ,EAAGC,IACNI,EAAI,IAAK,CACd,CAAC,EAAG,CAAC,EACL,CAAC,EAAG,GAAI,EACR,CAAC,GAAI,CAAC,CACR,CAAC,EAAEL,CAAC,EALK,aAOX,QAAS,EACX,CAAC,EACD,OAAQR,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,OAD1B,SAGV,EACA,CACE,UAAW,aACX,WAAY,IAAIG,EAAe,CAC7B,KAAM,CAAC,EAAG,CAAC,EACX,MAAON,EAAE,WACT,MAAO,EACT,CAAC,EACD,OAAQN,EAAA,CAACQ,EAAGC,IAAM,CAChB,IAAMK,EAAgBL,EAAE,MAAM,sBAAsB,EACpD,OAAO,OAAOK,GAAkB,UAAYA,EAAgB,CAC9D,EAHQ,SAIV,CACF,EA1YwB,cA6YbC,GAAaf,EAACM,GAA0B,CACnD,IAAMU,EAAW,CAAC,MAAM,EAExB,MAAO,CAiBL,CACE,UAAW,QACX,WAAY,IAAIC,EAAoB,CAClC,WAAYD,EACZ,KAAMV,EAAE,kBACR,KAAM,sBACN,MAAO,EACP,OAAQA,EAAE,sBACZ,CAAC,EAED,QAAS,GACT,OAAQN,EAAA,CAACQ,EAAGC,IAAM,CAChB,IAAME,EAAOZ,EAAUU,EAAE,MAAO,WAAW,EAC3C,MAAO,CAAC,aAAc,QAAS,MAAM,EAAE,SAASE,CAAI,CACtD,EAHQ,SAIV,EACA,CACE,UAAW,QACX,WAAY,IAAIM,EAAoB,CAClC,WAAYD,EACZ,KAAMV,EAAE,kBACR,KAAM,sBACN,MAAO,EACP,OAAQA,EAAE,sBACZ,CAAC,EAED,QAAS,GACT,OAAQN,EAAA,CAACQ,EAAGC,IAAM,CAChB,IAAME,EAAOZ,EAAUU,EAAE,MAAO,WAAW,EAC3C,MAAO,CAAC,UAAW,aAAc,aAAa,EAAE,SAASE,CAAI,CAC/D,EAHQ,SAIV,EACA,CACE,UAAW,QACX,WAAY,IAAIM,EAAoB,CAClC,WAAYD,EACZ,KAAMV,EAAE,kBACR,KAAM,sBACN,MAAO,EACP,OAAQA,EAAE,sBACZ,CAAC,EAED,QAAS,GACT,OAAQN,EAAA,CAACQ,EAAGC,IAAM,CAChB,IAAME,EAAOZ,EAAUU,EAAE,MAAO,WAAW,EAC3C,MAAO,CAAC,UAAW,aAAc,aAAa,EAAE,SAASE,CAAI,CAC/D,EAHQ,SAIV,EACA,CACE,UAAW,iBACX,WAAY,IAAIO,EAAuB,CACrC,WAAYF,EACZ,KAAMV,EAAE,YACR,WAAY,IACZ,cAAe,EACf,KAAMN,EAAA,CAACQ,EAAGC,IAKD,OAJMU,GAAO,CAClB,CAAC,EAAG,EAAE,EACN,CAAC,GAAI,EAAE,CACT,CAAC,EAAEX,CAAC,CACc,gBALd,QAON,cAAe,WACjB,CAAC,EACD,OAAQR,EAAA,CAACQ,EAAGC,IAAM,CAChB,IAAME,EAAOZ,EAAUU,EAAE,MAAO,WAAW,EAC3C,MAAO,CAAC,QAAS,MAAO,SAAU,OAAO,EAAE,SAASE,CAAI,CAC1D,EAHQ,SAIV,EACA,CACE,UAAW,iBACX,WAAY,IAAIO,EAAuB,CACrC,WAAYF,EACZ,KAAMV,EAAE,YACR,WAAY,IACZ,cAAe,EACf,KAAMN,EAAA,CAACQ,EAAGC,IAMD,OALMU,GAAO,CAClB,CAAC,EAAG,CAAC,EACL,CAAC,EAAG,EAAE,EACN,CAAC,GAAI,EAAE,CACT,CAAC,EAAEX,CAAC,CACc,gBANd,OAQR,CAAC,EACD,OAAQR,EAAA,CAACQ,EAAGC,IAAM,CAChB,IAAME,EAAOZ,EAAUU,EAAE,MAAO,WAAW,EAC3C,MAAO,CAAC,MAAO,OAAQ,OAAO,EAAE,SAASE,CAAI,CAC/C,EAHQ,SAIV,EACA,CACE,UAAW,SACX,WAAY,IAAIO,EAAuB,CACrC,WAAYlB,EAAA,CAACQ,EAAGC,IACVD,EAAI,EACC,CAAC,YAAY,EAEfQ,EAJG,cAMZ,KAAMV,EAAE,YACR,OAAQA,EAAE,iBACV,MAAO,EACP,WAAY,IACZ,KAAMN,EAAA,CAACQ,EAAWC,IACZD,EAAI,EAAU,sBACX,sBAFH,QAIN,cAAe,WACjB,CAAC,EACD,OAAQR,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,SAD1B,SAGV,EACA,CACE,UAAW,SACX,WAAY,IAAIS,EAAuB,CACrC,WAAYF,EACZ,KAAMV,EAAE,cACR,WAAY,IACZ,KAAMN,EAAA,CAACQ,EAAWC,KACZD,EAAI,EAAU,uBADd,QAIN,cAAe,WACjB,CAAC,EACD,OAAQR,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,UAD1B,SAGV,EACA,CAEE,UAAW,SACX,QAAS,EACT,WAAY,IAAIS,EAAuB,CACrC,WAAYF,EACZ,KAAMV,EAAE,WACR,WAAY,IACZ,KAAMN,EAAA,CAACQ,EAAWC,IAAgB,CAChC,GAAI,CAACA,EAAG,MAAO,sBACf,IAAMW,EAAUX,EAAE,MAAM,eAAe,EACnCY,EAAS,IACTD,GAAWA,GAAW,IACxBC,EAAS,KAEX,IAAIC,EAAO,GACLC,EAAUd,EAAE,MAAM,sBAAsB,EAC9C,OAAIc,GAAWA,EAAU,IACvBD,EAAO,IAEF,GAAGD,CAAM,IAAIC,CAAI,eAC1B,EAbM,OAcR,CAAC,EACD,KAAMtB,EAAA,CAACwB,EAAGC,IAAM,CACd,IAAMC,EAAQtB,GAAUoB,EAAG,sBAAsB,EAC3CG,EAAQvB,GAAUqB,EAAG,sBAAsB,EACjD,OAAOC,EAAQC,CACjB,EAJM,QAKN,OAAQ3B,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,WAD1B,SAGV,EACA,CACE,UAAW,SACX,QAAS,EACT,WAAY,IAAImB,GAAgB,CAC9B,IAAIC,GAAiB,CACnB,OAAQ,EACR,KAAMvB,EAAE,YACR,OAAQA,EAAE,mBACV,MAAO,GACT,CAAC,EACD,IAAIwB,GAAqB,CACvB,WAAYd,EACZ,KAAMV,EAAE,WACR,OAAQA,EAAE,gBACV,MAAO,EACP,QAAS,EACT,QAAS,IACT,KAAMN,EAAA,CAACQ,EAAGC,IACD,sBADH,OAGR,CAAC,CACH,CAAC,EACD,OAAQT,EAAA,CAACQ,EAAGC,IACHA,EAAE,MAAM,WAAW,IAAM,WAD1B,SAGV,CACF,CACF,EAhN0B,cChVnB,IAAMsB,GAAe,CAC1B,WAAY,UACZ,MAAO,UACP,OAAQ,UACR,OAAQ,UACR,SAAU,UACV,WAAY,UACZ,OAAQ,UACR,OAAQ,UACR,OAAQ,UACR,WAAY,UACZ,QAAS,UACT,QAAS,UACT,QAAS,UACT,KAAM,UACN,MAAO,UACP,UAAW,UACX,OAAQ,UACR,MAAO,UACP,KAAM,UACN,IAAK,UACL,SAAU,UAEV,oBAAqB,UACrB,oBAAqB,UACrB,mBAAoB,UACpB,qBAAsB,UACtB,oBAAqB,UACrB,sBAAuB,UACvB,aAAc,UACd,aAAc,UACd,YAAa,UACb,cAAe,UACf,aAAc,UACd,eAAgB,UAEhB,aAAc,UACd,UAAW,UAEX,qBAAsB,UACtB,aAAc,UACd,YAAa,UACb,cAAe,UACf,kBAAmB,UACnB,oBAAqB,UACrB,MAAO,UACP,cAAe,UACf,QAAS,UACT,QAAS,UACT,KAAM,UACN,OAAQ,UACR,mBAAoB,UACpB,MAAO,UACP,qBAAsB,UACtB,QAAS,UAET,QAAS,UACT,WAAY,UACZ,eAAgB,UAEhB,qBAAsB,UACtB,qBAAsB,UACtB,oBAAqB,UACrB,sBAAuB,UACvB,qBAAsB,UACtB,uBAAwB,UACxB,cAAe,UACf,cAAe,UACf,aAAc,UACd,eAAgB,UAChB,cAAe,UACf,gBAAiB,UAEjB,kBAAmB,UACnB,uBAAwB,UACxB,kBAAmB,UACnB,uBAAwB,UACxB,YAAa,UACb,WAAY,UACZ,eAAgB,UAChB,oBAAqB,UACrB,YAAa,UACb,mBAAoB,UACpB,WAAY,UACZ,gBAAiB,UACjB,YAAa,UACb,iBAAkB,UAClB,cAAe,SACjB,EAEaC,GAAc,CACzB,WAAY,UACZ,MAAO,UACP,OAAQ,UACR,OAAQ,UACR,SAAU,UACV,WAAY,UACZ,OAAQ,UACR,OAAQ,UACR,OAAQ,UACR,WAAY,UACZ,QAAS,UACT,QAAS,UACT,QAAS,UACT,KAAM,UACN,MAAO,UACP,UAAW,UACX,OAAQ,UACR,MAAO,UACP,KAAM,UACN,IAAK,UACL,SAAU,UAEV,oBAAqB,UACrB,oBAAqB,UACrB,mBAAoB,UACpB,qBAAsB,UACtB,oBAAqB,UACrB,sBAAuB,UACvB,aAAc,UACd,aAAc,UACd,YAAa,UACb,cAAe,UACf,aAAc,UACd,eAAgB,UAEhB,aAAc,UACd,UAAW,UAEX,qBAAsB,UACtB,aAAc,UACd,YAAa,UACb,cAAe,UACf,kBAAmB,UACnB,oBAAqB,UACrB,MAAO,UACP,cAAe,UACf,QAAS,UACT,QAAS,UACT,KAAM,UACN,OAAQ,UACR,mBAAoB,UACpB,MAAO,UACP,qBAAsB,UACtB,QAAS,UAET,QAAS,UACT,WAAY,UACZ,eAAgB,UAEhB,qBAAsB,UACtB,qBAAsB,UACtB,oBAAqB,UACrB,sBAAuB,UACvB,qBAAsB,UACtB,uBAAwB,UACxB,cAAe,UACf,cAAe,UACf,aAAc,UACd,eAAgB,UAChB,cAAe,UACf,gBAAiB,UAEjB,kBAAmB,UACnB,uBAAwB,UACxB,kBAAmB,UACnB,uBAAwB,UACxB,YAAa,UACb,WAAY,UACZ,eAAgB,UAChB,oBAAqB,UACrB,YAAa,UACb,mBAAoB,UACpB,WAAY,UACZ,gBAAiB,UACjB,YAAa,UACb,iBAAkB,UAClB,cAAe,SACjB,EAEaC,GAAe,CAC1B,WAAY,UACZ,MAAO,UACP,OAAQ,UACR,OAAQ,UACR,SAAU,UACV,WAAY,UACZ,OAAQ,UACR,OAAQ,UACR,OAAQ,UACR,WAAY,UACZ,QAAS,UACT,QAAS,UACT,QAAS,UACT,KAAM,UACN,MAAO,UACP,UAAW,UACX,OAAQ,UACR,MAAO,UACP,KAAM,UACN,IAAK,UACL,SAAU,UAEV,oBAAqB,UACrB,oBAAqB,UACrB,mBAAoB,UACpB,qBAAsB,UACtB,oBAAqB,UACrB,sBAAuB,UACvB,aAAc,UACd,aAAc,UACd,YAAa,UACb,cAAe,UACf,aAAc,UACd,eAAgB,UAEhB,aAAc,UACd,UAAW,UAEX,qBAAsB,UACtB,aAAc,UACd,YAAa,UACb,cAAe,UACf,kBAAmB,UACnB,oBAAqB,UACrB,MAAO,UACP,cAAe,UACf,QAAS,UACT,QAAS,UACT,KAAM,UACN,OAAQ,UACR,mBAAoB,UACpB,MAAO,UACP,qBAAsB,UACtB,QAAS,UAET,QAAS,UACT,WAAY,UACZ,eAAgB,UAEhB,qBAAsB,UACtB,qBAAsB,UACtB,oBAAqB,UACrB,sBAAuB,UACvB,qBAAsB,UACtB,uBAAwB,UACxB,cAAe,UACf,cAAe,UACf,aAAc,UACd,eAAgB,UAChB,cAAe,UACf,gBAAiB,UAEjB,kBAAmB,UACnB,uBAAwB,UACxB,kBAAmB,UACnB,uBAAwB,UACxB,YAAa,UACb,WAAY,UACZ,eAAgB,UAChB,oBAAqB,UACrB,YAAa,UACb,mBAAoB,UACpB,WAAY,UACZ,gBAAiB,UACjB,YAAa,UACb,iBAAkB,UAClB,cAAe,SACjB,EAEaC,GAAmB,CAC9B,WAAY,UACZ,MAAO,UACP,OAAQ,UACR,OAAQ,UACR,SAAU,UACV,WAAY,UACZ,OAAQ,UACR,OAAQ,UACR,OAAQ,UACR,WAAY,UACZ,QAAS,UACT,QAAS,UACT,QAAS,UACT,KAAM,UACN,MAAO,UACP,UAAW,UACX,OAAQ,UACR,MAAO,UACP,KAAM,UACN,IAAK,UACL,SAAU,UAEV,oBAAqB,UACrB,oBAAqB,UACrB,mBAAoB,UACpB,qBAAsB,UACtB,oBAAqB,UACrB,sBAAuB,UACvB,aAAc,UACd,aAAc,UACd,YAAa,UACb,cAAe,UACf,aAAc,UACd,eAAgB,UAEhB,aAAc,UACd,UAAW,UAEX,qBAAsB,UACtB,aAAc,UACd,YAAa,UACb,cAAe,UACf,kBAAmB,UACnB,oBAAqB,UACrB,MAAO,UACP,cAAe,UACf,QAAS,UACT,QAAS,UACT,KAAM,UACN,OAAQ,UACR,mBAAoB,UACpB,MAAO,UACP,qBAAsB,UACtB,QAAS,UAET,QAAS,UACT,WAAY,UACZ,eAAgB,UAEhB,qBAAsB,UACtB,qBAAsB,UACtB,oBAAqB,UACrB,sBAAuB,UACvB,qBAAsB,UACtB,uBAAwB,UACxB,cAAe,UACf,cAAe,UACf,aAAc,UACd,eAAgB,UAChB,cAAe,UACf,gBAAiB,UAEjB,kBAAmB,UACnB,uBAAwB,UACxB,kBAAmB,UACnB,uBAAwB,UACxB,YAAa,UACb,WAAY,UACZ,eAAgB,UAChB,oBAAqB,UACrB,YAAa,UACb,mBAAoB,UACpB,WAAY,UACZ,gBAAiB,UACjB,YAAa,UACb,iBAAkB,UAClB,cAAe,SACjB,EAEaC,GAAe,CAC1B,WAAY,UACZ,MAAO,UACP,OAAQ,UACR,OAAQ,UACR,SAAU,UACV,WAAY,UACZ,OAAQ,UACR,OAAQ,UACR,OAAQ,UACR,WAAY,UACZ,QAAS,UACT,QAAS,UACT,QAAS,UACT,KAAM,UACN,MAAO,UACP,UAAW,UACX,OAAQ,UACR,MAAO,UACP,KAAM,UACN,IAAK,UACL,SAAU,UAEV,oBAAqB,UACrB,oBAAqB,UACrB,mBAAoB,UACpB,qBAAsB,UACtB,oBAAqB,UACrB,sBAAuB,UACvB,aAAc,UACd,aAAc,UACd,YAAa,UACb,cAAe,UACf,aAAc,UACd,eAAgB,UAEhB,aAAc,UACd,UAAW,UAEX,qBAAsB,UACtB,aAAc,UACd,YAAa,UACb,cAAe,UACf,kBAAmB,UACnB,oBAAqB,UACrB,MAAO,UACP,cAAe,UACf,QAAS,UACT,QAAS,UACT,KAAM,UACN,OAAQ,UACR,mBAAoB,UACpB,MAAO,UACP,qBAAsB,UACtB,QAAS,UAET,QAAS,UACT,WAAY,UACZ,eAAgB,UAEhB,qBAAsB,UACtB,qBAAsB,UACtB,oBAAqB,UACrB,sBAAuB,UACvB,qBAAsB,UACtB,uBAAwB,UACxB,cAAe,UACf,cAAe,UACf,aAAc,UACd,eAAgB,UAChB,cAAe,UACf,gBAAiB,UAEjB,kBAAmB,UACnB,uBAAwB,UACxB,kBAAmB,UACnB,uBAAwB,UACxB,YAAa,UACb,WAAY,UACZ,eAAgB,UAChB,oBAAqB,UACrB,YAAa,UACb,mBAAoB,UACpB,WAAY,UACZ,gBAAiB,UACjB,YAAa,UACb,iBAAkB,UAClB,cAAe,SACjB,EAEaC,GAAc,CACzB,WAAY,cACZ,MAAO,UACP,OAAQ,UACR,OAAQ,UACR,SAAU,UACV,WAAY,UACZ,OAAQ,UACR,OAAQ,UACR,OAAQ,UACR,WAAY,UACZ,QAAS,UACT,QAAS,UACT,QAAS,UACT,KAAM,UACN,MAAO,UACP,UAAW,UACX,OAAQ,UACR,MAAO,UACP,KAAM,UACN,IAAK,UACL,SAAU,UAEV,oBAAqB,UACrB,oBAAqB,UACrB,mBAAoB,UACpB,qBAAsB,UACtB,oBAAqB,UACrB,sBAAuB,UACvB,aAAc,UACd,aAAc,UACd,YAAa,UACb,cAAe,UACf,aAAc,UACd,eAAgB,UAEhB,aAAc,UACd,UAAW,UAEX,qBAAsB,UACtB,aAAc,UACd,YAAa,UACb,cAAe,UACf,kBAAmB,UACnB,oBAAqB,UACrB,MAAO,UACP,cAAe,UACf,QAAS,UACT,QAAS,UACT,KAAM,UACN,OAAQ,UACR,mBAAoB,UACpB,MAAO,UACP,qBAAsB,UACtB,QAAS,UAET,QAAS,UACT,WAAY,UACZ,eAAgB,UAEhB,qBAAsB,UACtB,qBAAsB,UACtB,oBAAqB,UACrB,sBAAuB,UACvB,qBAAsB,UACtB,uBAAwB,UACxB,cAAe,UACf,cAAe,UACf,aAAc,UACd,eAAgB,UAChB,cAAe,UACf,gBAAiB,UAEjB,kBAAmB,UACnB,uBAAwB,UACxB,kBAAmB,UACnB,uBAAwB,UACxB,YAAa,UACb,WAAY,UACZ,eAAgB,UAChB,oBAAqB,UACrB,YAAa,UACb,mBAAoB,UACpB,WAAY,UACZ,gBAAiB,UACjB,YAAa,UACb,iBAAkB,UAClB,cAAe,SACjB,EAEaC,GAAgC,CAC3C,KAAMD,GACN,MAAOL,GACP,KAAMC,GACN,MAAOC,GACP,UAAWC,GACX,MAAOC,EACT,EC5nBe,SAARG,GAA6BC,EAAKC,EAAGC,EAAMC,EAAOC,EAAS,CAC9DC,GAAgBL,EAAKC,EAAGC,GAAQ,EAAGC,GAAUH,EAAI,OAAS,EAAII,GAAWE,EAAc,CAC3F,CAFwBC,EAAAR,GAAA,eAIxB,SAASM,GAAgBL,EAAKC,EAAGC,EAAMC,EAAOC,EAAS,CAEnD,KAAOD,EAAQD,GAAM,CACjB,GAAIC,EAAQD,EAAO,IAAK,CACpB,IAAIM,EAAIL,EAAQD,EAAO,EACnBO,EAAIR,EAAIC,EAAO,EACfQ,EAAI,KAAK,IAAIF,CAAC,EACdG,EAAI,GAAM,KAAK,IAAI,EAAID,EAAI,CAAC,EAC5BE,EAAK,GAAM,KAAK,KAAKF,EAAIC,GAAKH,EAAIG,GAAKH,CAAC,GAAKC,EAAID,EAAI,EAAI,EAAI,GAAK,GAClEK,EAAU,KAAK,IAAIX,EAAM,KAAK,MAAMD,EAAIQ,EAAIE,EAAIH,EAAII,CAAE,CAAC,EACvDE,EAAW,KAAK,IAAIX,EAAO,KAAK,MAAMF,GAAKO,EAAIC,GAAKE,EAAIH,EAAII,CAAE,CAAC,EACnEP,GAAgBL,EAAKC,EAAGY,EAASC,EAAUV,CAAO,CACtD,CAEA,IAAIW,EAAIf,EAAIC,CAAC,EACTe,EAAId,EACJe,EAAId,EAKR,IAHAe,GAAKlB,EAAKE,EAAMD,CAAC,EACbG,EAAQJ,EAAIG,CAAK,EAAGY,CAAC,EAAI,GAAGG,GAAKlB,EAAKE,EAAMC,CAAK,EAE9Ca,EAAIC,GAAG,CAIV,IAHAC,GAAKlB,EAAKgB,EAAGC,CAAC,EACdD,IACAC,IACOb,EAAQJ,EAAIgB,CAAC,EAAGD,CAAC,EAAI,GAAGC,IAC/B,KAAOZ,EAAQJ,EAAIiB,CAAC,EAAGF,CAAC,EAAI,GAAGE,GACnC,CAEIb,EAAQJ,EAAIE,CAAI,EAAGa,CAAC,IAAM,EAAGG,GAAKlB,EAAKE,EAAMe,CAAC,GAE9CA,IACAC,GAAKlB,EAAKiB,EAAGd,CAAK,GAGlBc,GAAKhB,IAAGC,EAAOe,EAAI,GACnBhB,GAAKgB,IAAGd,EAAQc,EAAI,EAC5B,CACJ,CAtCSV,EAAAF,GAAA,mBAwCT,SAASa,GAAKlB,EAAKgB,EAAGC,EAAG,CACrB,IAAIE,EAAMnB,EAAIgB,CAAC,EACfhB,EAAIgB,CAAC,EAAIhB,EAAIiB,CAAC,EACdjB,EAAIiB,CAAC,EAAIE,CACb,CAJSZ,EAAAW,GAAA,QAMT,SAASZ,GAAec,EAAGC,EAAG,CAC1B,OAAOD,EAAIC,EAAI,GAAKD,EAAIC,EAAI,EAAI,CACpC,CAFSd,EAAAD,GAAA,kBCjDT,IAAqBgB,GAArB,MAAqBA,EAAM,CACvB,YAAYC,EAAa,EAAG,CAExB,KAAK,YAAc,KAAK,IAAI,EAAGA,CAAU,EACzC,KAAK,YAAc,KAAK,IAAI,EAAG,KAAK,KAAK,KAAK,YAAc,EAAG,CAAC,EAChE,KAAK,MAAM,CACf,CAEA,KAAM,CACF,OAAO,KAAK,KAAK,KAAK,KAAM,CAAC,CAAC,CAClC,CAEA,OAAOC,EAAM,CACT,IAAIC,EAAO,KAAK,KACVC,EAAS,CAAC,EAEhB,GAAI,CAACC,GAAWH,EAAMC,CAAI,EAAG,OAAOC,EAEpC,IAAME,EAAS,KAAK,OACdC,EAAgB,CAAC,EAEvB,KAAOJ,GAAM,CACT,QAASK,EAAI,EAAGA,EAAIL,EAAK,SAAS,OAAQK,IAAK,CAC3C,IAAMC,EAAQN,EAAK,SAASK,CAAC,EACvBE,EAAYP,EAAK,KAAOG,EAAOG,CAAK,EAAIA,EAE1CJ,GAAWH,EAAMQ,CAAS,IACtBP,EAAK,KAAMC,EAAO,KAAKK,CAAK,EACvBE,GAAST,EAAMQ,CAAS,EAAG,KAAK,KAAKD,EAAOL,CAAM,EACtDG,EAAc,KAAKE,CAAK,EAErC,CACAN,EAAOI,EAAc,IAAI,CAC7B,CAEA,OAAOH,CACX,CAEA,SAASF,EAAM,CACX,IAAIC,EAAO,KAAK,KAEhB,GAAI,CAACE,GAAWH,EAAMC,CAAI,EAAG,MAAO,GAEpC,IAAMI,EAAgB,CAAC,EACvB,KAAOJ,GAAM,CACT,QAASK,EAAI,EAAGA,EAAIL,EAAK,SAAS,OAAQK,IAAK,CAC3C,IAAMC,EAAQN,EAAK,SAASK,CAAC,EACvBE,EAAYP,EAAK,KAAO,KAAK,OAAOM,CAAK,EAAIA,EAEnD,GAAIJ,GAAWH,EAAMQ,CAAS,EAAG,CAC7B,GAAIP,EAAK,MAAQQ,GAAST,EAAMQ,CAAS,EAAG,MAAO,GACnDH,EAAc,KAAKE,CAAK,CAC5B,CACJ,CACAN,EAAOI,EAAc,IAAI,CAC7B,CAEA,MAAO,EACX,CAEA,KAAKK,EAAM,CACP,GAAI,EAAEA,GAAQA,EAAK,QAAS,OAAO,KAEnC,GAAIA,EAAK,OAAS,KAAK,YAAa,CAChC,QAASJ,EAAI,EAAGA,EAAII,EAAK,OAAQJ,IAC7B,KAAK,OAAOI,EAAKJ,CAAC,CAAC,EAEvB,OAAO,IACX,CAGA,IAAIL,EAAO,KAAK,OAAOS,EAAK,MAAM,EAAG,EAAGA,EAAK,OAAS,EAAG,CAAC,EAE1D,GAAI,CAAC,KAAK,KAAK,SAAS,OAEpB,KAAK,KAAOT,UAEL,KAAK,KAAK,SAAWA,EAAK,OAEjC,KAAK,WAAW,KAAK,KAAMA,CAAI,MAE5B,CACH,GAAI,KAAK,KAAK,OAASA,EAAK,OAAQ,CAEhC,IAAMU,EAAU,KAAK,KACrB,KAAK,KAAOV,EACZA,EAAOU,CACX,CAGA,KAAK,QAAQV,EAAM,KAAK,KAAK,OAASA,EAAK,OAAS,EAAG,EAAI,CAC/D,CAEA,OAAO,IACX,CAEA,OAAOW,EAAM,CACT,OAAIA,GAAM,KAAK,QAAQA,EAAM,KAAK,KAAK,OAAS,CAAC,EAC1C,IACX,CAEA,OAAQ,CACJ,YAAK,KAAOC,GAAW,CAAC,CAAC,EAClB,IACX,CAEA,OAAOD,EAAME,EAAU,CACnB,GAAI,CAACF,EAAM,OAAO,KAElB,IAAIX,EAAO,KAAK,KACVD,EAAO,KAAK,OAAOY,CAAI,EACvBG,EAAO,CAAC,EACRC,EAAU,CAAC,EACbV,EAAGW,EAAQC,EAGf,KAAOjB,GAAQc,EAAK,QAAQ,CASxB,GAPKd,IACDA,EAAOc,EAAK,IAAI,EAChBE,EAASF,EAAKA,EAAK,OAAS,CAAC,EAC7BT,EAAIU,EAAQ,IAAI,EAChBE,EAAU,IAGVjB,EAAK,KAAM,CACX,IAAMkB,EAAQC,GAASR,EAAMX,EAAK,SAAUa,CAAQ,EAEpD,GAAIK,IAAU,GAEV,OAAAlB,EAAK,SAAS,OAAOkB,EAAO,CAAC,EAC7BJ,EAAK,KAAKd,CAAI,EACd,KAAK,UAAUc,CAAI,EACZ,IAEf,CAEI,CAACG,GAAW,CAACjB,EAAK,MAAQQ,GAASR,EAAMD,CAAI,GAC7Ce,EAAK,KAAKd,CAAI,EACde,EAAQ,KAAKV,CAAC,EACdA,EAAI,EACJW,EAAShB,EACTA,EAAOA,EAAK,SAAS,CAAC,GAEfgB,GACPX,IACAL,EAAOgB,EAAO,SAASX,CAAC,EACxBY,EAAU,IAEPjB,EAAO,IAClB,CAEA,OAAO,IACX,CAEA,OAAOW,EAAM,CAAE,OAAOA,CAAM,CAE5B,YAAYS,EAAGC,EAAG,CAAE,OAAOD,EAAE,KAAOC,EAAE,IAAM,CAC5C,YAAYD,EAAGC,EAAG,CAAE,OAAOD,EAAE,KAAOC,EAAE,IAAM,CAE5C,QAAS,CAAE,OAAO,KAAK,IAAM,CAE7B,SAASZ,EAAM,CACX,YAAK,KAAOA,EACL,IACX,CAEA,KAAKT,EAAMC,EAAQ,CACf,IAAMG,EAAgB,CAAC,EACvB,KAAOJ,GACCA,EAAK,KAAMC,EAAO,KAAK,GAAGD,EAAK,QAAQ,EACtCI,EAAc,KAAK,GAAGJ,EAAK,QAAQ,EAExCA,EAAOI,EAAc,IAAI,EAE7B,OAAOH,CACX,CAEA,OAAOqB,EAAOC,EAAMC,EAAOC,EAAQ,CAE/B,IAAMC,EAAIF,EAAQD,EAAO,EACrBI,EAAI,KAAK,YACT3B,EAEJ,GAAI0B,GAAKC,EAEL,OAAA3B,EAAOY,GAAWU,EAAM,MAAMC,EAAMC,EAAQ,CAAC,CAAC,EAC9CI,GAAS5B,EAAM,KAAK,MAAM,EACnBA,EAGNyB,IAEDA,EAAS,KAAK,KAAK,KAAK,IAAIC,CAAC,EAAI,KAAK,IAAIC,CAAC,CAAC,EAG5CA,EAAI,KAAK,KAAKD,EAAI,KAAK,IAAIC,EAAGF,EAAS,CAAC,CAAC,GAG7CzB,EAAOY,GAAW,CAAC,CAAC,EACpBZ,EAAK,KAAO,GACZA,EAAK,OAASyB,EAId,IAAMI,EAAK,KAAK,KAAKH,EAAIC,CAAC,EACpBG,EAAKD,EAAK,KAAK,KAAK,KAAK,KAAKF,CAAC,CAAC,EAEtCI,GAAYT,EAAOC,EAAMC,EAAOM,EAAI,KAAK,WAAW,EAEpD,QAASzB,EAAIkB,EAAMlB,GAAKmB,EAAOnB,GAAKyB,EAAI,CAEpC,IAAME,EAAS,KAAK,IAAI3B,EAAIyB,EAAK,EAAGN,CAAK,EAEzCO,GAAYT,EAAOjB,EAAG2B,EAAQH,EAAI,KAAK,WAAW,EAElD,QAASI,EAAI5B,EAAG4B,GAAKD,EAAQC,GAAKJ,EAAI,CAElC,IAAMK,EAAS,KAAK,IAAID,EAAIJ,EAAK,EAAGG,CAAM,EAG1ChC,EAAK,SAAS,KAAK,KAAK,OAAOsB,EAAOW,EAAGC,EAAQT,EAAS,CAAC,CAAC,CAChE,CACJ,CAEA,OAAAG,GAAS5B,EAAM,KAAK,MAAM,EAEnBA,CACX,CAEA,eAAeD,EAAMC,EAAMmC,EAAOrB,EAAM,CACpC,KACIA,EAAK,KAAKd,CAAI,EAEV,EAAAA,EAAK,MAAQc,EAAK,OAAS,IAAMqB,IAH5B,CAKT,IAAIC,EAAU,IACVC,EAAiB,IACjBC,EAEJ,QAASjC,EAAI,EAAGA,EAAIL,EAAK,SAAS,OAAQK,IAAK,CAC3C,IAAMC,EAAQN,EAAK,SAASK,CAAC,EACvBkC,EAAOC,GAASlC,CAAK,EACrBmC,EAAcC,GAAa3C,EAAMO,CAAK,EAAIiC,EAG5CE,EAAcJ,GACdA,EAAiBI,EACjBL,EAAUG,EAAOH,EAAUG,EAAOH,EAClCE,EAAahC,GAENmC,IAAgBJ,GAEnBE,EAAOH,IACPA,EAAUG,EACVD,EAAahC,EAGzB,CAEAN,EAAOsC,GAActC,EAAK,SAAS,CAAC,CACxC,CAEA,OAAOA,CACX,CAEA,QAAQW,EAAMwB,EAAOQ,EAAQ,CACzB,IAAM5C,EAAO4C,EAAShC,EAAO,KAAK,OAAOA,CAAI,EACvCiC,EAAa,CAAC,EAGd5C,EAAO,KAAK,eAAeD,EAAM,KAAK,KAAMoC,EAAOS,CAAU,EAOnE,IAJA5C,EAAK,SAAS,KAAKW,CAAI,EACvBkC,GAAO7C,EAAMD,CAAI,EAGVoC,GAAS,GACRS,EAAWT,CAAK,EAAE,SAAS,OAAS,KAAK,aACzC,KAAK,OAAOS,EAAYT,CAAK,EAC7BA,IAKR,KAAK,oBAAoBpC,EAAM6C,EAAYT,CAAK,CACpD,CAGA,OAAOS,EAAYT,EAAO,CACtB,IAAMnC,EAAO4C,EAAWT,CAAK,EACvBR,EAAI3B,EAAK,SAAS,OAClB8C,EAAI,KAAK,YAEf,KAAK,iBAAiB9C,EAAM8C,EAAGnB,CAAC,EAEhC,IAAMoB,EAAa,KAAK,kBAAkB/C,EAAM8C,EAAGnB,CAAC,EAE9CqB,EAAUpC,GAAWZ,EAAK,SAAS,OAAO+C,EAAY/C,EAAK,SAAS,OAAS+C,CAAU,CAAC,EAC9FC,EAAQ,OAAShD,EAAK,OACtBgD,EAAQ,KAAOhD,EAAK,KAEpB4B,GAAS5B,EAAM,KAAK,MAAM,EAC1B4B,GAASoB,EAAS,KAAK,MAAM,EAEzBb,EAAOS,EAAWT,EAAQ,CAAC,EAAE,SAAS,KAAKa,CAAO,EACjD,KAAK,WAAWhD,EAAMgD,CAAO,CACtC,CAEA,WAAWhD,EAAMgD,EAAS,CAEtB,KAAK,KAAOpC,GAAW,CAACZ,EAAMgD,CAAO,CAAC,EACtC,KAAK,KAAK,OAAShD,EAAK,OAAS,EACjC,KAAK,KAAK,KAAO,GACjB4B,GAAS,KAAK,KAAM,KAAK,MAAM,CACnC,CAEA,kBAAkB5B,EAAM8C,EAAGnB,EAAG,CAC1B,IAAIT,EACA+B,EAAa,IACbb,EAAU,IAEd,QAAS/B,EAAIyC,EAAGzC,GAAKsB,EAAImB,EAAGzC,IAAK,CAC7B,IAAM6C,EAAQC,GAASnD,EAAM,EAAGK,EAAG,KAAK,MAAM,EACxC+C,EAAQD,GAASnD,EAAMK,EAAGsB,EAAG,KAAK,MAAM,EAExC0B,EAAUC,GAAiBJ,EAAOE,CAAK,EACvCb,EAAOC,GAASU,CAAK,EAAIV,GAASY,CAAK,EAGzCC,EAAUJ,GACVA,EAAaI,EACbnC,EAAQb,EAER+B,EAAUG,EAAOH,EAAUG,EAAOH,GAE3BiB,IAAYJ,GAEfV,EAAOH,IACPA,EAAUG,EACVrB,EAAQb,EAGpB,CAEA,OAAOa,GAASS,EAAImB,CACxB,CAGA,iBAAiB9C,EAAM8C,EAAGnB,EAAG,CACzB,IAAM4B,EAAcvD,EAAK,KAAO,KAAK,YAAcwD,GAC7CC,EAAczD,EAAK,KAAO,KAAK,YAAc0D,GAC7CC,EAAU,KAAK,eAAe3D,EAAM8C,EAAGnB,EAAG4B,CAAW,EACrDK,EAAU,KAAK,eAAe5D,EAAM8C,EAAGnB,EAAG8B,CAAW,EAIvDE,EAAUC,GAAS5D,EAAK,SAAS,KAAKuD,CAAW,CACzD,CAGA,eAAevD,EAAM8C,EAAGnB,EAAGkC,EAAS,CAChC7D,EAAK,SAAS,KAAK6D,CAAO,EAE1B,IAAM1D,EAAS,KAAK,OACd2D,EAAWX,GAASnD,EAAM,EAAG8C,EAAG3C,CAAM,EACtC4D,EAAYZ,GAASnD,EAAM2B,EAAImB,EAAGnB,EAAGxB,CAAM,EAC7C6D,EAASC,GAAWH,CAAQ,EAAIG,GAAWF,CAAS,EAExD,QAAS1D,EAAIyC,EAAGzC,EAAIsB,EAAImB,EAAGzC,IAAK,CAC5B,IAAMC,EAAQN,EAAK,SAASK,CAAC,EAC7BwC,GAAOiB,EAAU9D,EAAK,KAAOG,EAAOG,CAAK,EAAIA,CAAK,EAClD0D,GAAUC,GAAWH,CAAQ,CACjC,CAEA,QAASzD,EAAIsB,EAAImB,EAAI,EAAGzC,GAAKyC,EAAGzC,IAAK,CACjC,IAAMC,EAAQN,EAAK,SAASK,CAAC,EAC7BwC,GAAOkB,EAAW/D,EAAK,KAAOG,EAAOG,CAAK,EAAIA,CAAK,EACnD0D,GAAUC,GAAWF,CAAS,CAClC,CAEA,OAAOC,CACX,CAEA,oBAAoBjE,EAAMe,EAAMqB,EAAO,CAEnC,QAAS9B,EAAI8B,EAAO9B,GAAK,EAAGA,IACxBwC,GAAO/B,EAAKT,CAAC,EAAGN,CAAI,CAE5B,CAEA,UAAUe,EAAM,CAEZ,QAAST,EAAIS,EAAK,OAAS,EAAGoD,EAAU7D,GAAK,EAAGA,IACxCS,EAAKT,CAAC,EAAE,SAAS,SAAW,EACxBA,EAAI,GACJ6D,EAAWpD,EAAKT,EAAI,CAAC,EAAE,SACvB6D,EAAS,OAAOA,EAAS,QAAQpD,EAAKT,CAAC,CAAC,EAAG,CAAC,GAEzC,KAAK,MAAM,EAEfuB,GAASd,EAAKT,CAAC,EAAG,KAAK,MAAM,CAE5C,CACJ,EArZ2B8D,EAAAtE,GAAA,SAA3B,IAAqBuE,GAArBvE,GAuZA,SAASsB,GAASR,EAAMW,EAAOT,EAAU,CACrC,GAAI,CAACA,EAAU,OAAOS,EAAM,QAAQX,CAAI,EAExC,QAASN,EAAI,EAAGA,EAAIiB,EAAM,OAAQjB,IAC9B,GAAIQ,EAASF,EAAMW,EAAMjB,CAAC,CAAC,EAAG,OAAOA,EAEzC,MAAO,EACX,CAPS8D,EAAAhD,GAAA,YAUT,SAASS,GAAS5B,EAAMG,EAAQ,CAC5BgD,GAASnD,EAAM,EAAGA,EAAK,SAAS,OAAQG,EAAQH,CAAI,CACxD,CAFSmE,EAAAvC,GAAA,YAKT,SAASuB,GAASnD,EAAMqE,EAAGC,EAAGnE,EAAQoE,EAAU,CACvCA,IAAUA,EAAW3D,GAAW,IAAI,GACzC2D,EAAS,KAAO,IAChBA,EAAS,KAAO,IAChBA,EAAS,KAAO,KAChBA,EAAS,KAAO,KAEhB,QAASlE,EAAIgE,EAAGhE,EAAIiE,EAAGjE,IAAK,CACxB,IAAMC,EAAQN,EAAK,SAASK,CAAC,EAC7BwC,GAAO0B,EAAUvE,EAAK,KAAOG,EAAOG,CAAK,EAAIA,CAAK,CACtD,CAEA,OAAOiE,CACX,CAbSJ,EAAAhB,GAAA,YAeT,SAASN,GAAOzB,EAAGC,EAAG,CAClB,OAAAD,EAAE,KAAO,KAAK,IAAIA,EAAE,KAAMC,EAAE,IAAI,EAChCD,EAAE,KAAO,KAAK,IAAIA,EAAE,KAAMC,EAAE,IAAI,EAChCD,EAAE,KAAO,KAAK,IAAIA,EAAE,KAAMC,EAAE,IAAI,EAChCD,EAAE,KAAO,KAAK,IAAIA,EAAE,KAAMC,EAAE,IAAI,EACzBD,CACX,CANS+C,EAAAtB,GAAA,UAQT,SAASW,GAAgBpC,EAAGC,EAAG,CAAE,OAAOD,EAAE,KAAOC,EAAE,IAAM,CAAhD8C,EAAAX,GAAA,mBACT,SAASE,GAAgBtC,EAAGC,EAAG,CAAE,OAAOD,EAAE,KAAOC,EAAE,IAAM,CAAhD8C,EAAAT,GAAA,mBAET,SAASlB,GAASpB,EAAK,CAAE,OAAQA,EAAE,KAAOA,EAAE,OAASA,EAAE,KAAOA,EAAE,KAAO,CAA9D+C,EAAA3B,GAAA,YACT,SAASyB,GAAW7C,EAAG,CAAE,OAAQA,EAAE,KAAOA,EAAE,MAASA,EAAE,KAAOA,EAAE,KAAO,CAA9D+C,EAAAF,GAAA,cAET,SAASvB,GAAatB,EAAGC,EAAG,CACxB,OAAQ,KAAK,IAAIA,EAAE,KAAMD,EAAE,IAAI,EAAI,KAAK,IAAIC,EAAE,KAAMD,EAAE,IAAI,IAClD,KAAK,IAAIC,EAAE,KAAMD,EAAE,IAAI,EAAI,KAAK,IAAIC,EAAE,KAAMD,EAAE,IAAI,EAC9D,CAHS+C,EAAAzB,GAAA,gBAKT,SAASY,GAAiBlC,EAAGC,EAAG,CAC5B,IAAMmD,EAAO,KAAK,IAAIpD,EAAE,KAAMC,EAAE,IAAI,EAC9BoD,EAAO,KAAK,IAAIrD,EAAE,KAAMC,EAAE,IAAI,EAC9BqD,EAAO,KAAK,IAAItD,EAAE,KAAMC,EAAE,IAAI,EAC9BsD,EAAO,KAAK,IAAIvD,EAAE,KAAMC,EAAE,IAAI,EAEpC,OAAO,KAAK,IAAI,EAAGqD,EAAOF,CAAI,EACvB,KAAK,IAAI,EAAGG,EAAOF,CAAI,CAClC,CARSN,EAAAb,GAAA,oBAUT,SAAS9C,GAASY,EAAGC,EAAG,CACpB,OAAOD,EAAE,MAAQC,EAAE,MACZD,EAAE,MAAQC,EAAE,MACZA,EAAE,MAAQD,EAAE,MACZC,EAAE,MAAQD,EAAE,IACvB,CALS+C,EAAA3D,GAAA,YAOT,SAASN,GAAWkB,EAAGC,EAAG,CACtB,OAAOA,EAAE,MAAQD,EAAE,MACZC,EAAE,MAAQD,EAAE,MACZC,EAAE,MAAQD,EAAE,MACZC,EAAE,MAAQD,EAAE,IACvB,CALS+C,EAAAjE,GAAA,cAOT,SAASU,GAAWgE,EAAU,CAC1B,MAAO,CACH,SAAAA,EACA,OAAQ,EACR,KAAM,GACN,KAAM,IACN,KAAM,IACN,KAAM,KACN,KAAM,IACV,CACJ,CAVST,EAAAvD,GAAA,cAeT,SAASmB,GAAY8C,EAAKtD,EAAMC,EAAO,EAAGqC,EAAS,CAC/C,IAAMiB,EAAQ,CAACvD,EAAMC,CAAK,EAE1B,KAAOsD,EAAM,QAAQ,CAIjB,GAHAtD,EAAQsD,EAAM,IAAI,EAClBvD,EAAOuD,EAAM,IAAI,EAEbtD,EAAQD,GAAQ,EAAG,SAEvB,IAAMwD,EAAMxD,EAAO,KAAK,MAAMC,EAAQD,GAAQ,EAAI,CAAC,EAAI,EACvDyD,GAAYH,EAAKE,EAAKxD,EAAMC,EAAOqC,CAAO,EAE1CiB,EAAM,KAAKvD,EAAMwD,EAAKA,EAAKvD,CAAK,CACpC,CACJ,CAdS2C,EAAApC,GAAA,eC5cF,IAAMkD,GAAgBC,EAAA,CAC3BC,EACAC,EACAC,IACG,CACH,IAAMC,EAAS,CAAC,EAChB,QAAWC,KAAOJ,EAAM,CACtB,IAAMK,EAAO,CAAC,EACd,QAAWC,KAASF,EAClBC,EAAK,KAAKC,EAAM,MAAM,EAAE,KAAKL,CAAK,EAAE,IAAIC,CAAS,CAAC,EAEpDC,EAAO,KAAKE,CAAI,CAClB,CACA,OAAOF,CACT,EAd6B,iBAgBhBI,GAAOR,EAAA,CAACS,EAAaC,IAAc,CAC9C,IAAMC,EAAM,GAAKD,EACjB,OAAID,EAAM,EAAUE,EAAMF,EACtBA,GAAOE,EAAYF,EAAME,EACtBF,CACT,EALoB,QAWPG,GAAN,MAAMA,EAAK,CAKhB,YAAYC,EAAsBC,EAAsBC,EAAmB,CACzE,KAAK,UAAYF,EACjB,KAAK,aAAeC,EACpB,KAAK,UAAYC,CACnB,CAEO,mBACLC,EACAC,EACsB,CACtB,IAAMC,EAAaC,EAAA,EAAKH,GAAcG,EAAA,EAAK,KAAK,KAAKH,CAAW,GAC1DI,EAAS,CAAC,EACZlB,EAAQ,EACNS,EAAM,KAAK,UAAU,SAC3B,GAAIK,EAAc,KAAK,UACrBd,EAAS,GAAK,GAAM,KAAK,UAAYc,GAAiBE,EACtDE,EAAO,KAAK,CACV,SAAU,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,CAAE,EAC7B,OAAQ,IAAIC,EAAM,EAAG,CAAC,EACtB,MAAOnB,EACP,IAAKS,EAAMT,CACb,CAAC,UACQc,GAAe,KAAK,UAAY,KAAK,aAAc,CAC5D,IAAMM,EAAI,GAAK,KAAK,UAEdC,EAAe,IAAML,EAErBM,EAAW,KAAK,KAAKR,CAAW,EAAI,KAAK,UAEzCS,EAAW,KAAK,MAAMR,EAAO,KAAOK,EAAIC,CAAY,EACpDG,EAAW,KAAK,MAAMT,EAAO,KAAOK,EAAIC,CAAY,EACpDI,EAAW,KAAK,MAAMV,EAAO,KAAOK,EAAIC,CAAY,EACpDK,EAAW,KAAK,MAAMX,EAAO,KAAOK,EAAIC,CAAY,EAC1D,QAASM,EAAKJ,EAAUI,GAAMF,EAAUE,IACtC,QAASC,EAAKJ,EAAUI,GAAMF,EAAUE,IAAM,CAC5C,IAAMC,EAAS,IAAIV,EACjBQ,EAAKP,EAAIC,EACTO,EAAKR,EAAIC,CACX,EACAH,EAAO,KAAK,CACV,SAAU,CACR,EAAGI,EACH,EAAGhB,GAAKqB,EAAIL,CAAQ,EACpB,EAAGhB,GAAKsB,EAAIN,CAAQ,CACtB,EACA,OAAQO,EACR,MAAOb,EACP,IAAKP,EAAMO,CACb,CAAC,CACH,CAEJ,KAAO,CACL,IAAMI,EAAI,GAAK,KAAK,UACpBpB,GACG,GAAM,KAAK,KAAKc,CAAW,EAAI,KAAK,aAAe,KAAK,WACzDE,EACF,IAAMO,EAAW,KAAK,MAAMR,EAAO,KAAOK,EAAI,IAAMpB,CAAK,EACnDwB,EAAW,KAAK,MAAMT,EAAO,KAAOK,EAAI,IAAMpB,CAAK,EACnDyB,EAAW,KAAK,MAAMV,EAAO,KAAOK,EAAI,IAAMpB,CAAK,EACnD0B,EAAW,KAAK,MAAMX,EAAO,KAAOK,EAAI,IAAMpB,CAAK,EACzD,QAAS2B,EAAKJ,EAAUI,GAAMF,EAAUE,IACtC,QAASC,EAAKJ,EAAUI,GAAMF,EAAUE,IAAM,CAC5C,IAAMC,EAAS,IAAIV,EAAMQ,EAAKP,EAAI,IAAMpB,EAAO4B,EAAKR,EAAI,IAAMpB,CAAK,EACnEkB,EAAO,KAAK,CACV,SAAU,CACR,EAAG,KAAK,aACR,EAAGZ,GAAKqB,EAAI,KAAK,YAAY,EAC7B,EAAGrB,GAAKsB,EAAI,KAAK,YAAY,CAC/B,EACA,OAAQC,EACR,MAAO7B,EACP,IAAKS,EAAMT,CACb,CAAC,CACH,CAEJ,CACA,OAAOkB,CACT,CAEO,uBAAuBY,EAAiC,CAC7D,IAAIC,EACA/B,EAAQ,EACRS,EAAM,KAAK,UAAU,SACrBoB,EACJ,GAAIC,EAAY,EAAI,KAAK,UACvBC,EAAW,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,CAAE,EAC9B/B,EAAQ,GAAK,GAAM,KAAK,UAAY8B,EAAY,GAChDD,EAAS,IAAIV,EAAM,EAAG,CAAC,EACvBV,EAAMA,EAAMT,UACH8B,EAAY,GAAK,KAAK,UAAY,KAAK,aAAc,CAC9D,IAAMV,EAAI,GAAK,KAAK,UACpBW,EAAW,CACT,EAAGD,EAAY,EAAI,KAAK,UACxB,EAAG,KAAK,MAAMA,EAAY,EAAIV,CAAC,EAC/B,EAAG,KAAK,MAAMU,EAAY,EAAIV,CAAC,CACjC,EACAS,EAAS,IAAIV,EAAMY,EAAS,EAAIX,EAAI,IAAKW,EAAS,EAAIX,EAAI,GAAG,CAC/D,KAAO,CACLpB,EAAQ,GAAM8B,EAAY,EAAI,KAAK,aAAe,KAAK,UACvD,IAAMV,EAAI,GAAK,KAAK,UACpBW,EAAW,CACT,EAAG,KAAK,aACR,EAAG,KAAK,MAAMD,EAAY,EAAIV,EAAIpB,CAAK,EACvC,EAAG,KAAK,MAAM8B,EAAY,EAAIV,EAAIpB,CAAK,CACzC,EACA6B,EAAS,IAAIV,EACXY,EAAS,EAAIX,EAAIpB,EAAQ,IACzB+B,EAAS,EAAIX,EAAIpB,EAAQ,GAC3B,EACAS,EAAMA,EAAMT,CACd,CACA,MAAO,CAAE,SAAU+B,EAAU,MAAO/B,EAAO,OAAQ6B,EAAQ,IAAKpB,CAAI,CACtE,CAEa,QACXK,EACAC,EAC8B,QAAAiB,EAAA,sBAC9B,IAAMd,EAAS,KAAK,mBAAmBJ,EAAaC,CAAM,EAI1D,OAHe,MAAM,QAAQ,IAC3BG,EAAO,IAAKe,GAAO,KAAK,UAAU,IAAIA,EAAG,QAAQ,CAAC,CACpD,GACc,IAAI,CAACC,EAAMC,IAAM,CAC7B,IAAMF,EAAKf,EAAOiB,CAAC,EACnB,MAAO,CACL,KAAMD,EACN,EAAGpB,EACH,SAAUmB,EAAG,SACb,MAAOA,EAAG,MACV,IAAKA,EAAG,IACR,OAAQA,EAAG,MACb,CACF,CAAC,CACH,GAEa,eAAeH,EAAyC,QAAAE,EAAA,sBACnE,IAAMC,EAAK,KAAK,uBAAuBH,CAAW,EAElD,MAAO,CACL,KAFW,MAAM,KAAK,UAAU,IAAIG,EAAG,QAAQ,EAG/C,EAAGH,EAAY,EACf,SAAUG,EAAG,SACb,MAAOA,EAAG,MACV,OAAQA,EAAG,OACX,IAAKA,EAAG,GACV,CACF,GAEO,cACLG,EACAC,EACAvB,EACAwB,EACA,CACA,IAAMC,EAAc,KAAK,MAAMzB,CAAW,EACpCQ,EAAW,KAAK,IAAIiB,EAAc,KAAK,UAAW,KAAK,YAAY,EACnEC,EAAkBF,GAAa,GAAMC,EAAcjB,GACzD,OAAO,KAAK,UAAU,cAAcc,EAAKC,EAAKf,EAAUkB,CAAe,CACzE,CACF,EApKkB1C,EAAAY,GAAA,QAAX,IAAM+B,GAAN/B,GA6KMgC,GAAiB5C,EAAC6C,GAA2B,CACxD,IAAMC,EAAgB9C,EAAC+C,GAA2B,CAChD,IAAMhC,EAAYgC,EAAE,YAAc,OAAY,EAAIA,EAAE,UAC9CC,EAAcD,EAAE,aAAe,GACjCE,EACJ,GAAI,OAAOF,EAAE,KAAQ,SACf,IAAI,IAAIA,EAAE,IAAK,oBAAoB,EAAE,SAAS,SAAS,UAAU,EACnEE,EAAS,IAAIC,GAAcH,EAAE,IAAK,EAAI,EAEtCE,EAAS,IAAIE,GAAUJ,EAAE,IAAK,EAAI,UAE3BA,EAAE,IACXE,EAAS,IAAIC,GAAcH,EAAE,IAAK,EAAI,MAEtC,OAAM,IAAI,MAAM,kBAAkBA,EAAE,GAAG,EAAE,EAG3C,IAAMK,EAAQ,IAAIC,GAAUJ,EAAS,IAAM,GAAMlC,CAAS,EAC1D,OAAO,IAAI4B,GAAKS,EAAOJ,EAAajC,CAAS,CAC/C,EAlBsB,iBAoBhBuC,EAAU,IAAI,IACpB,GAAIT,EAAQ,QACV,QAAWU,KAAOV,EAAQ,QACxBS,EAAQ,IAAIC,EAAKT,EAAcD,EAAQ,QAAQU,CAAG,CAAC,CAAC,OAGtDD,EAAQ,IAAI,GAAIR,EAAcD,CAAO,CAAC,EAExC,OAAOS,CACT,EA9B8B,kBCzLvB,IAAME,GAAWC,EAAA,CACtBC,EACAC,EACAC,IACG,CAEH,IAAMC,EAAIF,EAAY,IAEhBG,EAAO,KAAK,MAAMF,EAAK,KAAO,GAAG,EACjCG,EAAO,KAAK,MAAMH,EAAK,KAAO,GAAG,EACjCI,EAAO,KAAK,MAAMJ,EAAK,KAAO,GAAG,EACjCK,EAAO,KAAK,MAAML,EAAK,KAAO,GAAG,EACjCM,EAAY,KAAK,KAAKL,CAAC,EAEvBM,EAAS,CAAC,EAChB,QAASC,EAAIN,EAAMM,GAAKJ,EAAMI,IAAK,CACjC,IAAMC,EAAWD,GAAK,GAAKV,GAC3B,QAASY,EAAIP,EAAMO,GAAKL,EAAMK,IAC5BH,EAAO,KAAK,CACV,QAASI,EAAQ,CAAE,EAAGb,EAAa,EAAGW,EAAU,EAAGC,CAAE,CAAC,EACtD,IAAKC,EAAQ,CACX,EAAGb,EAAcQ,EACjB,EAAG,KAAK,MAAMG,EAAWR,CAAC,EAC1B,EAAG,KAAK,MAAMS,EAAIT,CAAC,CACrB,CAAC,CACH,CAAC,CAEL,CACA,OAAOM,CACT,EA7BwB,YA+BXK,GAAN,MAAMA,EAAM,CAMjB,YAAYC,EAAaC,EAAyB,CAChD,KAAK,KAAO,IAAIC,GAChB,KAAK,QAAU,IAAI,IACnB,KAAK,IAAMF,EACX,KAAK,gBAAkBC,CACzB,CAEO,UAAUE,EAA0B,CACzC,QAAWC,KAAO,KAAK,QAAQ,KAAK,EAClC,GAAIA,EAAI,WAAWD,CAAO,EAAG,MAAO,GAEtC,MAAO,EACT,CAEO,IAAIA,EAA0B,CACnC,OAAO,KAAK,QAAQ,IAAIA,CAAO,CACjC,CAEO,MAAe,CACpB,OAAO,KAAK,QAAQ,IACtB,CAEO,MAAO,CACZ,OAAO,KAAK,QAAQ,KAAK,CAC3B,CAEO,WAAWhB,EAAYkB,EAAkC,CAC9D,IAAMC,EAAS,IAAI,IACnB,QAAWC,KAAS,KAAK,KAAK,OAAOpB,CAAI,EACnCoB,EAAM,aAAa,OAASF,GAC9BC,EAAO,IAAIC,EAAM,YAAY,EAGjC,OAAOD,CACT,CAEO,YAAYE,EAAcH,EAAkC,CACjE,IAAMC,EAAS,IAAI,IACnB,QAAWnB,KAAQqB,EAAM,OACvB,QAAWD,KAAS,KAAK,KAAK,OAAOpB,CAAI,EACnCoB,EAAM,aAAa,OAASF,GAC9BC,EAAO,IAAIC,EAAM,YAAY,EAInC,OAAOD,CACT,CAEO,aAAanB,EAAYkB,EAAwB,CACtD,QAAWE,KAAS,KAAK,KAAK,OAAOpB,CAAI,EACvC,GAAIoB,EAAM,aAAa,OAASF,EAAO,MAAO,GAEhD,MAAO,EACT,CAEO,cAAcG,EAAcH,EAAwB,CACzD,QAAWlB,KAAQqB,EAAM,OACvB,QAAWD,KAAS,KAAK,KAAK,OAAOpB,CAAI,EACvC,GAAIoB,EAAM,aAAa,OAASF,EAAO,MAAO,GAGlD,MAAO,EACT,CAEO,sBAAsBG,EAAuB,CAGlD,GAAI,CAACA,EAAM,kBAAoB,CAACA,EAAM,sBAAuB,MAAO,GACpE,IAAMC,EAAOD,EAAM,sBACbE,EAAW,CACf,KAAMF,EAAM,OAAO,EAAIC,EACvB,KAAMD,EAAM,OAAO,EAAIC,EACvB,KAAMD,EAAM,OAAO,EAAIC,EACvB,KAAMD,EAAM,OAAO,EAAIC,CACzB,EACA,QAAWE,KAAa,KAAK,KAAK,OAAOD,CAAQ,EAC/C,GAAIC,EAAU,aAAa,mBAAqBH,EAAM,kBAChDG,EAAU,aAAa,OAAO,KAAKH,EAAM,MAAM,EAAIC,EACrD,MAAO,GAIb,MAAO,EACT,CAEO,UAAUN,EAAiB,CAC5B,KAAK,QAAQ,IAAIA,CAAO,GAC1B,QAAQ,IAAI,qBAAqB,EAEnC,IAAMS,EAAS,IAAI,IACnB,KAAK,QAAQ,IAAIT,EAASS,CAAM,CAClC,CAGO,OAAOJ,EAAcH,EAAeF,EAAuB,CAChE,IAAMU,EAAe,CACnB,OAAQL,EAAM,OACd,OAAQA,EAAM,OACd,KAAMA,EAAM,KACZ,MAAOH,EACP,QAASF,EACT,iBAAkBK,EAAM,iBACxB,sBAAuBA,EAAM,qBAC/B,EACIM,EAAQ,KAAK,QAAQ,IAAIX,CAAO,EACpC,GAAI,CAACW,EAAO,CACV,IAAMF,EAAS,IAAI,IACnB,KAAK,QAAQ,IAAIT,EAASS,CAAM,EAChCE,EAAQF,CACV,CACAE,EAAM,IAAID,CAAY,EAEtB,IAAIE,EAAY,GACZC,EAAa,GACjB,QAAW7B,KAAQqB,EAAM,OACvB,KAAK,KAAK,OAAO,CACf,KAAMrB,EAAK,KACX,KAAMA,EAAK,KACX,KAAMA,EAAK,KACX,KAAMA,EAAK,KACX,aAAc0B,CAChB,CAAC,EACG1B,EAAK,KAAO,IAAG4B,EAAY,IAC3B5B,EAAK,KAAO,KAAK,MAAK6B,EAAa,IAGzC,GAAID,GAAaC,EAAY,CAC3B,IAAMC,EAAQF,EAAY,KAAK,IAAM,CAAC,KAAK,IAErCG,EAAY,CAAC,EACnB,QAAW/B,KAAQqB,EAAM,OACvBU,EAAU,KAAK,CACb,KAAM/B,EAAK,KAAO8B,EAClB,KAAM9B,EAAK,KACX,KAAMA,EAAK,KAAO8B,EAClB,KAAM9B,EAAK,IACb,CAAC,EAEH,IAAMgC,EAAiB,CACrB,OAAQ,IAAIC,EAAMZ,EAAM,OAAO,EAAIS,EAAOT,EAAM,OAAO,CAAC,EACxD,OAAQU,EACR,KAAMV,EAAM,KACZ,MAAOH,EACP,QAASF,CACX,EACMW,EAAQ,KAAK,QAAQ,IAAIX,CAAO,EAClCW,GAAOA,EAAM,IAAIK,CAAc,EACnC,QAAWhC,KAAQ+B,EACjB,KAAK,KAAK,OAAO,CACf,KAAM/B,EAAK,KACX,KAAMA,EAAK,KACX,KAAMA,EAAK,KACX,KAAMA,EAAK,KACX,aAAcgC,CAChB,CAAC,CAEL,CACF,CAEO,YAAYE,EAAkB,CACnC,IAAMC,EAAQD,EAAS,MAAM,GAAG,EAC5BE,EACAC,EAAU,EACVC,EAAY,EAEhB,QAAWC,KAAe,KAAK,QAAQ,KAAK,EAAG,CAC7C,IAAMC,EAAWD,EAAY,MAAM,GAAG,EACtC,GAAIC,EAAS,CAAC,IAAML,EAAM,CAAC,EAAG,CAC5BG,IACA,IAAMhB,EAAO,KAAK,KACfmB,EAAA,CAACD,EAAS,CAAC,EAAI,CAACL,EAAM,CAAC,EAAM,GAAKM,EAAA,CAACD,EAAS,CAAC,EAAI,CAACL,EAAM,CAAC,EAAM,EAClE,EACIb,EAAOe,IACTA,EAAUf,EACVc,EAASG,EAEb,CAEIH,GAAUE,EAAY,KAAK,iBAC7B,KAAK,SAASF,CAAM,CAExB,CACF,CAEO,SAASM,EAA2B,CACzC,IAAMC,EAAgB,KAAK,QAAQ,IAAID,CAAW,EAClD,GAAI,CAACC,EAAe,OACpB,IAAMC,EAAkB,CAAC,EACzB,QAAWjB,KAAS,KAAK,KAAK,IAAI,EAC5BgB,EAAc,IAAIhB,EAAM,YAAY,GACtCiB,EAAgB,KAAKjB,CAAK,EAG9B,QAAWA,KAASiB,EAClB,KAAK,KAAK,OAAOjB,CAAK,EAExB,KAAK,QAAQ,OAAOe,CAAW,CACjC,CAMO,YAAYG,EAAmC,CACpD,IAAMD,EAAkB,CAAC,EACzB,QAAWjB,KAAS,KAAK,KAAK,IAAI,EAC5BkB,IAAkBlB,EAAM,cAC1BiB,EAAgB,KAAKjB,CAAK,EAG9B,QAAWA,KAASiB,EAClB,KAAK,KAAK,OAAOjB,CAAK,EAExB,IAAMmB,EAAI,KAAK,QAAQ,IAAID,EAAc,OAAO,EAC5CC,GAAGA,EAAE,OAAOD,CAAa,CAC/B,CACF,EA9NmBhD,EAAAe,GAAA,SAAZ,IAAMmC,GAANnC,GAgOMoC,GAAN,MAAMA,EAAQ,CAOnB,YACEC,EACAC,EACAC,EACArC,EACAsC,EACA,CACA,KAAK,MAAQ,IAAIL,GAAO,IAAM,GAAME,EAAGnC,CAAe,EACtD,KAAK,EAAImC,EACT,KAAK,QAAUC,EACf,KAAK,WAAaC,EAClB,KAAK,SAAWC,CAClB,CAEQ,OAAOC,EAAsD,CACnE,IAAMC,EAAQ,YAAY,IAAI,EAExBC,EAAa,IAAI,IAEvB,OAAW,CAACC,EAAGC,CAAa,IAAKJ,EAC/B,QAAWK,KAAgBD,EAAe,CACxC,IAAMxC,EAAM,GAAGN,EAAQ+C,EAAa,QAAQ,CAAC,IAAIF,CAAC,GAC7C,KAAK,MAAM,IAAIvC,CAAG,IACrB,KAAK,MAAM,UAAUA,CAAG,EACxBsC,EAAW,IAAItC,CAAG,EAEtB,CAGF,IAAM0C,EAAmB,IAAI,IAC7B,OAAW,CAACzC,EAAO0C,CAAI,IAAK,KAAK,WAAW,QAAQ,EAAG,CAGrD,GAFIA,EAAK,UAAY,IACjBA,EAAK,SAAW,KAAK,EAAIA,EAAK,SAC9BA,EAAK,SAAW,KAAK,EAAIA,EAAK,QAAS,SAE3C,IAAMC,EAASD,EAAK,YAAc,GAC5BH,EAAgBJ,EAAgB,IAAIQ,CAAM,EAChD,GAAKJ,EAEL,QAAWC,KAAgBD,EAAe,CACxC,IAAMxC,EAAM,GAAGN,EAAQ+C,EAAa,QAAQ,CAAC,IAAIG,CAAM,GACvD,GAAI,CAACN,EAAW,IAAItC,CAAG,EAAG,SAE1B,IAAM6C,EAAQJ,EAAa,KAAK,IAAIE,EAAK,SAAS,EAClD,GAAIE,IAAU,OAAW,SAEzB,IAAMC,EAAQD,EACVF,EAAK,MACPG,EAAM,KAAK,CAACC,EAAGC,IACTL,EAAK,KACAA,EAAK,KAAKI,EAAE,MAAOC,EAAE,KAAK,EAE5B,CACR,EAEH,IAAMC,EAAS,CACb,MAAO,KAAK,MACZ,KAAM,KAAK,EACX,QAAS,KAAK,QACd,MAAOhD,EACP,SAAU,KAAK,EAAIwC,EAAa,SAAS,CAC3C,EACA,QAAWS,KAAWJ,EAAO,CAC3B,GAAIH,EAAK,QAAU,CAACA,EAAK,OAAO,KAAK,EAAGO,CAAO,EAAG,SAClD,IAAMC,EAAcC,GAClBF,EAAQ,KACRT,EAAa,MACbA,EAAa,MACf,EACMvC,EAASyC,EAAK,WAAW,MAAMM,EAAQE,EAAaD,CAAO,EACjE,GAAKhD,EAEL,QAAWE,KAASF,EAAQ,CAC1B,IAAImD,EAAa,GACjB,GACE,EAAAjD,EAAM,kBACN,KAAK,MAAM,sBAAsBA,CAAK,GAMxC,IAAI,KAAK,MAAM,cAAcA,EAAO,GAAQ,GAC1C,GAAI,CAAC,KAAK,MAAM,cAAcA,EAAOH,CAAK,EAAG,CAC3C,IAAMqD,EAAY,KAAK,MAAM,YAAYlD,EAAO,GAAQ,EACxD,QAAWmD,KAAYD,EAAW,CAChC,KAAK,MAAM,YAAYC,CAAQ,EAC/B,QAAWxE,KAAQwE,EAAS,OAC1B,KAAK,qBACHb,EACAD,EAAa,IACb1D,EACAiB,CACF,CAEJ,CACA,KAAK,MAAM,OAAOI,EAAOH,EAAOD,CAAG,EACnCqD,EAAa,EACf,OAGA,KAAK,MAAM,OAAOjD,EAAOH,EAAOD,CAAG,EACnCqD,EAAa,GAGf,GAAIA,EACF,QAAWtE,KAAQqB,EAAM,QAErBrB,EAAK,KAAO0D,EAAa,OAAO,EAAIA,EAAa,KACjD1D,EAAK,KAAO0D,EAAa,OAAO,GAChC1D,EAAK,KAAO0D,EAAa,OAAO,GAChC1D,EAAK,KAAO0D,EAAa,OAAO,EAAIA,EAAa,MAEjD,KAAK,qBACHC,EACAD,EAAa,IACb1D,EACAiB,CACF,EAIR,CACF,CACF,CACF,CAEA,QAAWA,KAAOsC,EAChB,KAAK,MAAM,YAAYtC,CAAG,EAG5B,OAAI0C,EAAiB,KAAO,GAAK,KAAK,UACpC,KAAK,SAASA,CAAgB,EAEzB,YAAY,IAAI,EAAIL,CAC7B,CAEQ,qBACNK,EACA9C,EACAb,EACAiB,EACA,CACA,IAAMwD,EAAU7E,GAAS,KAAK,EAAGiB,EAAKb,CAAI,EAC1C,QAAW0E,KAAKD,EACVC,EAAE,MAAQzD,GAAO,KAAK,MAAM,UAAUyD,EAAE,GAAG,GAC7Cf,EAAiB,IAAIe,EAAE,OAAO,CAGpC,CAEO,IAAIrB,EAAsD,CAC/D,IAAIsB,EAAW,GACf,OAAW,CAACnB,EAAGC,CAAa,IAAKJ,EAC/B,QAAWK,KAAgBD,EACpB,KAAK,MAAM,IAAI,GAAG9C,EAAQ+C,EAAa,QAAQ,CAAC,IAAIF,CAAC,EAAE,IAC1DmB,EAAW,IAIjB,OAAIA,EACK,EAEM,KAAK,OAAOtB,CAAe,CAE5C,CACF,EA7KqBxD,EAAAmD,GAAA,WAAd,IAAM4B,GAAN5B,GA+KM6B,GAAN,MAAMA,EAAS,CAOpB,YACE3B,EACAC,EACArC,EACAsC,EACA,CACA,KAAK,SAAW,IAAI,IACpB,KAAK,QAAUF,EACf,KAAK,WAAaC,EAClB,KAAK,gBAAkBrC,EACvB,KAAK,SAAWsC,CAClB,CAEO,IAAIH,EAAWI,EAAsD,CAC1E,IAAIyB,EAAU,KAAK,SAAS,IAAI7B,CAAC,EACjC,OAAI6B,IAGJA,EAAU,IAAIF,GACZ3B,EACA,KAAK,QACL,KAAK,WACL,KAAK,gBACL,KAAK,QACP,EACA,KAAK,SAAS,IAAIA,EAAG6B,CAAO,GACrBA,EAAQ,IAAIzB,CAAe,CACpC,CAEO,SAASJ,EAAW,CACzB,IAAM6B,EAAU,KAAK,SAAS,IAAI7B,CAAC,EACnC,GAAI6B,EAAS,OAAOA,EAAQ,KAC9B,CACF,EAxCsBjF,EAAAgF,GAAA,YAAf,IAAME,GAANF,GChdA,SAASG,GACdC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACA,CACA,IAAMC,EAAQ,YAAY,IAAI,EAC9BT,EAAI,KAAK,EACTA,EAAI,WAAa,EAEjB,QAAWU,KAAQN,EAAO,CAExB,GADIM,EAAK,SAAWT,EAAIS,EAAK,SACzBA,EAAK,SAAWT,EAAIS,EAAK,QAAS,SACtC,IAAMC,EAAgBT,EAAgB,IAAIQ,EAAK,YAAc,EAAE,EAC/D,GAAKC,EACL,QAAWC,KAAgBD,EAAe,CACxC,IAAME,EAAQD,EAAa,KAAK,IAAIF,EAAK,SAAS,EAClD,GAAIG,IAAU,OAAW,SACrBH,EAAK,WAAW,QAAQA,EAAK,WAAW,OAAOV,EAAKY,EAAa,CAAC,EAEtE,IAAME,EAAKF,EAAa,OAClBG,EAAMH,EAAa,IACnBI,EAAKJ,EAAa,MAKxB,GAJAZ,EAAI,KAAK,EAILO,EAAM,CACRP,EAAI,UAAU,EACd,IAAMiB,EAAO,KAAK,IAAIH,EAAG,EAAIR,EAAO,EAAGD,EAAK,KAAOC,EAAO,CAAC,EACrDY,EAAO,KAAK,IAAIJ,EAAG,EAAIR,EAAO,EAAGD,EAAK,KAAOC,EAAO,CAAC,EACrDa,EAAO,KAAK,IAAIL,EAAG,EAAIR,EAAO,EAAIS,EAAKV,EAAK,KAAOC,EAAO,CAAC,EAC3Dc,EAAO,KAAK,IAAIN,EAAG,EAAIR,EAAO,EAAIS,EAAKV,EAAK,KAAOC,EAAO,CAAC,EACjEN,EAAI,KAAKiB,EAAMC,EAAMC,EAAOF,EAAMG,EAAOF,CAAI,EAC7ClB,EAAI,KAAK,CACX,CAEAA,EAAI,UAAUc,EAAG,EAAIR,EAAO,EAAGQ,EAAG,EAAIR,EAAO,CAAC,EAU9C,QAAWe,KAAWR,EAAO,CAC3B,IAAIS,EAAOD,EAAQ,KACbE,EAAOF,EAAQ,KAEnBE,EAAK,KAAOP,EAAKF,EAAG,EAAIT,EAAK,MAC7BkB,EAAK,KAAOP,EAAKF,EAAG,EAAIT,EAAK,MAC7BkB,EAAK,KAAOP,EAAKF,EAAG,EAAIT,EAAK,MAC7BkB,EAAK,KAAOP,EAAKF,EAAG,EAAIT,EAAK,MAI3BK,EAAK,QAAU,CAACA,EAAK,OAAOE,EAAa,EAAGS,CAAO,IACnDL,IAAO,IACTM,EAAOE,GAAcF,EAAMN,EAAI,IAAIS,EAAM,EAAG,CAAC,CAAC,GAEhDf,EAAK,WAAW,KAAKV,EAAKsB,EAAMV,EAAa,EAAGS,CAAO,EACzD,CACArB,EAAI,QAAQ,CACd,CACF,CAaA,GAXIO,IACFP,EAAI,UAAU,EACdA,EAAI,KACFK,EAAK,KAAOC,EAAO,EACnBD,EAAK,KAAOC,EAAO,EACnBD,EAAK,KAAOA,EAAK,KACjBA,EAAK,KAAOA,EAAK,IACnB,EACAL,EAAI,KAAK,GAGPG,EAAW,CACb,IAAMuB,EAAUvB,EAAU,WAAWE,EAAM,GAAQ,EACnD,QAAWsB,KAASD,EAKlB,GAJA1B,EAAI,KAAK,EACTA,EAAI,UAAU2B,EAAM,OAAO,EAAIrB,EAAO,EAAGqB,EAAM,OAAO,EAAIrB,EAAO,CAAC,EAClEqB,EAAM,KAAK3B,CAAG,EACdA,EAAI,QAAQ,EACRQ,EAAO,CACTR,EAAI,UAAY,GAChBA,EAAI,YAAcQ,EAClBR,EAAI,UAAYQ,EAChBR,EAAI,YAAc,EAClBA,EAAI,SACF2B,EAAM,OAAO,EAAIrB,EAAO,EAAI,EAC5BqB,EAAM,OAAO,EAAIrB,EAAO,EAAI,EAC5B,EACA,CACF,EACA,QAAWD,KAAQsB,EAAM,OACvB3B,EAAI,WACFK,EAAK,KAAOC,EAAO,EACnBD,EAAK,KAAOC,EAAO,EACnBD,EAAK,KAAOA,EAAK,KACjBA,EAAK,KAAOA,EAAK,IACnB,CAEJ,CAEJ,CACA,OAAAL,EAAI,QAAQ,EACL,YAAY,IAAI,EAAIS,CAC7B,CAnHgBmB,EAAA7B,GAAA,SCThB,IAAM8B,GAAI,QACJC,GAAe,cACfC,EAAWF,GAAI,KAAK,GAEpBG,GAAUC,EAACC,GAAyB,CACxC,IAAMC,EAAI,KAAK,GAAK,IACdC,EAAiB,KAAK,IAC1B,KAAK,IAAIN,GAAcI,EAAO,CAAC,EAC/B,CAACJ,EACH,EACMO,EAAM,KAAK,IAAID,EAAiBD,CAAC,EACvC,OAAO,IAAIG,EAAMT,GAAIK,EAAO,EAAIC,EAAIN,GAAI,KAAK,KAAK,EAAIQ,IAAQ,EAAIA,EAAI,EAAK,CAAC,CAC9E,EARgB,WAUVE,GAAYN,EAACO,GAAiB,CAClC,IAAML,EAAI,IAAM,KAAK,GACrB,MAAO,CACL,KAAM,EAAI,KAAK,KAAK,KAAK,IAAIK,EAAM,EAAIX,EAAC,CAAC,EAAI,KAAK,GAAK,GAAKM,EAC5D,IAAMK,EAAM,EAAIL,EAAKN,EACvB,CACF,EANkB,aAQZY,GAAmBR,EAAA,CAACS,EAAeC,IAC/BT,GAAkB,CACxB,IAAMU,EAAYZ,GAAQE,CAAM,EAKhC,OAJmB,IAAII,GACpBM,EAAU,EAAIb,IAAaA,EAAW,GACvC,GAAKa,EAAU,EAAIb,IAAaA,EAAW,EAC7C,EACkB,KAAKc,EAAA,EAAKF,GAAc,GAAG,EAAE,IAAID,CAAM,CAC3D,EARuB,oBAWnBI,GAAqBb,EAAA,CAACS,EAAeC,IACjCH,GAAiB,CACvB,IAAMO,EAAa,IAAIT,EAAME,EAAM,EAAGA,EAAM,CAAC,EAC1C,IAAIE,CAAM,EACV,IAAIG,EAAA,EAAKF,GAAc,GAAG,EACvBC,EAAY,IAAIN,EACpBS,EAAW,GAAKhB,EAAW,GAAKA,GAC/B,EAAIgB,EAAW,IAAMhB,EAAW,GAAKA,CACxC,EACA,OAAOQ,GAAUK,CAAS,CAC5B,EAVyB,sBAadI,GAAUf,EAAA,CAACgB,EAAoBC,IAA8B,CACxE,IAAMf,EAAIe,GAAa,IAAMD,GAC7B,OAAO,KAAK,KAAKd,EAAI,GAAG,CAC1B,EAHuB,WAkBVgB,GAAN,MAAMA,EAAO,CAOlB,YAAYC,EAAwB,CAClC,GAAIA,EAAQ,MAAO,CACjB,IAAMC,EAAQC,GAAOF,EAAQ,KAAK,EAClC,KAAK,WAAaG,GAAWF,CAAK,EAClC,KAAK,WAAaG,GAAWH,CAAK,EAClC,KAAK,gBAAkBA,EAAM,UAC/B,MACE,KAAK,WAAaD,EAAQ,YAAc,CAAC,EACzC,KAAK,WAAaA,EAAQ,YAAc,CAAC,EACzC,KAAK,gBAAkBA,EAAQ,gBAGjC,KAAK,MAAQK,GAAeL,CAAO,EACnC,KAAK,MAAQA,EAAQ,OAAS,EAChC,CAEM,YACJM,EACAC,EACAC,EACA1B,EACAS,EACA,QAAAkB,EAAA,sBACA,IAAMC,EAAS9B,GAAQE,CAAM,EAOvBQ,EANmB,IAAIJ,GAC1BwB,EAAO,EAAI/B,IAAaA,EAAW,GACpC,GAAK+B,EAAO,EAAI/B,IAAaA,EAAW,EAC1C,EAIG,MAAM,EACN,KAAKc,EAAA,EAAKF,GAAc,GAAG,EAC3B,IAAI,IAAIL,EAAMqB,EAAQ,EAAGC,EAAS,CAAC,CAAC,EAGjCG,EAAO,CACX,KAAMrB,EAAO,EACb,KAAMA,EAAO,EACb,KAAMA,EAAO,EAAIiB,EACjB,KAAMjB,EAAO,EAAIkB,CACnB,EAEMI,EAAW,CAAC,EAClB,OAAW,CAACC,EAAGC,CAAC,IAAK,KAAK,MAAO,CAC/B,IAAMC,EAAUD,EAAE,QAAQvB,EAAaoB,CAAI,EAC3CC,EAAS,KAAK,CAAE,IAAKC,EAAG,QAASE,CAAQ,CAAC,CAC5C,CACA,IAAMC,EAAgB,MAAM,QAAQ,IAClCJ,EAAS,IAAKK,GACLA,EAAE,QAAQ,KACdH,IACQ,CAAE,OAAQ,YAAa,MAAOA,EAAG,IAAKG,EAAE,GAAI,GAEpDC,IACQ,CAAE,OAAQ,WAAY,MAAO,CAAC,EAAG,OAAQA,EAAO,IAAKD,EAAE,GAAI,EAEtE,CACD,CACH,EAEME,EAAkB,IAAI,IAC5B,QAAWC,KAAgBJ,EACrBI,EAAa,SAAW,aAC1BD,EAAgB,IAAIC,EAAa,IAAKA,EAAa,KAAK,EAI5D,IAAMC,EAAQ,YAAY,IAAI,EACxBC,EAAU,IAAIC,GAClBhC,EACAe,EACA,KAAK,WACL,GACA,MACF,EAEMkB,EAAaF,EAAQ,IAAIH,CAAe,EAE1C,KAAK,kBACPb,EAAI,KAAK,EACTA,EAAI,UAAY,KAAK,gBACrBA,EAAI,SAAS,EAAG,EAAGC,EAAOC,CAAM,EAChCF,EAAI,QAAQ,GAGd,IAAMH,EAAa,KAAK,WAElBsB,EAAIC,GACRpB,EACAf,EACA4B,EACAG,EAAQ,MACRnB,EACAQ,EACArB,EACA,GACA,KAAK,KACP,EAEA,GAAI,KAAK,MAAO,CACdgB,EAAI,KAAK,EACTA,EAAI,UAAU,CAAChB,EAAO,EAAG,CAACA,EAAO,CAAC,EAClCgB,EAAI,YAAc,KAAK,MACvBA,EAAI,UAAY,KAAK,MACrBA,EAAI,KAAO,kBACX,IAAIqB,EAAM,EACV,OAAW,CAACd,EAAGC,CAAC,IAAKK,EAAiB,CACpC,QAAWS,KAAgBd,EAAG,CAC5BR,EAAI,WACFsB,EAAa,OAAO,EACpBA,EAAa,OAAO,EACpBA,EAAa,IACbA,EAAa,GACf,EACA,IAAMC,EAAKD,EAAa,SACxBtB,EAAI,SACF,GAAGO,GAAKA,EAAI,IAAM,IAAMgB,EAAG,CAAC,IAAIA,EAAG,CAAC,IAAIA,EAAG,CAAC,GAC5CD,EAAa,OAAO,EAAI,EACxBA,EAAa,OAAO,EAAI,IAAM,EAAID,EACpC,CACF,CACAA,GACF,CACArB,EAAI,QAAQ,CACd,CAGA,MAAO,CACL,QAAS,YAAY,IAAI,EAAIe,EAC7B,QAAShC,GAAiBC,EAAQC,CAAW,EAC7C,UAAWG,GAAmBJ,EAAQC,CAAW,CACnD,CACF,GAEM,WACJuC,EACAC,EACAC,EAEA,QAAAvB,EAAA,yBAJAwB,EACAnD,EACAS,EACAS,EAAyB,CAAC,EAC1B,CACA,IAAMkC,EAAM,OAAO,iBACb3B,EAAQ0B,EAAO,YACfzB,EAASyB,EAAO,aAChBA,EAAO,QAAU1B,EAAQ2B,GAAOD,EAAO,SAAWzB,EAAS0B,IAC/DD,EAAO,MAAQ1B,EAAQ2B,EACvBD,EAAO,OAASzB,EAAS0B,GAEvBlC,EAAQ,OAAMiC,EAAO,KAAOjC,EAAQ,MACxC,IAAMM,EAAM2B,EAAO,WAAW,IAAI,EAClC,GAAI,CAAC3B,EAAK,CACR,QAAQ,MAAM,wCAAwC,EACtD,MACF,CACA,OAAAA,EAAI,aAAa4B,EAAK,EAAG,EAAGA,EAAK,EAAG,CAAC,EAC9B,KAAK,YAAY5B,EAAKC,EAAOC,EAAQ1B,EAAQS,CAAW,CACjE,GAEM,kBACJe,EACA6B,EACAC,EACA7B,EACAC,EACA,QAAAC,EAAA,sBACA,IAAM4B,EAAeD,EAAY,EAAID,EAAQ,EACvCzB,EAAS,IAAIxB,GAChBiD,EAAQ,EAAIC,EAAY,GAAK,GAC7BD,EAAQ,EAAIC,EAAY,GAAK,CAChC,EACA,OAAO,KAAK,YACV9B,EACAC,EACAC,EACAE,EACAd,GAAQyC,EAAc9B,CAAK,CAC7B,CACF,GAEM,iBACJuB,EACAC,EACAC,EACAM,EAEA,QAAA7B,EAAA,yBALAwB,EACAE,EACAC,EACA7B,EACAP,EAAyB,CAAC,EAC1B,CACA,IAAMqC,EAAeD,EAAY,EAAID,EAAQ,EACvCzB,EAAS,IAAIxB,GAChBiD,EAAQ,EAAIC,EAAY,GAAK,GAC7BD,EAAQ,EAAIC,EAAY,GAAK,CAChC,EACA,OAAO,KAAK,WACVH,EACAvB,EACAd,GAAQyC,EAAc9B,CAAK,EAC3BP,CACF,CACF,GACF,EA7MoBnB,EAAAkB,GAAA,UAAb,IAAMwC,GAANxC,GC3DP,IAAMyC,GAAQC,EAACC,GACN,IAAI,QAAeC,GAAY,CACpC,WAAW,IAAM,CACfA,EAAQ,CACV,EAAGD,CAAQ,CACb,CAAC,EALW,SAiBRE,GAAUH,EAACI,GACRA,EAAQ,KACZC,IACQ,CAAE,OAAQ,YAAa,MAAOA,CAAE,GAExCC,IACQ,CAAE,OAAQ,WAAY,OAAQA,CAAM,EAE/C,EARc,WAgCVC,GAAeP,EAAA,CAACQ,EAA+B,CAAC,IAAM,CAC1D,IAAMC,EAAN,MAAMA,UAAqB,EAAE,SAAU,CAKrC,YAAYD,EAA+B,CAAC,EAAG,CAW7C,GAVIA,EAAQ,QAAU,CAACA,EAAQ,SAC7BA,EAAQ,OAAS,CACf,CAAC,IAAK,IAAI,EACV,CAAC,GAAI,GAAG,CACV,GACEA,EAAQ,aAAe,OACzBA,EAAQ,YACN,sHACJ,MAAMA,CAAO,EAETA,EAAQ,MAAO,CACjB,IAAME,EAAQC,GAAOH,EAAQ,KAAK,EAClC,KAAK,WAAaI,GAAWF,CAAK,EAClC,KAAK,WAAaG,GAAWH,CAAK,EAClC,KAAK,gBAAkBA,EAAM,UAC/B,MACE,KAAK,WAAaF,EAAQ,YAAc,CAAC,EACzC,KAAK,WAAaA,EAAQ,YAAc,CAAC,EACzC,KAAK,gBAAkBA,EAAQ,gBAGjC,KAAK,eAAiB,OACtB,KAAK,MAAQA,EAAQ,OAAS,CAAC,EAE/B,KAAK,MAAQM,GAAeN,CAAO,EAEnC,KAAK,MAAQA,EAAQ,MACrB,IAAMO,EAAU,SAAS,cAAc,QAAQ,EAAE,WAAW,IAAI,EAChE,KAAK,QAAUA,EACf,KAAK,mBAAsBC,GAAuB,CAChD,QAAWC,KAAKD,EACd,KAAK,aAAaC,CAAC,CAEvB,EACA,KAAK,SAAW,IAAIC,GAClB,KAAK,QACL,KAAK,WACL,GACA,KAAK,kBACP,EACA,KAAK,SAAW,IAAM,OAAO,iBAC7B,KAAK,UAAYV,EAAQ,WAAa,EACtC,KAAK,KAAOA,EAAQ,IACtB,CAEa,WACXW,EACAC,EACAC,EACAC,EAAO,IAAM,CAAC,EACd,QAAAC,EAAA,sBACA,KAAK,eAAiBJ,EAAO,EAE7B,IAAMK,EAAW,CAAC,EAClB,OAAW,CAACC,EAAGpB,CAAC,IAAK,KAAK,MAAO,CAC/B,IAAMD,EAAUC,EAAE,eAAec,CAAM,EACvCK,EAAS,KAAK,CAAE,IAAKC,EAAG,QAASrB,CAAQ,CAAC,CAC5C,CACA,IAAMsB,EAAgB,MAAM,QAAQ,IAClCF,EAAS,IAAKG,GACLA,EAAE,QAAQ,KACdtB,IACQ,CAAE,OAAQ,YAAa,MAAOA,EAAG,IAAKsB,EAAE,GAAI,GAEpDrB,IACQ,CAAE,OAAQ,WAAY,OAAQA,EAAO,IAAKqB,EAAE,GAAI,EAE3D,CACD,CACH,EAEMC,EAAkB,IAAI,IAC5B,QAAWC,KAAgBH,EACrBG,EAAa,SAAW,YAC1BD,EAAgB,IAAIC,EAAa,IAAK,CAACA,EAAa,KAAK,CAAC,EAEtDA,EAAa,OAAO,OAAS,cAG/B,QAAQ,MAAMA,EAAa,MAAM,EAWvC,GANIT,EAAQ,MAAQC,GAChB,KAAK,iBAAmBF,EAAO,IAEnC,MAAM,QAAQ,IAAI,KAAK,MAAM,IAAIhB,EAAO,CAAC,EAErCiB,EAAQ,MAAQC,IAChB,KAAK,iBAAmBF,EAAO,EAAG,OAEtC,IAAMW,EAAa,KAAK,SAAS,IAAIX,EAAO,EAAGS,CAAe,EAG9D,GADIR,EAAQ,MAAQC,GAChB,KAAK,iBAAmBF,EAAO,EAAG,OAEtC,IAAMY,EAAY,KAAK,SAAS,SAASZ,EAAO,CAAC,EAEjD,GAAI,CAAC,KAAK,KAAM,OAEhB,IAAMa,EAAS,KAAK,KAAK,UAAU,EAAE,KAAK,EACpCC,EAAc,KAAK,qBAAqBD,CAAM,EAE9CE,EADY,KAAK,qBAAqBD,CAAW,EAC1B,UAAU,EACjCE,EAAWhB,EAAO,WAAWe,CAAU,EAAI,KAAK,UAKtD,GAHA,MAAMnC,GAAMoC,CAAQ,EAEhBf,EAAQ,MAAQC,GAChB,KAAK,iBAAmBF,EAAO,EAAG,OAEtC,IAAMiB,EAAM,GACNC,EAAO,CACX,KAAM,IAAMlB,EAAO,EAAIiB,EACvB,KAAM,IAAMjB,EAAO,EAAIiB,EACvB,KAAM,KAAOjB,EAAO,EAAI,GAAKiB,EAC7B,KAAM,KAAOjB,EAAO,EAAI,GAAKiB,CAC/B,EACME,EAAS,IAAIC,EAAM,IAAMpB,EAAO,EAAG,IAAMA,EAAO,CAAC,EAEvDC,EAAQ,MAAQ,KAAK,SACrBA,EAAQ,OAAS,KAAK,SACtB,IAAMoB,EAAMpB,EAAQ,WAAW,IAAI,EACnC,GAAI,CAACoB,EAAK,CACR,QAAQ,MAAM,8BAA8B,EAC5C,MACF,CACAA,EAAI,aAAa,KAAK,SAAW,IAAK,EAAG,EAAG,KAAK,SAAW,IAAK,EAAG,CAAC,EACrEA,EAAI,UAAU,EAAG,EAAG,IAAK,GAAG,EAExB,KAAK,kBACPA,EAAI,KAAK,EACTA,EAAI,UAAY,KAAK,gBACrBA,EAAI,SAAS,EAAG,EAAG,IAAK,GAAG,EAC3BA,EAAI,QAAQ,GAGd,IAAIC,EAAe,EAEb7B,EAAa,KAAK,WAcxB,GAZA6B,EAAeC,GACbF,EACArB,EAAO,EACPS,EACA,KAAK,KAAO,KAAOG,EACnBnB,EACAyB,EACAC,EACA,GACA,KAAK,KACP,EAEI,KAAK,MAAO,CACdE,EAAI,KAAK,EACTA,EAAI,UAAY,KAAK,MACrBA,EAAI,KAAO,sBACXA,EAAI,SAAS,GAAGrB,EAAO,CAAC,IAAIA,EAAO,CAAC,IAAIA,EAAO,CAAC,GAAI,EAAG,EAAE,EAEzDqB,EAAI,KAAO,kBACX,IAAIG,EAAO,GACX,OAAW,CAAClB,EAAGpB,CAAC,IAAKuB,EAAiB,CACpC,IAAMgB,EAAKvC,EAAE,CAAC,EAAE,SAChBmC,EAAI,SAAS,GAAGf,GAAKA,EAAI,IAAM,IAAMmB,EAAG,CAAC,IAAIA,EAAG,CAAC,IAAIA,EAAG,CAAC,GAAI,EAAGD,CAAI,EACpEA,GAAQ,EACV,CAEAH,EAAI,KAAO,sBACPC,EAAe,IACjBD,EAAI,SAAS,GAAGC,EAAa,QAAQ,CAAC,YAAa,EAAGE,CAAI,EAC1DA,GAAQ,IAGNb,EAAa,GACfU,EAAI,SAAS,GAAGV,EAAW,QAAQ,CAAC,aAAc,EAAGa,CAAI,EAE3DH,EAAI,YAAc,KAAK,MAEvBA,EAAI,UAAY,GAChBA,EAAI,UAAU,EACdA,EAAI,OAAO,EAAG,CAAC,EACfA,EAAI,OAAO,EAAG,GAAG,EACjBA,EAAI,OAAO,EAEXA,EAAI,UAAY,GAChBA,EAAI,UAAU,EACdA,EAAI,OAAO,EAAG,CAAC,EACfA,EAAI,OAAO,IAAK,CAAC,EACjBA,EAAI,OAAO,EAEXA,EAAI,QAAQ,CACd,CACAlB,EAAK,CACP,GAEO,aAAaD,EAAa,CAC/B,QAAWwB,KAAc,KAAK,OAAQ,CACpC,IAAMC,EAAe,KAAK,YACxB,KAAK,iBAAiBD,CAAU,CAClC,EACIxB,IAAQ,KAAK,iBAAiByB,CAAY,GAC5C,KAAK,WAAWA,EAAc,KAAK,OAAOD,CAAU,EAAE,GAAIxB,CAAG,CAEjE,CACF,CAOO,uBACL0B,EACAC,EACAC,EAAY,GACkB,CAC9B,IAAMC,EAAuB,IAAI,IACjC,OAAW,CAACC,EAAYC,CAAI,IAAK,KAAK,MACpCF,EAAqB,IACnBC,EACAC,EAAK,cAAcL,EAAKC,EAAK,KAAK,KAAK,QAAQ,EAAGC,CAAS,CAC7D,EAEF,OAAOC,CACT,CAEO,aAAc,CACnB,KAAK,SAAW,IAAIhC,GAClB,KAAK,QACL,KAAK,WACL,GACA,KAAK,kBACP,CACF,CAEO,eAAgB,CACrB,QAAW2B,KAAc,KAAK,OAAQ,CACpC,IAAMC,EAAe,KAAK,YACxB,KAAK,iBAAiBD,CAAU,CAClC,EACMxB,EAAM,KAAK,iBAAiByB,CAAY,EAC9C,KAAK,WAAWA,EAAc,KAAK,OAAOD,CAAU,EAAE,GAAIxB,CAAG,CAC/D,CACF,CAEO,WAAWF,EAAgBkC,EAAwB,CACxD,IAAMjC,EAAU,EAAE,QAAQ,OAAO,SAAU,cAAc,EACzDA,EAAQ,KAAO,KAAK,KAEpB,IAAMC,EAAM,KAAK,iBAAiBF,CAAM,EACxC,OAAAC,EAAQ,IAAMC,EAEd,KAAK,WAAWF,EAAQC,EAASC,EAAK,IAAM,CAC1CgC,EAAS,OAAWjC,CAAO,CAC7B,CAAC,EAEMA,CACT,CAEO,YAAYC,EAAa,CAC9B,IAAMiC,EAAO,KAAK,OAAOjC,CAAG,EACvBiC,IAGLA,EAAK,GAAG,QAAU,GAClBA,EAAK,GAAG,IAAM,OACd,EAAE,QAAQ,YAAYA,EAAK,GAAI,qBAAqB,EACpDA,EAAK,GAAG,MAAQA,EAAK,GAAG,OAAS,EACjC,EAAE,QAAQ,OAAOA,EAAK,EAAE,EACxB,OAAO,KAAK,OAAOjC,CAAG,EACtB,KAAK,KAAK,aAAc,CACtB,KAAMiC,EAAK,GACX,OAAQ,KAAK,iBAAiBjC,CAAG,CACnC,CAAC,EACH,CACF,EA1RuCrB,EAAAS,EAAA,gBAAvC,IAAM8C,EAAN9C,EA2RA,OAAO,IAAI8C,EAAa/C,CAAO,CACjC,EA7RqB,gBC9DN,SAARgD,GAAyBC,EAAO,CAGnC,IAAIC,EAAO,EACPC,EAAW,EAEf,QAAWC,KAAOH,EACdC,GAAQE,EAAI,EAAIA,EAAI,EACpBD,EAAW,KAAK,IAAIA,EAAUC,EAAI,CAAC,EAIvCH,EAAM,KAAK,CAACI,EAAGC,IAAMA,EAAE,EAAID,EAAE,CAAC,EAO9B,IAAME,EAAS,CAAC,CAAC,EAAG,EAAG,EAAG,EAAG,EAHV,KAAK,IAAI,KAAK,KAAK,KAAK,KAAKL,EAAO,GAAI,CAAC,EAAGC,CAAQ,EAG3B,EAAG,GAAQ,CAAC,EAEpDK,EAAQ,EACRC,EAAS,EAEb,QAAWL,KAAOH,EAEd,QAASS,EAAIH,EAAO,OAAS,EAAGG,GAAK,EAAGA,IAAK,CACzC,IAAMC,EAAQJ,EAAOG,CAAC,EAGtB,GAAI,EAAAN,EAAI,EAAIO,EAAM,GAAKP,EAAI,EAAIO,EAAM,GAcrC,IANAP,EAAI,EAAIO,EAAM,EACdP,EAAI,EAAIO,EAAM,EAEdF,EAAS,KAAK,IAAIA,EAAQL,EAAI,EAAIA,EAAI,CAAC,EACvCI,EAAQ,KAAK,IAAIA,EAAOJ,EAAI,EAAIA,EAAI,CAAC,EAEjCA,EAAI,IAAMO,EAAM,GAAKP,EAAI,IAAMO,EAAM,EAAG,CAExC,IAAMC,EAAOL,EAAO,IAAI,EACpBG,EAAIH,EAAO,SAAQA,EAAOG,CAAC,EAAIE,EAEvC,MAAWR,EAAI,IAAMO,EAAM,GAKvBA,EAAM,GAAKP,EAAI,EACfO,EAAM,GAAKP,EAAI,GAERA,EAAI,IAAMO,EAAM,GAOvBA,EAAM,GAAKP,EAAI,EACfO,EAAM,GAAKP,EAAI,IASfG,EAAO,KAAK,CACR,EAAGI,EAAM,EAAIP,EAAI,EACjB,EAAGO,EAAM,EACT,EAAGA,EAAM,EAAIP,EAAI,EACjB,EAAGA,EAAI,CACX,CAAC,EACDO,EAAM,GAAKP,EAAI,EACfO,EAAM,GAAKP,EAAI,GAEnB,MACJ,CAGJ,MAAO,CACH,EAAGI,EACH,EAAGC,EACH,KAAOP,GAAQM,EAAQC,IAAY,CACvC,CACJ,CA5FwBI,EAAAb,GAAA,WCEjB,IAAMc,GAAOC,EAAA,CAACC,EAAcC,EAAaC,IAAmB,CACjE,IAAMC,EAAK,IAAI,SAASH,EAAM,OAAOC,CAAG,IAAK,CAAE,OAAQC,CAAO,CAAC,EAC/D,gBAAS,MAAM,IAAIC,CAAE,EACdA,EAAG,KAAK,CACjB,EAJoB,QAsBdC,GAAQL,EAAOM,GAA2CC,EAAA,wBAC9D,OAAO,IAAI,QAAQ,CAACC,EAASC,IAAW,CACtC,IAAMC,EAAM,IAAI,MAChBA,EAAI,OAAS,IAAMF,EAAQE,CAAG,EAC9BA,EAAI,QAAU,IAAMD,EAAO,aAAa,EACxCC,EAAI,IAAMJ,CACZ,CAAC,CACH,GAPc,SASRK,GAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASHC,GAAN,MAAMA,EAAM,CAMjB,YAAYN,EAAa,CACvB,KAAK,IAAMA,EACX,KAAK,OAAS,SAAS,cAAc,QAAQ,EAC7C,KAAK,QAAU,IAAI,IACnB,KAAK,WAAa,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAE,CAC7C,CAEM,MAAO,QAAAC,EAAA,sBACX,IAAID,EAAM,KAAK,IACTO,EAAQ,OAAO,iBACjBP,EAAI,SAAS,OAAO,IAEtBA,EAAM,MADI,MAAM,MAAMA,CAAG,GACX,KAAK,GAErB,IAAMQ,EAAO,IAAI,OAAO,UAAU,EAAE,gBAAgBR,EAAK,WAAW,EAC9DS,EAAQ,MAAM,KAAKD,EAAK,KAAK,QAAQ,EAErCE,EAAa,MAAMX,GACvB,6BAA6B,KAAKM,EAAO,CAAC,EAC5C,EAEMM,EAAwB,CAC5B,CACE,EAAGD,EAAW,MAAQH,EACtB,EAAGG,EAAW,OAASH,EACvB,IAAKG,EACL,GAAI,EACN,CACF,EAEME,EAAa,IAAI,cACvB,QAAWC,KAAMJ,EAAO,CAEtB,IAAMK,EAAU,6BADF,KAAKF,EAAW,kBAAkBC,CAAE,CAAC,CACD,GAC5CT,EAAM,MAAML,GAAMe,CAAO,EAC/BH,EAAM,KAAK,CACT,EAAGP,EAAI,MAAQG,EACf,EAAGH,EAAI,OAASG,EAChB,IAAKH,EACL,GAAIS,EAAG,EACT,CAAC,CACH,CAEA,IAAME,EAAaC,GAAQL,CAAK,EAChC,KAAK,OAAO,MAAQI,EAAW,EAC/B,KAAK,OAAO,OAASA,EAAW,EAChC,IAAME,EAAM,KAAK,OAAO,WAAW,IAAI,EACvC,GAAIA,EACF,QAAWC,KAAOP,EACZO,EAAI,IAAM,QAAaA,EAAI,IAAM,SACnCD,EAAI,UAAUC,EAAI,IAAKA,EAAI,EAAGA,EAAI,EAAGA,EAAI,EAAGA,EAAI,CAAC,EAC7CA,EAAI,GACN,KAAK,QAAQ,IAAIA,EAAI,GAAI,CACvB,EAAGA,EAAI,EACP,EAAGA,EAAI,EACP,EAAGA,EAAI,EACP,EAAGA,EAAI,CACT,CAAC,EACE,KAAK,WAAa,CAAE,EAAGA,EAAI,EAAG,EAAGA,EAAI,EAAG,EAAGA,EAAI,EAAG,EAAGA,EAAI,CAAE,GAItE,OAAO,IACT,GAEA,IAAIvB,EAAsB,CACxB,IAAIwB,EAAS,KAAK,QAAQ,IAAIxB,CAAI,EAClC,OAAKwB,IAAQA,EAAS,KAAK,YACpBA,CACT,CACF,EA5EmBzB,EAAAY,GAAA,SAAZ,IAAMc,GAANd","names":["src_exports","__export","CenteredSymbolizer","CenteredTextSymbolizer","CircleSymbolizer","FlexSymbolizer","Font","GeomType","GroupSymbolizer","IconSymbolizer","Index","Justify","Labeler","Labelers","LineLabelPlacement","LineLabelSymbolizer","LineSymbolizer","OffsetSymbolizer","OffsetTextSymbolizer","Padding","PmtilesSource","PolygonSymbolizer","Sheet","ShieldSymbolizer","Static","TextPlacements","TextSymbolizer","TileCache","View","ZxySource","arr","covering","createPattern","exp","getZoom","isCcw","isInRing","labelRules","leafletLayer","linear","paint","paintRules","pointInPolygon","pointMinDistToLines","pointMinDistToPoints","sourcesToViews","step","toIndex","transformGeom","wrap","Point","x","y","__name","p","k","a","m","other","dx","dy","b","angle","cos","sin","guard","low","high","value","Math","min","max","ColorError","Error","constructor","color","__name","_ColorError","ColorError$1","parseToRgba","trim","toLowerCase","normalizedColor","namedColorRegex","test","nameToHex","reducedHexMatch","reducedHexRegex","exec","arr","Array","from","slice","map","x","parseInt","r","hexMatch","hexRegex","rgbaMatch","rgbaRegex","parseFloat","hslaMatch","hslaRegex","h","s","l","a","hslToRgb","Number","isNaN","hash","str","i","length","charCodeAt","colorToInt","replace","compressedColorMap","split","reduce","acc","next","key","substring","hex","toString","prefix","normalizedColorName","result","amount","join","RegExp","roundColor","round","hue","saturation","lightness","huePrime","chroma","abs","secondComponent","red","green","blue","lightnessModification","finalRed","finalGreen","finalBlue","rgba","red","green","blue","alpha","guard","toFixed","parseFloat","mix","color1","color2","weight","normalize","n","index","r1","g1","b1","a1","parseToRgba","map","r2","g2","b2","a2","alphaDelta","normalizedWeight","weight2","weight1","r","g","b","a","_StringAttr","c","defaultValue","z","f","__name","StringAttr","_NumberAttr","NumberAttr","_TextAttr","options","_a","retval","labelProps","property","transform","word","TextAttr","_FontAttr","_b","style","weight","size","family","FontAttr","_ArrayAttr","ArrayAttr","linelabel","__name","pts","maxAngleDelta","targetLen","chunks","a","b","c","i","n","d","abmag","bcmag","abx","aby","bcx","bcy","dt","iStart","dStart","__pow","simpleLabel","mls","minimum","repeatDistance","cellSize","candidates","ls","segments","segment","start","Point","end","normalized","lineCells","length","spacing","dx","dy","dist","retval","factor","linebreak","str","maxUnits","endIndex","spaceBefore","spaceAfter","first","after","__name","CJK_CHARS","cjkTest","_VectorTileFeature","pbf","end","extent","keys","values","readFeature","lines","line","cmd","length","x","y","cmdLen","Point","x1","x2","y1","y2","z","size","x0","y0","vtCoords","projectPoint","p","__name","projectLine","geometry","points","coordinates","polygons","classifyRings","polygon","result","VectorTileFeature","tag","feature","readTag","key","value","rings","len","ccw","i","area","signedArea","ring","sum","j","p1","p2","_VectorTileLayer","readLayer","VectorTileLayer","layer","readValueMessage","_VectorTile","readTile","VectorTile","layers","SHIFT_RIGHT_32","TEXT_DECODER_MIN_LENGTH","utf8TextDecoder","PBF_VARINT","PBF_FIXED64","PBF_BYTES","PBF_FIXED32","_Pbf","buf","readField","result","end","val","tag","startPos","isSigned","b","readVarintRemainder","num","pos","readUtf8","buffer","arr","type","min","length","writeBigVarint","str","writeUtf8","len","makeRoomForExtraLength","i","fn","obj","writePackedVarint","writePackedSVarint","writePackedBoolean","writePackedFloat","writePackedDouble","writePackedFixed32","writePackedSFixed32","writePackedFixed64","writePackedSFixed64","__name","Pbf","l","s","p","h","toNum","low","high","pbf","writeBigVarintLow","writeBigVarintHigh","lsb","extraLen","b0","c","bytesPerSequence","b1","b2","b3","lead","__pow","__async","__name","__this","__arguments","generator","resolve","reject","fulfilled","value","step","e","rejected","x","u8","u16","i32","fleb","fdeb","clim","freb","eb","start","b","i","j","_a","fl","revfl","_b","fd","revfd","rev","hMap","cd","mb","r","s","l","le","co","rvb","sv","r_1","v","m","flt","fdt","flrm","fdrm","max","a","bits","d","p","o","bits16","shft","slc","ec","err","ind","msg","nt","inflt","dat","st","buf","dict","sl","dl","noBuf","noSt","cbuf","l2","bl","nbuf","final","pos","bt","lm","dm","lbt","dbt","tbts","type","hLit","hcLen","tl","ldt","clt","clb","clbmsk","clm","c","n","lt","dt","t","lms","dms","lpos","sym","add","dsym","end","shift2","dend","et","gzs","flg","zs","gzl","zls","inflateSync","data","opts","gunzipSync","unzlibSync","decompressSync","td","tds","shift","unshift","getUint24","view","getUint48","compare","tz","tx","ty","y","queryLeafdir","z","offsetLen","queryView","queryTile","k","cmp","entrySort","parseEntry","dataview","zRaw","sortDir","entries","createDirectory","buffer","arr","entry","deriveLeaf","tile","numEntries","leafLevel","levelDiff","leafX","leafY","getHeader","source","resp","jsonSize","rootEntries","dec","jsonMetadata","tileCompression","minzoom","maxzoom","centerLon","centerLat","centerZoom","minLon","minLat","maxLon","maxLat","split","getZxy","header","cache","signal","rootDir","tileData","leafcoords","leafdirEntry","leafDir","tileEntry","v2_default","toNum","low","high","__name","readVarintRemainder","l","p","buf","b","h","readVarint","val","rotate","n","xy","rx","ry","t","tzValues","zxyToTileId","z","x","y","__pow","acc","n","rx","ry","d","xy","s","rotate","__name","defaultDecompress","buf","compression","__async","decompressSync","stream","result","__name","HEADER_SIZE_BYTES","findTile","entries","tileId","m","k","cmp","__name","_a","FetchSource","url","customHeaders","offset","length","passedSignal","etag","__async","controller","signal","requestHeaders","cache","resp","contentRange","actualLength","newEtag","EtagMismatch","contentLength","__name","getUint64","v","wh","wl","__pow","bytesToHeader","bytes","specVersion","deserializeIndex","buffer","p","numEntries","readVarint","entries","lastId","i","detectVersion","a","getHeaderAndRoot","source","decompress","v2_default","headerData","HEADER_SIZE_BYTES","header","rootDirData","dirKey","rootDir","getDirectory","data","directory","_a","SharedPromiseCache","maxCacheEntries","prefetch","decompress","defaultDecompress","source","__async","cacheKey","cacheValue","p","resolve","reject","getHeaderAndRoot","res","e","offset","length","header","getDirectory","directory","resp","minUsed","minKey","key","h","__name","PMTiles","cache","FetchSource","z","x","y","signal","tileId","zxyToTileId","v2_default","dO","dL","depth","entry","findTile","EtagMismatch","decompressed","dec","GeomType","toIndex","c","__name","loadGeomAndBbox","pbf","geometry","scale","end","cmd","length","x","y","x1","x2","y1","y2","lines","line","cmdLen","Point","parseTile","buffer","tileSize","v","VectorTile","Pbf","result","key","value","features","layer","i","loaded","numVertices","part","_PmtilesSource","url","shouldCancelZooms","PMTiles","__async","za","controller","signal","PmtilesSource","_ZxySource","resolve","reject","resp","e","ZxySource","R","MAX_LATITUDE","MAXCOORD","project","latlng","d","constrainedLat","sin","sqr","dist2","w","distToSegmentSquared","p","l2","t","isInRing","point","ring","inside","j","xi","yi","xj","yj","isCcw","area","pointInPolygon","geom","isInCurrentExterior","pointMinDistToPoints","min","l","dist","pointMinDistToLines","_TileCache","source","idx","entry","ifentry","tile","ifentry2","minUsed","minKey","lng","lat","zoom","brushSize","projected","normalized","onZoom","tileX","tileY","retval","center","layerName","layerArr","feature","TileCache","Justify","TextPlacements","createPattern","__name","width","height","fn","canvas","ctx","_PolygonSymbolizer","options","_a","StringAttr","NumberAttr","z","patten","geom","f","doStroke","drawPath","poly","p","pt","PolygonSymbolizer","arr","base","a","b","getStopIndex","input","stops","idx","interpolate","factor","start","end","computeInterpolationFactor","difference","progress","__pow","exp","step","output0","retval","i","linear","_LineSymbolizer","ArrayAttr","strokePath","ls","LineSymbolizer","_IconSymbolizer","layout","feature","Point","loc","bbox","IconSymbolizer","_CircleSymbolizer","radius","CircleSymbolizer","_ShieldSymbolizer","FontAttr","TextAttr","property","font","metrics","ascent","descent","ShieldSymbolizer","_FlexSymbolizer","list","labels","label","anchor","draws","newGeom","mergeBbox","sub","FlexSymbolizer","b1","b2","_GroupSymbolizer","first","GroupSymbolizer","_CenteredSymbolizer","symbolizer","placed","firstLabel","centered","CenteredSymbolizer","_Padding","padding","Padding","_TextSymbolizer","letterSpacing","lines","linebreak","longestLine","longestLineLen","line","lineHeight","extra","textStrokeWidth","y","startX","xPos","letter","TextSymbolizer","_CenteredTextSymbolizer","CenteredTextSymbolizer","_OffsetSymbolizer","_b","_c","fb","offsetXvalue","offsetYvalue","justifyValue","placements","ddOffsetX","ddOffsetY","ddJustify","ddPlacements","offsetX","offsetY","getBbox","o","origin","justify","draw","placeLabelInPoint","placement","xAxisOffset","yAxisOffset","labelWidth","labelHalfWidth","labelHalfHeight","labelBottom","labelCenterHeight","fixedJustify","OffsetSymbolizer","_OffsetTextSymbolizer","OffsetTextSymbolizer","LineLabelPlacement","_LineLabelSymbolizer","name","minLabelableDim","fbbox","repeatDistance","cellSize","labelCandidates","simpleLabel","candidate","dx","dy","bboxes","lineCells","c","heightPlacement","lineWidth","LineLabelSymbolizer","getString","__name","props","key","val","getNumber","paintRules","t","PolygonSymbolizer","z","f","mix","kind","LineSymbolizer","exp","minAdminLevel","labelRules","nametags","LineLabelSymbolizer","CenteredTextSymbolizer","linear","minZoom","weight","size","popRank","a","b","aRank","bRank","GroupSymbolizer","CircleSymbolizer","OffsetTextSymbolizer","LIGHT","DARK","WHITE","GRAYSCALE","BLACK","SHOW","themes","quickselect","arr","k","left","right","compare","quickselectStep","defaultCompare","__name","n","m","z","s","sd","newLeft","newRight","t","i","j","swap","tmp","a","b","_RBush","maxEntries","bbox","node","result","intersects","toBBox","nodesToSearch","i","child","childBBox","contains","data","tmpNode","item","createNode","equalsFn","path","indexes","parent","goingUp","index","findItem","a","b","items","left","right","height","N","M","calcBBox","N2","N1","multiSelect","right2","j","right3","level","minArea","minEnlargement","targetNode","area","bboxArea","enlargement","enlargedArea","isNode","insertPath","extend","m","splitIndex","newNode","minOverlap","bbox1","distBBox","bbox2","overlap","intersectionArea","compareMinX","compareNodeMinX","compareMinY","compareNodeMinY","xMargin","yMargin","compare","leftBBox","rightBBox","margin","bboxMargin","siblings","__name","RBush","k","p","destNode","minX","minY","maxX","maxY","children","arr","stack","mid","quickselect","transformGeom","__name","geom","scale","translate","retval","arr","loop","coord","wrap","val","z","dim","_View","tileCache","maxDataLevel","levelDiff","displayZoom","bounds","fractional","__pow","needed","Point","f","basetileSize","dataZoom","mintileX","mintileY","maxtileX","maxtileY","tx","ty","origin","displayTile","dataTile","__async","tt","data","i","lng","lat","brushSize","roundedZoom","brushSizeAtZoom","View","sourcesToViews","options","sourceToViews","o","maxDataZoom","source","PmtilesSource","ZxySource","cache","TileCache","sources","key","covering","__name","displayZoom","tileWidth","bbox","f","minx","miny","maxx","maxy","leveldiff","retval","x","wrappedX","y","toIndex","_Index","dim","maxLabeledTiles","RBush","tileKey","key","order","labels","match","label","dist","testBbox","collision","newSet","indexedLabel","entry","wrapsLeft","wrapsRight","shift","newBboxes","duplicateLabel","Point","keyAdded","added","maxKey","maxDist","keysForDs","existingKey","existing","__pow","keyToRemove","indexedLabels","entriesToDelete","labelToRemove","c","Index","_Labeler","z","scratch","labelRules","callback","preparedTilemap","start","keysAdding","k","preparedTiles","preparedTile","tilesInvalidated","rule","dsName","layer","feats","a","b","layout","feature","transformed","transformGeom","labelAdded","conflicts","conflict","touched","s","allAdded","Labeler","_Labelers","labeler","Labelers","paint","ctx","z","preparedTilemap","labelData","rules","bbox","origin","clip","debug","start","rule","preparedTiles","preparedTile","layer","po","dim","ps","minX","minY","maxX","maxY","feature","geom","fbox","transformGeom","Point","matches","label","__name","R","MAX_LATITUDE","MAXCOORD","project","__name","latlng","d","constrainedLat","sin","Point","unproject","point","instancedProject","origin","displayZoom","projected","__pow","instancedUnproject","normalized","getZoom","degreesLng","cssPixels","_Static","options","theme","themes","paintRules","labelRules","sourcesToViews","ctx","width","height","__async","center","bbox","promises","k","v","promise","tileResponses","o","error","preparedTilemap","tileResponse","start","labeler","Labeler","layoutTime","p","paint","idx","preparedTile","dt","_0","_1","_2","canvas","dpr","topLeft","bottomRight","deltaDegrees","_3","Static","timer","__name","duration","resolve","reflect","promise","v","error","leafletLayer","options","_LeafletLayer","theme","themes","paintRules","labelRules","sourcesToViews","scratch","tiles","t","Labelers","coords","element","key","done","__async","promises","k","tileResponses","o","preparedTilemap","tileResponse","layoutTime","labelData","center","pixelBounds","tileCenter","priority","buf","bbox","origin","Point","ctx","paintingTime","paint","ypos","dt","unwrappedK","wrappedCoord","lng","lat","brushSize","featuresBySourceName","sourceName","view","showTile","tile","LeafletLayer","potpack","boxes","area","maxWidth","box","a","b","spaces","width","height","i","space","last","__name","Font","__name","name","url","weight","ff","mkimg","src","__async","resolve","reject","img","MISSING","_Sheet","scale","tree","icons","missingImg","boxes","serializer","ps","image64","packresult","potpack","ctx","box","result","Sheet"]}